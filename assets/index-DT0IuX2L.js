var e=Object.defineProperty;import{g as t,p as s,P as i}from"./phaser-DCd8Ppya.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var a={exports:{}},n={},r={exports:{}},o={},l=Symbol.for("react.element"),h=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),b=Symbol.iterator,w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,x={};function S(e,t,s){this.props=e,this.context=t,this.refs=x,this.updater=s||w}function C(){}function E(e,t,s){this.props=e,this.context=t,this.refs=x,this.updater=s||w}S.prototype.isReactComponent={},S.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},S.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},C.prototype=S.prototype;var k=E.prototype=new C;k.constructor=E,M(k,S.prototype),k.isPureReactComponent=!0;var T=Array.isArray,P=Object.prototype.hasOwnProperty,D={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,s){var i,a={},n=null,r=null;if(null!=t)for(i in void 0!==t.ref&&(r=t.ref),void 0!==t.key&&(n=""+t.key),t)P.call(t,i)&&!_.hasOwnProperty(i)&&(a[i]=t[i]);var o=arguments.length-2;if(1===o)a.children=s;else if(1<o){for(var h=Array(o),c=0;c<o;c++)h[c]=arguments[c+2];a.children=h}if(e&&e.defaultProps)for(i in o=e.defaultProps)void 0===a[i]&&(a[i]=o[i]);return{$$typeof:l,type:e,key:n,ref:r,props:a,_owner:D.current}}function R(e){return"object"==typeof e&&null!==e&&e.$$typeof===l}var O=/\/+/g;function B(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,s,i,a){var n=typeof e;"undefined"!==n&&"boolean"!==n||(e=null);var r=!1;if(null===e)r=!0;else switch(n){case"string":case"number":r=!0;break;case"object":switch(e.$$typeof){case l:case h:r=!0}}if(r)return a=a(r=e),e=""===i?"."+B(r,0):i,T(a)?(s="",null!=e&&(s=e.replace(O,"$&/")+"/"),I(a,t,s,"",(function(e){return e}))):null!=a&&(R(a)&&(a=function(e,t){return{$$typeof:l,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||r&&r.key===a.key?"":(""+a.key).replace(O,"$&/")+"/")+e)),t.push(a)),1;if(r=0,i=""===i?".":i+":",T(e))for(var o=0;o<e.length;o++){var c=i+B(n=e[o],o);r+=I(n,t,s,c,a)}else if(c=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=b&&e[b]||e["@@iterator"])?e:null}(e),"function"==typeof c)for(e=c.call(e),o=0;!(n=e.next()).done;)r+=I(n=n.value,t,s,c=i+B(n,o++),a);else if("object"===n)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return r}function L(e,t,s){if(null==e)return e;var i=[],a=0;return I(e,i,"","",(function(e){return t.call(s,e,a++)})),i}function F(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N={current:null},W={transition:null},U={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:W,ReactCurrentOwner:D};function z(){throw Error("act(...) is not supported in production builds of React.")}o.Children={map:L,forEach:function(e,t,s){L(e,(function(){t.apply(this,arguments)}),s)},count:function(e){var t=0;return L(e,(function(){t++})),t},toArray:function(e){return L(e,(function(e){return e}))||[]},only:function(e){if(!R(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},o.Component=S,o.Fragment=c,o.Profiler=d,o.PureComponent=E,o.StrictMode=u,o.Suspense=g,o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U,o.act=z,o.cloneElement=function(e,t,s){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=M({},e.props),a=e.key,n=e.ref,r=e._owner;if(null!=t){if(void 0!==t.ref&&(n=t.ref,r=D.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(h in t)P.call(t,h)&&!_.hasOwnProperty(h)&&(i[h]=void 0===t[h]&&void 0!==o?o[h]:t[h])}var h=arguments.length-2;if(1===h)i.children=s;else if(1<h){o=Array(h);for(var c=0;c<h;c++)o[c]=arguments[c+2];i.children=o}return{$$typeof:l,type:e.type,key:a,ref:n,props:i,_owner:r}},o.createContext=function(e){return(e={$$typeof:f,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:p,_context:e},e.Consumer=e},o.createElement=A,o.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},o.createRef=function(){return{current:null}},o.forwardRef=function(e){return{$$typeof:m,render:e}},o.isValidElement=R,o.lazy=function(e){return{$$typeof:v,_payload:{_status:-1,_result:e},_init:F}},o.memo=function(e,t){return{$$typeof:y,type:e,compare:void 0===t?null:t}},o.startTransition=function(e){var t=W.transition;W.transition={};try{e()}finally{W.transition=t}},o.unstable_act=z,o.useCallback=function(e,t){return N.current.useCallback(e,t)},o.useContext=function(e){return N.current.useContext(e)},o.useDebugValue=function(){},o.useDeferredValue=function(e){return N.current.useDeferredValue(e)},o.useEffect=function(e,t){return N.current.useEffect(e,t)},o.useId=function(){return N.current.useId()},o.useImperativeHandle=function(e,t,s){return N.current.useImperativeHandle(e,t,s)},o.useInsertionEffect=function(e,t){return N.current.useInsertionEffect(e,t)},o.useLayoutEffect=function(e,t){return N.current.useLayoutEffect(e,t)},o.useMemo=function(e,t){return N.current.useMemo(e,t)},o.useReducer=function(e,t,s){return N.current.useReducer(e,t,s)},o.useRef=function(e){return N.current.useRef(e)},o.useState=function(e){return N.current.useState(e)},o.useSyncExternalStore=function(e,t,s){return N.current.useSyncExternalStore(e,t,s)},o.useTransition=function(){return N.current.useTransition()},o.version="18.3.1",r.exports=o;var V=r.exports;const H=t(V);var $=V,j=Symbol.for("react.element"),G=Symbol.for("react.fragment"),K=Object.prototype.hasOwnProperty,Y=$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,X={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,s){var i,a={},n=null,r=null;for(i in void 0!==s&&(n=""+s),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(r=t.ref),t)K.call(t,i)&&!X.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===a[i]&&(a[i]=t[i]);return{$$typeof:j,type:e,key:n,ref:r,props:a,_owner:Y.current}}n.Fragment=G,n.jsx=q,n.jsxs=q,a.exports=n;var Q=a.exports,J={},Z={exports:{}},ee={},te={exports:{}},se={};!function(e){function t(e,t){var s=e.length;e.push(t);e:for(;0<s;){var i=s-1>>>1,n=e[i];if(!(0<a(n,t)))break e;e[i]=t,e[s]=n,s=i}}function s(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],s=e.pop();if(s!==t){e[0]=s;e:for(var i=0,n=e.length,r=n>>>1;i<r;){var o=2*(i+1)-1,l=e[o],h=o+1,c=e[h];if(0>a(l,s))h<n&&0>a(c,l)?(e[i]=c,e[h]=s,i=h):(e[i]=l,e[o]=s,i=o);else{if(!(h<n&&0>a(c,s)))break e;e[i]=c,e[h]=s,i=h}}}return t}function a(e,t){var s=e.sortIndex-t.sortIndex;return 0!==s?s:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var n=performance;e.unstable_now=function(){return n.now()}}else{var r=Date,o=r.now();e.unstable_now=function(){return r.now()-o}}var l=[],h=[],c=1,u=null,d=3,p=!1,f=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var a=s(h);null!==a;){if(null===a.callback)i(h);else{if(!(a.startTime<=e))break;i(h),a.sortIndex=a.expirationTime,t(l,a)}a=s(h)}}function w(e){if(m=!1,b(e),!f)if(null!==s(l))f=!0,R(M);else{var t=s(h);null!==t&&O(w,t.startTime-e)}}function M(t,a){f=!1,m&&(m=!1,y(E),E=-1),p=!0;var n=d;try{for(b(a),u=s(l);null!==u&&(!(u.expirationTime>a)||t&&!P());){var r=u.callback;if("function"==typeof r){u.callback=null,d=u.priorityLevel;var o=r(u.expirationTime<=a);a=e.unstable_now(),"function"==typeof o?u.callback=o:u===s(l)&&i(l),b(a)}else i(l);u=s(l)}if(null!==u)var c=!0;else{var g=s(h);null!==g&&O(w,g.startTime-a),c=!1}return c}finally{u=null,d=n,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x,S=!1,C=null,E=-1,k=5,T=-1;function P(){return!(e.unstable_now()-T<k)}function D(){if(null!==C){var t=e.unstable_now();T=t;var s=!0;try{s=C(!0,t)}finally{s?x():(S=!1,C=null)}}else S=!1}if("function"==typeof v)x=function(){v(D)};else if("undefined"!=typeof MessageChannel){var _=new MessageChannel,A=_.port2;_.port1.onmessage=D,x=function(){A.postMessage(null)}}else x=function(){g(D,0)};function R(e){C=e,S||(S=!0,x())}function O(t,s){E=g((function(){t(e.unstable_now())}),s)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,R(M))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return s(l)},e.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var s=d;d=t;try{return e()}finally{d=s}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var s=d;d=e;try{return t()}finally{d=s}},e.unstable_scheduleCallback=function(i,a,n){var r=e.unstable_now();switch(n="object"==typeof n&&null!==n&&"number"==typeof(n=n.delay)&&0<n?r+n:r,i){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return i={id:c++,callback:a,priorityLevel:i,startTime:n,expirationTime:o=n+o,sortIndex:-1},n>r?(i.sortIndex=n,t(h,i),null===s(l)&&i===s(h)&&(m?(y(E),E=-1):m=!0,O(w,n-r))):(i.sortIndex=o,t(l,i),f||p||(f=!0,R(M))),i},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(e){var t=d;return function(){var s=d;d=t;try{return e.apply(this,arguments)}finally{d=s}}}}(se),te.exports=se;var ie=te.exports,ae=V,ne=ie;function re(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oe=new Set,le={};function he(e,t){ce(e,t),ce(e+"Capture",t)}function ce(e,t){for(le[e]=t,e=0;e<t.length;e++)oe.add(t[e])}var ue=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),de=Object.prototype.hasOwnProperty,pe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fe={},me={};function ge(e,t,s,i,a,n,r){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=n,this.removeEmptyString=r}var ye={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){ye[e]=new ge(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];ye[t]=new ge(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){ye[e]=new ge(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){ye[e]=new ge(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){ye[e]=new ge(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){ye[e]=new ge(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){ye[e]=new ge(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){ye[e]=new ge(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){ye[e]=new ge(e,5,!1,e.toLowerCase(),null,!1,!1)}));var ve=/[\-:]([a-z])/g;function be(e){return e[1].toUpperCase()}function we(e,t,s,i){var a=ye.hasOwnProperty(t)?ye[t]:null;(null!==a?0!==a.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,s,i){if(null==t||function(e,t,s,i){if(null!==s&&0===s.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==s?!s.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,s,i))return!0;if(i)return!1;if(null!==s)switch(s.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,s,a,i)&&(s=null),i||null===a?function(e){return!!de.call(me,e)||!de.call(fe,e)&&(pe.test(e)?me[e]=!0:(fe[e]=!0,!1))}(t)&&(null===s?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=null===s?3!==a.type&&"":s:(t=a.attributeName,i=a.attributeNamespace,null===s?e.removeAttribute(t):(s=3===(a=a.type)||4===a&&!0===s?"":""+s,i?e.setAttributeNS(i,t,s):e.setAttribute(t,s))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(ve,be);ye[t]=new ge(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(ve,be);ye[t]=new ge(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(ve,be);ye[t]=new ge(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){ye[e]=new ge(e,1,!1,e.toLowerCase(),null,!1,!1)})),ye.xlinkHref=new ge("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){ye[e]=new ge(e,1,!1,e.toLowerCase(),null,!0,!0)}));var Me=ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xe=Symbol.for("react.element"),Se=Symbol.for("react.portal"),Ce=Symbol.for("react.fragment"),Ee=Symbol.for("react.strict_mode"),ke=Symbol.for("react.profiler"),Te=Symbol.for("react.provider"),Pe=Symbol.for("react.context"),De=Symbol.for("react.forward_ref"),_e=Symbol.for("react.suspense"),Ae=Symbol.for("react.suspense_list"),Re=Symbol.for("react.memo"),Oe=Symbol.for("react.lazy"),Be=Symbol.for("react.offscreen"),Ie=Symbol.iterator;function Le(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=Ie&&e[Ie]||e["@@iterator"])?e:null}var Fe,Ne=Object.assign;function We(e){if(void 0===Fe)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);Fe=t&&t[1]||""}return"\n"+Fe+e}var Ue=!1;function ze(e,t){if(!e||Ue)return"";Ue=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(h){var i=h}Reflect.construct(e,[],t)}else{try{t.call()}catch(h){i=h}e.call(t.prototype)}else{try{throw Error()}catch(h){i=h}e()}}catch(h){if(h&&i&&"string"==typeof h.stack){for(var a=h.stack.split("\n"),n=i.stack.split("\n"),r=a.length-1,o=n.length-1;1<=r&&0<=o&&a[r]!==n[o];)o--;for(;1<=r&&0<=o;r--,o--)if(a[r]!==n[o]){if(1!==r||1!==o)do{if(r--,0>--o||a[r]!==n[o]){var l="\n"+a[r].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=r&&0<=o);break}}}finally{Ue=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?We(e):""}function Ve(e){switch(e.tag){case 5:return We(e.type);case 16:return We("Lazy");case 13:return We("Suspense");case 19:return We("SuspenseList");case 0:case 2:case 15:return ze(e.type,!1);case 11:return ze(e.type.render,!1);case 1:return ze(e.type,!0);default:return""}}function He(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case Ce:return"Fragment";case Se:return"Portal";case ke:return"Profiler";case Ee:return"StrictMode";case _e:return"Suspense";case Ae:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case Pe:return(e.displayName||"Context")+".Consumer";case Te:return(e._context.displayName||"Context")+".Provider";case De:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case Re:return null!==(t=e.displayName||null)?t:He(e.type)||"Memo";case Oe:t=e._payload,e=e._init;try{return He(e(t))}catch(s){}}return null}function $e(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return He(t);case 8:return t===Ee?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function je(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Ge(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Ke(e){e._valueTracker||(e._valueTracker=function(e){var t=Ge(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==s&&"function"==typeof s.get&&"function"==typeof s.set){var a=s.get,n=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){i=""+e,n.call(this,e)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Ye(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),i="";return e&&(i=Ge(e)?e.checked?"true":"false":e.value),(e=i)!==s&&(t.setValue(e),!0)}function Xe(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function qe(e,t){var s=t.checked;return Ne({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=s?s:e._wrapperState.initialChecked})}function Qe(e,t){var s=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;s=je(null!=t.value?t.value:s),e._wrapperState={initialChecked:i,initialValue:s,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Je(e,t){null!=(t=t.checked)&&we(e,"checked",t,!1)}function Ze(e,t){Je(e,t);var s=je(t.value),i=t.type;if(null!=s)"number"===i?(0===s&&""===e.value||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?tt(e,t.type,s):t.hasOwnProperty("defaultValue")&&tt(e,t.type,je(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function et(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}""!==(s=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==s&&(e.name=s)}function tt(e,t,s){"number"===t&&Xe(e.ownerDocument)===e||(null==s?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var st=Array.isArray;function it(e,t,s,i){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&i&&(e[s].defaultSelected=!0)}else{for(s=""+je(s),t=null,a=0;a<e.length;a++){if(e[a].value===s)return e[a].selected=!0,void(i&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function at(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(re(91));return Ne({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function nt(e,t){var s=t.value;if(null==s){if(s=t.children,t=t.defaultValue,null!=s){if(null!=t)throw Error(re(92));if(st(s)){if(1<s.length)throw Error(re(93));s=s[0]}t=s}null==t&&(t=""),s=t}e._wrapperState={initialValue:je(s)}}function rt(e,t){var s=je(t.value),i=je(t.defaultValue);null!=s&&((s=""+s)!==e.value&&(e.value=s),null==t.defaultValue&&e.defaultValue!==s&&(e.defaultValue=s)),null!=i&&(e.defaultValue=""+i)}function ot(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function lt(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ht(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?lt(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ct,ut,dt=(ut=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ct=ct||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ct.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,s,i){MSApp.execUnsafeLocalFunction((function(){return ut(e,t)}))}:ut);function pt(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&3===s.nodeType)return void(s.nodeValue=t)}e.textContent=t}var ft={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},mt=["Webkit","ms","Moz","O"];function gt(e,t,s){return null==t||"boolean"==typeof t||""===t?"":s||"number"!=typeof t||0===t||ft.hasOwnProperty(e)&&ft[e]?(""+t).trim():t+"px"}function yt(e,t){for(var s in e=e.style,t)if(t.hasOwnProperty(s)){var i=0===s.indexOf("--"),a=gt(s,t[s],i);"float"===s&&(s="cssFloat"),i?e.setProperty(s,a):e[s]=a}}Object.keys(ft).forEach((function(e){mt.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ft[t]=ft[e]}))}));var vt=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bt(e,t){if(t){if(vt[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(re(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(re(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(re(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(re(62))}}function wt(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mt=null;function xt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var St=null,Ct=null,Et=null;function kt(e){if(e=wn(e)){if("function"!=typeof St)throw Error(re(280));var t=e.stateNode;t&&(t=xn(t),St(e.stateNode,e.type,t))}}function Tt(e){Ct?Et?Et.push(e):Et=[e]:Ct=e}function Pt(){if(Ct){var e=Ct,t=Et;if(Et=Ct=null,kt(e),t)for(e=0;e<t.length;e++)kt(t[e])}}function Dt(e,t){return e(t)}function _t(){}var At=!1;function Rt(e,t,s){if(At)return e(t,s);At=!0;try{return Dt(e,t,s)}finally{At=!1,(null!==Ct||null!==Et)&&(_t(),Pt())}}function Ot(e,t){var s=e.stateNode;if(null===s)return null;var i=xn(s);if(null===i)return null;s=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(s&&"function"!=typeof s)throw Error(re(231,t,typeof s));return s}var Bt=!1;if(ue)try{var It={};Object.defineProperty(It,"passive",{get:function(){Bt=!0}}),window.addEventListener("test",It,It),window.removeEventListener("test",It,It)}catch(ut){Bt=!1}function Lt(e,t,s,i,a,n,r,o,l){var h=Array.prototype.slice.call(arguments,3);try{t.apply(s,h)}catch(c){this.onError(c)}}var Ft=!1,Nt=null,Wt=!1,Ut=null,zt={onError:function(e){Ft=!0,Nt=e}};function Vt(e,t,s,i,a,n,r,o,l){Ft=!1,Nt=null,Lt.apply(zt,arguments)}function Ht(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(4098&(t=e).flags)&&(s=t.return),e=t.return}while(e)}return 3===t.tag?s:null}function $t(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function jt(e){if(Ht(e)!==e)throw Error(re(188))}function Gt(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ht(e)))throw Error(re(188));return t!==e?null:e}for(var s=e,i=t;;){var a=s.return;if(null===a)break;var n=a.alternate;if(null===n){if(null!==(i=a.return)){s=i;continue}break}if(a.child===n.child){for(n=a.child;n;){if(n===s)return jt(a),e;if(n===i)return jt(a),t;n=n.sibling}throw Error(re(188))}if(s.return!==i.return)s=a,i=n;else{for(var r=!1,o=a.child;o;){if(o===s){r=!0,s=a,i=n;break}if(o===i){r=!0,i=a,s=n;break}o=o.sibling}if(!r){for(o=n.child;o;){if(o===s){r=!0,s=n,i=a;break}if(o===i){r=!0,i=n,s=a;break}o=o.sibling}if(!r)throw Error(re(189))}}if(s.alternate!==i)throw Error(re(190))}if(3!==s.tag)throw Error(re(188));return s.stateNode.current===s?e:t}(e))?Kt(e):null}function Kt(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Kt(e);if(null!==t)return t;e=e.sibling}return null}var Yt=ne.unstable_scheduleCallback,Xt=ne.unstable_cancelCallback,qt=ne.unstable_shouldYield,Qt=ne.unstable_requestPaint,Jt=ne.unstable_now,Zt=ne.unstable_getCurrentPriorityLevel,es=ne.unstable_ImmediatePriority,ts=ne.unstable_UserBlockingPriority,ss=ne.unstable_NormalPriority,is=ne.unstable_LowPriority,as=ne.unstable_IdlePriority,ns=null,rs=null,os=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(ls(e)/hs|0)|0},ls=Math.log,hs=Math.LN2,cs=64,us=4194304;function ds(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ps(e,t){var s=e.pendingLanes;if(0===s)return 0;var i=0,a=e.suspendedLanes,n=e.pingedLanes,r=268435455&s;if(0!==r){var o=r&~a;0!==o?i=ds(o):0!=(n&=r)&&(i=ds(n))}else 0!=(r=s&~a)?i=ds(r):0!==n&&(i=ds(n));if(0===i)return 0;if(0!==t&&t!==i&&0==(t&a)&&((a=i&-i)>=(n=t&-t)||16===a&&0!=(4194240&n)))return t;if(0!=(4&i)&&(i|=16&s),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)a=1<<(s=31-os(t)),i|=e[s],t&=~a;return i}function fs(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ms(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gs(){var e=cs;return 0==(4194240&(cs<<=1))&&(cs=64),e}function ys(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function vs(e,t,s){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-os(t)]=s}function bs(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var i=31-os(s),a=1<<i;a&t|e[i]&t&&(e[i]|=t),s&=~a}}var ws=0;function Ms(e){return 1<(e&=-e)?4<e?0!=(268435455&e)?16:536870912:4:1}var xs,Ss,Cs,Es,ks,Ts=!1,Ps=[],Ds=null,_s=null,As=null,Rs=new Map,Os=new Map,Bs=[],Is="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ls(e,t){switch(e){case"focusin":case"focusout":Ds=null;break;case"dragenter":case"dragleave":_s=null;break;case"mouseover":case"mouseout":As=null;break;case"pointerover":case"pointerout":Rs.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Os.delete(t.pointerId)}}function Fs(e,t,s,i,a,n){return null===e||e.nativeEvent!==n?(e={blockedOn:t,domEventName:s,eventSystemFlags:i,nativeEvent:n,targetContainers:[a]},null!==t&&null!==(t=wn(t))&&Ss(t),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Ns(e){var t=bn(e.target);if(null!==t){var s=Ht(t);if(null!==s)if(13===(t=s.tag)){if(null!==(t=$t(s)))return e.blockedOn=t,void ks(e.priority,(function(){Cs(s)}))}else if(3===t&&s.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===s.tag?s.stateNode.containerInfo:null)}e.blockedOn=null}function Ws(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var s=qs(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==s)return null!==(t=wn(s))&&Ss(t),e.blockedOn=s,!1;var i=new(s=e.nativeEvent).constructor(s.type,s);Mt=i,s.target.dispatchEvent(i),Mt=null,t.shift()}return!0}function Us(e,t,s){Ws(e)&&s.delete(t)}function zs(){Ts=!1,null!==Ds&&Ws(Ds)&&(Ds=null),null!==_s&&Ws(_s)&&(_s=null),null!==As&&Ws(As)&&(As=null),Rs.forEach(Us),Os.forEach(Us)}function Vs(e,t){e.blockedOn===t&&(e.blockedOn=null,Ts||(Ts=!0,ne.unstable_scheduleCallback(ne.unstable_NormalPriority,zs)))}function Hs(e){function t(t){return Vs(t,e)}if(0<Ps.length){Vs(Ps[0],e);for(var s=1;s<Ps.length;s++){var i=Ps[s];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Ds&&Vs(Ds,e),null!==_s&&Vs(_s,e),null!==As&&Vs(As,e),Rs.forEach(t),Os.forEach(t),s=0;s<Bs.length;s++)(i=Bs[s]).blockedOn===e&&(i.blockedOn=null);for(;0<Bs.length&&null===(s=Bs[0]).blockedOn;)Ns(s),null===s.blockedOn&&Bs.shift()}var $s=Me.ReactCurrentBatchConfig,js=!0;function Gs(e,t,s,i){var a=ws,n=$s.transition;$s.transition=null;try{ws=1,Ys(e,t,s,i)}finally{ws=a,$s.transition=n}}function Ks(e,t,s,i){var a=ws,n=$s.transition;$s.transition=null;try{ws=4,Ys(e,t,s,i)}finally{ws=a,$s.transition=n}}function Ys(e,t,s,i){if(js){var a=qs(e,t,s,i);if(null===a)$a(e,t,i,Xs,s),Ls(e,i);else if(function(e,t,s,i,a){switch(t){case"focusin":return Ds=Fs(Ds,e,t,s,i,a),!0;case"dragenter":return _s=Fs(_s,e,t,s,i,a),!0;case"mouseover":return As=Fs(As,e,t,s,i,a),!0;case"pointerover":var n=a.pointerId;return Rs.set(n,Fs(Rs.get(n)||null,e,t,s,i,a)),!0;case"gotpointercapture":return n=a.pointerId,Os.set(n,Fs(Os.get(n)||null,e,t,s,i,a)),!0}return!1}(a,e,t,s,i))i.stopPropagation();else if(Ls(e,i),4&t&&-1<Is.indexOf(e)){for(;null!==a;){var n=wn(a);if(null!==n&&xs(n),null===(n=qs(e,t,s,i))&&$a(e,t,i,Xs,s),n===a)break;a=n}null!==a&&i.stopPropagation()}else $a(e,t,i,null,s)}}var Xs=null;function qs(e,t,s,i){if(Xs=null,null!==(e=bn(e=xt(i))))if(null===(t=Ht(e)))e=null;else if(13===(s=t.tag)){if(null!==(e=$t(t)))return e;e=null}else if(3===s){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xs=e,null}function Qs(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zt()){case es:return 1;case ts:return 4;case ss:case is:return 16;case as:return 536870912;default:return 16}default:return 16}}var Js=null,Zs=null,ei=null;function ti(){if(ei)return ei;var e,t,s=Zs,i=s.length,a="value"in Js?Js.value:Js.textContent,n=a.length;for(e=0;e<i&&s[e]===a[e];e++);var r=i-e;for(t=1;t<=r&&s[i-t]===a[n-t];t++);return ei=a.slice(e,1<t?1-t:void 0)}function si(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ai(){return!1}function ni(e){function t(t,s,i,a,n){for(var r in this._reactName=t,this._targetInst=i,this.type=s,this.nativeEvent=a,this.target=n,this.currentTarget=null,e)e.hasOwnProperty(r)&&(t=e[r],this[r]=t?t(a):a[r]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?ii:ai,this.isPropagationStopped=ai,this}return Ne(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var ri,oi,li,hi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ci=ni(hi),ui=Ne({},hi,{view:0,detail:0}),di=ni(ui),pi=Ne({},ui,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ei,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==li&&(li&&"mousemove"===e.type?(ri=e.screenX-li.screenX,oi=e.screenY-li.screenY):oi=ri=0,li=e),ri)},movementY:function(e){return"movementY"in e?e.movementY:oi}}),fi=ni(pi),mi=ni(Ne({},pi,{dataTransfer:0})),gi=ni(Ne({},ui,{relatedTarget:0})),yi=ni(Ne({},hi,{animationName:0,elapsedTime:0,pseudoElement:0})),vi=Ne({},hi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bi=ni(vi),wi=ni(Ne({},hi,{data:0})),Mi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Si={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ci(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Si[e])&&!!t[e]}function Ei(){return Ci}var ki=Ne({},ui,{key:function(e){if(e.key){var t=Mi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=si(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ei,charCode:function(e){return"keypress"===e.type?si(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?si(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ti=ni(ki),Pi=ni(Ne({},pi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Di=ni(Ne({},ui,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ei})),_i=ni(Ne({},hi,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ai=Ne({},pi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ri=ni(Ai),Oi=[9,13,27,32],Bi=ue&&"CompositionEvent"in window,Ii=null;ue&&"documentMode"in document&&(Ii=document.documentMode);var Li=ue&&"TextEvent"in window&&!Ii,Fi=ue&&(!Bi||Ii&&8<Ii&&11>=Ii),Ni=String.fromCharCode(32),Wi=!1;function Ui(e,t){switch(e){case"keyup":return-1!==Oi.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zi(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Vi=!1,Hi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $i(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hi[e.type]:"textarea"===t}function ji(e,t,s,i){Tt(i),0<(t=Ga(t,"onChange")).length&&(s=new ci("onChange","change",null,s,i),e.push({event:s,listeners:t}))}var Gi=null,Ki=null;function Yi(e){Na(e,0)}function Xi(e){if(Ye(Mn(e)))return e}function qi(e,t){if("change"===e)return t}var Qi=!1;if(ue){var Ji;if(ue){var Zi="oninput"in document;if(!Zi){var ea=document.createElement("div");ea.setAttribute("oninput","return;"),Zi="function"==typeof ea.oninput}Ji=Zi}else Ji=!1;Qi=Ji&&(!document.documentMode||9<document.documentMode)}function ta(){Gi&&(Gi.detachEvent("onpropertychange",sa),Ki=Gi=null)}function sa(e){if("value"===e.propertyName&&Xi(Ki)){var t=[];ji(t,Ki,e,xt(e)),Rt(Yi,t)}}function ia(e,t,s){"focusin"===e?(ta(),Ki=s,(Gi=t).attachEvent("onpropertychange",sa)):"focusout"===e&&ta()}function aa(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xi(Ki)}function na(e,t){if("click"===e)return Xi(t)}function ra(e,t){if("input"===e||"change"===e)return Xi(t)}var oa="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function la(e,t){if(oa(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(i=0;i<s.length;i++){var a=s[i];if(!de.call(t,a)||!oa(e[a],t[a]))return!1}return!0}function ha(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ca(e,t){var s,i=ha(e);for(e=0;i;){if(3===i.nodeType){if(s=e+i.textContent.length,e<=t&&s>=t)return{node:i,offset:t-e};e=s}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ha(i)}}function ua(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ua(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function da(){for(var e=window,t=Xe();t instanceof e.HTMLIFrameElement;){try{var s="string"==typeof t.contentWindow.location.href}catch(i){s=!1}if(!s)break;t=Xe((e=t.contentWindow).document)}return t}function pa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fa(e){var t=da(),s=e.focusedElem,i=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&ua(s.ownerDocument.documentElement,s)){if(null!==i&&pa(s))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if((e=(t=s.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=s.textContent.length,n=Math.min(i.start,a);i=void 0===i.end?n:Math.min(i.end,a),!e.extend&&n>i&&(a=i,i=n,n=a),a=ca(s,n);var r=ca(s,i);a&&r&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==r.node||e.focusOffset!==r.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),n>i?(e.addRange(t),e.extend(r.node,r.offset)):(t.setEnd(r.node,r.offset),e.addRange(t)))}for(t=[],e=s;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof s.focus&&s.focus(),s=0;s<t.length;s++)(e=t[s]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ma=ue&&"documentMode"in document&&11>=document.documentMode,ga=null,ya=null,va=null,ba=!1;function wa(e,t,s){var i=s.window===s?s.document:9===s.nodeType?s:s.ownerDocument;ba||null==ga||ga!==Xe(i)||(i="selectionStart"in(i=ga)&&pa(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},va&&la(va,i)||(va=i,0<(i=Ga(ya,"onSelect")).length&&(t=new ci("onSelect","select",null,t,s),e.push({event:t,listeners:i}),t.target=ga)))}function Ma(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var xa={animationend:Ma("Animation","AnimationEnd"),animationiteration:Ma("Animation","AnimationIteration"),animationstart:Ma("Animation","AnimationStart"),transitionend:Ma("Transition","TransitionEnd")},Sa={},Ca={};function Ea(e){if(Sa[e])return Sa[e];if(!xa[e])return e;var t,s=xa[e];for(t in s)if(s.hasOwnProperty(t)&&t in Ca)return Sa[e]=s[t];return e}ue&&(Ca=document.createElement("div").style,"AnimationEvent"in window||(delete xa.animationend.animation,delete xa.animationiteration.animation,delete xa.animationstart.animation),"TransitionEvent"in window||delete xa.transitionend.transition);var ka=Ea("animationend"),Ta=Ea("animationiteration"),Pa=Ea("animationstart"),Da=Ea("transitionend"),_a=new Map,Aa="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ra(e,t){_a.set(e,t),he(t,[e])}for(var Oa=0;Oa<Aa.length;Oa++){var Ba=Aa[Oa];Ra(Ba.toLowerCase(),"on"+(Ba[0].toUpperCase()+Ba.slice(1)))}Ra(ka,"onAnimationEnd"),Ra(Ta,"onAnimationIteration"),Ra(Pa,"onAnimationStart"),Ra("dblclick","onDoubleClick"),Ra("focusin","onFocus"),Ra("focusout","onBlur"),Ra(Da,"onTransitionEnd"),ce("onMouseEnter",["mouseout","mouseover"]),ce("onMouseLeave",["mouseout","mouseover"]),ce("onPointerEnter",["pointerout","pointerover"]),ce("onPointerLeave",["pointerout","pointerover"]),he("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),he("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),he("onBeforeInput",["compositionend","keypress","textInput","paste"]),he("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),he("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),he("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ia="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),La=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ia));function Fa(e,t,s){var i=e.type||"unknown-event";e.currentTarget=s,function(e,t,s,i,a,n,r,o,l){if(Vt.apply(this,arguments),Ft){if(!Ft)throw Error(re(198));var h=Nt;Ft=!1,Nt=null,Wt||(Wt=!0,Ut=h)}}(i,t,void 0,e),e.currentTarget=null}function Na(e,t){t=0!=(4&t);for(var s=0;s<e.length;s++){var i=e[s],a=i.event;i=i.listeners;e:{var n=void 0;if(t)for(var r=i.length-1;0<=r;r--){var o=i[r],l=o.instance,h=o.currentTarget;if(o=o.listener,l!==n&&a.isPropagationStopped())break e;Fa(a,o,h),n=l}else for(r=0;r<i.length;r++){if(l=(o=i[r]).instance,h=o.currentTarget,o=o.listener,l!==n&&a.isPropagationStopped())break e;Fa(a,o,h),n=l}}}if(Wt)throw e=Ut,Wt=!1,Ut=null,e}function Wa(e,t){var s=t[gn];void 0===s&&(s=t[gn]=new Set);var i=e+"__bubble";s.has(i)||(Ha(t,e,2,!1),s.add(i))}function Ua(e,t,s){var i=0;t&&(i|=4),Ha(s,e,i,t)}var za="_reactListening"+Math.random().toString(36).slice(2);function Va(e){if(!e[za]){e[za]=!0,oe.forEach((function(t){"selectionchange"!==t&&(La.has(t)||Ua(t,!1,e),Ua(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[za]||(t[za]=!0,Ua("selectionchange",!1,t))}}function Ha(e,t,s,i){switch(Qs(t)){case 1:var a=Gs;break;case 4:a=Ks;break;default:a=Ys}s=a.bind(null,t,s,e),a=void 0,!Bt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),i?void 0!==a?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):void 0!==a?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function $a(e,t,s,i,a){var n=i;if(0==(1&t)&&0==(2&t)&&null!==i)e:for(;;){if(null===i)return;var r=i.tag;if(3===r||4===r){var o=i.stateNode.containerInfo;if(o===a||8===o.nodeType&&o.parentNode===a)break;if(4===r)for(r=i.return;null!==r;){var l=r.tag;if((3===l||4===l)&&((l=r.stateNode.containerInfo)===a||8===l.nodeType&&l.parentNode===a))return;r=r.return}for(;null!==o;){if(null===(r=bn(o)))return;if(5===(l=r.tag)||6===l){i=n=r;continue e}o=o.parentNode}}i=i.return}Rt((function(){var i=n,a=xt(s),r=[];e:{var o=_a.get(e);if(void 0!==o){var l=ci,h=e;switch(e){case"keypress":if(0===si(s))break e;case"keydown":case"keyup":l=Ti;break;case"focusin":h="focus",l=gi;break;case"focusout":h="blur",l=gi;break;case"beforeblur":case"afterblur":l=gi;break;case"click":if(2===s.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Di;break;case ka:case Ta:case Pa:l=yi;break;case Da:l=_i;break;case"scroll":l=di;break;case"wheel":l=Ri;break;case"copy":case"cut":case"paste":l=bi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Pi}var c=0!=(4&t),u=!c&&"scroll"===e,d=c?null!==o?o+"Capture":null:o;c=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&null!=(m=Ot(f,d))&&c.push(ja(f,m,p))),u)break;f=f.return}0<c.length&&(o=new l(o,h,null,s,a),r.push({event:o,listeners:c}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||s===Mt||!(h=s.relatedTarget||s.fromElement)||!bn(h)&&!h[mn])&&(l||o)&&(o=a.window===a?a:(o=a.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(h=(h=s.relatedTarget||s.toElement)?bn(h):null)&&(h!==(u=Ht(h))||5!==h.tag&&6!==h.tag)&&(h=null)):(l=null,h=i),l!==h)){if(c=fi,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(c=Pi,m="onPointerLeave",d="onPointerEnter",f="pointer"),u=null==l?o:Mn(l),p=null==h?o:Mn(h),(o=new c(m,f+"leave",l,s,a)).target=u,o.relatedTarget=p,m=null,bn(a)===i&&((c=new c(d,f+"enter",h,s,a)).target=p,c.relatedTarget=u,m=c),u=m,l&&h)e:{for(d=h,f=0,p=c=l;p;p=Ka(p))f++;for(p=0,m=d;m;m=Ka(m))p++;for(;0<f-p;)c=Ka(c),f--;for(;0<p-f;)d=Ka(d),p--;for(;f--;){if(c===d||null!==d&&c===d.alternate)break e;c=Ka(c),d=Ka(d)}c=null}else c=null;null!==l&&Ya(r,o,l,c,!1),null!==h&&null!==u&&Ya(r,u,h,c,!0)}if("select"===(l=(o=i?Mn(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=qi;else if($i(o))if(Qi)g=ra;else{g=aa;var y=ia}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=na);switch(g&&(g=g(e,i))?ji(r,g,s,a):(y&&y(e,o,i),"focusout"===e&&(y=o._wrapperState)&&y.controlled&&"number"===o.type&&tt(o,"number",o.value)),y=i?Mn(i):window,e){case"focusin":($i(y)||"true"===y.contentEditable)&&(ga=y,ya=i,va=null);break;case"focusout":va=ya=ga=null;break;case"mousedown":ba=!0;break;case"contextmenu":case"mouseup":case"dragend":ba=!1,wa(r,s,a);break;case"selectionchange":if(ma)break;case"keydown":case"keyup":wa(r,s,a)}var v;if(Bi)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vi?Ui(e,s)&&(b="onCompositionEnd"):"keydown"===e&&229===s.keyCode&&(b="onCompositionStart");b&&(Fi&&"ko"!==s.locale&&(Vi||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vi&&(v=ti()):(Zs="value"in(Js=a)?Js.value:Js.textContent,Vi=!0)),0<(y=Ga(i,b)).length&&(b=new wi(b,e,null,s,a),r.push({event:b,listeners:y}),(v||null!==(v=zi(s)))&&(b.data=v))),(v=Li?function(e,t){switch(e){case"compositionend":return zi(t);case"keypress":return 32!==t.which?null:(Wi=!0,Ni);case"textInput":return(e=t.data)===Ni&&Wi?null:e;default:return null}}(e,s):function(e,t){if(Vi)return"compositionend"===e||!Bi&&Ui(e,t)?(e=ti(),ei=Zs=Js=null,Vi=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fi&&"ko"!==t.locale?null:t.data}}(e,s))&&0<(i=Ga(i,"onBeforeInput")).length&&(a=new wi("onBeforeInput","beforeinput",null,s,a),r.push({event:a,listeners:i}),a.data=v)}Na(r,t)}))}function ja(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Ga(e,t){for(var s=t+"Capture",i=[];null!==e;){var a=e,n=a.stateNode;5===a.tag&&null!==n&&(a=n,null!=(n=Ot(e,s))&&i.unshift(ja(e,n,a)),null!=(n=Ot(e,t))&&i.push(ja(e,n,a))),e=e.return}return i}function Ka(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ya(e,t,s,i,a){for(var n=t._reactName,r=[];null!==s&&s!==i;){var o=s,l=o.alternate,h=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==h&&(o=h,a?null!=(l=Ot(s,n))&&r.unshift(ja(s,l,o)):a||null!=(l=Ot(s,n))&&r.push(ja(s,l,o))),s=s.return}0!==r.length&&e.push({event:t,listeners:r})}var Xa=/\r\n?/g,qa=/\u0000|\uFFFD/g;function Qa(e){return("string"==typeof e?e:""+e).replace(Xa,"\n").replace(qa,"")}function Ja(e,t,s){if(t=Qa(t),Qa(e)!==t&&s)throw Error(re(425))}function Za(){}var en=null,tn=null;function sn(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var an="function"==typeof setTimeout?setTimeout:void 0,nn="function"==typeof clearTimeout?clearTimeout:void 0,rn="function"==typeof Promise?Promise:void 0,on="function"==typeof queueMicrotask?queueMicrotask:void 0!==rn?function(e){return rn.resolve(null).then(e).catch(ln)}:an;function ln(e){setTimeout((function(){throw e}))}function hn(e,t){var s=t,i=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&8===a.nodeType)if("/$"===(s=a.data)){if(0===i)return e.removeChild(a),void Hs(t);i--}else"$"!==s&&"$?"!==s&&"$!"!==s||i++;s=a}while(s);Hs(t)}function cn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function un(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var s=e.data;if("$"===s||"$!"===s||"$?"===s){if(0===t)return e;t--}else"/$"===s&&t++}e=e.previousSibling}return null}var dn=Math.random().toString(36).slice(2),pn="__reactFiber$"+dn,fn="__reactProps$"+dn,mn="__reactContainer$"+dn,gn="__reactEvents$"+dn,yn="__reactListeners$"+dn,vn="__reactHandles$"+dn;function bn(e){var t=e[pn];if(t)return t;for(var s=e.parentNode;s;){if(t=s[mn]||s[pn]){if(s=t.alternate,null!==t.child||null!==s&&null!==s.child)for(e=un(e);null!==e;){if(s=e[pn])return s;e=un(e)}return t}s=(e=s).parentNode}return null}function wn(e){return!(e=e[pn]||e[mn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Mn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(re(33))}function xn(e){return e[fn]||null}var Sn=[],Cn=-1;function En(e){return{current:e}}function kn(e){0>Cn||(e.current=Sn[Cn],Sn[Cn]=null,Cn--)}function Tn(e,t){Cn++,Sn[Cn]=e.current,e.current=t}var Pn={},Dn=En(Pn),_n=En(!1),An=Pn;function Rn(e,t){var s=e.type.contextTypes;if(!s)return Pn;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var a,n={};for(a in s)n[a]=t[a];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function On(e){return null!=e.childContextTypes}function Bn(){kn(_n),kn(Dn)}function In(e,t,s){if(Dn.current!==Pn)throw Error(re(168));Tn(Dn,t),Tn(_n,s)}function Ln(e,t,s){var i=e.stateNode;if(t=t.childContextTypes,"function"!=typeof i.getChildContext)return s;for(var a in i=i.getChildContext())if(!(a in t))throw Error(re(108,$e(e)||"Unknown",a));return Ne({},s,i)}function Fn(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Pn,An=Dn.current,Tn(Dn,e),Tn(_n,_n.current),!0}function Nn(e,t,s){var i=e.stateNode;if(!i)throw Error(re(169));s?(e=Ln(e,t,An),i.__reactInternalMemoizedMergedChildContext=e,kn(_n),kn(Dn),Tn(Dn,e)):kn(_n),Tn(_n,s)}var Wn=null,Un=!1,zn=!1;function Vn(e){null===Wn?Wn=[e]:Wn.push(e)}function Hn(){if(!zn&&null!==Wn){zn=!0;var e=0,t=ws;try{var s=Wn;for(ws=1;e<s.length;e++){var i=s[e];do{i=i(!0)}while(null!==i)}Wn=null,Un=!1}catch(a){throw null!==Wn&&(Wn=Wn.slice(e+1)),Yt(es,Hn),a}finally{ws=t,zn=!1}}return null}var $n=[],jn=0,Gn=null,Kn=0,Yn=[],Xn=0,qn=null,Qn=1,Jn="";function Zn(e,t){$n[jn++]=Kn,$n[jn++]=Gn,Gn=e,Kn=t}function er(e,t,s){Yn[Xn++]=Qn,Yn[Xn++]=Jn,Yn[Xn++]=qn,qn=e;var i=Qn;e=Jn;var a=32-os(i)-1;i&=~(1<<a),s+=1;var n=32-os(t)+a;if(30<n){var r=a-a%5;n=(i&(1<<r)-1).toString(32),i>>=r,a-=r,Qn=1<<32-os(t)+a|s<<a|i,Jn=n+e}else Qn=1<<n|s<<a|i,Jn=e}function tr(e){null!==e.return&&(Zn(e,1),er(e,1,0))}function sr(e){for(;e===Gn;)Gn=$n[--jn],$n[jn]=null,Kn=$n[--jn],$n[jn]=null;for(;e===qn;)qn=Yn[--Xn],Yn[Xn]=null,Jn=Yn[--Xn],Yn[Xn]=null,Qn=Yn[--Xn],Yn[Xn]=null}var ir=null,ar=null,nr=!1,rr=null;function or(e,t){var s=Rc(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,null===(t=e.deletions)?(e.deletions=[s],e.flags|=16):t.push(s)}function lr(e,t){switch(e.tag){case 5:var s=e.type;return null!==(t=1!==t.nodeType||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ir=e,ar=cn(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ir=e,ar=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(s=null!==qn?{id:Qn,overflow:Jn}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},(s=Rc(18,null,null,0)).stateNode=t,s.return=e,e.child=s,ir=e,ar=null,!0);default:return!1}}function hr(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function cr(e){if(nr){var t=ar;if(t){var s=t;if(!lr(e,t)){if(hr(e))throw Error(re(418));t=cn(s.nextSibling);var i=ir;t&&lr(e,t)?or(i,s):(e.flags=-4097&e.flags|2,nr=!1,ir=e)}}else{if(hr(e))throw Error(re(418));e.flags=-4097&e.flags|2,nr=!1,ir=e}}}function ur(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ir=e}function dr(e){if(e!==ir)return!1;if(!nr)return ur(e),nr=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!sn(e.type,e.memoizedProps)),t&&(t=ar)){if(hr(e))throw pr(),Error(re(418));for(;t;)or(e,t),t=cn(t.nextSibling)}if(ur(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(re(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var s=e.data;if("/$"===s){if(0===t){ar=cn(e.nextSibling);break e}t--}else"$"!==s&&"$!"!==s&&"$?"!==s||t++}e=e.nextSibling}ar=null}}else ar=ir?cn(e.stateNode.nextSibling):null;return!0}function pr(){for(var e=ar;e;)e=cn(e.nextSibling)}function fr(){ar=ir=null,nr=!1}function mr(e){null===rr?rr=[e]:rr.push(e)}var gr=Me.ReactCurrentBatchConfig;function yr(e,t,s){if(null!==(e=s.ref)&&"function"!=typeof e&&"object"!=typeof e){if(s._owner){if(s=s._owner){if(1!==s.tag)throw Error(re(309));var i=s.stateNode}if(!i)throw Error(re(147,e));var a=i,n=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===n?t.ref:((t=function(e){var t=a.refs;null===e?delete t[n]:t[n]=e})._stringRef=n,t)}if("string"!=typeof e)throw Error(re(284));if(!s._owner)throw Error(re(290,e))}return e}function vr(e,t){throw e=Object.prototype.toString.call(t),Error(re(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function br(e){return(0,e._init)(e._payload)}function wr(e){function t(t,s){if(e){var i=t.deletions;null===i?(t.deletions=[s],t.flags|=16):i.push(s)}}function s(s,i){if(!e)return null;for(;null!==i;)t(s,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Bc(e,t)).index=0,e.sibling=null,e}function n(t,s,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<s?(t.flags|=2,s):i:(t.flags|=2,s):(t.flags|=1048576,s)}function r(t){return e&&null===t.alternate&&(t.flags|=2),t}function o(e,t,s,i){return null===t||6!==t.tag?((t=Nc(s,e.mode,i)).return=e,t):((t=a(t,s)).return=e,t)}function l(e,t,s,i){var n=s.type;return n===Ce?c(e,t,s.props.children,i,s.key):null!==t&&(t.elementType===n||"object"==typeof n&&null!==n&&n.$$typeof===Oe&&br(n)===t.type)?((i=a(t,s.props)).ref=yr(e,t,s),i.return=e,i):((i=Ic(s.type,s.key,s.props,null,e.mode,i)).ref=yr(e,t,s),i.return=e,i)}function h(e,t,s,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==s.containerInfo||t.stateNode.implementation!==s.implementation?((t=Wc(s,e.mode,i)).return=e,t):((t=a(t,s.children||[])).return=e,t)}function c(e,t,s,i,n){return null===t||7!==t.tag?((t=Lc(s,e.mode,i,n)).return=e,t):((t=a(t,s)).return=e,t)}function u(e,t,s){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Nc(""+t,e.mode,s)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case xe:return(s=Ic(t.type,t.key,t.props,null,e.mode,s)).ref=yr(e,null,t),s.return=e,s;case Se:return(t=Wc(t,e.mode,s)).return=e,t;case Oe:return u(e,(0,t._init)(t._payload),s)}if(st(t)||Le(t))return(t=Lc(t,e.mode,s,null)).return=e,t;vr(e,t)}return null}function d(e,t,s,i){var a=null!==t?t.key:null;if("string"==typeof s&&""!==s||"number"==typeof s)return null!==a?null:o(e,t,""+s,i);if("object"==typeof s&&null!==s){switch(s.$$typeof){case xe:return s.key===a?l(e,t,s,i):null;case Se:return s.key===a?h(e,t,s,i):null;case Oe:return d(e,t,(a=s._init)(s._payload),i)}if(st(s)||Le(s))return null!==a?null:c(e,t,s,i,null);vr(e,s)}return null}function p(e,t,s,i,a){if("string"==typeof i&&""!==i||"number"==typeof i)return o(t,e=e.get(s)||null,""+i,a);if("object"==typeof i&&null!==i){switch(i.$$typeof){case xe:return l(t,e=e.get(null===i.key?s:i.key)||null,i,a);case Se:return h(t,e=e.get(null===i.key?s:i.key)||null,i,a);case Oe:return p(e,t,s,(0,i._init)(i._payload),a)}if(st(i)||Le(i))return c(t,e=e.get(s)||null,i,a,null);vr(t,i)}return null}return function o(l,h,c,f){if("object"==typeof c&&null!==c&&c.type===Ce&&null===c.key&&(c=c.props.children),"object"==typeof c&&null!==c){switch(c.$$typeof){case xe:e:{for(var m=c.key,g=h;null!==g;){if(g.key===m){if((m=c.type)===Ce){if(7===g.tag){s(l,g.sibling),(h=a(g,c.props.children)).return=l,l=h;break e}}else if(g.elementType===m||"object"==typeof m&&null!==m&&m.$$typeof===Oe&&br(m)===g.type){s(l,g.sibling),(h=a(g,c.props)).ref=yr(l,g,c),h.return=l,l=h;break e}s(l,g);break}t(l,g),g=g.sibling}c.type===Ce?((h=Lc(c.props.children,l.mode,f,c.key)).return=l,l=h):((f=Ic(c.type,c.key,c.props,null,l.mode,f)).ref=yr(l,h,c),f.return=l,l=f)}return r(l);case Se:e:{for(g=c.key;null!==h;){if(h.key===g){if(4===h.tag&&h.stateNode.containerInfo===c.containerInfo&&h.stateNode.implementation===c.implementation){s(l,h.sibling),(h=a(h,c.children||[])).return=l,l=h;break e}s(l,h);break}t(l,h),h=h.sibling}(h=Wc(c,l.mode,f)).return=l,l=h}return r(l);case Oe:return o(l,h,(g=c._init)(c._payload),f)}if(st(c))return function(a,r,o,l){for(var h=null,c=null,f=r,m=r=0,g=null;null!==f&&m<o.length;m++){f.index>m?(g=f,f=null):g=f.sibling;var y=d(a,f,o[m],l);if(null===y){null===f&&(f=g);break}e&&f&&null===y.alternate&&t(a,f),r=n(y,r,m),null===c?h=y:c.sibling=y,c=y,f=g}if(m===o.length)return s(a,f),nr&&Zn(a,m),h;if(null===f){for(;m<o.length;m++)null!==(f=u(a,o[m],l))&&(r=n(f,r,m),null===c?h=f:c.sibling=f,c=f);return nr&&Zn(a,m),h}for(f=i(a,f);m<o.length;m++)null!==(g=p(f,a,m,o[m],l))&&(e&&null!==g.alternate&&f.delete(null===g.key?m:g.key),r=n(g,r,m),null===c?h=g:c.sibling=g,c=g);return e&&f.forEach((function(e){return t(a,e)})),nr&&Zn(a,m),h}(l,h,c,f);if(Le(c))return function(a,r,o,l){var h=Le(o);if("function"!=typeof h)throw Error(re(150));if(null==(o=h.call(o)))throw Error(re(151));for(var c=h=null,f=r,m=r=0,g=null,y=o.next();null!==f&&!y.done;m++,y=o.next()){f.index>m?(g=f,f=null):g=f.sibling;var v=d(a,f,y.value,l);if(null===v){null===f&&(f=g);break}e&&f&&null===v.alternate&&t(a,f),r=n(v,r,m),null===c?h=v:c.sibling=v,c=v,f=g}if(y.done)return s(a,f),nr&&Zn(a,m),h;if(null===f){for(;!y.done;m++,y=o.next())null!==(y=u(a,y.value,l))&&(r=n(y,r,m),null===c?h=y:c.sibling=y,c=y);return nr&&Zn(a,m),h}for(f=i(a,f);!y.done;m++,y=o.next())null!==(y=p(f,a,m,y.value,l))&&(e&&null!==y.alternate&&f.delete(null===y.key?m:y.key),r=n(y,r,m),null===c?h=y:c.sibling=y,c=y);return e&&f.forEach((function(e){return t(a,e)})),nr&&Zn(a,m),h}(l,h,c,f);vr(l,c)}return"string"==typeof c&&""!==c||"number"==typeof c?(c=""+c,null!==h&&6===h.tag?(s(l,h.sibling),(h=a(h,c)).return=l,l=h):(s(l,h),(h=Nc(c,l.mode,f)).return=l,l=h),r(l)):s(l,h)}}var Mr=wr(!0),xr=wr(!1),Sr=En(null),Cr=null,Er=null,kr=null;function Tr(){kr=Er=Cr=null}function Pr(e){var t=Sr.current;kn(Sr),e._currentValue=t}function Dr(e,t,s){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===s)break;e=e.return}}function _r(e,t){Cr=e,kr=Er=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(wl=!0),e.firstContext=null)}function Ar(e){var t=e._currentValue;if(kr!==e)if(e={context:e,memoizedValue:t,next:null},null===Er){if(null===Cr)throw Error(re(308));Er=e,Cr.dependencies={lanes:0,firstContext:e}}else Er=Er.next=e;return t}var Rr=null;function Or(e){null===Rr?Rr=[e]:Rr.push(e)}function Br(e,t,s,i){var a=t.interleaved;return null===a?(s.next=s,Or(t)):(s.next=a.next,a.next=s),t.interleaved=s,Ir(e,i)}function Ir(e,t){e.lanes|=t;var s=e.alternate;for(null!==s&&(s.lanes|=t),s=e,e=e.return;null!==e;)e.childLanes|=t,null!==(s=e.alternate)&&(s.childLanes|=t),s=e,e=e.return;return 3===s.tag?s.stateNode:null}var Lr=!1;function Fr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Nr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Wr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ur(e,t,s){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!=(2&Dh)){var a=i.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),i.pending=t,Ir(e,s)}return null===(a=i.interleaved)?(t.next=t,Or(i)):(t.next=a.next,a.next=t),i.interleaved=t,Ir(e,s)}function zr(e,t,s){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&s))){var i=t.lanes;s|=i&=e.pendingLanes,t.lanes=s,bs(e,s)}}function Vr(e,t){var s=e.updateQueue,i=e.alternate;if(null!==i&&s===(i=i.updateQueue)){var a=null,n=null;if(null!==(s=s.firstBaseUpdate)){do{var r={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};null===n?a=n=r:n=n.next=r,s=s.next}while(null!==s);null===n?a=n=t:n=n.next=t}else a=n=t;return s={baseState:i.baseState,firstBaseUpdate:a,lastBaseUpdate:n,shared:i.shared,effects:i.effects},void(e.updateQueue=s)}null===(e=s.lastBaseUpdate)?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Hr(e,t,s,i){var a=e.updateQueue;Lr=!1;var n=a.firstBaseUpdate,r=a.lastBaseUpdate,o=a.shared.pending;if(null!==o){a.shared.pending=null;var l=o,h=l.next;l.next=null,null===r?n=h:r.next=h,r=l;var c=e.alternate;null!==c&&(o=(c=c.updateQueue).lastBaseUpdate)!==r&&(null===o?c.firstBaseUpdate=h:o.next=h,c.lastBaseUpdate=l)}if(null!==n){var u=a.baseState;for(r=0,c=h=l=null,o=n;;){var d=o.lane,p=o.eventTime;if((i&d)===d){null!==c&&(c=c.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(d=t,p=s,m.tag){case 1:if("function"==typeof(f=m.payload)){u=f.call(p,u,d);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(p,u,d):f))break e;u=Ne({},u,d);break e;case 2:Lr=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=a.effects)?a.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===c?(h=c=p,l=u):c=c.next=p,r|=d;if(null===(o=o.next)){if(null===(o=a.shared.pending))break;o=(d=o).next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}if(null===c&&(l=u),a.baseState=l,a.firstBaseUpdate=h,a.lastBaseUpdate=c,null!==(t=a.shared.interleaved)){a=t;do{r|=a.lane,a=a.next}while(a!==t)}else null===n&&(a.shared.lanes=0);Fh|=r,e.lanes=r,e.memoizedState=u}}function $r(e,t,s){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],a=i.callback;if(null!==a){if(i.callback=null,i=s,"function"!=typeof a)throw Error(re(191,a));a.call(i)}}}var jr={},Gr=En(jr),Kr=En(jr),Yr=En(jr);function Xr(e){if(e===jr)throw Error(re(174));return e}function qr(e,t){switch(Tn(Yr,t),Tn(Kr,e),Tn(Gr,jr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ht(null,"");break;default:t=ht(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}kn(Gr),Tn(Gr,t)}function Qr(){kn(Gr),kn(Kr),kn(Yr)}function Jr(e){Xr(Yr.current);var t=Xr(Gr.current),s=ht(t,e.type);t!==s&&(Tn(Kr,e),Tn(Gr,s))}function Zr(e){Kr.current===e&&(kn(Gr),kn(Kr))}var eo=En(0);function to(e){for(var t=e;null!==t;){if(13===t.tag){var s=t.memoizedState;if(null!==s&&(null===(s=s.dehydrated)||"$?"===s.data||"$!"===s.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var so=[];function io(){for(var e=0;e<so.length;e++)so[e]._workInProgressVersionPrimary=null;so.length=0}var ao=Me.ReactCurrentDispatcher,no=Me.ReactCurrentBatchConfig,ro=0,oo=null,lo=null,ho=null,co=!1,uo=!1,po=0,fo=0;function mo(){throw Error(re(321))}function go(e,t){if(null===t)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!oa(e[s],t[s]))return!1;return!0}function yo(e,t,s,i,a,n){if(ro=n,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ao.current=null===e||null===e.memoizedState?el:tl,e=s(i,a),uo){n=0;do{if(uo=!1,po=0,25<=n)throw Error(re(301));n+=1,ho=lo=null,t.updateQueue=null,ao.current=sl,e=s(i,a)}while(uo)}if(ao.current=Zo,t=null!==lo&&null!==lo.next,ro=0,ho=lo=oo=null,co=!1,t)throw Error(re(300));return e}function vo(){var e=0!==po;return po=0,e}function bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ho?oo.memoizedState=ho=e:ho=ho.next=e,ho}function wo(){if(null===lo){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=lo.next;var t=null===ho?oo.memoizedState:ho.next;if(null!==t)ho=t,lo=e;else{if(null===e)throw Error(re(310));e={memoizedState:(lo=e).memoizedState,baseState:lo.baseState,baseQueue:lo.baseQueue,queue:lo.queue,next:null},null===ho?oo.memoizedState=ho=e:ho=ho.next=e}return ho}function Mo(e,t){return"function"==typeof t?t(e):t}function xo(e){var t=wo(),s=t.queue;if(null===s)throw Error(re(311));s.lastRenderedReducer=e;var i=lo,a=i.baseQueue,n=s.pending;if(null!==n){if(null!==a){var r=a.next;a.next=n.next,n.next=r}i.baseQueue=a=n,s.pending=null}if(null!==a){n=a.next,i=i.baseState;var o=r=null,l=null,h=n;do{var c=h.lane;if((ro&c)===c)null!==l&&(l=l.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),i=h.hasEagerState?h.eagerState:e(i,h.action);else{var u={lane:c,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};null===l?(o=l=u,r=i):l=l.next=u,oo.lanes|=c,Fh|=c}h=h.next}while(null!==h&&h!==n);null===l?r=i:l.next=o,oa(i,t.memoizedState)||(wl=!0),t.memoizedState=i,t.baseState=r,t.baseQueue=l,s.lastRenderedState=i}if(null!==(e=s.interleaved)){a=e;do{n=a.lane,oo.lanes|=n,Fh|=n,a=a.next}while(a!==e)}else null===a&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function So(e){var t=wo(),s=t.queue;if(null===s)throw Error(re(311));s.lastRenderedReducer=e;var i=s.dispatch,a=s.pending,n=t.memoizedState;if(null!==a){s.pending=null;var r=a=a.next;do{n=e(n,r.action),r=r.next}while(r!==a);oa(n,t.memoizedState)||(wl=!0),t.memoizedState=n,null===t.baseQueue&&(t.baseState=n),s.lastRenderedState=n}return[n,i]}function Co(){}function Eo(e,t){var s=oo,i=wo(),a=t(),n=!oa(i.memoizedState,a);if(n&&(i.memoizedState=a,wl=!0),i=i.queue,Fo(Po.bind(null,s,i,e),[e]),i.getSnapshot!==t||n||null!==ho&&1&ho.memoizedState.tag){if(s.flags|=2048,Ro(9,To.bind(null,s,i,a,t),void 0,null),null===_h)throw Error(re(349));0!=(30&ro)||ko(s,t,a)}return a}function ko(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(s=t.stores)?t.stores=[e]:s.push(e)}function To(e,t,s,i){t.value=s,t.getSnapshot=i,Do(t)&&_o(e)}function Po(e,t,s){return s((function(){Do(t)&&_o(e)}))}function Do(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!oa(e,s)}catch(i){return!0}}function _o(e){var t=Ir(e,1);null!==t&&ic(t,e,1,-1)}function Ao(e){var t=bo();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Mo,lastRenderedState:e},t.queue=e,e=e.dispatch=Xo.bind(null,oo,e),[t.memoizedState,e]}function Ro(e,t,s,i){return e={tag:e,create:t,destroy:s,deps:i,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(s=t.lastEffect)?t.lastEffect=e.next=e:(i=s.next,s.next=e,e.next=i,t.lastEffect=e),e}function Oo(){return wo().memoizedState}function Bo(e,t,s,i){var a=bo();oo.flags|=e,a.memoizedState=Ro(1|t,s,void 0,void 0===i?null:i)}function Io(e,t,s,i){var a=wo();i=void 0===i?null:i;var n=void 0;if(null!==lo){var r=lo.memoizedState;if(n=r.destroy,null!==i&&go(i,r.deps))return void(a.memoizedState=Ro(t,s,n,i))}oo.flags|=e,a.memoizedState=Ro(1|t,s,n,i)}function Lo(e,t){return Bo(8390656,8,e,t)}function Fo(e,t){return Io(2048,8,e,t)}function No(e,t){return Io(4,2,e,t)}function Wo(e,t){return Io(4,4,e,t)}function Uo(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function zo(e,t,s){return s=null!=s?s.concat([e]):null,Io(4,4,Uo.bind(null,t,e),s)}function Vo(){}function Ho(e,t){var s=wo();t=void 0===t?null:t;var i=s.memoizedState;return null!==i&&null!==t&&go(t,i[1])?i[0]:(s.memoizedState=[e,t],e)}function $o(e,t){var s=wo();t=void 0===t?null:t;var i=s.memoizedState;return null!==i&&null!==t&&go(t,i[1])?i[0]:(e=e(),s.memoizedState=[e,t],e)}function jo(e,t,s){return 0==(21&ro)?(e.baseState&&(e.baseState=!1,wl=!0),e.memoizedState=s):(oa(s,t)||(s=gs(),oo.lanes|=s,Fh|=s,e.baseState=!0),t)}function Go(e,t){var s=ws;ws=0!==s&&4>s?s:4,e(!0);var i=no.transition;no.transition={};try{e(!1),t()}finally{ws=s,no.transition=i}}function Ko(){return wo().memoizedState}function Yo(e,t,s){var i=sc(e);s={lane:i,action:s,hasEagerState:!1,eagerState:null,next:null},qo(e)?Qo(t,s):null!==(s=Br(e,t,s,i))&&(ic(s,e,i,tc()),Jo(s,t,i))}function Xo(e,t,s){var i=sc(e),a={lane:i,action:s,hasEagerState:!1,eagerState:null,next:null};if(qo(e))Qo(t,a);else{var n=e.alternate;if(0===e.lanes&&(null===n||0===n.lanes)&&null!==(n=t.lastRenderedReducer))try{var r=t.lastRenderedState,o=n(r,s);if(a.hasEagerState=!0,a.eagerState=o,oa(o,r)){var l=t.interleaved;return null===l?(a.next=a,Or(t)):(a.next=l.next,l.next=a),void(t.interleaved=a)}}catch(h){}null!==(s=Br(e,t,a,i))&&(ic(s,e,i,a=tc()),Jo(s,t,i))}}function qo(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function Qo(e,t){uo=co=!0;var s=e.pending;null===s?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Jo(e,t,s){if(0!=(4194240&s)){var i=t.lanes;s|=i&=e.pendingLanes,t.lanes=s,bs(e,s)}}var Zo={readContext:Ar,useCallback:mo,useContext:mo,useEffect:mo,useImperativeHandle:mo,useInsertionEffect:mo,useLayoutEffect:mo,useMemo:mo,useReducer:mo,useRef:mo,useState:mo,useDebugValue:mo,useDeferredValue:mo,useTransition:mo,useMutableSource:mo,useSyncExternalStore:mo,useId:mo,unstable_isNewReconciler:!1},el={readContext:Ar,useCallback:function(e,t){return bo().memoizedState=[e,void 0===t?null:t],e},useContext:Ar,useEffect:Lo,useImperativeHandle:function(e,t,s){return s=null!=s?s.concat([e]):null,Bo(4194308,4,Uo.bind(null,t,e),s)},useLayoutEffect:function(e,t){return Bo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Bo(4,2,e,t)},useMemo:function(e,t){var s=bo();return t=void 0===t?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var i=bo();return t=void 0!==s?s(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Yo.bind(null,oo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},bo().memoizedState=e},useState:Ao,useDebugValue:Vo,useDeferredValue:function(e){return bo().memoizedState=e},useTransition:function(){var e=Ao(!1),t=e[0];return e=Go.bind(null,e[1]),bo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var i=oo,a=bo();if(nr){if(void 0===s)throw Error(re(407));s=s()}else{if(s=t(),null===_h)throw Error(re(349));0!=(30&ro)||ko(i,t,s)}a.memoizedState=s;var n={value:s,getSnapshot:t};return a.queue=n,Lo(Po.bind(null,i,n,e),[e]),i.flags|=2048,Ro(9,To.bind(null,i,n,s,t),void 0,null),s},useId:function(){var e=bo(),t=_h.identifierPrefix;if(nr){var s=Jn;t=":"+t+"R"+(s=(Qn&~(1<<32-os(Qn)-1)).toString(32)+s),0<(s=po++)&&(t+="H"+s.toString(32)),t+=":"}else t=":"+t+"r"+(s=fo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},tl={readContext:Ar,useCallback:Ho,useContext:Ar,useEffect:Fo,useImperativeHandle:zo,useInsertionEffect:No,useLayoutEffect:Wo,useMemo:$o,useReducer:xo,useRef:Oo,useState:function(){return xo(Mo)},useDebugValue:Vo,useDeferredValue:function(e){return jo(wo(),lo.memoizedState,e)},useTransition:function(){return[xo(Mo)[0],wo().memoizedState]},useMutableSource:Co,useSyncExternalStore:Eo,useId:Ko,unstable_isNewReconciler:!1},sl={readContext:Ar,useCallback:Ho,useContext:Ar,useEffect:Fo,useImperativeHandle:zo,useInsertionEffect:No,useLayoutEffect:Wo,useMemo:$o,useReducer:So,useRef:Oo,useState:function(){return So(Mo)},useDebugValue:Vo,useDeferredValue:function(e){var t=wo();return null===lo?t.memoizedState=e:jo(t,lo.memoizedState,e)},useTransition:function(){return[So(Mo)[0],wo().memoizedState]},useMutableSource:Co,useSyncExternalStore:Eo,useId:Ko,unstable_isNewReconciler:!1};function il(e,t){if(e&&e.defaultProps){for(var s in t=Ne({},t),e=e.defaultProps)void 0===t[s]&&(t[s]=e[s]);return t}return t}function al(e,t,s,i){s=null==(s=s(i,t=e.memoizedState))?t:Ne({},t,s),e.memoizedState=s,0===e.lanes&&(e.updateQueue.baseState=s)}var nl={isMounted:function(e){return!!(e=e._reactInternals)&&Ht(e)===e},enqueueSetState:function(e,t,s){e=e._reactInternals;var i=tc(),a=sc(e),n=Wr(i,a);n.payload=t,null!=s&&(n.callback=s),null!==(t=Ur(e,n,a))&&(ic(t,e,a,i),zr(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var i=tc(),a=sc(e),n=Wr(i,a);n.tag=1,n.payload=t,null!=s&&(n.callback=s),null!==(t=Ur(e,n,a))&&(ic(t,e,a,i),zr(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=tc(),i=sc(e),a=Wr(s,i);a.tag=2,null!=t&&(a.callback=t),null!==(t=Ur(e,a,i))&&(ic(t,e,i,s),zr(t,e,i))}};function rl(e,t,s,i,a,n,r){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,n,r):!(t.prototype&&t.prototype.isPureReactComponent&&la(s,i)&&la(a,n))}function ol(e,t,s){var i=!1,a=Pn,n=t.contextType;return"object"==typeof n&&null!==n?n=Ar(n):(a=On(t)?An:Dn.current,n=(i=null!=(i=t.contextTypes))?Rn(e,a):Pn),t=new t(s,n),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=nl,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=n),t}function ll(e,t,s,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(s,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(s,i),t.state!==e&&nl.enqueueReplaceState(t,t.state,null)}function hl(e,t,s,i){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},Fr(e);var n=t.contextType;"object"==typeof n&&null!==n?a.context=Ar(n):(n=On(t)?An:Dn.current,a.context=Rn(e,n)),a.state=e.memoizedState,"function"==typeof(n=t.getDerivedStateFromProps)&&(al(e,t,n,s),a.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(t=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&nl.enqueueReplaceState(a,a.state,null),Hr(e,s,a,i),a.state=e.memoizedState),"function"==typeof a.componentDidMount&&(e.flags|=4194308)}function cl(e,t){try{var s="",i=t;do{s+=Ve(i),i=i.return}while(i);var a=s}catch(n){a="\nError generating stack: "+n.message+"\n"+n.stack}return{value:e,source:t,stack:a,digest:null}}function ul(e,t,s){return{value:e,source:null,stack:null!=s?s:null,digest:null!=t?t:null}}function dl(e,t){try{console.error(t.value)}catch(s){setTimeout((function(){throw s}))}}var pl="function"==typeof WeakMap?WeakMap:Map;function fl(e,t,s){(s=Wr(-1,s)).tag=3,s.payload={element:null};var i=t.value;return s.callback=function(){jh||(jh=!0,Gh=i),dl(0,t)},s}function ml(e,t,s){(s=Wr(-1,s)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var a=t.value;s.payload=function(){return i(a)},s.callback=function(){dl(0,t)}}var n=e.stateNode;return null!==n&&"function"==typeof n.componentDidCatch&&(s.callback=function(){dl(0,t),"function"!=typeof i&&(null===Kh?Kh=new Set([this]):Kh.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),s}function gl(e,t,s){var i=e.pingCache;if(null===i){i=e.pingCache=new pl;var a=new Set;i.set(t,a)}else void 0===(a=i.get(t))&&(a=new Set,i.set(t,a));a.has(s)||(a.add(s),e=kc.bind(null,e,t,s),t.then(e,e))}function yl(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vl(e,t,s,i,a){return 0==(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,1===s.tag&&(null===s.alternate?s.tag=17:((t=Wr(-1,1)).tag=2,Ur(s,t,1))),s.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bl=Me.ReactCurrentOwner,wl=!1;function Ml(e,t,s,i){t.child=null===e?xr(t,null,s,i):Mr(t,e.child,s,i)}function xl(e,t,s,i,a){s=s.render;var n=t.ref;return _r(t,a),i=yo(e,t,s,i,n,a),s=vo(),null===e||wl?(nr&&s&&tr(t),t.flags|=1,Ml(e,t,i,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,jl(e,t,a))}function Sl(e,t,s,i,a){if(null===e){var n=s.type;return"function"!=typeof n||Oc(n)||void 0!==n.defaultProps||null!==s.compare||void 0!==s.defaultProps?((e=Ic(s.type,null,i,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=n,Cl(e,t,n,i,a))}if(n=e.child,0==(e.lanes&a)){var r=n.memoizedProps;if((s=null!==(s=s.compare)?s:la)(r,i)&&e.ref===t.ref)return jl(e,t,a)}return t.flags|=1,(e=Bc(n,i)).ref=t.ref,e.return=t,t.child=e}function Cl(e,t,s,i,a){if(null!==e){var n=e.memoizedProps;if(la(n,i)&&e.ref===t.ref){if(wl=!1,t.pendingProps=i=n,0==(e.lanes&a))return t.lanes=e.lanes,jl(e,t,a);0!=(131072&e.flags)&&(wl=!0)}}return Tl(e,t,s,i,a)}function El(e,t,s){var i=t.pendingProps,a=i.children,n=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tn(Bh,Oh),Oh|=s;else{if(0==(1073741824&s))return e=null!==n?n.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Tn(Bh,Oh),Oh|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==n?n.baseLanes:s,Tn(Bh,Oh),Oh|=i}else null!==n?(i=n.baseLanes|s,t.memoizedState=null):i=s,Tn(Bh,Oh),Oh|=i;return Ml(e,t,a,s),t.child}function kl(e,t){var s=t.ref;(null===e&&null!==s||null!==e&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function Tl(e,t,s,i,a){var n=On(s)?An:Dn.current;return n=Rn(t,n),_r(t,a),s=yo(e,t,s,i,n,a),i=vo(),null===e||wl?(nr&&i&&tr(t),t.flags|=1,Ml(e,t,s,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,jl(e,t,a))}function Pl(e,t,s,i,a){if(On(s)){var n=!0;Fn(t)}else n=!1;if(_r(t,a),null===t.stateNode)$l(e,t),ol(t,s,i),hl(t,s,i,a),i=!0;else if(null===e){var r=t.stateNode,o=t.memoizedProps;r.props=o;var l=r.context,h=s.contextType;h="object"==typeof h&&null!==h?Ar(h):Rn(t,h=On(s)?An:Dn.current);var c=s.getDerivedStateFromProps,u="function"==typeof c||"function"==typeof r.getSnapshotBeforeUpdate;u||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(o!==i||l!==h)&&ll(t,r,i,h),Lr=!1;var d=t.memoizedState;r.state=d,Hr(t,i,r,a),l=t.memoizedState,o!==i||d!==l||_n.current||Lr?("function"==typeof c&&(al(t,s,c,i),l=t.memoizedState),(o=Lr||rl(t,s,o,i,d,l,h))?(u||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(t.flags|=4194308)):("function"==typeof r.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),r.props=i,r.state=l,r.context=h,i=o):("function"==typeof r.componentDidMount&&(t.flags|=4194308),i=!1)}else{r=t.stateNode,Nr(e,t),o=t.memoizedProps,h=t.type===t.elementType?o:il(t.type,o),r.props=h,u=t.pendingProps,d=r.context,l="object"==typeof(l=s.contextType)&&null!==l?Ar(l):Rn(t,l=On(s)?An:Dn.current);var p=s.getDerivedStateFromProps;(c="function"==typeof p||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(o!==u||d!==l)&&ll(t,r,i,l),Lr=!1,d=t.memoizedState,r.state=d,Hr(t,i,r,a);var f=t.memoizedState;o!==u||d!==f||_n.current||Lr?("function"==typeof p&&(al(t,s,p,i),f=t.memoizedState),(h=Lr||rl(t,s,h,i,d,f,l)||!1)?(c||"function"!=typeof r.UNSAFE_componentWillUpdate&&"function"!=typeof r.componentWillUpdate||("function"==typeof r.componentWillUpdate&&r.componentWillUpdate(i,f,l),"function"==typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(i,f,l)),"function"==typeof r.componentDidUpdate&&(t.flags|=4),"function"==typeof r.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof r.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),r.props=i,r.state=f,r.context=l,i=h):("function"!=typeof r.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Dl(e,t,s,i,n,a)}function Dl(e,t,s,i,a,n){kl(e,t);var r=0!=(128&t.flags);if(!i&&!r)return a&&Nn(t,s,!1),jl(e,t,n);i=t.stateNode,bl.current=t;var o=r&&"function"!=typeof s.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&r?(t.child=Mr(t,e.child,null,n),t.child=Mr(t,null,o,n)):Ml(e,t,o,n),t.memoizedState=i.state,a&&Nn(t,s,!0),t.child}function _l(e){var t=e.stateNode;t.pendingContext?In(0,t.pendingContext,t.pendingContext!==t.context):t.context&&In(0,t.context,!1),qr(e,t.containerInfo)}function Al(e,t,s,i,a){return fr(),mr(a),t.flags|=256,Ml(e,t,s,i),t.child}var Rl,Ol,Bl,Il,Ll={dehydrated:null,treeContext:null,retryLane:0};function Fl(e){return{baseLanes:e,cachePool:null,transitions:null}}function Nl(e,t,s){var i,a=t.pendingProps,n=eo.current,r=!1,o=0!=(128&t.flags);if((i=o)||(i=(null===e||null!==e.memoizedState)&&0!=(2&n)),i?(r=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(n|=1),Tn(eo,1&n),null===e)return cr(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0==(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(o=a.children,e=a.fallback,r?(a=t.mode,r=t.child,o={mode:"hidden",children:o},0==(1&a)&&null!==r?(r.childLanes=0,r.pendingProps=o):r=Fc(o,a,0,null),e=Lc(e,a,s,null),r.return=t,e.return=t,r.sibling=e,t.child=r,t.child.memoizedState=Fl(s),t.memoizedState=Ll,e):Wl(t,o));if(null!==(n=e.memoizedState)&&null!==(i=n.dehydrated))return function(e,t,s,i,a,n,r){if(s)return 256&t.flags?(t.flags&=-257,Ul(e,t,r,i=ul(Error(re(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(n=i.fallback,a=t.mode,i=Fc({mode:"visible",children:i.children},a,0,null),(n=Lc(n,a,r,null)).flags|=2,i.return=t,n.return=t,i.sibling=n,t.child=i,0!=(1&t.mode)&&Mr(t,e.child,null,r),t.child.memoizedState=Fl(r),t.memoizedState=Ll,n);if(0==(1&t.mode))return Ul(e,t,r,null);if("$!"===a.data){if(i=a.nextSibling&&a.nextSibling.dataset)var o=i.dgst;return i=o,Ul(e,t,r,i=ul(n=Error(re(419)),i,void 0))}if(o=0!=(r&e.childLanes),wl||o){if(null!==(i=_h)){switch(r&-r){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!=(a&(i.suspendedLanes|r))?0:a)&&a!==n.retryLane&&(n.retryLane=a,Ir(e,a),ic(i,e,a,-1))}return gc(),Ul(e,t,r,i=ul(Error(re(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Pc.bind(null,e),a._reactRetry=t,null):(e=n.treeContext,ar=cn(a.nextSibling),ir=t,nr=!0,rr=null,null!==e&&(Yn[Xn++]=Qn,Yn[Xn++]=Jn,Yn[Xn++]=qn,Qn=e.id,Jn=e.overflow,qn=t),(t=Wl(t,i.children)).flags|=4096,t)}(e,t,o,a,i,n,s);if(r){r=a.fallback,o=t.mode,i=(n=e.child).sibling;var l={mode:"hidden",children:a.children};return 0==(1&o)&&t.child!==n?((a=t.child).childLanes=0,a.pendingProps=l,t.deletions=null):(a=Bc(n,l)).subtreeFlags=14680064&n.subtreeFlags,null!==i?r=Bc(i,r):(r=Lc(r,o,s,null)).flags|=2,r.return=t,a.return=t,a.sibling=r,t.child=a,a=r,r=t.child,o=null===(o=e.child.memoizedState)?Fl(s):{baseLanes:o.baseLanes|s,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=e.childLanes&~s,t.memoizedState=Ll,a}return e=(r=e.child).sibling,a=Bc(r,{mode:"visible",children:a.children}),0==(1&t.mode)&&(a.lanes=s),a.return=t,a.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=a,t.memoizedState=null,a}function Wl(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ul(e,t,s,i){return null!==i&&mr(i),Mr(t,e.child,null,s),(e=Wl(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zl(e,t,s){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Dr(e.return,t,s)}function Vl(e,t,s,i,a){var n=e.memoizedState;null===n?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:s,tailMode:a}:(n.isBackwards=t,n.rendering=null,n.renderingStartTime=0,n.last=i,n.tail=s,n.tailMode=a)}function Hl(e,t,s){var i=t.pendingProps,a=i.revealOrder,n=i.tail;if(Ml(e,t,i.children,s),0!=(2&(i=eo.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zl(e,s,t);else if(19===e.tag)zl(e,s,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Tn(eo,i),0==(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;null!==s;)null!==(e=s.alternate)&&null===to(e)&&(a=s),s=s.sibling;null===(s=a)?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),Vl(t,!1,a,s,n);break;case"backwards":for(s=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===to(e)){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}Vl(t,!0,s,null,n);break;case"together":Vl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function $l(e,t){0==(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function jl(e,t,s){if(null!==e&&(t.dependencies=e.dependencies),Fh|=t.lanes,0==(s&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(re(153));if(null!==t.child){for(s=Bc(e=t.child,e.pendingProps),t.child=s,s.return=t;null!==e.sibling;)e=e.sibling,(s=s.sibling=Bc(e,e.pendingProps)).return=t;s.sibling=null}return t.child}function Gl(e,t){if(!nr)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;null!==t;)null!==t.alternate&&(s=t),t=t.sibling;null===s?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var i=null;null!==s;)null!==s.alternate&&(i=s),s=s.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Kl(e){var t=null!==e.alternate&&e.alternate.child===e.child,s=0,i=0;if(t)for(var a=e.child;null!==a;)s|=a.lanes|a.childLanes,i|=14680064&a.subtreeFlags,i|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)s|=a.lanes|a.childLanes,i|=a.subtreeFlags,i|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=i,e.childLanes=s,t}function Yl(e,t,s){var i=t.pendingProps;switch(sr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kl(t),null;case 1:case 17:return On(t.type)&&Bn(),Kl(t),null;case 3:return i=t.stateNode,Qr(),kn(_n),kn(Dn),io(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(dr(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==rr&&(oc(rr),rr=null))),Ol(e,t),Kl(t),null;case 5:Zr(t);var a=Xr(Yr.current);if(s=t.type,null!==e&&null!=t.stateNode)Bl(e,t,s,i,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(re(166));return Kl(t),null}if(e=Xr(Gr.current),dr(t)){i=t.stateNode,s=t.type;var n=t.memoizedProps;switch(i[pn]=t,i[fn]=n,e=0!=(1&t.mode),s){case"dialog":Wa("cancel",i),Wa("close",i);break;case"iframe":case"object":case"embed":Wa("load",i);break;case"video":case"audio":for(a=0;a<Ia.length;a++)Wa(Ia[a],i);break;case"source":Wa("error",i);break;case"img":case"image":case"link":Wa("error",i),Wa("load",i);break;case"details":Wa("toggle",i);break;case"input":Qe(i,n),Wa("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!n.multiple},Wa("invalid",i);break;case"textarea":nt(i,n),Wa("invalid",i)}for(var r in bt(s,n),a=null,n)if(n.hasOwnProperty(r)){var o=n[r];"children"===r?"string"==typeof o?i.textContent!==o&&(!0!==n.suppressHydrationWarning&&Ja(i.textContent,o,e),a=["children",o]):"number"==typeof o&&i.textContent!==""+o&&(!0!==n.suppressHydrationWarning&&Ja(i.textContent,o,e),a=["children",""+o]):le.hasOwnProperty(r)&&null!=o&&"onScroll"===r&&Wa("scroll",i)}switch(s){case"input":Ke(i),et(i,n,!0);break;case"textarea":Ke(i),ot(i);break;case"select":case"option":break;default:"function"==typeof n.onClick&&(i.onclick=Za)}i=a,t.updateQueue=i,null!==i&&(t.flags|=4)}else{r=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=lt(s)),"http://www.w3.org/1999/xhtml"===e?"script"===s?((e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=r.createElement(s,{is:i.is}):(e=r.createElement(s),"select"===s&&(r=e,i.multiple?r.multiple=!0:i.size&&(r.size=i.size))):e=r.createElementNS(e,s),e[pn]=t,e[fn]=i,Rl(e,t,!1,!1),t.stateNode=e;e:{switch(r=wt(s,i),s){case"dialog":Wa("cancel",e),Wa("close",e),a=i;break;case"iframe":case"object":case"embed":Wa("load",e),a=i;break;case"video":case"audio":for(a=0;a<Ia.length;a++)Wa(Ia[a],e);a=i;break;case"source":Wa("error",e),a=i;break;case"img":case"image":case"link":Wa("error",e),Wa("load",e),a=i;break;case"details":Wa("toggle",e),a=i;break;case"input":Qe(e,i),a=qe(e,i),Wa("invalid",e);break;case"option":default:a=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},a=Ne({},i,{value:void 0}),Wa("invalid",e);break;case"textarea":nt(e,i),a=at(e,i),Wa("invalid",e)}for(n in bt(s,a),o=a)if(o.hasOwnProperty(n)){var l=o[n];"style"===n?yt(e,l):"dangerouslySetInnerHTML"===n?null!=(l=l?l.__html:void 0)&&dt(e,l):"children"===n?"string"==typeof l?("textarea"!==s||""!==l)&&pt(e,l):"number"==typeof l&&pt(e,""+l):"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&"autoFocus"!==n&&(le.hasOwnProperty(n)?null!=l&&"onScroll"===n&&Wa("scroll",e):null!=l&&we(e,n,l,r))}switch(s){case"input":Ke(e),et(e,i,!1);break;case"textarea":Ke(e),ot(e);break;case"option":null!=i.value&&e.setAttribute("value",""+je(i.value));break;case"select":e.multiple=!!i.multiple,null!=(n=i.value)?it(e,!!i.multiple,n,!1):null!=i.defaultValue&&it(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=Za)}switch(s){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Kl(t),null;case 6:if(e&&null!=t.stateNode)Il(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(re(166));if(s=Xr(Yr.current),Xr(Gr.current),dr(t)){if(i=t.stateNode,s=t.memoizedProps,i[pn]=t,(n=i.nodeValue!==s)&&null!==(e=ir))switch(e.tag){case 3:Ja(i.nodeValue,s,0!=(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ja(i.nodeValue,s,0!=(1&e.mode))}n&&(t.flags|=4)}else(i=(9===s.nodeType?s:s.ownerDocument).createTextNode(i))[pn]=t,t.stateNode=i}return Kl(t),null;case 13:if(kn(eo),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(nr&&null!==ar&&0!=(1&t.mode)&&0==(128&t.flags))pr(),fr(),t.flags|=98560,n=!1;else if(n=dr(t),null!==i&&null!==i.dehydrated){if(null===e){if(!n)throw Error(re(318));if(!(n=null!==(n=t.memoizedState)?n.dehydrated:null))throw Error(re(317));n[pn]=t}else fr(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Kl(t),n=!1}else null!==rr&&(oc(rr),rr=null),n=!0;if(!n)return 65536&t.flags?t:null}return 0!=(128&t.flags)?(t.lanes=s,t):((i=null!==i)!=(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!=(1&t.mode)&&(null===e||0!=(1&eo.current)?0===Ih&&(Ih=3):gc())),null!==t.updateQueue&&(t.flags|=4),Kl(t),null);case 4:return Qr(),Ol(e,t),null===e&&Va(t.stateNode.containerInfo),Kl(t),null;case 10:return Pr(t.type._context),Kl(t),null;case 19:if(kn(eo),null===(n=t.memoizedState))return Kl(t),null;if(i=0!=(128&t.flags),null===(r=n.rendering))if(i)Gl(n,!1);else{if(0!==Ih||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(r=to(e))){for(t.flags|=128,Gl(n,!1),null!==(i=r.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=s,s=t.child;null!==s;)e=i,(n=s).flags&=14680066,null===(r=n.alternate)?(n.childLanes=0,n.lanes=e,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=r.childLanes,n.lanes=r.lanes,n.child=r.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=r.memoizedProps,n.memoizedState=r.memoizedState,n.updateQueue=r.updateQueue,n.type=r.type,e=r.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return Tn(eo,1&eo.current|2),t.child}e=e.sibling}null!==n.tail&&Jt()>Hh&&(t.flags|=128,i=!0,Gl(n,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=to(r))){if(t.flags|=128,i=!0,null!==(s=e.updateQueue)&&(t.updateQueue=s,t.flags|=4),Gl(n,!0),null===n.tail&&"hidden"===n.tailMode&&!r.alternate&&!nr)return Kl(t),null}else 2*Jt()-n.renderingStartTime>Hh&&1073741824!==s&&(t.flags|=128,i=!0,Gl(n,!1),t.lanes=4194304);n.isBackwards?(r.sibling=t.child,t.child=r):(null!==(s=n.last)?s.sibling=r:t.child=r,n.last=r)}return null!==n.tail?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=Jt(),t.sibling=null,s=eo.current,Tn(eo,i?1&s|2:1&s),t):(Kl(t),null);case 22:case 23:return dc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!=(1&t.mode)?0!=(1073741824&Oh)&&(Kl(t),6&t.subtreeFlags&&(t.flags|=8192)):Kl(t),null;case 24:case 25:return null}throw Error(re(156,t.tag))}function Xl(e,t){switch(sr(t),t.tag){case 1:return On(t.type)&&Bn(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qr(),kn(_n),kn(Dn),io(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zr(t),null;case 13:if(kn(eo),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(re(340));fr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return kn(eo),null;case 4:return Qr(),null;case 10:return Pr(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Rl=function(e,t){for(var s=t.child;null!==s;){if(5===s.tag||6===s.tag)e.appendChild(s.stateNode);else if(4!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},Ol=function(){},Bl=function(e,t,s,i){var a=e.memoizedProps;if(a!==i){e=t.stateNode,Xr(Gr.current);var n,r=null;switch(s){case"input":a=qe(e,a),i=qe(e,i),r=[];break;case"select":a=Ne({},a,{value:void 0}),i=Ne({},i,{value:void 0}),r=[];break;case"textarea":a=at(e,a),i=at(e,i),r=[];break;default:"function"!=typeof a.onClick&&"function"==typeof i.onClick&&(e.onclick=Za)}for(h in bt(s,i),s=null,a)if(!i.hasOwnProperty(h)&&a.hasOwnProperty(h)&&null!=a[h])if("style"===h){var o=a[h];for(n in o)o.hasOwnProperty(n)&&(s||(s={}),s[n]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(le.hasOwnProperty(h)?r||(r=[]):(r=r||[]).push(h,null));for(h in i){var l=i[h];if(o=null!=a?a[h]:void 0,i.hasOwnProperty(h)&&l!==o&&(null!=l||null!=o))if("style"===h)if(o){for(n in o)!o.hasOwnProperty(n)||l&&l.hasOwnProperty(n)||(s||(s={}),s[n]="");for(n in l)l.hasOwnProperty(n)&&o[n]!==l[n]&&(s||(s={}),s[n]=l[n])}else s||(r||(r=[]),r.push(h,s)),s=l;else"dangerouslySetInnerHTML"===h?(l=l?l.__html:void 0,o=o?o.__html:void 0,null!=l&&o!==l&&(r=r||[]).push(h,l)):"children"===h?"string"!=typeof l&&"number"!=typeof l||(r=r||[]).push(h,""+l):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(le.hasOwnProperty(h)?(null!=l&&"onScroll"===h&&Wa("scroll",e),r||o===l||(r=[])):(r=r||[]).push(h,l))}s&&(r=r||[]).push("style",s);var h=r;(t.updateQueue=h)&&(t.flags|=4)}},Il=function(e,t,s,i){s!==i&&(t.flags|=4)};var ql=!1,Ql=!1,Jl="function"==typeof WeakSet?WeakSet:Set,Zl=null;function eh(e,t){var s=e.ref;if(null!==s)if("function"==typeof s)try{s(null)}catch(i){Ec(e,t,i)}else s.current=null}function th(e,t,s){try{s()}catch(i){Ec(e,t,i)}}var sh=!1;function ih(e,t,s){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var a=i=i.next;do{if((a.tag&e)===e){var n=a.destroy;a.destroy=void 0,void 0!==n&&th(t,s,n)}a=a.next}while(a!==i)}}function ah(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var s=t=t.next;do{if((s.tag&e)===e){var i=s.create;s.destroy=i()}s=s.next}while(s!==t)}}function nh(e){var t=e.ref;if(null!==t){var s=e.stateNode;e.tag,e=s,"function"==typeof t?t(e):t.current=e}}function rh(e){var t=e.alternate;null!==t&&(e.alternate=null,rh(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[pn],delete t[fn],delete t[gn],delete t[yn],delete t[vn]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oh(e){return 5===e.tag||3===e.tag||4===e.tag}function lh(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oh(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function hh(e,t,s){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===s.nodeType?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(8===s.nodeType?(t=s.parentNode).insertBefore(e,s):(t=s).appendChild(e),null!=(s=s._reactRootContainer)||null!==t.onclick||(t.onclick=Za));else if(4!==i&&null!==(e=e.child))for(hh(e,t,s),e=e.sibling;null!==e;)hh(e,t,s),e=e.sibling}function ch(e,t,s){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ch(e,t,s),e=e.sibling;null!==e;)ch(e,t,s),e=e.sibling}var uh=null,dh=!1;function ph(e,t,s){for(s=s.child;null!==s;)fh(e,t,s),s=s.sibling}function fh(e,t,s){if(rs&&"function"==typeof rs.onCommitFiberUnmount)try{rs.onCommitFiberUnmount(ns,s)}catch(o){}switch(s.tag){case 5:Ql||eh(s,t);case 6:var i=uh,a=dh;uh=null,ph(e,t,s),dh=a,null!==(uh=i)&&(dh?(e=uh,s=s.stateNode,8===e.nodeType?e.parentNode.removeChild(s):e.removeChild(s)):uh.removeChild(s.stateNode));break;case 18:null!==uh&&(dh?(e=uh,s=s.stateNode,8===e.nodeType?hn(e.parentNode,s):1===e.nodeType&&hn(e,s),Hs(e)):hn(uh,s.stateNode));break;case 4:i=uh,a=dh,uh=s.stateNode.containerInfo,dh=!0,ph(e,t,s),uh=i,dh=a;break;case 0:case 11:case 14:case 15:if(!Ql&&null!==(i=s.updateQueue)&&null!==(i=i.lastEffect)){a=i=i.next;do{var n=a,r=n.destroy;n=n.tag,void 0!==r&&(0!=(2&n)||0!=(4&n))&&th(s,t,r),a=a.next}while(a!==i)}ph(e,t,s);break;case 1:if(!Ql&&(eh(s,t),"function"==typeof(i=s.stateNode).componentWillUnmount))try{i.props=s.memoizedProps,i.state=s.memoizedState,i.componentWillUnmount()}catch(o){Ec(s,t,o)}ph(e,t,s);break;case 21:ph(e,t,s);break;case 22:1&s.mode?(Ql=(i=Ql)||null!==s.memoizedState,ph(e,t,s),Ql=i):ph(e,t,s);break;default:ph(e,t,s)}}function mh(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var s=e.stateNode;null===s&&(s=e.stateNode=new Jl),t.forEach((function(t){var i=Dc.bind(null,e,t);s.has(t)||(s.add(t),t.then(i,i))}))}}function gh(e,t){var s=t.deletions;if(null!==s)for(var i=0;i<s.length;i++){var a=s[i];try{var n=e,r=t,o=r;e:for(;null!==o;){switch(o.tag){case 5:uh=o.stateNode,dh=!1;break e;case 3:case 4:uh=o.stateNode.containerInfo,dh=!0;break e}o=o.return}if(null===uh)throw Error(re(160));fh(n,r,a),uh=null,dh=!1;var l=a.alternate;null!==l&&(l.return=null),a.return=null}catch(h){Ec(a,t,h)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yh(t,e),t=t.sibling}function yh(e,t){var s=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gh(t,e),vh(e),4&i){try{ih(3,e,e.return),ah(3,e)}catch(m){Ec(e,e.return,m)}try{ih(5,e,e.return)}catch(m){Ec(e,e.return,m)}}break;case 1:gh(t,e),vh(e),512&i&&null!==s&&eh(s,s.return);break;case 5:if(gh(t,e),vh(e),512&i&&null!==s&&eh(s,s.return),32&e.flags){var a=e.stateNode;try{pt(a,"")}catch(m){Ec(e,e.return,m)}}if(4&i&&null!=(a=e.stateNode)){var n=e.memoizedProps,r=null!==s?s.memoizedProps:n,o=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===o&&"radio"===n.type&&null!=n.name&&Je(a,n),wt(o,r);var h=wt(o,n);for(r=0;r<l.length;r+=2){var c=l[r],u=l[r+1];"style"===c?yt(a,u):"dangerouslySetInnerHTML"===c?dt(a,u):"children"===c?pt(a,u):we(a,c,u,h)}switch(o){case"input":Ze(a,n);break;case"textarea":rt(a,n);break;case"select":var d=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!n.multiple;var p=n.value;null!=p?it(a,!!n.multiple,p,!1):d!==!!n.multiple&&(null!=n.defaultValue?it(a,!!n.multiple,n.defaultValue,!0):it(a,!!n.multiple,n.multiple?[]:"",!1))}a[fn]=n}catch(m){Ec(e,e.return,m)}}break;case 6:if(gh(t,e),vh(e),4&i){if(null===e.stateNode)throw Error(re(162));a=e.stateNode,n=e.memoizedProps;try{a.nodeValue=n}catch(m){Ec(e,e.return,m)}}break;case 3:if(gh(t,e),vh(e),4&i&&null!==s&&s.memoizedState.isDehydrated)try{Hs(t.containerInfo)}catch(m){Ec(e,e.return,m)}break;case 4:default:gh(t,e),vh(e);break;case 13:gh(t,e),vh(e),8192&(a=e.child).flags&&(n=null!==a.memoizedState,a.stateNode.isHidden=n,!n||null!==a.alternate&&null!==a.alternate.memoizedState||(Vh=Jt())),4&i&&mh(e);break;case 22:if(c=null!==s&&null!==s.memoizedState,1&e.mode?(Ql=(h=Ql)||c,gh(t,e),Ql=h):gh(t,e),vh(e),8192&i){if(h=null!==e.memoizedState,(e.stateNode.isHidden=h)&&!c&&0!=(1&e.mode))for(Zl=e,c=e.child;null!==c;){for(u=Zl=c;null!==Zl;){switch(p=(d=Zl).child,d.tag){case 0:case 11:case 14:case 15:ih(4,d,d.return);break;case 1:eh(d,d.return);var f=d.stateNode;if("function"==typeof f.componentWillUnmount){i=d,s=d.return;try{t=i,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(m){Ec(i,s,m)}}break;case 5:eh(d,d.return);break;case 22:if(null!==d.memoizedState){xh(u);continue}}null!==p?(p.return=d,Zl=p):xh(u)}c=c.sibling}e:for(c=null,u=e;;){if(5===u.tag){if(null===c){c=u;try{a=u.stateNode,h?"function"==typeof(n=a.style).setProperty?n.setProperty("display","none","important"):n.display="none":(o=u.stateNode,r=null!=(l=u.memoizedProps.style)&&l.hasOwnProperty("display")?l.display:null,o.style.display=gt("display",r))}catch(m){Ec(e,e.return,m)}}}else if(6===u.tag){if(null===c)try{u.stateNode.nodeValue=h?"":u.memoizedProps}catch(m){Ec(e,e.return,m)}}else if((22!==u.tag&&23!==u.tag||null===u.memoizedState||u===e)&&null!==u.child){u.child.return=u,u=u.child;continue}if(u===e)break e;for(;null===u.sibling;){if(null===u.return||u.return===e)break e;c===u&&(c=null),u=u.return}c===u&&(c=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:gh(t,e),vh(e),4&i&&mh(e);case 21:}}function vh(e){var t=e.flags;if(2&t){try{e:{for(var s=e.return;null!==s;){if(oh(s)){var i=s;break e}s=s.return}throw Error(re(160))}switch(i.tag){case 5:var a=i.stateNode;32&i.flags&&(pt(a,""),i.flags&=-33),ch(e,lh(e),a);break;case 3:case 4:var n=i.stateNode.containerInfo;hh(e,lh(e),n);break;default:throw Error(re(161))}}catch(r){Ec(e,e.return,r)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bh(e,t,s){Zl=e,wh(e)}function wh(e,t,s){for(var i=0!=(1&e.mode);null!==Zl;){var a=Zl,n=a.child;if(22===a.tag&&i){var r=null!==a.memoizedState||ql;if(!r){var o=a.alternate,l=null!==o&&null!==o.memoizedState||Ql;o=ql;var h=Ql;if(ql=r,(Ql=l)&&!h)for(Zl=a;null!==Zl;)l=(r=Zl).child,22===r.tag&&null!==r.memoizedState?Sh(a):null!==l?(l.return=r,Zl=l):Sh(a);for(;null!==n;)Zl=n,wh(n),n=n.sibling;Zl=a,ql=o,Ql=h}Mh(e)}else 0!=(8772&a.subtreeFlags)&&null!==n?(n.return=a,Zl=n):Mh(e)}}function Mh(e){for(;null!==Zl;){var t=Zl;if(0!=(8772&t.flags)){var s=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ql||ah(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ql)if(null===s)i.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:il(t.type,s.memoizedProps);i.componentDidUpdate(a,s.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var n=t.updateQueue;null!==n&&$r(t,n,i);break;case 3:var r=t.updateQueue;if(null!==r){if(s=null,null!==t.child)switch(t.child.tag){case 5:case 1:s=t.child.stateNode}$r(t,r,s)}break;case 5:var o=t.stateNode;if(null===s&&4&t.flags){s=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&s.focus();break;case"img":l.src&&(s.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var h=t.alternate;if(null!==h){var c=h.memoizedState;if(null!==c){var u=c.dehydrated;null!==u&&Hs(u)}}}break;default:throw Error(re(163))}Ql||512&t.flags&&nh(t)}catch(d){Ec(t,t.return,d)}}if(t===e){Zl=null;break}if(null!==(s=t.sibling)){s.return=t.return,Zl=s;break}Zl=t.return}}function xh(e){for(;null!==Zl;){var t=Zl;if(t===e){Zl=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zl=s;break}Zl=t.return}}function Sh(e){for(;null!==Zl;){var t=Zl;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{ah(4,t)}catch(l){Ec(t,s,l)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var a=t.return;try{i.componentDidMount()}catch(l){Ec(t,a,l)}}var n=t.return;try{nh(t)}catch(l){Ec(t,n,l)}break;case 5:var r=t.return;try{nh(t)}catch(l){Ec(t,r,l)}}}catch(l){Ec(t,t.return,l)}if(t===e){Zl=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zl=o;break}Zl=t.return}}var Ch,Eh=Math.ceil,kh=Me.ReactCurrentDispatcher,Th=Me.ReactCurrentOwner,Ph=Me.ReactCurrentBatchConfig,Dh=0,_h=null,Ah=null,Rh=0,Oh=0,Bh=En(0),Ih=0,Lh=null,Fh=0,Nh=0,Wh=0,Uh=null,zh=null,Vh=0,Hh=1/0,$h=null,jh=!1,Gh=null,Kh=null,Yh=!1,Xh=null,qh=0,Qh=0,Jh=null,Zh=-1,ec=0;function tc(){return 0!=(6&Dh)?Jt():-1!==Zh?Zh:Zh=Jt()}function sc(e){return 0==(1&e.mode)?1:0!=(2&Dh)&&0!==Rh?Rh&-Rh:null!==gr.transition?(0===ec&&(ec=gs()),ec):0!==(e=ws)?e:e=void 0===(e=window.event)?16:Qs(e.type)}function ic(e,t,s,i){if(50<Qh)throw Qh=0,Jh=null,Error(re(185));vs(e,s,i),0!=(2&Dh)&&e===_h||(e===_h&&(0==(2&Dh)&&(Nh|=s),4===Ih&&lc(e,Rh)),ac(e,i),1===s&&0===Dh&&0==(1&t.mode)&&(Hh=Jt()+500,Un&&Hn()))}function ac(e,t){var s=e.callbackNode;!function(e,t){for(var s=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,n=e.pendingLanes;0<n;){var r=31-os(n),o=1<<r,l=a[r];-1===l?0!=(o&s)&&0==(o&i)||(a[r]=fs(o,t)):l<=t&&(e.expiredLanes|=o),n&=~o}}(e,t);var i=ps(e,e===_h?Rh:0);if(0===i)null!==s&&Xt(s),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=s&&Xt(s),1===t)0===e.tag?function(e){Un=!0,Vn(e)}(hc.bind(null,e)):Vn(hc.bind(null,e)),on((function(){0==(6&Dh)&&Hn()})),s=null;else{switch(Ms(i)){case 1:s=es;break;case 4:s=ts;break;case 16:default:s=ss;break;case 536870912:s=as}s=_c(s,nc.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function nc(e,t){if(Zh=-1,ec=0,0!=(6&Dh))throw Error(re(327));var s=e.callbackNode;if(Sc()&&e.callbackNode!==s)return null;var i=ps(e,e===_h?Rh:0);if(0===i)return null;if(0!=(30&i)||0!=(i&e.expiredLanes)||t)t=yc(e,i);else{t=i;var a=Dh;Dh|=2;var n=mc();for(_h===e&&Rh===t||($h=null,Hh=Jt()+500,pc(e,t));;)try{bc();break}catch(o){fc(e,o)}Tr(),kh.current=n,Dh=a,null!==Ah?t=0:(_h=null,Rh=0,t=Ih)}if(0!==t){if(2===t&&0!==(a=ms(e))&&(i=a,t=rc(e,a)),1===t)throw s=Lh,pc(e,0),lc(e,i),ac(e,Jt()),s;if(6===t)lc(e,i);else{if(a=e.current.alternate,0==(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var s=t.updateQueue;if(null!==s&&null!==(s=s.stores))for(var i=0;i<s.length;i++){var a=s[i],n=a.getSnapshot;a=a.value;try{if(!oa(n(),a))return!1}catch(r){return!1}}}if(s=t.child,16384&t.subtreeFlags&&null!==s)s.return=t,t=s;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=yc(e,i))&&0!==(n=ms(e))&&(i=n,t=rc(e,n)),1===t))throw s=Lh,pc(e,0),lc(e,i),ac(e,Jt()),s;switch(e.finishedWork=a,e.finishedLanes=i,t){case 0:case 1:throw Error(re(345));case 2:case 5:xc(e,zh,$h);break;case 3:if(lc(e,i),(130023424&i)===i&&10<(t=Vh+500-Jt())){if(0!==ps(e,0))break;if(((a=e.suspendedLanes)&i)!==i){tc(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=an(xc.bind(null,e,zh,$h),t);break}xc(e,zh,$h);break;case 4:if(lc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,a=-1;0<i;){var r=31-os(i);n=1<<r,(r=t[r])>a&&(a=r),i&=~n}if(i=a,10<(i=(120>(i=Jt()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Eh(i/1960))-i)){e.timeoutHandle=an(xc.bind(null,e,zh,$h),i);break}xc(e,zh,$h);break;default:throw Error(re(329))}}}return ac(e,Jt()),e.callbackNode===s?nc.bind(null,e):null}function rc(e,t){var s=Uh;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=yc(e,t))&&(t=zh,zh=s,null!==t&&oc(t)),e}function oc(e){null===zh?zh=e:zh.push.apply(zh,e)}function lc(e,t){for(t&=~Wh,t&=~Nh,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-os(t),i=1<<s;e[s]=-1,t&=~i}}function hc(e){if(0!=(6&Dh))throw Error(re(327));Sc();var t=ps(e,0);if(0==(1&t))return ac(e,Jt()),null;var s=yc(e,t);if(0!==e.tag&&2===s){var i=ms(e);0!==i&&(t=i,s=rc(e,i))}if(1===s)throw s=Lh,pc(e,0),lc(e,t),ac(e,Jt()),s;if(6===s)throw Error(re(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,zh,$h),ac(e,Jt()),null}function cc(e,t){var s=Dh;Dh|=1;try{return e(t)}finally{0===(Dh=s)&&(Hh=Jt()+500,Un&&Hn())}}function uc(e){null!==Xh&&0===Xh.tag&&0==(6&Dh)&&Sc();var t=Dh;Dh|=1;var s=Ph.transition,i=ws;try{if(Ph.transition=null,ws=1,e)return e()}finally{ws=i,Ph.transition=s,0==(6&(Dh=t))&&Hn()}}function dc(){Oh=Bh.current,kn(Bh)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(-1!==s&&(e.timeoutHandle=-1,nn(s)),null!==Ah)for(s=Ah.return;null!==s;){var i=s;switch(sr(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Bn();break;case 3:Qr(),kn(_n),kn(Dn),io();break;case 5:Zr(i);break;case 4:Qr();break;case 13:case 19:kn(eo);break;case 10:Pr(i.type._context);break;case 22:case 23:dc()}s=s.return}if(_h=e,Ah=e=Bc(e.current,null),Rh=Oh=t,Ih=0,Lh=null,Wh=Nh=Fh=0,zh=Uh=null,null!==Rr){for(t=0;t<Rr.length;t++)if(null!==(i=(s=Rr[t]).interleaved)){s.interleaved=null;var a=i.next,n=s.pending;if(null!==n){var r=n.next;n.next=a,i.next=r}s.pending=i}Rr=null}return e}function fc(e,t){for(;;){var s=Ah;try{if(Tr(),ao.current=Zo,co){for(var i=oo.memoizedState;null!==i;){var a=i.queue;null!==a&&(a.pending=null),i=i.next}co=!1}if(ro=0,ho=lo=oo=null,uo=!1,po=0,Th.current=null,null===s||null===s.return){Ih=1,Lh=t,Ah=null;break}e:{var n=e,r=s.return,o=s,l=t;if(t=Rh,o.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var h=l,c=o,u=c.tag;if(0==(1&c.mode)&&(0===u||11===u||15===u)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=yl(r);if(null!==p){p.flags&=-257,vl(p,r,o,0,t),1&p.mode&&gl(n,h,t),l=h;var f=(t=p).updateQueue;if(null===f){var m=new Set;m.add(l),t.updateQueue=m}else f.add(l);break e}if(0==(1&t)){gl(n,h,t),gc();break e}l=Error(re(426))}else if(nr&&1&o.mode){var g=yl(r);if(null!==g){0==(65536&g.flags)&&(g.flags|=256),vl(g,r,o,0,t),mr(cl(l,o));break e}}n=l=cl(l,o),4!==Ih&&(Ih=2),null===Uh?Uh=[n]:Uh.push(n),n=r;do{switch(n.tag){case 3:n.flags|=65536,t&=-t,n.lanes|=t,Vr(n,fl(0,l,t));break e;case 1:o=l;var y=n.type,v=n.stateNode;if(0==(128&n.flags)&&("function"==typeof y.getDerivedStateFromError||null!==v&&"function"==typeof v.componentDidCatch&&(null===Kh||!Kh.has(v)))){n.flags|=65536,t&=-t,n.lanes|=t,Vr(n,ml(n,o,t));break e}}n=n.return}while(null!==n)}Mc(s)}catch(b){t=b,Ah===s&&null!==s&&(Ah=s=s.return);continue}break}}function mc(){var e=kh.current;return kh.current=Zo,null===e?Zo:e}function gc(){0!==Ih&&3!==Ih&&2!==Ih||(Ih=4),null===_h||0==(268435455&Fh)&&0==(268435455&Nh)||lc(_h,Rh)}function yc(e,t){var s=Dh;Dh|=2;var i=mc();for(_h===e&&Rh===t||($h=null,pc(e,t));;)try{vc();break}catch(a){fc(e,a)}if(Tr(),Dh=s,kh.current=i,null!==Ah)throw Error(re(261));return _h=null,Rh=0,Ih}function vc(){for(;null!==Ah;)wc(Ah)}function bc(){for(;null!==Ah&&!qt();)wc(Ah)}function wc(e){var t=Ch(e.alternate,e,Oh);e.memoizedProps=e.pendingProps,null===t?Mc(e):Ah=t,Th.current=null}function Mc(e){var t=e;do{var s=t.alternate;if(e=t.return,0==(32768&t.flags)){if(null!==(s=Yl(s,t,Oh)))return void(Ah=s)}else{if(null!==(s=Xl(s,t)))return s.flags&=32767,void(Ah=s);if(null===e)return Ih=6,void(Ah=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ah=t);Ah=t=e}while(null!==t);0===Ih&&(Ih=5)}function xc(e,t,s){var i=ws,a=Ph.transition;try{Ph.transition=null,ws=1,function(e,t,s,i){do{Sc()}while(null!==Xh);if(0!=(6&Dh))throw Error(re(327));s=e.finishedWork;var a=e.finishedLanes;if(null===s)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(re(177));e.callbackNode=null,e.callbackPriority=0;var n=s.lanes|s.childLanes;if(function(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-os(s),n=1<<a;t[a]=0,i[a]=-1,e[a]=-1,s&=~n}}(e,n),e===_h&&(Ah=_h=null,Rh=0),0==(2064&s.subtreeFlags)&&0==(2064&s.flags)||Yh||(Yh=!0,_c(ss,(function(){return Sc(),null}))),n=0!=(15990&s.flags),0!=(15990&s.subtreeFlags)||n){n=Ph.transition,Ph.transition=null;var r=ws;ws=1;var o=Dh;Dh|=4,Th.current=null,function(e,t){if(en=js,pa(e=da())){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(s=(s=e.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(i&&0!==i.rangeCount){s=i.anchorNode;var a=i.anchorOffset,n=i.focusNode;i=i.focusOffset;try{s.nodeType,n.nodeType}catch(w){s=null;break e}var r=0,o=-1,l=-1,h=0,c=0,u=e,d=null;t:for(;;){for(var p;u!==s||0!==a&&3!==u.nodeType||(o=r+a),u!==n||0!==i&&3!==u.nodeType||(l=r+i),3===u.nodeType&&(r+=u.nodeValue.length),null!==(p=u.firstChild);)d=u,u=p;for(;;){if(u===e)break t;if(d===s&&++h===a&&(o=r),d===n&&++c===i&&(l=r),null!==(p=u.nextSibling))break;d=(u=d).parentNode}u=p}s=-1===o||-1===l?null:{start:o,end:l}}else s=null}s=s||{start:0,end:0}}else s=null;for(tn={focusedElem:e,selectionRange:s},js=!1,Zl=t;null!==Zl;)if(e=(t=Zl).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,Zl=e;else for(;null!==Zl;){t=Zl;try{var f=t.alternate;if(0!=(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var m=f.memoizedProps,g=f.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:il(t.type,m),g);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(re(163))}}catch(w){Ec(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Zl=e;break}Zl=t.return}f=sh,sh=!1}(e,s),yh(s,e),fa(tn),js=!!en,tn=en=null,e.current=s,bh(s),Qt(),Dh=o,ws=r,Ph.transition=n}else e.current=s;if(Yh&&(Yh=!1,Xh=e,qh=a),0===(n=e.pendingLanes)&&(Kh=null),function(e){if(rs&&"function"==typeof rs.onCommitFiberRoot)try{rs.onCommitFiberRoot(ns,e,void 0,128==(128&e.current.flags))}catch(t){}}(s.stateNode),ac(e,Jt()),null!==t)for(i=e.onRecoverableError,s=0;s<t.length;s++)i((a=t[s]).value,{componentStack:a.stack,digest:a.digest});if(jh)throw jh=!1,e=Gh,Gh=null,e;0!=(1&qh)&&0!==e.tag&&Sc(),0!=(1&(n=e.pendingLanes))?e===Jh?Qh++:(Qh=0,Jh=e):Qh=0,Hn()}(e,t,s,i)}finally{Ph.transition=a,ws=i}return null}function Sc(){if(null!==Xh){var e=Ms(qh),t=Ph.transition,s=ws;try{if(Ph.transition=null,ws=16>e?16:e,null===Xh)var i=!1;else{if(e=Xh,Xh=null,qh=0,0!=(6&Dh))throw Error(re(331));var a=Dh;for(Dh|=4,Zl=e.current;null!==Zl;){var n=Zl,r=n.child;if(0!=(16&Zl.flags)){var o=n.deletions;if(null!==o){for(var l=0;l<o.length;l++){var h=o[l];for(Zl=h;null!==Zl;){var c=Zl;switch(c.tag){case 0:case 11:case 15:ih(8,c,n)}var u=c.child;if(null!==u)u.return=c,Zl=u;else for(;null!==Zl;){var d=(c=Zl).sibling,p=c.return;if(rh(c),c===h){Zl=null;break}if(null!==d){d.return=p,Zl=d;break}Zl=p}}}var f=n.alternate;if(null!==f){var m=f.child;if(null!==m){f.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Zl=n}}if(0!=(2064&n.subtreeFlags)&&null!==r)r.return=n,Zl=r;else e:for(;null!==Zl;){if(0!=(2048&(n=Zl).flags))switch(n.tag){case 0:case 11:case 15:ih(9,n,n.return)}var y=n.sibling;if(null!==y){y.return=n.return,Zl=y;break e}Zl=n.return}}var v=e.current;for(Zl=v;null!==Zl;){var b=(r=Zl).child;if(0!=(2064&r.subtreeFlags)&&null!==b)b.return=r,Zl=b;else e:for(r=v;null!==Zl;){if(0!=(2048&(o=Zl).flags))try{switch(o.tag){case 0:case 11:case 15:ah(9,o)}}catch(M){Ec(o,o.return,M)}if(o===r){Zl=null;break e}var w=o.sibling;if(null!==w){w.return=o.return,Zl=w;break e}Zl=o.return}}if(Dh=a,Hn(),rs&&"function"==typeof rs.onPostCommitFiberRoot)try{rs.onPostCommitFiberRoot(ns,e)}catch(M){}i=!0}return i}finally{ws=s,Ph.transition=t}}return!1}function Cc(e,t,s){e=Ur(e,t=fl(0,t=cl(s,t),1),1),t=tc(),null!==e&&(vs(e,1,t),ac(e,t))}function Ec(e,t,s){if(3===e.tag)Cc(e,e,s);else for(;null!==t;){if(3===t.tag){Cc(t,e,s);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Kh||!Kh.has(i))){t=Ur(t,e=ml(t,e=cl(s,e),1),1),e=tc(),null!==t&&(vs(t,1,e),ac(t,e));break}}t=t.return}}function kc(e,t,s){var i=e.pingCache;null!==i&&i.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&s,_h===e&&(Rh&s)===s&&(4===Ih||3===Ih&&(130023424&Rh)===Rh&&500>Jt()-Vh?pc(e,0):Wh|=s),ac(e,t)}function Tc(e,t){0===t&&(0==(1&e.mode)?t=1:(t=us,0==(130023424&(us<<=1))&&(us=4194304)));var s=tc();null!==(e=Ir(e,t))&&(vs(e,t,s),ac(e,s))}function Pc(e){var t=e.memoizedState,s=0;null!==t&&(s=t.retryLane),Tc(e,s)}function Dc(e,t){var s=0;switch(e.tag){case 13:var i=e.stateNode,a=e.memoizedState;null!==a&&(s=a.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(re(314))}null!==i&&i.delete(t),Tc(e,s)}function _c(e,t){return Yt(e,t)}function Ac(e,t,s,i){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,s,i){return new Ac(e,t,s,i)}function Oc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bc(e,t){var s=e.alternate;return null===s?((s=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=14680064&e.flags,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Ic(e,t,s,i,a,n){var r=2;if(i=e,"function"==typeof e)Oc(e)&&(r=1);else if("string"==typeof e)r=5;else e:switch(e){case Ce:return Lc(s.children,a,n,t);case Ee:r=8,a|=8;break;case ke:return(e=Rc(12,s,t,2|a)).elementType=ke,e.lanes=n,e;case _e:return(e=Rc(13,s,t,a)).elementType=_e,e.lanes=n,e;case Ae:return(e=Rc(19,s,t,a)).elementType=Ae,e.lanes=n,e;case Be:return Fc(s,a,n,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case Te:r=10;break e;case Pe:r=9;break e;case De:r=11;break e;case Re:r=14;break e;case Oe:r=16,i=null;break e}throw Error(re(130,null==e?e:typeof e,""))}return(t=Rc(r,s,t,a)).elementType=e,t.type=i,t.lanes=n,t}function Lc(e,t,s,i){return(e=Rc(7,e,i,t)).lanes=s,e}function Fc(e,t,s,i){return(e=Rc(22,e,i,t)).elementType=Be,e.lanes=s,e.stateNode={isHidden:!1},e}function Nc(e,t,s){return(e=Rc(6,e,null,t)).lanes=s,e}function Wc(e,t,s){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uc(e,t,s,i,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ys(0),this.expirationTimes=ys(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ys(0),this.identifierPrefix=i,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function zc(e,t,s,i,a,n,r,o,l){return e=new Uc(e,t,s,o,l),1===t?(t=1,!0===n&&(t|=8)):t=0,n=Rc(3,null,null,t),e.current=n,n.stateNode=e,n.memoizedState={element:i,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fr(n),e}function Vc(e){if(!e)return Pn;e:{if(Ht(e=e._reactInternals)!==e||1!==e.tag)throw Error(re(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(On(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(re(171))}if(1===e.tag){var s=e.type;if(On(s))return Ln(e,s,t)}return t}function Hc(e,t,s,i,a,n,r,o,l){return(e=zc(s,i,!0,e,0,n,0,o,l)).context=Vc(null),s=e.current,(n=Wr(i=tc(),a=sc(s))).callback=null!=t?t:null,Ur(s,n,a),e.current.lanes=a,vs(e,a,i),ac(e,i),e}function $c(e,t,s,i){var a=t.current,n=tc(),r=sc(a);return s=Vc(s),null===t.context?t.context=s:t.pendingContext=s,(t=Wr(n,r)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Ur(a,t,r))&&(ic(e,a,r,n),zr(e,a,r)),r}function jc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var s=e.retryLane;e.retryLane=0!==s&&s<t?s:t}}function Kc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}Ch=function(e,t,s){if(null!==e)if(e.memoizedProps!==t.pendingProps||_n.current)wl=!0;else{if(0==(e.lanes&s)&&0==(128&t.flags))return wl=!1,function(e,t,s){switch(t.tag){case 3:_l(t),fr();break;case 5:Jr(t);break;case 1:On(t.type)&&Fn(t);break;case 4:qr(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,a=t.memoizedProps.value;Tn(Sr,i._currentValue),i._currentValue=a;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Tn(eo,1&eo.current),t.flags|=128,null):0!=(s&t.child.childLanes)?Nl(e,t,s):(Tn(eo,1&eo.current),null!==(e=jl(e,t,s))?e.sibling:null);Tn(eo,1&eo.current);break;case 19:if(i=0!=(s&t.childLanes),0!=(128&e.flags)){if(i)return Hl(e,t,s);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Tn(eo,eo.current),i)break;return null;case 22:case 23:return t.lanes=0,El(e,t,s)}return jl(e,t,s)}(e,t,s);wl=0!=(131072&e.flags)}else wl=!1,nr&&0!=(1048576&t.flags)&&er(t,Kn,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;$l(e,t),e=t.pendingProps;var a=Rn(t,Dn.current);_r(t,s),a=yo(null,t,i,e,a,s);var n=vo();return t.flags|=1,"object"==typeof a&&null!==a&&"function"==typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,On(i)?(n=!0,Fn(t)):n=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Fr(t),a.updater=nl,t.stateNode=a,a._reactInternals=t,hl(t,i,e,s),t=Dl(null,t,i,!0,n,s)):(t.tag=0,nr&&n&&tr(t),Ml(null,t,a,s),t=t.child),t;case 16:i=t.elementType;e:{switch($l(e,t),e=t.pendingProps,i=(a=i._init)(i._payload),t.type=i,a=t.tag=function(e){if("function"==typeof e)return Oc(e)?1:0;if(null!=e){if((e=e.$$typeof)===De)return 11;if(e===Re)return 14}return 2}(i),e=il(i,e),a){case 0:t=Tl(null,t,i,e,s);break e;case 1:t=Pl(null,t,i,e,s);break e;case 11:t=xl(null,t,i,e,s);break e;case 14:t=Sl(null,t,i,il(i.type,e),s);break e}throw Error(re(306,i,""))}return t;case 0:return i=t.type,a=t.pendingProps,Tl(e,t,i,a=t.elementType===i?a:il(i,a),s);case 1:return i=t.type,a=t.pendingProps,Pl(e,t,i,a=t.elementType===i?a:il(i,a),s);case 3:e:{if(_l(t),null===e)throw Error(re(387));i=t.pendingProps,a=(n=t.memoizedState).element,Nr(e,t),Hr(t,i,null,s);var r=t.memoizedState;if(i=r.element,n.isDehydrated){if(n={element:i,isDehydrated:!1,cache:r.cache,pendingSuspenseBoundaries:r.pendingSuspenseBoundaries,transitions:r.transitions},t.updateQueue.baseState=n,t.memoizedState=n,256&t.flags){t=Al(e,t,i,s,a=cl(Error(re(423)),t));break e}if(i!==a){t=Al(e,t,i,s,a=cl(Error(re(424)),t));break e}for(ar=cn(t.stateNode.containerInfo.firstChild),ir=t,nr=!0,rr=null,s=xr(t,null,i,s),t.child=s;s;)s.flags=-3&s.flags|4096,s=s.sibling}else{if(fr(),i===a){t=jl(e,t,s);break e}Ml(e,t,i,s)}t=t.child}return t;case 5:return Jr(t),null===e&&cr(t),i=t.type,a=t.pendingProps,n=null!==e?e.memoizedProps:null,r=a.children,sn(i,a)?r=null:null!==n&&sn(i,n)&&(t.flags|=32),kl(e,t),Ml(e,t,r,s),t.child;case 6:return null===e&&cr(t),null;case 13:return Nl(e,t,s);case 4:return qr(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Mr(t,null,i,s):Ml(e,t,i,s),t.child;case 11:return i=t.type,a=t.pendingProps,xl(e,t,i,a=t.elementType===i?a:il(i,a),s);case 7:return Ml(e,t,t.pendingProps,s),t.child;case 8:case 12:return Ml(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(i=t.type._context,a=t.pendingProps,n=t.memoizedProps,r=a.value,Tn(Sr,i._currentValue),i._currentValue=r,null!==n)if(oa(n.value,r)){if(n.children===a.children&&!_n.current){t=jl(e,t,s);break e}}else for(null!==(n=t.child)&&(n.return=t);null!==n;){var o=n.dependencies;if(null!==o){r=n.child;for(var l=o.firstContext;null!==l;){if(l.context===i){if(1===n.tag){(l=Wr(-1,s&-s)).tag=2;var h=n.updateQueue;if(null!==h){var c=(h=h.shared).pending;null===c?l.next=l:(l.next=c.next,c.next=l),h.pending=l}}n.lanes|=s,null!==(l=n.alternate)&&(l.lanes|=s),Dr(n.return,s,t),o.lanes|=s;break}l=l.next}}else if(10===n.tag)r=n.type===t.type?null:n.child;else if(18===n.tag){if(null===(r=n.return))throw Error(re(341));r.lanes|=s,null!==(o=r.alternate)&&(o.lanes|=s),Dr(r,s,t),r=n.sibling}else r=n.child;if(null!==r)r.return=n;else for(r=n;null!==r;){if(r===t){r=null;break}if(null!==(n=r.sibling)){n.return=r.return,r=n;break}r=r.return}n=r}Ml(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,i=t.pendingProps.children,_r(t,s),i=i(a=Ar(a)),t.flags|=1,Ml(e,t,i,s),t.child;case 14:return a=il(i=t.type,t.pendingProps),Sl(e,t,i,a=il(i.type,a),s);case 15:return Cl(e,t,t.type,t.pendingProps,s);case 17:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:il(i,a),$l(e,t),t.tag=1,On(i)?(e=!0,Fn(t)):e=!1,_r(t,s),ol(t,i,a),hl(t,i,a,s),Dl(null,t,i,!0,e,s);case 19:return Hl(e,t,s);case 22:return El(e,t,s)}throw Error(re(156,t.tag))};var Yc="function"==typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function qc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function eu(e,t,s,i,a){var n=s._reactRootContainer;if(n){var r=n;if("function"==typeof a){var o=a;a=function(){var e=jc(r);o.call(e)}}$c(t,r,e,a)}else r=function(e,t,s,i,a){if(a){if("function"==typeof i){var n=i;i=function(){var e=jc(r);n.call(e)}}var r=Hc(t,i,e,0,null,!1,0,"",Zc);return e._reactRootContainer=r,e[mn]=r.current,Va(8===e.nodeType?e.parentNode:e),uc(),r}for(;a=e.lastChild;)e.removeChild(a);if("function"==typeof i){var o=i;i=function(){var e=jc(l);o.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[mn]=l.current,Va(8===e.nodeType?e.parentNode:e),uc((function(){$c(t,l,s,i)})),l}(s,t,e,a,i);return jc(r)}qc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(re(409));$c(e,t,null,null)},qc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc((function(){$c(null,e,null,null)})),t[mn]=null}},qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Es();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Bs.length&&0!==t&&t<Bs[s].priority;s++);Bs.splice(s,0,e),0===s&&Ns(e)}},xs=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=ds(t.pendingLanes);0!==s&&(bs(t,1|s),ac(t,Jt()),0==(6&Dh)&&(Hh=Jt()+500,Hn()))}break;case 13:uc((function(){var t=Ir(e,1);if(null!==t){var s=tc();ic(t,e,1,s)}})),Kc(e,1)}},Ss=function(e){if(13===e.tag){var t=Ir(e,134217728);null!==t&&ic(t,e,134217728,tc()),Kc(e,134217728)}},Cs=function(e){if(13===e.tag){var t=sc(e),s=Ir(e,t);null!==s&&ic(s,e,t,tc()),Kc(e,t)}},Es=function(){return ws},ks=function(e,t){var s=ws;try{return ws=e,t()}finally{ws=s}},St=function(e,t,s){switch(t){case"input":if(Ze(e,s),t=s.name,"radio"===s.type&&null!=t){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var i=s[t];if(i!==e&&i.form===e.form){var a=xn(i);if(!a)throw Error(re(90));Ye(i),Ze(i,a)}}}break;case"textarea":rt(e,s);break;case"select":null!=(t=s.value)&&it(e,!!s.multiple,t,!1)}},Dt=cc,_t=uc;var tu={usingClientEntryPoint:!1,Events:[wn,Mn,xn,Tt,Pt,cc]},su={findFiberByHostInstance:bn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iu={bundleType:su.bundleType,version:su.version,rendererPackageName:su.rendererPackageName,rendererConfig:su.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Me.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Gt(e))?null:e.stateNode},findFiberByHostInstance:su.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var au=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!au.isDisabled&&au.supportsFiber)try{ns=au.inject(iu),rs=au}catch(ut){}}ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,ee.createPortal=function(e,t){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(re(200));return function(e,t,s){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:Se,key:null==i?null:""+i,children:e,containerInfo:t,implementation:s}}(e,t,null,s)},ee.createRoot=function(e,t){if(!Qc(e))throw Error(re(299));var s=!1,i="",a=Yc;return null!=t&&(!0===t.unstable_strictMode&&(s=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=zc(e,1,!1,null,0,s,0,i,a),e[mn]=t.current,Va(8===e.nodeType?e.parentNode:e),new Xc(t)},ee.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(re(188));throw e=Object.keys(e).join(","),Error(re(268,e))}return null===(e=Gt(t))?null:e.stateNode},ee.flushSync=function(e){return uc(e)},ee.hydrate=function(e,t,s){if(!Jc(t))throw Error(re(200));return eu(null,e,t,!0,s)},ee.hydrateRoot=function(e,t,s){if(!Qc(e))throw Error(re(405));var i=null!=s&&s.hydratedSources||null,a=!1,n="",r=Yc;if(null!=s&&(!0===s.unstable_strictMode&&(a=!0),void 0!==s.identifierPrefix&&(n=s.identifierPrefix),void 0!==s.onRecoverableError&&(r=s.onRecoverableError)),t=Hc(t,null,e,1,null!=s?s:null,a,0,n,r),e[mn]=t.current,Va(e),i)for(e=0;e<i.length;e++)a=(a=(s=i[e])._getVersion)(s._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new qc(t)},ee.render=function(e,t,s){if(!Jc(t))throw Error(re(200));return eu(null,e,t,!1,s)},ee.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(re(40));return!!e._reactRootContainer&&(uc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[mn]=null}))})),!0)},ee.unstable_batchedUpdates=cc,ee.unstable_renderSubtreeIntoContainer=function(e,t,s,i){if(!Jc(s))throw Error(re(200));if(null==e||void 0===e._reactInternals)throw Error(re(38));return eu(e,t,s,!1,i)},ee.version="18.3.1-next-f1338f8080-20240426",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),Z.exports=ee;var nu=Z.exports;J.createRoot=nu.createRoot,J.hydrateRoot=nu.hydrateRoot;var ru={exports:{}};function ou(){}function lu(){}lu.resetWarningCache=ou,ru.exports=function(){function e(e,t,s,i,a,n){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==n){var r=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw r.name="Invariant Violation",r}}function t(){return e}e.isRequired=e;var s={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:lu,resetWarningCache:ou};return s.PropTypes=s,s}();const hu=t(ru.exports);class cu extends s.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/images/bg.png")}create(){this.scene.start("Preloader")}}const uu=new i.Events.EventEmitter;class du extends s.Scene{constructor(){super("GameOver")}init(e){this.survivalTime=e.survivalTime||0,this.killCount=e.killCount||0}create(){this.cameras.main.setBackgroundColor(16711680),this.add.image(512,384,"background").setAlpha(.5),this.add.text(512,300,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100),this.add.text(512,380,`You survived for ${this.survivalTime} seconds`,{fontFamily:"Arial",fontSize:28,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5).setDepth(100),this.add.text(512,420,`Enemies killed: ${this.killCount}`,{fontFamily:"Arial",fontSize:28,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5).setDepth(100),this.add.text(512,480,"Click to Return to Menu",{fontFamily:"Arial",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5).setDepth(100).setInteractive().on("pointerdown",this.changeScene,this),uu.emit("current-scene-ready",this)}changeScene(){this.scene.start("MainMenu")}}class pu{constructor(e){this.scene=e,this.musicTracks={},this.soundEffects={},this.currentMusic=null,this.musicVolume=.05,this.effectsVolume=.07,this.isMuted=!1,this._musicPaused=!1,this._musicWasPlaying=!1,this._originalVolume=null,this._seekPosition=0,this._musicKey=null}initBackgroundMusic(e,t={}){const s={volume:this.musicVolume,loop:!0,delay:0,...t},i=Math.min(s.volume,this.musicVolume);return this.musicTracks[e]=this.scene.sound.add(e,{volume:i,loop:s.loop}),this.musicTracks[e]}playMusic(e,t={}){const s={fadeIn:1e3,fadeOut:1e3,delay:0,...t};this.musicTracks[e]?this.currentMusic&&this.currentMusic!==this.musicTracks[e]?(this.currentMusic.volume,this._getMusicKeyByTrack(this.currentMusic),this.scene.tweens.add({targets:this.currentMusic,volume:0,duration:s.fadeOut,onComplete:()=>{this.currentMusic.stop(),this.startNewMusic(e,s.fadeIn,s.delay)}})):this.currentMusic?this.currentMusic.volume:(this.musicVolume,this.startNewMusic(e,s.fadeIn,s.delay)):console.warn(`Music track "${e}" not found, cannot play`)}startNewMusic(e,t,s=0){if(!this.musicTracks[e])return void console.warn(`Music track "${e}" not found`);this.currentMusic=this.musicTracks[e];const i=this.isMuted?0:this.musicVolume;t<=50?(this.currentMusic.volume=i,this.currentMusic.play({delay:s/1e3})):(this.currentMusic.volume=0,this.currentMusic.play({delay:s/1e3}),this.scene.tweens.add({targets:this.currentMusic,volume:i,duration:t}))}stopMusic(e=1e3){this.currentMusic&&(e>0?this.scene.tweens.add({targets:this.currentMusic,volume:0,duration:e,onComplete:()=>{this.currentMusic.stop(),this.currentMusic=null}}):(this.currentMusic.stop(),this.currentMusic=null))}pauseMusic(){this.currentMusic&&(this._musicWasPlaying=this.currentMusic.isPlaying,this._musicWasPlaying&&(this._originalVolume=this.currentMusic.volume,this._musicKey=this._getMusicKeyByTrack(this.currentMusic),this._seekPosition=this.currentMusic.seek,this.scene.tweens.killTweensOf(this.currentMusic),this.currentMusic.stop(),this._musicPaused=!0,this.scene.sound.context&&!this.scene.sound.context.suspended&&this.scene.sound.pauseAll(),this._seekPosition))}resumeMusic(){if(this._musicPaused&&this._musicWasPlaying&&this._musicKey){this.scene.sound.context&&this.scene.sound.context.suspended&&this.scene.sound.resumeAll();const e=this.musicTracks[this._musicKey];if(e){e.isPlaying&&e.stop(),this.currentMusic=e;const t=Math.min(this._originalVolume||this.musicVolume,this.musicVolume);this.currentMusic.play({loop:!0,volume:t,seek:this._seekPosition||0}),this._seekPosition}else console.warn(`Could not resume music: track ${this._musicKey} not found`);this._musicPaused=!1,this._musicWasPlaying=!1,this._originalVolume=null,this._seekPosition=0,this._musicKey=null}}_getMusicKeyByTrack(e){if(!e)return null;for(const[t,s]of Object.entries(this.musicTracks))if(s===e)return t;return null}setMute(e){this.isMuted=e,this.scene.sound.mute=e}toggleMute(){return this.isMuted=!this.isMuted,this.scene.sound.mute=this.isMuted,this.isMuted}setMusicVolume(e){this.musicVolume=Phaser.Math.Clamp(e,0,.1),this.currentMusic&&(this.currentMusic.volume=this.musicVolume),Object.values(this.musicTracks).forEach((e=>{e.volume=this.musicVolume}))}setEffectsVolume(e){this.effectsVolume=Phaser.Math.Clamp(e,0,.1),Object.values(this.soundEffects).forEach((e=>{e.volume=this.effectsVolume}))}initSoundEffect(e,t={}){const s={volume:this.effectsVolume,rate:1,detune:0,loop:!1,...t};return this.soundEffects[e]=this.scene.sound.add(e,s),this.soundEffects[e]}playSoundEffect(e,t={}){if(!this.soundEffects[e]){if(!this.scene.cache.audio.exists(e))return console.warn(`Sound effect "${e}" not found and cannot be created`),null;this.initSoundEffect(e,{volume:this.effectsVolume,rate:1,loop:!1})}if(this.scene.sound.locked)return this.scene.sound.once("unlocked",(()=>{if(this.soundEffects[e]){const s={...t,loop:!1,volume:Math.min(t.volume||this.effectsVolume,this.effectsVolume)};this.soundEffects[e].play(s)}})),this.scene.sound.unlock(),null;this.soundEffects[e]&&this.soundEffects[e].isPlaying&&this.soundEffects[e].stop();const s={...t,loop:!1,volume:Math.min(t.volume||this.effectsVolume,this.effectsVolume)};s.volume;try{return this.soundEffects[e].play(s)}catch(i){return console.warn(`Error playing sound "${e}":`,i),null}}hasSound(e){return!!this.soundEffects[e]||this.scene.cache.audio.exists(e)}playRandomWaveEndSound(e={}){const t=`waveEnd${Math.floor(7*Math.random())+1}`,s={volume:.07,detune:100*Math.random()-50,loop:!1,duration:2e3,...e},i=this.soundEffects[t];i&&i.isPlaying&&i.stop();const a=this.playSoundEffect(t,s);return a&&this.scene.time.delayedCall(3e3,(()=>{a.isPlaying&&a.stop()})),a}destroy(){Object.values(this.musicTracks).forEach((e=>{e.stop(),e.destroy()})),Object.values(this.soundEffects).forEach((e=>{e.stop(),e.destroy()})),this.musicTracks={},this.soundEffects={},this.currentMusic=null}}const fu={MAP_GROUND:0,MAP_WALLS:1,MAP_DECORATION:2,BULLETS:10,PROJECTILES:11,PICKUP_ITEMS:12,ENEMIES:15,ENEMY_HEALTH_BAR_BG:16,ENEMY_HEALTH_BAR_FG:17,PLAYER:20,PLAYER_EFFECTS:22,PLAYER_UI:25,EFFECTS_LOW:30,EFFECTS_MID:40,EFFECTS_HIGH:50,UI_BACKGROUND:90,UI_ELEMENTS:95,UI_TEXT:100,UI_FLOATING_TEXT:105,UI_OVERLAY:1e3},mu={DEFAULT_SCALE_FACTOR:1.5,PLAYER_SPEED:3,PLAYER_FRICTION:.9,PLAYER_ACCELERATION:.3,PLAYER_RADIUS:20,WEAPON_FIRE_RATE:333,WEAPON_BULLET_SPEED:10,WEAPON_BULLET_DAMAGE:30,WEAPON_BULLET_CALIBER:5,WEAPON_BULLET_HEALTH:30},gu={AI:"ai",CODER:"coder",NEUTRAL:"neutral"},yu={MIN_VALUE:-100,MAX_VALUE:100,DEFAULT_VALUE:0,KILL_WEIGHT:1,PANIC_THRESHOLD:85,PANIC_DURATION:3e3,MULTIPLIERS:{HP:.01,DAMAGE:.01,FIRE_RATE:.01,DODGE:.01},MAJOR_EVENT_VALUE:100,SHAKE_INTENSITY:.01,SHAKE_DURATION:500,COLORS:{AI:3368703,CODER:16724838,NEUTRAL:11184810}},vu={[gu.AI]:{health:1.2,speed:.9,damage:1.3,color:16724787},[gu.CODER]:{health:.9,speed:1.2,damage:1,color:3386111},[gu.NEUTRAL]:{health:.7,speed:1.5,damage:.5,color:5635925}};class bu{constructor(e,t,s,i={}){this.scene=e,this.x=t,this.y=s,this.options={width:150,height:20,trackColor:6710886,fillColor:65280,knobColor:16777215,knobRadius:10,initialValue:.5,onChange:null,depth:100,label:"Volume",labelStyle:{fontFamily:"Arial",fontSize:16,color:"#ffffff"},...i},this.value=this.options.initialValue,this.container=e.add.container(t,s).setDepth(this.options.depth),this.createSlider(),this.setupInteraction()}createSlider(){this.label=this.scene.add.text(-this.options.width/2-10,0,this.options.label,this.options.labelStyle).setOrigin(1,.5),this.track=this.scene.add.rectangle(0,0,this.options.width,this.options.height,this.options.trackColor).setOrigin(.5),this.fill=this.scene.add.rectangle(-this.options.width/2,0,this.options.width*this.value,this.options.height,this.options.fillColor).setOrigin(0,.5),this.knob=this.scene.add.circle(-this.options.width/2+this.options.width*this.value,0,this.options.knobRadius,this.options.knobColor),this.container.add([this.label,this.track,this.fill,this.knob])}setupInteraction(){this.track.setInteractive({useHandCursor:!0}),this.track.on("pointerdown",(e=>{this.updateValue(e),this.startDrag()})),this.knob.setInteractive({useHandCursor:!0}),this.knob.on("pointerdown",(()=>{this.startDrag()}))}startDrag(){this.moveListener=e=>{this.updateValue(e)},this.upListener=()=>{this.stopDrag()},this.scene.input.on("pointermove",this.moveListener),this.scene.input.on("pointerup",this.upListener),this.scene.soundManager&&this.scene.soundManager.hasSound("button_click")&&this.scene.soundManager.playSoundEffect("button_click")}stopDrag(){this.moveListener&&(this.scene.input.off("pointermove",this.moveListener),this.scene.input.off("pointerup",this.upListener),this.moveListener=null,this.upListener=null)}updateValue(e){let t=(e.x-this.container.x+this.options.width/2)/this.options.width;if(t=Phaser.Math.Clamp(t,0,1),t!==this.value&&(this.value=t,this.updateVisuals(),this.options.onChange)){const e=.1*t;this.options.onChange(e)}}updateVisuals(){this.fill.width=this.options.width*this.value,this.knob.x=-this.options.width/2+this.options.width*this.value}setValue(e){const t=e/.1;this.value=Phaser.Math.Clamp(t,0,1),this.updateVisuals()}getValue(){return.1*this.value}setVisible(e){this.container.setVisible(e)}destroy(){this.stopDrag(),this.container.destroy()}}const wu={addButtonSound(e,t={}){const s={event:"pointerdown",volume:.06,detune:-200,rate:1.2,...t};return e.on(s.event,(()=>{uu.emit("button-click",{volume:s.volume,detune:s.detune})})),e},setupButtonSounds:e=>(e.soundManager&&!e.soundManager.hasSound("button_click")&&e.soundManager.initSoundEffect("button_click",{volume:.06,rate:1.2,detune:-200}),uu.on("button-click",(t=>{e.soundManager&&e.soundManager.playSoundEffect("button_click",{volume:(null==t?void 0:t.volume)||.06,detune:(null==t?void 0:t.detune)||-200,rate:(null==t?void 0:t.rate)||1.2})})),()=>{uu.off("button-click")})};class Mu extends s.Scene{constructor(){var t,s;super("MainMenu"),((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(this,"symbol"!=typeof(t="logoTween")?t+"":t,s)}create(){this.add.image(512,384,"background");const e=this.add.text(512,500,"START GAME",{fontFamily:"Arial Black",fontSize:38,color:"#39C66B",stroke:"#000000",strokeThickness:8,align:"center"}).setDepth(100).setOrigin(.5).setInteractive();e.on("pointerdown",(()=>{uu.emit("button-click",{volume:.06,detune:-200,rate:1.2}),this.startGame("wave")}),this),this.tweens.add({targets:e,alpha:.8,yoyo:!0,repeat:-1,duration:1e3}),this.setupSoundManager(),this.createVolumeSlider(),this.setupInput(),this.cleanupButtonSounds=wu.setupButtonSounds(this),uu.emit("current-scene-ready",this)}createVolumeSlider(){const e=this.cameras.main.width;this.cameras.main.height,this.volumeSlider=new bu(this,e-100,40,{width:150,height:10,trackColor:4473924,fillColor:3786347,knobColor:16777215,knobRadius:8,initialValue:this.soundManager?this.soundManager.musicVolume:.5,depth:100,label:"Volume",labelStyle:{fontFamily:"Arial",fontSize:16,color:"#ffffff",stroke:"#000000",strokeThickness:2},onChange:e=>{this.soundManager&&(this.soundManager.setMusicVolume(e),this.soundManager.setEffectsVolume(e))}})}setupSoundManager(){this.soundManager=new pu(this),this.soundManager.initBackgroundMusic("menu_music",{volume:.04,loop:!0}),this.soundManager.initSoundEffect("button_click",{volume:.06,rate:1}),this.soundManager.playMusic("menu_music",{fadeIn:2e3})}startGame(e){this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",(()=>{this.logoTween&&(this.logoTween.stop(),this.logoTween=null),this.scene.start("PreSpawn",{startWave:0})}))}changeScene(e,t){"WaveGame"===e?(this.selectedWeapon=t,this.startGame("wave")):(this.selectedWeapon=t,this.startGame("adventure"))}setupInput(){this.volumeDownKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.NINE),this.volumeUpKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ZERO)}update(){this.handleVolumeControls()}handleVolumeControls(){if(!this.soundManager)return;let e=!1,t=this.soundManager.musicVolume;Phaser.Input.Keyboard.JustDown(this.volumeDownKey)&&(t=Math.max(0,t-.01),e=!0),Phaser.Input.Keyboard.JustDown(this.volumeUpKey)&&(t=Math.min(.1,t+.01),e=!0),e&&(this.soundManager.setMusicVolume(t),this.soundManager.setEffectsVolume(t),this.volumeSlider&&this.volumeSlider.setValue(t),this.showVolumeIndicator(t))}showVolumeIndicator(e){this.volumeIndicator&&this.volumeIndicator.destroy();const t=Math.round(100*e),s=this.cameras.main,i=s.width,a=s.height;this.volumeIndicator=this.add.container(i/2,a-50).setDepth(200);const n=this.add.rectangle(0,0,200,40,0,.7).setOrigin(.5),r=this.add.text(0,0,`Volume: ${t}%`,{fontFamily:"Arial",fontSize:18,color:"#ffffff"}).setOrigin(.5);this.volumeIndicator.add([n,r]),this.time.delayedCall(1500,(()=>{this.volumeIndicator&&(this.volumeIndicator.destroy(),this.volumeIndicator=null)}))}moveLogo(e){this.logoTween?this.logoTween.isPlaying()?this.logoTween.pause():this.logoTween.play():this.logoTween=this.tweens.add({targets:this.logo,x:{value:750,duration:3e3,ease:"Back.easeInOut"},y:{value:80,duration:1500,ease:"Sine.easeOut"},yoyo:!0,repeat:-1,onUpdate:()=>{e&&e({x:Math.floor(this.logo.x),y:Math.floor(this.logo.y)})}})}shutdown(){this.cleanupButtonSounds&&this.cleanupButtonSounds(),super.shutdown()}}const xu={COMMON:{name:"Common",color:"#aaaaaa",hexColor:11184810,multiplier:1,weight:60},RARE:{name:"Rare",color:"#4488ff",hexColor:4491519,multiplier:1.5,weight:20},EPIC:{name:"Epic",color:"#aa44ff",hexColor:11158783,multiplier:2,weight:15},LEGENDARY:{name:"Legendary",color:"#ffaa00",hexColor:16755200,multiplier:3,weight:5}},Su="Damage",Cu="Range",Eu="Pierce",ku="Critical",Tu="Projectile",Pu="Drone",Du=[{id:"damage_1",name:" Damage Boost",category:Su,rarity:xu.COMMON,price:100,effects:"+10% Damage",stats:{damage:1.1},visualProperties:{borderColor:11154227,fillColor:2228224}},{id:"fire_rate_1",name:" Rapid Fire",category:"Fire Rate",rarity:xu.COMMON,price:120,effects:"+15% Fire Rate",stats:{fireRate:.85},visualProperties:{borderColor:3355562,fillColor:34}},{id:"range_1",name:" Extended Range",category:Cu,rarity:xu.COMMON,price:80,effects:"+20% Range",stats:{bulletRange:1.2},visualProperties:{borderColor:3385907,fillColor:8704}},{id:"range_2",name:" Superior Range",category:Cu,rarity:xu.EPIC,price:200,effects:"+40% Range",stats:{bulletRange:1.4},visualProperties:{borderColor:5622869,fillColor:13056}},{id:"pierce_1",name:" Piercing Shot",category:Eu,rarity:xu.RARE,price:180,effects:"+1 to pierce count",stats:{bulletPierce:1},visualProperties:{borderColor:11158698,fillColor:2228258}},{id:"pierce_2",name:" Advanced Piercing",category:Eu,rarity:xu.EPIC,price:300,effects:"+2 to pierce count",stats:{bulletPierce:2},visualProperties:{borderColor:13395660,fillColor:3342387}},{id:"pierce_3",name:" Master Piercing",category:Eu,rarity:xu.LEGENDARY,price:450,effects:"+5 to pierce count",stats:{bulletPierce:4},visualProperties:{borderColor:16755200,fillColor:5583616}},{id:"speed_1",name:" Swift Bullets",category:Tu,rarity:xu.RARE,price:120,effects:"+25% Bullet Speed",stats:{bulletSpeed:1.25},visualProperties:{borderColor:3386026,fillColor:8738}},{id:"critical_1",name:" Critical Strike",category:ku,rarity:xu.EPIC,price:180,effects:"+10% Critical Chance",stats:{criticalChance:10},visualProperties:{borderColor:11184691,fillColor:2236928}},{id:"area_1",name:" Explosive Rounds",category:"Area of Effect",rarity:xu.LEGENDARY,price:650,effects:"+80 AoE -50% damage",stats:{aoeRadius:80,aoeDamage:.5},visualProperties:{borderColor:16729088,fillColor:2232576}},{id:"damage_2",name:" Major Damage",category:Su,rarity:xu.EPIC,price:220,effects:"+25% Damage",stats:{damage:1.25},visualProperties:{borderColor:14496563,fillColor:3342336}},{id:"homing_1",name:" Homing Shot",category:Tu,rarity:xu.LEGENDARY,price:1e3,effects:"Bullets seek enemies",stats:{homing:!0,homingForce:.05},visualProperties:{borderColor:16755200,fillColor:3351040}},{id:"critical_damage_1",name:" Critical Power",category:ku,rarity:xu.EPIC,price:250,effects:"+50% Critical Damage",stats:{criticalDamageMultiplier:1.5},visualProperties:{borderColor:14505216,fillColor:3346688}},{id:"drone_1",name:" Combat Drone I",category:Pu,rarity:xu.RARE,price:300,effects:"Adds 1 Combat Drone",stats:{drone:!0,droneCount:1},isDroneUpgrade:!0,visualProperties:{borderColor:4500189,fillColor:1122867}},{id:"drone_2",name:" Combat Drone II",category:Pu,rarity:xu.EPIC,price:500,effects:"Adds a 2nd Combat Drone",stats:{drone:!0,droneCount:1},isDroneUpgrade:!0,visualProperties:{borderColor:4513279,fillColor:1127236}},{id:"drone_3",name:" Combat Drone III",category:Pu,rarity:xu.LEGENDARY,price:750,effects:"Adds a 3rd Combat Drone",stats:{drone:!0,droneCount:1},isDroneUpgrade:!0,visualProperties:{borderColor:2293759,fillColor:1131605}},{id:"drone_4",name:" Combat Drone IV",category:Pu,rarity:xu.LEGENDARY,price:1e3,effects:"Adds a 4th Combat Drone",stats:{drone:!0,droneCount:1},isDroneUpgrade:!0,minWave:15,visualProperties:{borderColor:65450,fillColor:1135940}},{id:"drone_5",name:" Combat Drone V",category:Pu,rarity:xu.LEGENDARY,price:1500,effects:"Adds a 5th Combat Drone",stats:{drone:!0,droneCount:1},isDroneUpgrade:!0,minWave:15,visualProperties:{borderColor:65484,fillColor:1140309}}];function _u(e,t){if(!t||t<10)return e;if(e.rarity&&("Epic"===e.rarity.name||"Legendary"===e.rarity.name))return JSON.parse(JSON.stringify(e));const s=Math.floor(t/10),i=JSON.parse(JSON.stringify(e));return i.stats&&Object.entries(i.stats).forEach((([e,t])=>{switch(e){case"damage":case"bulletRange":case"bulletSpeed":case"criticalDamageMultiplier":if("number"==typeof t&&t>1){const a=.05*s;i.stats[e]=t+a}break;case"fireRate":if("number"==typeof t)if(t<1){const a=.03*s;i.stats[e]=Math.max(.5,t-a)}else{const a=.05*s;i.stats[e]=t+a}break;case"bulletPierce":case"criticalChance":case"aoeRadius":case"aoeDamage":case"homingForce":if("number"==typeof t){const a=.1*t*s;i.stats[e]=t+a}break;case"homing":case"drone":break;default:if("number"==typeof t){const a=.05*t*s;i.stats[e]=t+a}}})),i.effects&&(i.effects+=` (Lv.${t} Bonus)`),i.price&&(i.price=Math.round(i.price*(1+.05*s))),i}const Au="Health",Ru="Defense",Ou="Speed",Bu="Special",Iu=[{id:"health_1",name:" Health Boost",category:Au,rarity:xu.COMMON,skillPointCost:1,description:"Increases maximum health",stats:{maxHealth:20},visualProperties:{borderColor:11167334,fillColor:2232593}},{id:"health_2",name:" Major Health",category:Au,rarity:xu.RARE,skillPointCost:1,description:"Significantly increases maximum health.",stats:{maxHealth:50},visualProperties:{borderColor:13395558,fillColor:3346705}},{id:"defense_1",name:" Armor Plating",category:Ru,rarity:xu.COMMON,skillPointCost:1,description:"Adds 5 defense points, reducing damage taken from all enemy attacks by 5%.",stats:{defense:5},visualProperties:{borderColor:6710954,fillColor:1118498}},{id:"defense_2",name:" Heavy Armor",category:Ru,rarity:xu.RARE,skillPointCost:1,description:"Adds 10 defense points, reducing damage taken from all enemy attacks by 10%.",stats:{defense:10},visualProperties:{borderColor:6710988,fillColor:1118515}},{id:"speed_1",name:" Speed Boost",category:Ou,rarity:xu.COMMON,skillPointCost:1,description:"Increases movement speed by 15%, helping you dodge enemies more effectively.",stats:{speed:1.15},visualProperties:{borderColor:11184742,fillColor:2236945}},{id:"speed_2",name:" Nitro Speed",category:Ou,rarity:xu.RARE,skillPointCost:1,description:"Further increases movement speed by 25%, making you significantly faster.",stats:{speed:1.25},visualProperties:{borderColor:13421670,fillColor:3355409}},{id:"pickup_radius_1",name:" Magnet Pull",category:"Pickup",rarity:xu.COMMON,skillPointCost:1,description:"Increases pickup collection radius by 25%, making it easier to collect drops.",stats:{pickupRadius:1.25},visualProperties:{borderColor:6728362,fillColor:1122850}},{id:"regen_1",name:" Regeneration",category:Au,rarity:xu.LEGENDARY,skillPointCost:3,description:"Slowly regenerate 1 health point every 2 seconds.",stats:{healthRegen:.5},visualProperties:{borderColor:11167402,fillColor:2232610}},{id:"dash_1",name:" Emergency Dash",category:Bu,rarity:xu.EPIC,skillPointCost:2,description:"Adds a dash ability to quickly escape dangerous situations (Cooldown: 10s).",stats:{dash:!0,dashPower:1.5,dashCooldown:1e4},visualProperties:{borderColor:6728396,fillColor:1122867}},{id:"shield_1",name:" Energy Shield",category:Bu,rarity:xu.LEGENDARY,skillPointCost:3,description:"Creates a temporary shield that blocks all damage for 3 seconds (Cooldown: 30s).",stats:{shield:!0,shieldDuration:3e3,shieldCooldown:3e4},visualProperties:{borderColor:6737066,fillColor:1127202}}];function Lu(e,t){if(!t||t<10)return e;if(e.rarity&&("Epic"===e.rarity.name||"Legendary"===e.rarity.name))return JSON.parse(JSON.stringify(e));const s=Math.floor(t/10),i=JSON.parse(JSON.stringify(e));return i.stats&&Object.entries(i.stats).forEach((([e,t])=>{switch(e){case"speed":case"pickupRadius":if("number"==typeof t&&t>1){const a=.05*s;i.stats[e]=t+a}break;case"maxHealth":if("number"==typeof t){const a=.2*t*s;i.stats[e]=Math.round(t+a)}break;case"defense":if("number"==typeof t){const a=.15*t*s;i.stats[e]=Math.round(t+a)}break;case"healthRegen":if("number"==typeof t){const a=.1*t*s;i.stats[e]=t+a}break;case"dashPower":if("number"==typeof t){const a=.05*t*s;i.stats[e]=t+a}break;case"dashCooldown":case"shieldCooldown":if("number"==typeof t){const a=.05*t*s;i.stats[e]=Math.max(.5*t,t-a)}break;case"shieldDuration":if("number"==typeof t){const a=.1*t*s;i.stats[e]=t+a}break;case"dash":case"shield":break;default:if("number"==typeof t){const a=.05*t*s;i.stats[e]=t+a}}})),i.description&&(i.description+=` (Lv.${t} Bonus)`),i}class Fu{constructor(e,t={}){this.scene=e,this.maxHealth=t.maxHealth||100,this.currentHealth=this.maxHealth,this.hitDamage=t.hitDamage||34,this.isInvulnerable=!1,this.invulnerabilityTime=t.invulnerabilityTime||1e3,this.damageResistance=void 0!==t.damageResistance?t.damageResistance:0,this.damageFlashDuration=t.damageFlashDuration||200,this.damageFlashColor=t.damageFlashColor||16711680,e.uiManager&&e.uiManager.updateHealthUI(this.currentHealth,this.maxHealth)}takeDamage(e=this.hitDamage){return!this.isInvulnerable&&(this.damageResistance>0&&(e=Math.max(1,e*(1-this.damageResistance))),this.currentHealth=Math.max(0,this.currentHealth-e),this.scene.uiManager&&this.scene.uiManager.updateHealthUI(this.currentHealth,this.maxHealth),this.showDamageEffect(),this.setInvulnerable(),uu.emit("player-damaged",{amount:e,currentHealth:this.currentHealth,maxHealth:this.maxHealth}),this.currentHealth<=0&&(this.onDeath(),!0))}setInvulnerable(){this.isInvulnerable=!0,this.invulnerabilityTimer&&this.scene.time.removeEvent(this.invulnerabilityTimer),this.invulnerabilityTimer=this.scene.time.delayedCall(this.invulnerabilityTime,(()=>{this.isInvulnerable=!1}))}showDamageEffect(){var e;const t=null==(e=this.scene.player)?void 0:e.graphics;t&&(t.setTint(this.damageFlashColor),this.scene.time.delayedCall(this.damageFlashDuration,(()=>{t.clearTint()})),this.scene.cameras.main.shake(100,.01))}onDeath(){var e,t;uu.emit("player-death",{x:null==(e=this.scene.player)?void 0:e.graphics.x,y:null==(t=this.scene.player)?void 0:t.graphics.y}),this.showDeathAnimation(),this.scene.playerDeath&&this.scene.time.delayedCall(1500,(()=>{this.scene.player&&this.scene.player.destroy&&this.scene.player.destroy(),this.scene.playerDeath()}))}showDeathAnimation(){var e;const t=null==(e=this.scene.player)?void 0:e.graphics;t&&(this.scene.player&&(this.scene.player.velX=0,this.scene.player.velY=0),this.scene.time.delayedCall(250,(()=>{this.scene.add.particles&&this.scene.add.particles(t.x,t.y,"particle_texture",{speed:{min:100,max:300},scale:{start:.4,end:0},alpha:{start:1,end:0},lifespan:600,blendMode:"ADD",quantity:30,angle:{min:0,max:360}}).setDepth(150)})),this.scene.tweens.add({targets:t,alpha:0,scaleX:1.5,scaleY:1.5,duration:1e3,ease:"Power2"}))}heal(e){var t;const s=this.currentHealth;this.currentHealth=Math.min(this.maxHealth,this.currentHealth+e);const i=this.currentHealth-s;this.scene.uiManager&&this.scene.uiManager.updateHealthUI(this.currentHealth,this.maxHealth);const a=null==(t=this.scene.player)?void 0:t.graphics;return a&&i>0&&(a.setTint(65280),this.scene.time.delayedCall(200,(()=>{a.clearTint()}))),i}reset(){this.currentHealth=this.maxHealth,this.isInvulnerable=!1,this.invulnerabilityTimer&&(this.scene.time.removeEvent(this.invulnerabilityTimer),this.invulnerabilityTimer=null),this.scene.uiManager&&this.scene.uiManager.updateHealthUI(this.currentHealth,this.maxHealth)}setMaxHealth(e){this.maxHealth=e,this.scene.uiManager&&this.scene.uiManager.updateHealthUI(this.currentHealth,this.maxHealth)}getCurrentHealth(){return this.currentHealth}getMaxHealth(){return this.maxHealth}setDamageResistance(e){this.damageResistance=Math.min(.25,Math.max(0,e))}getDamageResistance(){return this.damageResistance}getHealthPercent(){return this.currentHealth/this.maxHealth}getInvulnerable(){return this.isInvulnerable}}class Nu{constructor(e,t,s,i,a=0){this.scene=e,this.player=i,this.index=a,this.orbitRadius=120,this.orbitSpeed=.003;const n=e.weaponManager&&e.weaponManager.drones?e.weaponManager.drones.length+1:1;this.orbitOffset=2*Math.PI/n*a,this.radius=12,this.initGraphics(t,s),this.angle=this.orbitOffset,this.targetX=t,this.targetY=s,e.drones||(e.drones=[]),e.drones.push(this)}initGraphics(e,t){this.scene.textures.exists("drone")?(this.graphics=this.scene.add.sprite(e,t,"drone"),this.scene.anims.exists("drone_hover")||this.scene.anims.create({key:"drone_hover",frames:this.scene.anims.generateFrameNames("drone",{prefix:"drone_",start:0,end:5,suffix:".png"}),frameRate:12,repeat:-1}),this.graphics.play("drone_hover"),this.graphics.setScale(.8),this.graphics.setDepth(fu.PLAYER-1)):(this.scene.textures.exists("testplayer")?(this.graphics=this.scene.add.sprite(e,t,"testplayer"),this.graphics.setScale(.05)):this.graphics=this.scene.add.circle(e,t,this.radius,65535),this.graphics.setDepth(fu.PLAYER-1)),this.scene.isDev&&(this.debugOrbit=this.scene.add.graphics(),this.debugOrbit.lineStyle(1,65535,.3),this.debugOrbit.strokeCircle(e,t,this.orbitRadius),this.debugOrbit.setDepth(fu.EFFECTS_LOW))}update(){const e=this.player.getPosition();this.angle+=this.orbitSpeed;const t=this.orbitRadius+5*Math.sin(5*this.angle),s=e.x+Math.cos(this.angle)*t,i=e.y+Math.sin(this.angle)*t;this.graphics.x=s,this.graphics.y=i,this.targetX=s,this.targetY=i,this.debugOrbit&&(this.debugOrbit.clear(),this.debugOrbit.lineStyle(1,65535,.3),this.debugOrbit.strokeCircle(e.x,e.y,this.orbitRadius));const a=this.angle+Math.PI/2;this.graphics.rotation=a,this.updateShootingRangeTint()}updateShootingRangeTint(){if(!this.scene.input||!this.scene.input.activePointer)return;const e=this.scene.input.activePointer.worldX,t=this.scene.input.activePointer.worldY,s=e-this.graphics.x,i=t-this.graphics.y;Math.sqrt(s*s+i*i)<=this.orbitRadius?this.graphics.setTint(16737894):this.graphics.clearTint()}getPosition(){return{x:this.graphics.x,y:this.graphics.y}}shoot(e,t){}destroy(){if(this.graphics&&this.graphics.destroy(),this.debugOrbit&&this.debugOrbit.destroy(),this.scene&&this.scene.drones){const e=this.scene.drones.indexOf(this);-1!==e&&this.scene.drones.splice(e,1)}this.player=null,this.scene=null}}class Wu{constructor(e,t,s={}){this.scene=e,this.player=t,this.SETTINGS=mu,this.fireRate=0,this.caliber=0,this.bulletSpeed=0,this.bulletDamage=0,this.bulletColor=0,this.bulletHealth=0,this.bulletPierce=0,this.bulletCount=1,this.bulletRange=s.bulletRange||600,this.criticalHitChance=s.criticalHitChance||5,this.criticalDamageMultiplier=s.criticalDamageMultiplier||1.5,this.bulletAoeRadius=s.bulletAoeRadius||0,this.bulletAoeDamage=s.bulletAoeDamage||0,this.bulletHoming=s.bulletHoming||!1,this.homingForce=s.homingForce||.05,this.lastFireTime=0,this.drones=[],this.maxDrones=s.maxDrones||0,this.initWeaponProperties(),e.weaponManager=this}initWeaponProperties(){this.fireRate=this.SETTINGS.WEAPON_FIRE_RATE,this.caliber=this.SETTINGS.WEAPON_BULLET_CALIBER,this.bulletSpeed=this.SETTINGS.WEAPON_BULLET_SPEED,this.bulletDamage=this.SETTINGS.WEAPON_BULLET_DAMAGE,this.bulletColor=3331062,this.bulletHealth=this.SETTINGS.WEAPON_BULLET_HEALTH}addDrone(){if(this.drones.length>=this.maxDrones)return null;const e=this.player.getPosition(),t=new Nu(this.scene,e.x,e.y,this.player,this.drones.length);return this.drones.push(t),this.recalculateDronePositions(),uu.emit("drone-added",{drone:t,count:this.drones.length}),t}recalculateDronePositions(){const e=this.drones.length;if(0!==e)for(let t=0;t<e;t++){const s=this.drones[t];if(s){const i=2*Math.PI/e*t;s.orbitOffset=i,s.angle=i}}}upgradeDrones(){return this.maxDrones++,this.addDrone()}updateDrones(){for(let e=0;e<this.drones.length;e++)this.drones[e]&&this.drones[e].update&&this.drones[e].update()}shoot(e,t){const s=this.scene.time.now;if(s-this.lastFireTime<this.fireRate)return!1;this.lastFireTime=s;const i=this.player.getPosition(),a=e-i.x,n=t-i.y,r=Math.sqrt(a*a+n*n),o=a/r,l=n/r,h=i.x+o*this.player.radius,c=i.y+l*this.player.radius;return this.createBullet(h,c,o,l),this.playWeaponSound(),!0}shootDrones(e,t){for(let s=0;s<this.drones.length;s++)if(this.drones[s]&&this.drones[s].shoot){const i=this.drones[s].getPosition(),a=e-i.x,n=t-i.y,r=Math.sqrt(a*a+n*n);if(r<=(this.drones[s].orbitRadius||3*this.drones[s].radius||50))continue;const o=a/r,l=n/r;this.createBulletFromDrone(this.drones[s],o,l)}}createBulletFromDrone(e,t,s){const i=e.getPosition(),a=i.x+t*e.radius,n=i.y+s*e.radius;this.createBullet(a,n,t,s,.7)}createBullet(e,t,s,i,a=1){if(this.scene.bulletPool){const n=this.scene.bulletPool.createBullet(e,t,s,i,this.bulletSpeed,this.bulletHealth,this.bulletColor,this.caliber);return n&&(n.damage=this.bulletDamage*a,n.pierce=this.bulletPierce,n.range=this.bulletRange,n.penetratedEnemies=[],n.canCrit=Math.random()<this.criticalHitChance/100,n.critMultiplier=this.criticalDamageMultiplier,this.bulletAoeRadius>0&&(n.aoeRadius=this.bulletAoeRadius,n.aoeDamage=this.bulletAoeDamage),this.bulletHoming&&(n.homing=!0,n.homingForce=this.homingForce)),n}return null}playWeaponSound(){if(this.scene.soundManager)try{const e=200*Math.random()-100;this.scene.sound&&this.scene.sound.locked&&this.scene.sound.unlock(),this.scene.soundManager.playSoundEffect("shoot_weapon",{detune:e,volume:.05})}catch(e){console.warn("Error playing weapon sound:",e)}}applyUpgrade(e){e&&e.stats&&(Object.entries(e.stats).forEach((([e,t])=>{switch(e){case"damage":this.bulletDamage*=t;break;case"fireRate":t<1?this.fireRate*=t:this.fireRate/=t;break;case"bulletRange":this.bulletRange*=t,this.player&&void 0!==this.player.maxMouseDistance&&(this.player.maxMouseDistance=.5*this.bulletRange);break;case"bulletSpeed":this.bulletSpeed*=t;break;case"bulletPierce":this.bulletPierce+=t;break;case"criticalChance":this.criticalHitChance+=t;break;case"criticalDamageMultiplier":this.criticalDamageMultiplier+=t;break;case"aoeRadius":this.bulletAoeRadius+=t;break;case"aoeDamage":this.bulletAoeDamage+=t;break;case"homing":this.bulletHoming=t;break;case"homingForce":this.homingForce=t;break;default:console.warn(`Unknown weapon stat: ${e}`)}})),uu.emit("weapon-upgraded",{upgrade:e,newStats:{damage:this.bulletDamage,fireRate:this.fireRate,range:this.bulletRange,speed:this.bulletSpeed,pierce:this.bulletPierce,criticalChance:this.criticalHitChance,criticalDamage:this.criticalDamageMultiplier,aoeRadius:this.bulletAoeRadius,aoeDamage:this.bulletAoeDamage,homing:this.bulletHoming}}))}update(){this.updateDrones()}getStats(){return{type:"Standard",damage:this.bulletDamage,fireRate:this.fireRate,range:this.bulletRange,speed:this.bulletSpeed,pierce:this.bulletPierce,criticalChance:this.criticalHitChance,criticalDamage:this.criticalDamageMultiplier,aoeRadius:this.bulletAoeRadius,aoeDamage:this.bulletAoeDamage,homing:this.bulletHoming,droneCount:this.drones.length,maxDrones:this.maxDrones}}destroy(){this.drones.forEach((e=>{e&&e.destroy&&e.destroy()})),this.drones=[],this.player=null,this.scene=null}}class Uu{constructor(e,t,s){var i,a,n,r;this.scene=e,this.SETTINGS=mu,this.initPhysicsProperties(),this.initGraphics(t,s),this.initSounds(),this.createAnimations(),e.playerHealth?this.healthSystem=e.playerHealth:this.healthSystem=new Fu(e,{maxHealth:100,invulnerabilityTime:1e3,damageResistance:0}),this.xpCollectionRadius=40,this.cashCollectionRadius=40,this.lastMovementTime=0,this.lastKnockbackTime=0;const o=Iu.find((e=>"dash_1"===e.id)),l=Iu.find((e=>"shield_1"===e.id));this.hasDash=!1,this.dashPower=(null==(i=null==o?void 0:o.stats)?void 0:i.dashPower)||1.5,this.dashCooldown=(null==(a=null==o?void 0:o.stats)?void 0:a.dashCooldown)||1e4,this.dashDuration=200,this.dashCooldownTimer=0,this.isDashing=!1,this.dashDirection={x:0,y:0},this.hasShield=!1,this.shieldDuration=(null==(n=null==l?void 0:l.stats)?void 0:n.shieldDuration)||3e3,this.shieldCooldown=(null==(r=null==l?void 0:l.stats)?void 0:r.shieldCooldown)||3e4,this.shieldCooldownTimer=0,this.isShieldActive=!1,this.shieldContainer=null,this.upgrades={health:0,armor:0,speed:0,weaponDamage:0,fireRate:0,pierce:0},this.credits=100,this.skillPoints=0}initWeaponSystem(){this.weaponManager=new Wu(this.scene,this,{maxDrones:0,bulletRange:600}),this.maxMouseDistance=.5*this.weaponManager.bulletRange}applyUpgrade(e){if(!e||!e.type)return console.warn("Invalid upgrade provided:",e),!1;switch(e.type){case"Health":if(this.healthSystem){const e=this.healthSystem.getMaxHealth(),t=Math.round(.2*e);this.healthSystem.setMaxHealth(e+t),this.healthSystem.heal(t),this.upgrades.health++}break;case"Armor":let t=0,s=null;if(this.healthSystem?(t=this.healthSystem.getDamageResistance()||0,s=this.healthSystem):this.scene.playerHealth&&this.scene.playerHealth!==this.healthSystem&&(t=this.scene.playerHealth.getDamageResistance()||0,s=this.scene.playerHealth),t>=.25)return!1;if(!s)return console.warn("No health system found to apply armor upgrade"),!1;{const e=t+.15;s.setDamageResistance(e),this.scene.playerHealth&&this.scene.playerHealth!==this.healthSystem&&this.scene.playerHealth.setDamageResistance(e),this.upgrades.armor++}break;case"Speed":this.speed*=1.15,this.upgrades.speed++,this.graphics&&this.graphics.body&&this.graphics.body.setMaxVelocity(this.speed,this.speed);break;case"Drone":if(this.weaponManager)return!!this.weaponManager.upgradeDrones();break;default:return console.warn(`Unknown upgrade type: ${e.type}`),!1}return uu.emit("player-upgraded",{upgradeType:e.type,level:this.upgrades[e.type.toLowerCase()]}),!0}initPhysicsProperties(){this.speed=this.SETTINGS.PLAYER_SPEED,this.velX=0,this.velY=0,this.friction=this.SETTINGS.PLAYER_FRICTION,this.acceleration=this.SETTINGS.PLAYER_ACCELERATION,this.radius=this.SETTINGS.PLAYER_RADIUS,this.maxMouseDistance=300,this.targetX=null,this.targetY=null,this.directions={DOWN:"down",RIGHT:"right",UP:"up",LEFT:"left"},this.currentDirection=this.directions.DOWN,this.isMoving=!1,this.animationSpeed=8,this.xpCollectionInterval=100,this.cashCollectionInterval=100,this.lastXpCollectionTime=0,this.lastCashCollectionTime=0}initGraphics(e,t){this.scene.textures.exists("player")?this.useAtlas=!0:(console.warn("Player atlas texture not found. Will attempt to use individual sprites."),this.useAtlas=!1),this.useAtlas?this.graphics=this.scene.physics.add.sprite(e,t,"player"):this.graphics=this.scene.physics.add.sprite(e,t,"down1"),this.graphics.setDepth(fu.PLAYER),this.graphics.body&&(this.graphics.body.setGravity(0,0),this.graphics.body.setCollideWorldBounds(!0),this.graphics.body.setBounce(0),this.graphics.body.setFriction(0,0),this.graphics.body.setDrag(0,0),this.graphics.body.setMaxVelocity(500,500),this.graphics.body.setDamping(!1),this.radius),this.adjustSpriteScale(),this.line=this.scene.add.graphics(),this.line.setDepth(fu.PLAYER_UI),this.cursorCircle=this.scene.add.graphics(),this.cursorCircle.setDepth(fu.PLAYER_UI),this.line.setScrollFactor(1),this.cursorCircle.setScrollFactor(1)}adjustSpriteScale(){let e,t;if(this.useAtlas){const s=this.scene.textures.getFrame("player","down1.png");s&&(e=s.width,t=s.height)}else if(this.scene.textures.exists("down1")){const s=this.scene.textures.getFrame("down1");s&&(e=s.width,t=s.height)}if(e&&t){const s=2.5*this.radius/Math.min(e,t);this.graphics.setScale(s)}else this.graphics.setScale(.25);if(this.graphics.body)try{this.graphics.displayWidth,this.graphics.displayHeight;const e=this.graphics.displayWidth,t=this.graphics.displayHeight;this.graphics.body.setCircle(this.radius);let s=.5*e+this.radius,i=.5*t-this.radius;s+=0,i+=80,this.graphics.body.offset.set(s,i),this.radius,this.graphics.body.enable=!0,this.radius}catch(s){console.error("Error adjusting player physics body:",s)}}createAnimations(){const e=this.scene.anims,t=this.animationSpeed,s=(t,s)=>!e.exists(t)&&(this.useAtlas?s.every((e=>null!==this.scene.textures.getFrame("player",e.frame||e))):s.every((e=>this.scene.textures.exists(e)))),i=(s,i,a={})=>{try{this.useAtlas?e.create({key:s,frames:i.map((e=>({key:"player",frame:e}))),frameRate:a.frameRate||t,repeat:void 0!==a.repeat?a.repeat:-1}):e.create({key:s,frames:i.map((e=>({key:e.replace(".png","")}))),frameRate:a.frameRate||t,repeat:void 0!==a.repeat?a.repeat:-1}),this.scene.isDev}catch(n){console.warn(`Failed to create animation ${s}:`,n)}};Object.entries({"player-walk-down":["down1.png","down2.png","down3.png","down4.png"],"player-walk-up":["up1.png","up2.png","up3.png","up4.png"],"player-walk-left":["left1.png","left2.png","left3.png","left4.png"],"player-walk-right":["right1.png","right2.png","right3.png","right4.png"],"player-idle-down":["down1.png"],"player-idle-up":["up1.png"],"player-idle-left":["left1.png"],"player-idle-right":["right1.png"]}).forEach((([a,n])=>{if(s(a,n)){const e=a.includes("idle");i(a,n,{frameRate:e?1:t,repeat:e?0:-1})}else e.exists(a)||console.warn(`Cannot create animation ${a}: frames not available`)})),this.graphics.play("player-idle-down")}initSounds(){}update(){this.updateMovement(),this.updateAiming(),this.updateAnimation(),this.updateDash(),this.updateShield(),this.scene.isDev&&this.scene.time.now%1e3<20&&(this.hasDash&&this.dashCooldownTimer>0&&Math.ceil(this.dashCooldownTimer/1e3),this.hasShield&&this.shieldCooldownTimer>0&&Math.ceil(this.shieldCooldownTimer/1e3)),this.weaponManager&&this.weaponManager.update(),this.scene.collectibleManager||(this.checkXPCollection(),this.checkCashCollection())}updateShield(){this.hasShield&&this.isShieldActive&&this.shieldContainer&&this.shieldContainer.setPosition(this.graphics.x,this.graphics.y)}updateDash(){this.hasDash&&this.isDashing&&this.createDashTrailEffect()}activateDash(){if(!this.hasDash)return!1;if(this.dashCooldownEvent&&!this.dashCooldownEvent.hasDispatched){if(this.scene.showFloatingText){const e=this.dashCooldownEvent.getElapsed(),t=this.dashCooldownEvent.delay,s=Math.ceil((t-e)/1e3),i=this.graphics.x,a=this.graphics.y-40;this.scene.showFloatingText(i,a,`Dash on cooldown: ${s}s`,16711680)}return!1}let e=this.velX,t=this.velY;if(0===e&&0===t)switch(this.currentDirection){case this.directions.UP:t=-1;break;case this.directions.DOWN:t=1;break;case this.directions.LEFT:e=-1;break;case this.directions.RIGHT:e=1}const s=Math.sqrt(e*e+t*t);s>0&&(e/=s,t/=s),this.dashDirection={x:e,y:t};const i=150*this.dashPower,a=this.graphics.x+e*i,n=this.graphics.y+t*i;this.isDashing=!0,this.healthSystem&&"function"==typeof this.healthSystem.setInvulnerable&&this.healthSystem.setInvulnerable(),this.createDashEffect(),this.playDashSound(),this.graphics.setPosition(a,n),this.scene.time.delayedCall(this.dashDuration,(()=>{this.isDashing=!1}));const r=Number(this.dashCooldown)||1e4;return this.dashCooldownEvent=this.scene.time.delayedCall(r,(()=>{this.scene.showFloatingText&&this.scene.showFloatingText(this.graphics.x,this.graphics.y-40,"Dash Ready!",65535)})),this.scene.isDev,!0}createDashEffect(){this.graphics&&(this.graphics.setTint(65535),this.scene.time.delayedCall(this.dashDuration,(()=>{this.graphics&&this.graphics.clearTint()})));for(let e=0;e<10;e++){const e=this.scene.add.circle(this.graphics.x,this.graphics.y,Phaser.Math.Between(3,8),65535,.7);e.setDepth(fu.PLAYER-1);const t=Phaser.Math.Between(0,360)*(Math.PI/180),s=Phaser.Math.Between(50,150),i=Math.cos(t)*s,a=Math.sin(t)*s;this.scene.tweens.add({targets:e,x:e.x+i,y:e.y+a,alpha:0,scale:0,duration:300,ease:"Power2",onComplete:()=>{e.destroy()}})}}createDashTrailEffect(){if(this.isDashing&&this.scene.time.now%50==0){const e=this.scene.add.circle(this.graphics.x,this.graphics.y,this.radius,65535,.3);e.setDepth(fu.PLAYER-1),this.scene.tweens.add({targets:e,alpha:0,scale:.5,duration:200,onComplete:()=>{e.destroy()}})}}playDashSound(){if(this.scene.soundManager){const e=this.scene.soundManager.hasSound("dash")?"dash":"laserShoot";this.scene.soundManager.playSoundEffect(e,{detune:-300,volume:.04})}}activateShield(){if(!this.hasShield)return!1;if(this.shieldCooldownEvent&&!this.shieldCooldownEvent.hasDispatched){if(this.scene.showFloatingText){const e=this.shieldCooldownEvent.getElapsed(),t=this.shieldCooldownEvent.delay,s=Math.ceil((t-e)/1e3),i=this.graphics.x,a=this.graphics.y-40;this.scene.showFloatingText(i,a,`Shield on cooldown: ${s}s`,16711680)}return!1}if(this.isShieldActive)return!1;this.isShieldActive=!0,this.healthSystem&&"function"==typeof this.healthSystem.setInvulnerable&&this.healthSystem.setInvulnerable(),this.createShieldEffect(),this.playShieldActivationSound(),this.scene.time.delayedCall(this.shieldDuration,(()=>{this.deactivateShield()}));const e=Number(this.shieldCooldown)||3e4;return this.shieldCooldownEvent=this.scene.time.delayedCall(e,(()=>{this.scene.showFloatingText&&this.scene.showFloatingText(this.graphics.x,this.graphics.y-40,"Shield Ready!",65535)})),this.scene.isDev,!0}deactivateShield(){this.isShieldActive&&(this.isShieldActive=!1,this.playShieldDeactivationSound(),this.shieldContainer&&this.scene.tweens.add({targets:this.shieldContainer,alpha:0,duration:300,onComplete:()=>{this.shieldContainer&&(this.shieldContainer.destroy(),this.shieldContainer=null)}}))}createShieldEffect(){this.shieldContainer=this.scene.add.container(this.graphics.x,this.graphics.y),this.shieldContainer.setDepth(fu.PLAYER-1);const e=2*this.radius,t=this.scene.add.circle(0,0,e,43775,.2);t.setStrokeStyle(3,65535,.4);const s=this.scene.add.circle(0,0,.7*e,65535,.08);this.shieldContainer.add([t,s]),this.scene.tweens.add({targets:t,scale:1.2,duration:1e3,yoyo:!0,repeat:-1}),this.scene.tweens.add({targets:s,scale:1.3,duration:1e3,yoyo:!0,repeat:-1,delay:500}),this.scene.tweens.add({targets:this.shieldContainer,angle:360,duration:3e3,repeat:-1})}playShieldActivationSound(){if(this.scene.soundManager){const e=this.scene.soundManager.hasSound("shield_activate")?"shield_activate":"laserShoot";this.scene.soundManager.playSoundEffect(e,{detune:600,volume:.05})}}playShieldDeactivationSound(){if(this.scene.soundManager){const e=this.scene.soundManager.hasSound("shield_deactivate")?"shield_deactivate":"laserShoot";this.scene.soundManager.playSoundEffect(e,{detune:-600,volume:.04})}}updateDebugGraphics(){}checkXPCollection(){const e=this.scene.time.now;e-this.lastXpCollectionTime<this.xpCollectionInterval||(this.lastXpCollectionTime=e,this.scene.spritePool&&this.scene.xpManager&&this.scene.spritePool.checkCollision(this.graphics.x,this.graphics.y,this.xpCollectionRadius,(e=>{if(e&&e.customData&&e.customData.value&&(this.scene.xpManager.addXP(e.customData.value),this.scene.soundManager)){const e=this.scene.soundManager.hasSound("xp_collect")?"xp_collect":"shoot_weapon";this.scene.soundManager.playSoundEffect(e,{detune:1200,volume:.03})}return!0}),"xp_pickup"))}checkCashCollection(){const e=this.scene.time.now;e-this.lastCashCollectionTime<this.cashCollectionInterval||(this.lastCashCollectionTime=e,this.scene.spritePool&&this.scene.cashManager?this.scene.spritePool.checkCollision(this.graphics.x,this.graphics.y,this.cashCollectionRadius,(e=>{if(e&&e.customData&&"cash_pickup"===e.customData.type&&e.customData.value){const t=e.customData.value;if(this.scene.cashManager.addCash(t),this.scene.soundManager){const e=this.scene.soundManager.hasSound("cash_pickup")?"cash_pickup":"laserShoot";this.scene.soundManager.playSoundEffect(e,{detune:600,volume:.3})}}return!0})):console.warn("Missing required components for cash collection:",this.scene.spritePool?"":"spritePool",this.scene.cashManager?"":"cashManager"))}updateMovement(){const e=this.scene.wasd;this.velX=0,this.velY=0;const t=300;if(e.up.isDown&&(this.velY=-300),e.down.isDown&&(this.velY=t),e.left.isDown&&(this.velX=-300),e.right.isDown&&(this.velX=t),0!==this.velX&&0!==this.velY){const e=Math.sqrt(this.velX*this.velX+this.velY*this.velY);this.velX=this.velX/e*t,this.velY=this.velY/e*t}if(this.graphics.body)this.graphics.body.setVelocity(this.velX,this.velY);else{let e=this.graphics.x+this.velX*(1/60),t=this.graphics.y+this.velY*(1/60);const s=this.scene.physics.world.bounds;e=Phaser.Math.Clamp(e,s.x+this.radius,s.right-this.radius),t=Phaser.Math.Clamp(t,s.y+this.radius,s.bottom-this.radius),this.graphics.x=e,this.graphics.y=t}const s=Math.abs(this.velX)>1||Math.abs(this.velY)>1;s!==this.isMoving&&(this.isMoving=s)}updateAiming(){const e=this.scene.mouseX,t=this.scene.mouseY;if(void 0===e||void 0===t)return;const s=e-this.graphics.x,i=t-this.graphics.y,a=Math.atan2(i,s);let n=e,r=t;Math.sqrt(s*s+i*i)>this.maxMouseDistance&&(n=this.graphics.x+Math.cos(a)*this.maxMouseDistance,r=this.graphics.y+Math.sin(a)*this.maxMouseDistance),this.targetX=n,this.targetY=r;const o=this.graphics.x+Math.cos(a)*this.radius,l=this.graphics.y+Math.sin(a)*this.radius;this.updateSpriteDirection(a),this.line.clear(),this.cursorCircle.clear(),this.line.lineStyle(2,16777215),this.line.beginPath(),this.line.moveTo(o,l),this.line.lineTo(n,r),this.line.strokePath(),this.cursorCircle.lineStyle(2,16777215),this.cursorCircle.strokeCircle(n,r,10)}updateSpriteDirection(e){const t=Phaser.Math.RadToDeg(e);let s;s=t>=-45&&t<45?this.directions.RIGHT:t>=45&&t<135?this.directions.DOWN:t>=135&&t<=180||t>=-180&&t<-135?this.directions.LEFT:this.directions.UP,s!==this.currentDirection&&(this.currentDirection=s)}updateAnimation(){var e;if(!this.scene.anims||0===Object.keys(this.scene.anims.anims.entries).length)return;let t;if(t=this.isMoving?`player-walk-${this.currentDirection}`:`player-idle-${this.currentDirection}`,this.scene.anims.exists(t)&&(null==(e=this.graphics.anims.currentAnim)?void 0:e.key)!==t)this.graphics.play(t);else if(!this.scene.anims.exists(t))if(this.useAtlas){const e=`${this.currentDirection}1.png`;this.scene.textures.getFrame("player",e)&&this.graphics.setTexture("player",e)}else{const e=`${this.currentDirection}1`;this.scene.textures.exists(e)&&this.graphics.setTexture(e)}}shoot(){if(!this.weaponManager)return!1;const e=this.weaponManager.shoot(this.targetX,this.targetY);return e&&this.weaponManager.shootDrones(this.targetX,this.targetY),e}setPosition(e,t){this.graphics&&(this.graphics.setPosition(e,t),this.velX=0,this.velY=0,this.graphics.body&&this.graphics.body.setVelocity(0,0))}getPosition(){return{x:this.graphics.x,y:this.graphics.y}}destroy(){this.weaponManager&&(this.weaponManager.destroy(),this.weaponManager=null),this.graphics&&this.graphics.destroy(),this.line&&this.line.destroy(),this.cursorCircle&&this.cursorCircle.destroy(),this.shieldContainer&&(this.shieldContainer.destroy(),this.shieldContainer=null),this.debugGraphics&&(this.debugGraphics.destroy(),this.debugGraphics=null),this.scene&&this.scene.tweens&&this.scene.tweens.killTweensOf(this.graphics),this.velX=0,this.velY=0,this.targetX=null,this.targetY=null}}class zu{constructor(e){this.scene=e,this.pools={},this.defaultConfigs={bullet:{initialSize:50,maxSize:200,growSize:10},enemy:{initialSize:20,maxSize:250,growSize:5}},this.stats={created:{},reused:{},released:{}}}createPool(e,t,s,i={}){const a={...this.defaultConfigs[e]||{initialSize:20,maxSize:100,growSize:5},...i},n={objects:[],type:e,createFunc:t,resetFunc:s,config:a};return this.pools[e]=n,this.stats.created[e]=0,this.stats.reused[e]=0,this.stats.released[e]=0,this.populate(e,a.initialSize),n}populate(e,t){const s=this.pools[e];if(s){for(let i=0;i<t;i++){const t=s.createFunc();t.setActive?t.setActive(!1):t.active=!1,t.setVisible?t.setVisible(!1):t.visible=!1,s.objects.push(t),this.stats.created[e]++}s.objects.length}else console.warn(`Cannot populate non-existent pool of type: ${e}`)}get(e,...t){const s=this.pools[e];if(!s)return console.warn(`Cannot get from non-existent pool of type: ${e}`),null;let i=s.objects.find((e=>!e.active));return!i&&s.objects.length<s.config.maxSize&&(this.populate(e,s.config.growSize),i=s.objects.find((e=>!e.active))),i?(i.setActive?i.setActive(!0):i.active=!0,i.setVisible?i.setVisible(!0):i.visible=!0,s.resetFunc(i,...t),this.stats.reused[e]++,i):(console.warn(`Pool of type ${e} is at capacity (${s.config.maxSize})`),null)}release(e,t){this.pools[e]?t&&t.active&&(t.setActive?t.setActive(!1):t.active=!1,t.setVisible?t.setVisible(!1):t.visible=!1,this.stats.released[e]++):console.warn(`Cannot release to non-existent pool of type: ${e}`)}getStats(){const e={};for(const t in this.pools){const s=this.pools[t],i=s.objects.filter((e=>e.active)).length;e[t]={total:s.objects.length,active:i,available:s.objects.length-i,created:this.stats.created[t]||0,reused:this.stats.reused[t]||0,released:this.stats.released[t]||0}}return e}destroy(){for(const e in this.pools){const t=this.pools[e];t.objects.forEach((e=>{e.destroy&&"function"==typeof e.destroy&&e.destroy()})),t.objects.length=0}this.pools={},this.stats={created:{},reused:{},released:{}}}updatePool(e,t){const s=this.pools[e];s&&s.objects.forEach((e=>{e.active&&t(e)}))}}class Vu{constructor(e){this.enemy=e,this.scene=e.scene,this.originalStats={speed:e.speed,damage:e.damage,color:e.color},e.sprite&&e.sprite.anims&&e.sprite.anims.currentAnim&&(this.originalStats.animSpeed=e.sprite.anims.currentAnim.frameRate),this.speedMultiplier=1.7,this.damageMultiplier=1.5,this.outlineGraphic=null,this.particles=null,this.emitter=null}enter(){this.enemy.speed=this.originalStats.speed*this.speedMultiplier,this.enemy.damage=this.originalStats.damage*this.damageMultiplier;const e=this.enemy.sprite||this.enemy.graphics;if(this.createRageOutline(),this.enemy.sprite){if(this.enemy.sprite.setTint(16728128),this.pulseTween=this.scene.tweens.add({targets:this.enemy.sprite,scaleX:{from:1.5,to:1.7},scaleY:{from:1.5,to:1.7},duration:200,yoyo:!0,repeat:-1}),this.enemy.sprite.anims&&this.enemy.sprite.anims.currentAnim){const e=this.enemy.sprite.anims.currentAnim.key;this.enemy.sprite.anims.currentFrame;const t=this.originalStats.animSpeed||24;this.enemy.sprite.anims.stop(),this.enemy.sprite.play({key:e,frameRate:1.3*t,repeat:-1})}}else this.enemy.graphics&&this.enemy.graphics.setFillStyle(16711680);uu.emit("enemy-rage-started",{enemy:this.enemy,position:e?{x:e.x,y:e.y}:null})}createRageOutline(){const e=this.enemy.sprite||this.enemy.graphics;if(e)if(this.scene.particles)this.particles=this.scene.add.particles(e.x,e.y,"particle_texture",{scale:{start:.1,end:0},speed:{min:5,max:20},alpha:{start:.6,end:0},tint:16711680,lifespan:300,blendMode:"ADD",frequency:20}),this.particles.setDepth(e.depth-1),this.scene.tweens.add({targets:this.particles,x:e.x,y:e.y,duration:0,ease:"Linear",loop:-1,onUpdate:()=>{this.particles&&e.active&&this.particles.setPosition(e.x,e.y)}});else{const t=1.2*this.enemy.size;this.outlineGraphic=this.scene.add.circle(e.x,e.y,t/2,16711680,.3),this.outlineGraphic.setStrokeStyle(2,16711680),this.outlineGraphic.setDepth(e.depth-1)}}removeRageOutline(){this.particles&&(this.particles.destroy(),this.particles=null),this.outlineGraphic&&(this.outlineGraphic.destroy(),this.outlineGraphic=null)}update(e){const t=this.enemy.sprite||this.enemy.graphics;t&&this.outlineGraphic&&this.outlineGraphic.setPosition(t.x,t.y)}rushTowardsPlayer(){}exit(){if(this.enemy.speed=this.originalStats.speed,this.enemy.damage=this.originalStats.damage,this.removeRageOutline(),this.enemy.sprite){if(this.enemy.sprite.clearTint(),this.pulseTween&&(this.pulseTween.stop(),this.pulseTween=null,this.enemy.sprite.setScale(1.5)),this.enemy.sprite.anims&&this.enemy.sprite.anims.currentAnim){const e=this.enemy.sprite.anims.currentAnim.key,t=this.originalStats.animSpeed||24;this.enemy.sprite.anims.stop(),this.enemy.sprite.play({key:e,frameRate:t,repeat:-1})}}else this.enemy.graphics&&this.enemy.graphics.setFillStyle(this.originalStats.color)}static shouldRage(e){return!(!e.groupId||e.isNeutral)&&!!e.scene.chaosManager&&(e.scene.chaosManager.getFactionBalance(),e.scene.chaosManager.isGroupWeakened(e.groupId))}}class Hu{constructor(e,t,s,i=!1){this.scene=e,this.active=!0,this.type="base",this.hasHealthBar=!1,this.groupId=null,this._originalStats=null,this.currentAnimationKey=null,this.initProperties(),i||(this.createVisuals(t,s),this.hasHealthBar&&this.createHealthBar())}reset(e,t,s={}){this.active=!0,this.dying=!1,this.groupId=null,this._originalStats=null,this.currentAnimationKey=null,this.rageState&&this.exitRageState(),this.isNeutral=!1,this.applyOptions(s),this.initProperties(),this.sprite?(this.sprite.setPosition(e,t),this.sprite.setActive(!0),this.sprite.setVisible(!0),this.sprite.clearTint&&this.sprite.clearTint(),this.sprite.body&&(this.sprite.body.reset(e,t),this.sprite.body.setVelocity(0,0)),this.playAnimation("idle")):this.createVisuals(e,t),this.hasHealthBar&&(this.cleanupHealthBar(),this.createHealthBar()),s.groupId&&this.setGroup(s.groupId)}applyOptions(e){e.healthMultiplier&&e.healthMultiplier>1&&(this.baseHealth=this.baseHealth*e.healthMultiplier,this.health=this.baseHealth),e.damageMultiplier&&e.damageMultiplier>1&&(e.isBossEncounter||(this.damage=this.damage*e.damageMultiplier)),e.scoreMultiplier&&e.scoreMultiplier>1&&(this.scoreValue=this.scoreValue*e.scoreMultiplier),e.isBossEncounter&&(this.isBossEncounter=!0,this.bossCounter=e.bossCounter||1)}initProperties(){this.speed=.5,this.size=15,this.color=10066329,this.health=10,this.baseHealth=10,this.damage=1,this.scoreValue=10}createVisuals(e,t){"base"!==this.type&&this.scene.textures.exists(this.type)?(this.sprite=this.scene.add.sprite(e,t,this.type),this.sprite.setScale(2),this.playAnimation("idle"),this.sprite.setDepth(fu.ENEMIES),this.sprite.parentEnemy=this,this.graphics=this.sprite,this.scene.physics.add.existing(this.sprite)):(this.graphics=this.scene.add.rectangle(e,t,this.size,this.size,this.color),this.graphics.setDepth(fu.ENEMIES),this.graphics.parentEnemy=this,this.sprite=this.graphics,this.scene.physics.add.existing(this.graphics)),this.scene.enemies&&this.scene.enemies.add(this.graphics)}setGroup(e){if(this.groupId===e)return!1;const t=this.groupId;return this.groupId=e,this.scene.groupManager&&this.scene.groupManager.registerEntity(this,e),uu.emit("enemy-group-changed",{enemy:this,oldGroupId:t,newGroupId:e}),!0}setNeutral(){const e=this.setGroup(gu.NEUTRAL);return e&&(this.isNeutral=!0,this.sprite&&this.sprite.setTint(11184810)),e}cleanupHealthBar(){this.healthBar&&(this.healthBar.destroy(),this.healthBar=null),this.healthBarBg&&(this.healthBarBg.destroy(),this.healthBarBg=null)}createHealthBar(){if(!this.hasHealthBar)return;if(!this.sprite)return;const e=2*this.size,t=this.sprite.y-this.size-10;this.healthBarBg=this.scene.add.rectangle(this.sprite.x,t,e,5,0).setDepth(fu.ENEMY_HEALTH_BAR_BG),this.healthBar=this.scene.add.rectangle(this.sprite.x-e/2,t,e,5,16711680).setOrigin(0,.5).setDepth(fu.ENEMY_HEALTH_BAR_FG)}updateHealthBar(){if(!this.hasHealthBar||!this.healthBar||!this.healthBarBg)return;if(!this.sprite)return;this.healthBarBg.x=this.sprite.x,this.healthBarBg.y=this.sprite.y-this.size-10;const e=Math.max(0,this.health/this.baseHealth),t=2*this.size;this.healthBar.width=t*e,this.healthBar.x=this.sprite.x-t/2,this.healthBar.y=this.sprite.y-this.size-10}playAnimation(e,t=!1){if(!this.active||!this.sprite||!this.sprite.anims)return!1;if("base"===this.type)return!1;const s=`${this.type}_${e}`;return!(!t||!this.sprite.anims.currentAnim||this.sprite.anims.currentAnim.key!==s)||(this.scene.animationManager&&this.scene.animationManager.playAnimation(this.sprite,s,t)?(this.currentAnimationKey=s,!0):!!this.scene.anims.exists(s)&&(this.sprite.play(s,t),this.currentAnimationKey=s,!0))}update(){if(!this.active||!this.sprite||!this.sprite.active)return;if(this.dying)return;if(this.currentAnimationKey&&this.currentAnimationKey.includes("death"))return void(this.hasHealthBar&&this.updateHealthBar());this.checkRageState(),this.rageState&&this.rageState.update();const e=this.scene.player.getPosition();this.moveTowardsPlayer(e),this.checkPlayerCollision(e),this.hasHealthBar&&this.updateHealthBar()}checkRageState(){const e=Vu.shouldRage(this);this.rageState&&!e?this.exitRageState():!this.rageState&&e&&this.enterRageState()}enterRageState(){this.rageState=new Vu(this),this.rageState.enter(),this.sprite&&this.sprite.setTint(16737894),uu.emit("enemy-rage-started",{enemy:this,groupId:this.groupId,position:{x:this.sprite?this.sprite.x:0,y:this.sprite?this.sprite.y:0}})}exitRageState(){this.rageState&&(this.rageState.exit(),this.rageState=null,this.sprite&&!this.isNeutral&&this.sprite.clearTint())}isEnraged(){return!!this.rageState}resetTarget(){if(this.isNeutral)return;if(this.dying)return;if(!this.sprite)return;const e=this.scene.player.getPosition();this.moveTowardsPlayer(e),void 0!==this.attackCooldown&&(this.attackCooldown=Math.min(this.attackCooldown,this.scene.time.now+500))}moveTowardsPlayer(e){if(this.isNeutral)return;if(!this.sprite)return;if(this.currentAnimationKey&&this.currentAnimationKey.includes("death"))return;const t=e.x-this.sprite.x,s=e.y-this.sprite.y,i=Math.sqrt(t*t+s*s);if(i>0){const e=t/i,a=s/i;this.sprite.x+=e*this.speed,this.sprite.y+=a*this.speed,this.playAnimation("run",!0),0!==e&&this.sprite.anims&&this.sprite.setFlipX(e<0)}else this.playAnimation("idle",!0)}checkPlayerCollision(e){if(this.isNeutral)return;if(!this.sprite)return;const t=e.x-this.sprite.x,s=e.y-this.sprite.y;Math.sqrt(t*t+s*s),this.size,this.scene.player.radius}takeDamage(e){this.active&&(this.health-=e,this.sprite&&(this.sprite.setTint(16777215),this.scene.time.delayedCall(100,(()=>{this.active&&this.sprite&&!this.isEnraged()&&!this.isNeutral&&this.sprite.clearTint()}))),this.health<=0&&this.die())}die(){if(this.rageState&&this.exitRageState(),!this.active)return;const e=this.sprite?{x:this.sprite.x,y:this.sprite.y}:null;if(this.dying=!0,this.type,this.sprite&&"enemy1"===this.type){this.sprite.setVisible(!0),this.sprite.setAlpha(1);const e=`${this.type}_death`;this.scene.anims.exists(e)&&this.sprite&&this.sprite.anims?(this.sprite.off("animationcomplete"),this.sprite.on("animationcomplete",(t=>{t.key===e&&this.completeCleanup()})),this.sprite.play(e),this.currentAnimationKey=e,this.scene.time.delayedCall(3e3,(()=>{this.type;try{this.sprite.play(e),this.currentAnimationKey=e}catch(t){console.warn(`Failed to play ${e} animation: ${t.message}`),this.completeCleanup()}}))):this.completeCleanup()}else if(this.playAnimation("death")){this.type,this.sprite&&(this.sprite.setVisible(!0),this.sprite.setAlpha(1));const e=(t,s,i)=>{i===this.sprite&&t.key===`${this.type}_death`&&(this.type,this.sprite&&this.sprite.off&&this.sprite.off("animationcomplete",e),this.completeCleanup())};this.sprite&&this.sprite.on&&this.sprite.on("animationcomplete",e);let t=3e3;if(this.sprite&&this.sprite.anims&&this.sprite.anims.currentAnim){const e=this.sprite.anims.currentAnim.frameRate||10,s=this.sprite.anims.currentAnim.frames.length;t=Math.ceil(1e3*s/e)+500}this.scene.time.delayedCall(t,(()=>{this.type,this.completeCleanup()}))}else this.type,this.completeCleanup();uu.emit("enemy-killed",{enemy:this,position:e,time:this.scene.time.now}),this.scene.onEnemyKilled(this.isBossEnemy(),e?e.x:0,e?e.y:0,this.type,this)}completeCleanup(e){if(!this.active&&!this.sprite&&!this.graphics)return;const t={x:e?e.x:this.sprite?this.sprite.x:0,y:e?e.y:this.sprite?this.sprite.y:0};this.active=!1,this.scene.groupManager&&this.groupId&&this.scene.groupManager.deregister(this,this.groupId);const s=this.isBossEnemy();if(this.scene.cashManager){if(s||Math.random(0,1)<=.64){let e=1;s?e=2:"enemy2"!==this.type&&"enemy3"!==this.type||(e=1.5);const i=Math.ceil(this.scoreValue*e);this.scene.cashManager.spawnCashPickup(t.x,t.y,i)}Math.random(0,1)<.05&&this.scene.spritePool&&this.scene.spritePool.createHealthPickup(t.x,t.y,{value:25})}this.sprite&&(this.sprite.destroy(),this.sprite=null),this.graphics&&this.graphics!==this.sprite?(this.graphics.destroy(),this.graphics=null):this.graphics=null,this.cleanupHealthBar()}getScoreValue(){return this.scoreValue||10}getType(){return this.type}getGroup(){return this.groupId}isBossEnemy(){return this.type.includes("boss")}destroy(){this.active=!1,this.groupId&&this.scene.groupManager&&(this.scene.groupManager.deregister(this,this.groupId),this.groupId=null),this.sprite&&(this.sprite.destroy(),this.sprite=null),this.graphics&&this.graphics!==this.sprite?(this.graphics.destroy(),this.graphics=null):this.graphics=null,this.cleanupHealthBar(),this._originalStats=null,this.currentAnimationKey=null,this.rageState=null,uu.emit("enemy-destroyed",{enemy:this})}}class $u extends Hu{constructor(e,t,s,i=!1){super(e,t,s,i),this.type="enemy1"}initProperties(){this.speed=.7,this.size=18,this.color=65280,this.health=10,this.baseHealth=10,this.damage=30,this.scoreValue=10}moveTowardsPlayer(e){if(this.isNeutral)return;if(this.currentAnimationKey&&this.currentAnimationKey.includes("death"))return;const t=this.sprite||this.graphics;if(!t)return;const s=e.x-t.x,i=e.y-t.y,a=Math.sqrt(s*s+i*i);if(a>0){const e=s/a,n=i/a,r=.15*Math.sin(this.scene.time.now/400),o=-n,l=e;t.x+=(e+o*r)*this.speed,t.y+=(n+l*r)*this.speed,this.sprite&&(this.sprite.anims.isPlaying&&this.sprite.anims.currentAnim&&this.sprite.anims.currentAnim.key.includes("death")||(this.sprite.play("enemy1_run",!0),0!==e&&this.sprite.setFlipX(e<0)))}}}class ju extends Hu{constructor(e,t,s,i=!1){super(e,t,s,i),this.type="enemy2",this.dashCooldown=0,this.dashState="ready"}initProperties(){this.speed=.4,this.size=24,this.color=255,this.health=20,this.baseHealth=20,this.damage=40,this.scoreValue=25,this.dashSpeed=2,this.chargeTime=1500,this.dashTime=500,this.dashCooldownTime=5e3}reset(e,t,s={}){super.reset(e,t,s),this.dashCooldown=0,this.dashState="ready"}moveTowardsPlayer(e){if(this.isNeutral)return;if(this.currentAnimationKey&&this.currentAnimationKey.includes("death"))return;const t=this.sprite||this.graphics;if(!t)return;const s=e.x-t.x,i=e.y-t.y,a=Math.sqrt(s*s+i*i),n=this.scene.time.now;if("ready"===this.dashState&&a<250&&a>100&&this.dashCooldown<n)this.dashState="charging",this.dashDirection={x:s/a,y:i/a},this.dashTarget={x:e.x,y:e.y},this.chargeStartTime=n,this.sprite?(this.sprite.play("enemy2_activate"),this.sprite.setTint(16776960)):this.graphics&&this.graphics.setFillStyle(16776960);else if("charging"===this.dashState)if(n>this.chargeStartTime+this.chargeTime)this.dashState="dashing",this.dashStartTime=n,this.sprite?(this.sprite.play("enemy2_run",!0),this.sprite.anims&&this.sprite.anims.currentAnim&&(this.sprite.anims.currentAnim.frameRate=20),this.sprite.setTint(16711680)):this.graphics&&this.graphics.setFillStyle(16711680);else{const e=s/a,n=i/a;t.x+=e*(.3*this.speed),t.y+=n*(.3*this.speed),!this.sprite||this.sprite.anims.isPlaying&&"enemy2_activate"===this.sprite.anims.currentAnim.key||this.sprite.play("enemy2_idle",!0)}else if("dashing"===this.dashState)t.x+=this.dashDirection.x*this.dashSpeed,t.y+=this.dashDirection.y*this.dashSpeed,n>this.dashStartTime+this.dashTime&&(this.dashState="ready",this.dashCooldown=n+this.dashCooldownTime,this.sprite?(this.sprite.anims&&this.sprite.anims.currentAnim&&(this.sprite.anims.currentAnim.frameRate=10),this.sprite.clearTint(),this.sprite.play("enemy2_idle",!0)):this.graphics&&this.graphics.setFillStyle(this.color));else if(a>0){const e=s/a,n=i/a;t.x+=e*this.speed,t.y+=n*this.speed,this.sprite&&(!this.sprite.anims.isPlaying||this.sprite.anims.currentAnim&&!this.sprite.anims.currentAnim.key.includes("death"))&&(this.sprite.play("enemy2_run",!0),0!==e&&this.sprite.setFlipX(e<0))}}}class Gu extends Hu{constructor(e,t,s,i=!1){super(e,t,s,i),this.type="enemy3",this.attackCooldown=0,e.isDev&&(e.textures.exists("enemy3"),e.anims.exists("enemy3_idle"),e.anims.exists("enemy3_run"),e.anims.exists("enemy3_shoot"))}initProperties(){this.speed=.3,this.size=19,this.color=16737792,this.health=15,this.baseHealth=15,this.damage=20,this.scoreValue=20,this.attackRange=350,this.preferredRange=250,this.retreatRange=150,this.attackCooldownTime=2e3}reset(e,t,s={}){super.reset(e,t,s),this.attackCooldown=0,this.scene.isDev}createVisuals(e,t){if(super.createVisuals(e,t),this.scene.isDev&&(this.sprite,this.graphics,this.sprite))try{this.playAnimation("idle")||(this.graphics.setFillStyle(16746496,1),this.graphics.setStrokeStyle(2,16777215))}catch(s){console.warn(`[Enemy3] Error playing animation: ${s.message}`),this.graphics.setFillStyle(16746496,1),this.graphics.setStrokeStyle(2,16777215)}}moveTowardsPlayer(e){if(this.isNeutral)return;if(this.currentAnimationKey&&this.currentAnimationKey.includes("death"))return;const t=this.sprite||this.graphics;if(!t)return;const s=e.x-t.x,i=e.y-t.y,a=Math.sqrt(s*s+i*i),n=a>0?s/a:0,r=a>0?i/a:0,o=this.scene.time.now;if(a<=this.attackRange&&o>this.attackCooldown&&(this.fireProjectile(e),this.attackCooldown=o+this.attackCooldownTime),a<this.retreatRange){if(t.x-=n*this.speed*1.2,t.y-=r*this.speed*1.2,this.sprite&&this.sprite.anims)try{this.sprite.anims.isPlaying&&(!this.sprite.anims.currentAnim||this.sprite.anims.currentAnim.key.includes("death")||this.sprite.anims.currentAnim.key.includes("shoot"))||(this.sprite.play("enemy3_run",!0),this.sprite.setFlipX(n>0))}catch(l){console.warn(`[Enemy3] Error updating animation during retreat: ${l.message}`)}}else if(a>this.preferredRange){if(t.x+=n*this.speed*.8,t.y+=r*this.speed*.8,this.sprite&&this.sprite.anims)try{this.sprite.anims.isPlaying&&(!this.sprite.anims.currentAnim||this.sprite.anims.currentAnim.key.includes("death")||this.sprite.anims.currentAnim.key.includes("shoot"))||(this.sprite.play("enemy3_run",!0),this.sprite.setFlipX(n<0))}catch(l){console.warn(`[Enemy3] Error updating animation during approach: ${l.message}`)}}else{const e=-r,s=n,i=Math.floor(o/3e3)%2==0?1:-1;if(t.x+=e*this.speed*i,t.y+=s*this.speed*i,this.sprite&&this.sprite.anims)try{this.sprite.anims.isPlaying&&(!this.sprite.anims.currentAnim||this.sprite.anims.currentAnim.key.includes("death")||this.sprite.anims.currentAnim.key.includes("shoot"))||(this.sprite.play("enemy3_idle",!0),this.sprite.setFlipX(n<0))}catch(l){console.warn(`[Enemy3] Error updating animation during strafe: ${l.message}`)}}}fireProjectile(e){if(!this.scene.enemyManager)return;const t=this.sprite||this.graphics;if(!t)return;const s=e.x-t.x,i=e.y-t.y,a=Math.sqrt(s*s+i*i),n=s/a,r=i/a;if(this.sprite)try{this.sprite.anims?(this.sprite.play("enemy3_shoot"),this.sprite.setFlipX(n<0),this.sprite.once("animationcomplete",(e=>{if("enemy3_shoot"===e.key&&this.sprite&&this.sprite.anims)try{this.sprite.play("enemy3_idle",!0)}catch(t){console.warn(`[Enemy3] Error playing idle after shoot: ${t.message}`)}}))):(this.graphics.setFillStyle(16776960),this.scene.time.delayedCall(100,(()=>{this.active&&this.graphics&&this.graphics.active&&this.graphics.setFillStyle(this.color)})))}catch(o){console.warn(`[Enemy3] Error playing shoot animation: ${o.message}`),this.graphics.setFillStyle(16776960),this.scene.time.delayedCall(100,(()=>{this.active&&this.graphics&&this.graphics.active&&this.graphics.setFillStyle(this.color)}))}else this.graphics.setFillStyle(16776960),this.scene.time.delayedCall(100,(()=>{this.active&&this.graphics&&this.graphics.active&&this.graphics.setFillStyle(this.color)}));this.scene.isDev&&(t.x,t.y,e.x,e.y),uu.emit("enemy-attack",{type:"ranged",enemyType:this.type,position:{x:t.x,y:t.y}}),this.scene.enemyManager.spawnProjectile(t.x,t.y,n,r,3,this.damage/2)}}class Ku extends Hu{constructor(e,t,s,i=!1){super(e,t,s,i),this.type="boss1",this.hasHealthBar=!0,this.attackPhase=0,this.phaseTime=0}initProperties(){this.speed=.3,this.size=80,this.color=16711680,this.health=1e4,this.baseHealth=1e4,this.damage=40,this.scoreValue=100,this.attackCooldown=0,this.attackDuration=0,this.isAttacking=!1,this.attackPhase=0,this.attackPatterns=[{name:"orbit",duration:5e3,cooldown:2e3},{name:"charge",duration:2e3,cooldown:3e3},{name:"summon",duration:1e3,cooldown:7e3}]}reset(e,t,s={}){super.reset(e,t,s),this.attackCooldown=0,this.attackDuration=0,this.isAttacking=!1,this.attackPhase=0,this.phaseTime=0,this.chargeDirection=null}createVisuals(e,t){this.scene.textures.exists(this.type)?(this.sprite=this.scene.add.sprite(e,t,this.type),this.sprite.setScale(2.5),this.sprite.play(`${this.type}_idle`),this.sprite.setDepth(fu.ENEMIES),this.sprite.parentEnemy=this,this.graphics=this.sprite,this.scene.physics.add.existing(this.sprite)):(this.graphics=this.scene.add.circle(e,t,this.size/2,this.color),this.graphics.setStrokeStyle(4,16776960),this.graphics.setDepth(fu.ENEMIES),this.graphics.parentEnemy=this,this.scene.physics.add.existing(this.graphics)),this.scene.enemies&&this.scene.enemies.add(this.graphics)}update(){const e=this.sprite||this.graphics;if(!this.active||!e||!e.active)return;const t=this.scene.player.getPosition();this.updateHealthBar(),this.updateBossAttackPattern(t),this.checkPlayerCollision(t)}updateBossAttackPattern(e){const t=this.scene.time.now;if(!this.isAttacking&&t>this.attackCooldown){this.attackPhase=(this.attackPhase+1)%this.attackPatterns.length;const i=this.attackPatterns[this.attackPhase];if(this.isAttacking=!0,this.attackStartTime=t,this.attackDuration=i.duration,this.currentPattern=i,this.sprite){const e="charge"===i.name?`${this.type}_run`:`${this.type}_attack`;if(this.scene.textures.exists(this.type)&&this.scene.anims.exists(e)&&this.scene.anims.get(e).frames.length>0)try{this.sprite.play(e)}catch(s){console.warn(`Failed to play animation '${e}': ${s.message}`),this.sprite.setTint(16776960)}else this.sprite.setTint(16776960)}else this.graphics&&this.graphics.setStrokeStyle(2,16776960);"summon"===i.name&&this.summonMinions(e)}else if(this.isAttacking){if("orbit"===this.currentPattern.name?this.executeOrbitAttack(e,t):"charge"===this.currentPattern.name&&this.executeChargeAttack(e,t),t>this.attackStartTime+this.attackDuration)if(this.isAttacking=!1,this.attackCooldown=t+this.currentPattern.cooldown,this.sprite){this.sprite.clearTint();const e=`${this.type}_idle`;if(this.scene.anims.exists(e)&&this.scene.anims.get(e).frames.length>0)try{this.sprite.play(e)}catch(s){console.warn(`Failed to play animation '${e}': ${s.message}`)}}else this.graphics&&this.graphics.setStrokeStyle(0)}else this.moveTowardsPlayer(e)}executeOrbitAttack(e,t){const s=t-this.attackStartTime,i=.002*s,a=this.sprite||this.graphics;if(a.x=e.x+200*Math.cos(i),a.y=e.y+200*Math.sin(i),this.sprite){const e=Math.sin(i+Math.PI/2)>0;this.sprite.setFlipX(e)}s%500<20&&this.spawnProjectile(e)}executeChargeAttack(e,t){const s=t-this.attackStartTime,i=this.sprite||this.graphics;if(s<1e3)s%200<100?this.sprite?this.sprite.setTint(16776960):this.graphics.setFillStyle(16776960):this.sprite?this.sprite.setTint(16711680):this.graphics.setFillStyle(this.color);else{if(!this.chargeDirection){const t=e.x-i.x,s=e.y-i.y,a=Math.sqrt(t*t+s*s);this.chargeDirection={x:t/a,y:s/a},this.sprite?(this.sprite.setTint(16711680),this.sprite.setFlipX(this.chargeDirection.x<0),this.scene.anims.exists(`${this.type}_run`)&&(this.sprite.play(`${this.type}_run`,!0),this.sprite.anims&&"function"==typeof this.sprite.anims.setTimeScale&&this.sprite.anims.setTimeScale(2))):this.graphics.setFillStyle(16711680)}i.x+=3*this.chargeDirection.x,i.y+=3*this.chargeDirection.y,s>=this.attackDuration-100&&(this.chargeDirection=null,this.sprite?(this.sprite.clearTint(),this.sprite.anims&&"function"==typeof this.sprite.anims.setTimeScale&&this.sprite.anims.setTimeScale(1)):this.graphics&&this.graphics.setFillStyle(this.color))}}summonMinions(e){if(this.scene.enemyManager){const e=this.sprite||this.graphics,t=e.x,s=e.y,i=Math.floor(3+3*Math.random());this.scene.enemyManager.spawnEnemyGroup("enemy1",t,s,i,100);const a=this.scene.add.circle(t,s,100,16776960,.3).setDepth(90).setAlpha(.7);this.scene.tweens.add({targets:a,alpha:0,radius:140,duration:700,ease:"Cubic.Out",onComplete:(e,t)=>{t[0].destroy()}});const n=this.scene.add.circle(t,s,10,16776960,.1).setDepth(90);this.scene.tweens.add({targets:n,radius:120,alpha:0,duration:500,ease:"Cubic.Out",onComplete:(e,t)=>{t[0].destroy()}})}}spawnProjectile(e){var t;const s=this.sprite||this.graphics;if(this.sprite){const e=`${this.type}_shoot`;if(this.scene.anims.exists(e)&&this.scene.anims.get(e)&&this.scene.anims.get(e).frames&&this.scene.anims.get(e).frames.length>0)try{this.sprite.anims.isPlaying&&(null==(t=this.sprite.anims.currentAnim)?void 0:t.key)===`${this.type}_death`||this.sprite.play(e)}catch(l){console.warn(`Failed to play ${e} animation: ${l.message}`)}}const i=e.x-s.x,a=e.y-s.y,n=Math.sqrt(i*i+a*a),r=i/n,o=a/n;this.scene.enemyManager&&this.scene.enemyManager.spawnProjectile(s.x,s.y,r,o,2,this.damage/10)}moveTowardsPlayer(e){var t,s,i;if(this.isNeutral)return;if(this.currentAnimationKey&&this.currentAnimationKey.includes("death"))return;const a=this.sprite||this.graphics;if(!a)return;const n=e.x-a.x,r=e.y-a.y,o=Math.sqrt(n*n+r*r);if(o>0){const e=n/o,l=r/o;if(a.x+=e*this.speed,a.y+=l*this.speed,this.sprite){const a=o>100?`${this.type}_run`:`${this.type}_idle`;(null==(t=this.sprite.anims.currentAnim)?void 0:t.key)===a||(null==(s=this.sprite.anims.currentAnim)?void 0:s.key.includes("attack"))||(null==(i=this.sprite.anims.currentAnim)?void 0:i.key.includes("death"))||this.sprite.play(a,!0),0!==e&&this.sprite.setFlipX(e<0)}}}die(){this.sprite&&this.scene.anims.exists(`${this.type}_death`)?(this.sprite.play(`${this.type}_death`),this.sprite.on("animationcomplete",(e=>{e.key===`${this.type}_death`&&this.completeCleanup()})),this.scene.time.delayedCall(1500,(()=>{this.completeCleanup()}))):this.completeCleanup();const e=this.sprite||this.graphics,t=e?{x:e.x,y:e.y}:null;this.scene.onEnemyKilled(!0,t?t.x:0,t?t.y:0,this.type)}}class Yu{constructor(e){this.scene=e,this.enemyConstructors=new Map,this.enemyConfigs=new Map,this.poolOptions=new Map,this.registerDefaultEnemies()}registerDefaultEnemies(){this.registerEnemyType("enemy1",$u,{speed:.7,size:12,color:65280,health:10,damage:30,scoreValue:10},{initialSize:20,maxSize:250,growSize:5}),this.registerEnemyType("enemy2",ju,{speed:.4,size:18,color:255,health:20,damage:40,scoreValue:25,dashSpeed:2,chargeTime:1500,dashTime:500,dashCooldownTime:5e3},{initialSize:10,maxSize:150,growSize:3}),this.registerEnemyType("enemy3",Gu,{speed:.3,size:14,color:16737792,health:15,damage:20,scoreValue:20,attackRange:350,preferredRange:250,retreatRange:150,attackCooldownTime:2e3},{initialSize:10,maxSize:50,growSize:3}),this.registerEnemyType("boss1",Ku,{speed:.3,size:50,color:16711680,health:1e4,damage:5,scoreValue:500,hasHealthBar:!0},{initialSize:2,maxSize:5,growSize:1})}registerEnemyType(e,t,s={},i={}){this.enemyConstructors.has(e)&&console.warn(`Enemy type '${e}' is already registered. Overwriting.`),this.enemyConstructors.set(e,t),this.enemyConfigs.set(e,s),this.poolOptions.set(e,i)}getConstructor(e){return this.enemyConstructors.get(e)||null}getConfig(e){return this.enemyConfigs.get(e)||null}getPoolOptions(e){return this.poolOptions.get(e)||null}createEnemy(e,t,s,i=!1,a={}){const n=this.getConstructor(e);if(!n)return console.warn(`Enemy type '${e}' not found in registry`),null;const r=new n(this.scene,t,s,i);if(Object.keys(a).length>0&&Object.assign(r,a),this.scene.groupManager){const e=a.groupId||this.scene.groupManager.getNextSpawnGroup();r.setGroup(e)}return r}getRegisteredTypes(){return Array.from(this.enemyConstructors.keys())}getEnemyTypeSummary(){const e={};for(const[t,s]of this.enemyConstructors.entries()){const i=this.enemyConfigs.get(t)||{},a=this.poolOptions.get(t)||{};e[t]={className:s.name,config:{...i},pooling:{...a}}}return e}}class Xu{constructor(e,t={}){if(this.scene=e,this.isDev=this.scene.isDev||!1,t.initialWeights)this.groupWeights=t.initialWeights;else{const e=Math.floor(41*Math.random())+30,t=Math.floor(41*Math.random())+30;this.groupWeights={ai:e,coder:t}}this.totalWeight=this.calculateTotalWeight(),this.volatility=t.volatility||.35,this.killHistory={ai:0,coder:0},this.recentKills=[],this.maxRecentKills=10,this.enableFluctuations=!0,this.lastFluctuationTime=0,this.fluctuationInterval=t.fluctuationInterval||1e4,this.fluctuationIntensity=0,this.enableSurges=void 0===t.enableSurges||t.enableSurges,this.surgeThreshold=t.surgeThreshold||5,this.surgeMultiplier=t.surgeMultiplier||2.2,this.activeSurge=null,this.dynamicAdjustment=!0,this.minWeight=t.minWeight||15,this.maxWeight=t.maxWeight||500,this.isDev&&this.groupWeights}calculateTotalWeight(){return Object.values(this.groupWeights).reduce(((e,t)=>e+t),0)}getWeight(e){return this.groupWeights[e]||0}setWeight(e,t){this.groupWeights[e]=Math.max(this.minWeight,Math.min(this.maxWeight,t)),this.totalWeight=this.calculateTotalWeight(),this.isDev&&(this.groupWeights[e],this.totalWeight)}setWeights(e){for(const[t,s]of Object.entries(e))this.groupWeights[t]=Math.max(this.minWeight,Math.min(this.maxWeight,s));this.totalWeight=this.calculateTotalWeight()}registerKill(e){void 0!==this.killHistory[e]?this.killHistory[e]++:this.killHistory[e]=1,this.recentKills.push(e),this.recentKills.length>this.maxRecentKills&&this.recentKills.shift(),this.checkForSurges(e),this.dynamicAdjustment&&this.adjustWeightsBasedOnKills()}checkForSurges(e){if(!this.enableSurges)return;let t=0;for(let s=this.recentKills.length-1;s>=0&&this.recentKills[s]===e;s--)t++;t>=this.surgeThreshold&&(this.triggerSurge(e),this.recentKills=[])}triggerSurge(e){const t=Object.keys(this.groupWeights).find((t=>t!==e));if(!t)return;if(this.activeSurge&&this.activeSurge.groupId===t)return;this.activeSurge&&this.activeSurge.timer&&this.activeSurge.timer.remove();const s=this.groupWeights[t],i=s*this.surgeMultiplier;this.groupWeights[t]=i,this.totalWeight=this.calculateTotalWeight(),this.scene.events&&this.scene.events.emit("faction-surge",{groupId:t,strength:this.surgeMultiplier}),this.isDev,this.activeSurge={groupId:t,originalWeight:s,timer:this.scene.time.delayedCall(12e3,(()=>{this.groupWeights[t]===i&&(this.groupWeights[t]=s,this.totalWeight=this.calculateTotalWeight(),this.isDev),this.activeSurge=null}))}}applyRandomFluctuation(){}adjustWeightsBasedOnKills(){const e=Object.keys(this.groupWeights);if(e.length<=1)return;const t=Object.values(this.killHistory).reduce(((e,t)=>e+t),0);if(0===t)return;const s={};for(const l in this.killHistory)s[l]=this.killHistory[l]/t;const i=Object.values(this.groupWeights),a=Math.max(...i),n=Math.min(...i),r=a/Math.max(1,n),o={};for(const l in s){const t=s[l];if(r>5){const t=e.find((e=>e!==l));this.groupWeights[l]>5*this.groupWeights[t]?o[l]=Math.floor(1.5*this.groupWeights[t]):5*this.groupWeights[l]<this.groupWeights[t]&&(o[l]=Math.floor(this.groupWeights[t]/1.5))}else o[l]=50+100*t}for(const l in this.groupWeights)if(void 0!==o[l]){const e=this.groupWeights[l],t=o[l]-e,s=e+Math.sign(t)*Math.min(.1*Math.abs(t),10);this.groupWeights[l]=Math.max(this.minWeight,Math.min(this.maxWeight,s))}this.totalWeight=this.calculateTotalWeight(),this.isDev&&this.groupWeights}pickRandomGroup(){const e=Math.random()*this.totalWeight;let t=0;for(const[s,i]of Object.entries(this.groupWeights))if(t+=i,e<t)return s;return Object.keys(this.groupWeights)[0]}temporaryBoost(e,t=2,s=5e3){if(!this.groupWeights[e])return 0;const i=this.groupWeights[e],a=Math.min(this.maxWeight,i*t);this.groupWeights[e]=a,this.totalWeight=this.calculateTotalWeight();const n=Math.floor(s/1e3*(t-1));return this.isDev,this.scene.time.delayedCall(s,(()=>{this.groupWeights[e]===a&&(this.groupWeights[e]=i,this.totalWeight=this.calculateTotalWeight(),this.isDev)})),n}setDynamicAdjustment(e){this.dynamicAdjustment=e}setVolatility(e){this.volatility=Math.max(0,Math.min(1,e))}setFluctuationsEnabled(e){this.enableFluctuations=e}setSurgesEnabled(e){this.enableSurges=e}getProbabilities(){const e={};for(const[t,s]of Object.entries(this.groupWeights))e[t]=s/this.totalWeight;return e}resetKillHistory(){for(const e in this.killHistory)this.killHistory[e]=0;this.recentKills=[]}forceRebalanceWeights(){const e=Object.keys(this.groupWeights);if(e.length<=1)return!1;const t=Object.values(this.groupWeights),s=Math.max(...t),i=Math.min(...t);if(s/Math.max(1,i)>5){const t=50;for(const s of e){const e=.8+.4*Math.random();this.groupWeights[s]=Math.floor(t*e)}return this.totalWeight=this.calculateTotalWeight(),this.isDev&&this.groupWeights,!0}return!1}}class qu{constructor(e,t={}){this.scene=e,this.gameObjectManager=e.gameObjectManager||new zu(e),this.enemies=[],this.enemyPools={},this.projectiles=[],this.enemyRegistry=new Yu(e),this.groupWeightManager=new Xu(e,{initialWeights:t.initialGroupWeights||{ai:50,coder:50},volatility:t.groupVolatility||.2}),this.bossCounter=0,this.bossScalingFactor=t.bossScalingFactor||2.5,e.enemyManager=this,this.initializePools(t),this.isDev=this.scene.isDev||!1}initializePools(e){const t={initialSize:20,maxSize:300,growSize:5,...e};this.enemyRegistry.getRegisteredTypes().forEach((e=>{const s=this.enemyRegistry.getConstructor(e);this.enemyRegistry.getConfig(e);const i=this.enemyRegistry.getPoolOptions(e),a={...t,...i};this.createEnemyPool(e,s,a)})),this.createProjectilePool(t)}createEnemyPool(e,t,s){this.gameObjectManager.createPool(e,(()=>new t(this.scene,0,0,!0)),((e,t,s,i={})=>{e.killCounted=!1,e.reset(t,s,i),this.enemies.includes(e)||this.enemies.push(e)}),s),this.enemyPools[e]||(this.enemyPools[e]=!0)}createProjectilePool(e){this.gameObjectManager.createPool("projectile",(()=>{const e={graphics:this.scene.add.circle(0,0,5,16711680),active:!1,speed:0,directionX:0,directionY:0,damage:1,lifetime:0,maxLifetime:3e3};return e.graphics.setActive(!1),e.graphics.setVisible(!1),e}),((e,t,s,i={})=>{e.graphics.setPosition(t,s),e.graphics.setActive(!0),e.graphics.setVisible(!0),e.directionX=i.directionX||0,e.directionY=i.directionY||0,e.speed=i.speed||2,e.damage=i.damage||1,e.lifetime=0,e.maxLifetime=i.maxLifetime||3e3,e.active=!0,this.projectiles.includes(e)||this.projectiles.push(e)}),{initialSize:e.initialSize||30,maxSize:e.maxSize||100,growSize:e.growSize||10})}spawnEnemy(e,t,s,i={}){if(!this.enemyPools[e])return console.warn(`Enemy type '${e}' not found in enemy pools`),null;if(!i.groupId){const e=this.groupWeightManager.pickRandomGroup();i.groupId=e,this.isDev}const a=this.gameObjectManager.get(e,t,s,i);if(!a)return null;if(i.groupId&&a.setGroup&&(a.setGroup(i.groupId),this.scene.groupManager&&a.groupId&&this.scene.groupManager.applyModifiers(a,a.groupId)),a.groupId&&a.graphics){const e={ai:3447003,coder:15158332}[a.groupId];e&&(a.factionTint=e,a.graphics.setTint&&a.graphics.setTint(e),a.graphics.list&&Array.isArray(a.graphics.list)&&a.graphics.list.forEach((t=>{t&&t.setTint&&t.setTint(e)})),a.sprite&&a.sprite.setTint&&a.sprite.setTint(e))}return i.externalSpawn||(a._registeredWithWaveManager=!0),a}registerEnemyType(e,t,s={},i={}){return this.enemyRegistry.registerEnemyType(e,t,s,i),this.createEnemyPool(e,t,i),this}registerKill(e){this.groupWeightManager&&this.groupWeightManager.registerKill(e)}getGroupDistribution(){return this.groupWeightManager?{weights:{...this.groupWeightManager.groupWeights},probabilities:this.groupWeightManager.getProbabilities(),killPercentages:this.getKillPercentages()}:{weights:{},probabilities:{}}}getKillPercentages(){if(!this.groupWeightManager||!this.groupWeightManager.killHistory)return{};const e=this.groupWeightManager.killHistory,t=Object.values(e).reduce(((e,t)=>e+t),0);if(0===t)return{};const s={};for(const i in e)s[i]=e[i]/t;return s}checkAndRebalanceGroupWeights(){if(!this.groupWeightManager)return!1;const e=this.groupWeightManager.forceRebalanceWeights();return e&&this.isDev,e}setGroupVolatility(e){this.groupWeightManager&&this.groupWeightManager.setVolatility(e)}setGroupWeight(e,t){this.groupWeightManager&&this.groupWeightManager.setWeight(e,t)}hasEnemyType(e){return!0===this.enemyPools[e]}getEnemyTypeInfo(e){return this.enemyRegistry.getConstructor(e)?{config:this.enemyRegistry.getConfig(e),poolOptions:this.enemyRegistry.getPoolOptions(e)}:null}spawnProjectile(e,t,s,i,a=2,n=1){return this.gameObjectManager.get("projectile",e,t,{directionX:s,directionY:i,speed:a,damage:n})}spawnEnemyGroup(e,t,s,i=3,a=100,n={}){const r=[],o=this.scene.mapDimensions||{width:this.scene.game.config.width,height:this.scene.game.config.height};for(let l=0;l<i;l++){const i=Math.random()*Math.PI*2,l=Math.random()*a,h=Math.cos(i)*l,c=Math.sin(i)*l,u=Math.max(50,Math.min(o.width-50,t+h)),d=Math.max(50,Math.min(o.height-50,s+c)),p=this.spawnEnemy(e,u,d,n);p&&r.push(p)}return r}spawnEnemiesAtEdges(e,t=1){const s=this.scene.cameras.main,i=this.scene.player.getPosition(),a=this.scene.mapDimensions;for(let n=0;n<t;n++){let t,n;if(100*Math.random()<80){const e=Math.floor(4*Math.random()),r=150+250*Math.random();switch(e){case 0:t=i.x+(Math.random()*s.width-s.width/2),n=Math.max(50,i.y-s.height/2-r);break;case 1:t=Math.min(a.width-50,i.x+s.width/2+r),n=i.y+(Math.random()*s.height-s.height/2);break;case 2:t=i.x+(Math.random()*s.width-s.width/2),n=Math.min(a.height-50,i.y+s.height/2+r);break;case 3:t=Math.max(50,i.x-s.width/2-r),n=i.y+(Math.random()*s.height-s.height/2)}}else{const e=480;switch(Math.floor(4*Math.random())){case 0:t=Math.max(50,i.x-s.width/2-e),n=Math.max(50,i.y-s.height/2-e);break;case 1:t=Math.min(a.width-50,i.x+s.width/2+e),n=Math.max(50,i.y-s.height/2-e);break;case 2:t=Math.min(a.width-50,i.x+s.width/2+e),n=Math.min(a.height-50,i.y+s.height/2+e);break;case 3:t=Math.max(50,i.x-s.width/2-e),n=Math.min(a.height-50,i.y+s.height/2+e)}}t=Math.max(50,Math.min(a.width-50,t)),n=Math.max(50,Math.min(a.height-50,n)),this.spawnEnemy(e,t,n)}}spawnBoss(e="boss1"){this.scene.cameras.main;const t=this.scene.player.getPosition(),s=this.scene.mapDimensions,i=Math.random()*Math.PI*2;let a=t.x+600*Math.cos(i),n=t.y+600*Math.sin(i);a=Math.max(50,Math.min(s.width-50,a)),n=Math.max(50,Math.min(s.height-50,n)),this.bossCounter++;let r=1;if(this.scene.waveManager){const e=this.scene.waveManager.getCurrentWave(),t=this.scene.waveManager.bossWaveInterval||5;r=Math.floor(e/t),r=Math.max(1,r),this.isDev}const o=r<=1?1:Math.pow(this.bossScalingFactor,r-1);this.isDev;const l=this.spawnEnemy(e,a,n,{healthMultiplier:o,damageMultiplier:o,speedMultiplier:.5*Math.sqrt(o),scoreMultiplier:o,isBossEncounter:!0,bossCounter:r});if(l){l.baseHealth*=o,l.health=l.baseHealth,l.damage*=o,l.scoreValue*=o,l.speed*=Math.min(2,.5*Math.sqrt(o));const e=1+Math.min(1,.3*Math.log10(o));if(l.sprite){const t=l.sprite.scale;l.sprite.setScale(t*e)}l.health,this.scene.waveManager&&this.scene.waveManager.getCurrentWave(),o.toFixed(2),l.baseHealth,l.health,o.toFixed(2),l.damage,o.toFixed(2),l.speed,Math.min(2,.5*Math.sqrt(o)).toFixed(2),e.toFixed(2),l.scoreValue;const t=`BOSS #${r}`,s=`POWER: ${o.toFixed(1)}x`;if(l.sprite){const e=this.scene.add.text(l.sprite.x,l.sprite.y-60,t,{fontFamily:"Arial",fontSize:"20px",color:"#ff0000",stroke:"#000000",strokeThickness:3}).setOrigin(.5),i=this.scene.add.text(l.sprite.x,l.sprite.y-40,s,{fontFamily:"Arial",fontSize:"16px",color:"#ffff00",stroke:"#000000",strokeThickness:3}).setOrigin(.5);this.scene.time.addEvent({delay:100,loop:!0,callback:()=>{l&&l.sprite&&l.active?(e.setPosition(l.sprite.x,l.sprite.y-60),i.setPosition(l.sprite.x,l.sprite.y-40)):(e.destroy(),i.destroy())}})}}return this.scene.showBossWarning?this.scene.showBossWarning(r,o):this.showBossWarning(r,o),l}showBossWarning(){const e=this.scene.add.text(this.scene.cameras.main.width/2,this.scene.cameras.main.height/3,"BOSS INCOMING!",{fontFamily:"Arial",fontSize:"48px",color:"#ff0000",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(1e3);this.scene.tweens.add({targets:e,alpha:{from:1,to:0},scaleX:{from:1,to:1.5},scaleY:{from:1,to:1.5},duration:2e3,ease:"Power2",onComplete:()=>{e.destroy()}})}releaseEnemy(e){if(!e)return void console.warn("Attempted to release null or undefined enemy");const t=this.enemies.indexOf(e);if(-1!==t&&(this.enemies.splice(t,1),this.scene.waveManager&&!e.killCounted)){const t=e.isBossEnemy?e.isBossEnemy():e.type.includes("boss");this.scene.waveManager.onEnemyKilled(t,e.type),e.killCounted=!0}e.groupId&&this.scene.groupManager&&this.scene.groupManager.deregister(e,e.groupId),this.gameObjectManager.release(e.getType(),e)}releaseProjectile(e){const t=this.projectiles.indexOf(e);-1!==t&&this.projectiles.splice(t,1),e.graphics&&(e.graphics.setActive(!1),e.graphics.setVisible(!1)),e.active=!1,this.gameObjectManager.release("projectile",e)}update(){this.updateEnemies(),this.updateProjectiles()}updateEnemies(){for(let e=this.enemies.length-1;e>=0;e--){const t=this.enemies[e];t&&t.active&&(t.update(),t.active&&t.graphics&&t.graphics.active||this.releaseEnemy(t))}}updateProjectiles(){for(let e=this.projectiles.length-1;e>=0;e--){const t=this.projectiles[e];if(!t||!t.active)continue;if(t.graphics.x+=t.directionX*t.speed,t.graphics.y+=t.directionY*t.speed,t.lifetime+=this.scene.game.loop.delta,t.lifetime>t.maxLifetime){this.releaseProjectile(t);continue}const s=this.scene.player.getPosition();Phaser.Math.Distance.Between(t.graphics.x,t.graphics.y,s.x,s.y)<5+this.scene.player.radius&&(this.scene.player.healthSystem?this.scene.player.healthSystem.takeDamage(t.damage):this.scene.player.takeDamage?this.scene.player.takeDamage(t.damage):console.warn("Player health system not found, damage not applied"),this.releaseProjectile(t))}}getEnemyCount(e=null){return e?this.enemies.filter((t=>t.getType()===e)).length:this.enemies.length}getStats(){const e={totalActive:this.enemies.length,projectiles:this.projectiles.length,byType:{}};for(const t of this.enemies){const s=t.getType();e.byType[s]=(e.byType[s]||0)+1}return e}getAvailableEnemyTypes(){return this.enemyRegistry.getRegisteredTypes()}clearAllEnemies(){this.enemies.forEach((e=>{e.fromPool&&e.poolKey&&this.enemyPools[e.poolKey]?this.enemyPools[e.poolKey].releaseEnemy(e):(e.graphics&&e.graphics.destroy(),e.destroy&&e.destroy())})),this.enemies=[],this.projectiles.forEach((e=>{e.graphics&&e.graphics.destroy()})),this.projectiles=[]}}class Qu{constructor(e,t={}){this.scene=e,this.objectManager=e.gameObjectManager||new zu(e),this.objectManager.createPool("bullet",(()=>{const t=e.add.sprite(0,0,"bullet");return e.bullets.add(t),t.setDepth(fu.BULLETS),t.setOrigin(.5,.5),t.originalScale=1,t.trailEmitter=null,t}),((e,t,s,i,a,n,r,o,l)=>{e.setPosition(t,s),e.setTint(o);const h=l/10;if(e.setScale(h),e.originalScale=h,e.dirX=i,e.dirY=a,e.speed=n,e.health=r,e.lifetime=0,e.rotation=Math.atan2(a,i),e.setDepth(fu.BULLETS),e.setVisible(!0),e.setActive(!0),e.trailEmitter)try{e.trailEmitter.stop(),"function"==typeof e.trailEmitter.destroy?e.trailEmitter.destroy():"function"==typeof e.trailEmitter.remove&&e.trailEmitter.remove()}catch(c){console.warn("Error cleaning up trail emitter during reset:",c)}finally{e.trailEmitter=null}}),t)}createBullet(e,t,s,i,a,n,r,o){return this.objectManager.get("bullet",e,t,s,i,a,n,r,o)}releaseBullet(e){try{if(e.trailEmitter)try{e.trailEmitter.stop(),"function"==typeof e.trailEmitter.destroy?e.trailEmitter.destroy():"function"==typeof e.trailEmitter.remove&&e.trailEmitter.remove()}catch(t){console.warn("Error cleaning up trail emitter:",t)}finally{e.trailEmitter=null}this.objectManager.release("bullet",e)}catch(t){console.warn("Error releasing bullet:",t)}}updateBullets(e,t){this.objectManager.updatePool("bullet",(s=>{s.homing&&s.homingForce>0&&this.applyHomingBehavior(s),s.x+=s.dirX*s.speed,s.y+=s.dirY*s.speed,s.lifetime+=this.scene.time.physicsFrameDelta,s.depth!==fu.BULLETS&&s.setDepth(fu.BULLETS),e&&e(s),t&&t(s)&&this.releaseBullet(s)}))}applyHomingBehavior(e){if(!this.scene.enemyManager)return;const t=this.findClosestEnemy(e);if(!t)return;const s=t.graphics.x-e.x,i=t.graphics.y-e.y,a=Math.sqrt(s*s+i*i);if(a<1)return;const n=s/a,r=i/a;e.dirX+=(n-e.dirX)*e.homingForce,e.dirY+=(r-e.dirY)*e.homingForce;const o=Math.sqrt(e.dirX*e.dirX+e.dirY*e.dirY);o>0&&(e.dirX/=o,e.dirY/=o,e.rotation=Math.atan2(e.dirY,e.dirX)),this.updateHomingTrail(e,t),this.scene.isDev&&Math.random()<.1&&t.id}updateHomingTrail(e,t){try{if(!e.trailEmitter&&this.scene.add&&this.scene.add.particles)try{const t=e.tint||16727743;this.scene.textures.exists("particle_texture")||this.createFallbackParticleTexture(),e.trailEmitter=this.scene.add.particles(e.x,e.y,"particle_texture",{speed:{min:0,max:0},scale:{start:.2,end:0},alpha:{start:.6,end:0},lifespan:200,blendMode:"ADD",frequency:15,tint:t,emitting:!0}),e.trailEmitter.setDepth(fu.BULLETS-1)}catch(s){console.warn("Error creating homing bullet trail:",s),e.trailEmitter=null}if(e.trailEmitter&&(e.trailEmitter.setPosition(e.x,e.y),this.scene.isDev&&t&&t.graphics)){const s=this.scene.add.graphics();s.lineStyle(1,16776960,.3),s.lineBetween(e.x,e.y,t.graphics.x,t.graphics.y),this.scene.time.delayedCall(50,(()=>{s.destroy()}))}}catch(s){console.warn("Error updating homing bullet trail:",s)}}createFallbackParticleTexture(){try{const e=this.scene.make.graphics({x:0,y:0,add:!1});e.fillStyle(16777215),e.fillCircle(8,8,8),e.generateTexture("particle_texture",16,16),e.destroy()}catch(e){console.warn("Failed to create fallback particle texture:",e)}}findClosestEnemy(e){const t=this.scene.enemyManager.enemies;if(!t||0===t.length)return null;let s=null,i=Number.MAX_VALUE;for(const a of t){if(!(a&&a.active&&a.graphics&&a.graphics.active))continue;if(e.penetratedEnemies&&e.penetratedEnemies.includes(a.id))continue;const t=a.graphics.x-e.x,n=a.graphics.y-e.y,r=t*t+n*n;r<i&&(i=r,s=a)}return s}getStats(){return this.objectManager.getStats().bullet}getActiveBullets(){return this.objectManager&&"function"==typeof this.objectManager.getActive?this.objectManager.getActive("bullet"):Array.isArray(this.bullets)?this.bullets.filter((e=>e&&e.active)):[]}}class Ju{constructor(e,t={}){this.scene=e,this.currentMapKey=null,this.maps=new Map,this.tilesets=new Map,this.defaultOptions={scaleFactor:1.5,enablePhysics:!0,defaultTileWidth:32,defaultTileHeight:32},this.options={...this.defaultOptions,...t},this.scene.mapManager=this,t.maps&&this.registerMaps(t.maps)}registerMaps(e){Array.isArray(e)?e.forEach((e=>{this.registerMap(e)})):console.error("Maps must be an array of map configuration objects")}registerMap(e){e.key&&e.tilemapKey?(this.maps.set(e.key,e),e.tilesets&&e.tilesets.forEach((e=>{this.tilesets.set(e.key,e)}))):console.error("Map configuration must include key and tilemapKey")}preloadMaps(){this.maps.forEach(((e,t)=>{e.tilemapKey&&!this.scene.load.cacheManager.tilemap.exists(e.tilemapKey)&&this.scene.load.tilemapTiledJSON(e.tilemapKey,e.tilemapPath||`assets/${e.tilemapKey}.json`),e.tilesets&&e.tilesets.forEach((e=>{e.key&&!this.scene.textures.exists(e.key)&&this.scene.load.image(e.key,e.imagePath||`assets/${e.key}.png`)}))}))}loadMap(e){this.cleanupCurrentMap();const t=this.maps.get(e);if(!t)return console.error(`Map with key ${e} is not registered`),null;const s=this.scene.make.tilemap({key:t.tilemapKey}),i=new Map;t.tilesets&&t.tilesets.forEach((e=>{const t=s.addTilesetImage(e.name||e.key,e.key);i.set(e.key,t)}));const a=new Map;if(t.layers){t.layers.forEach((e=>{let t;if(e.tilesetKey?t=i.get(e.tilesetKey):1===i.size&&(t=i.values().next().value),s.layers.some((t=>t.name===e.name))){if(t){let n;const r=s.layers.find((t=>t.name===e.name)),o=r&&r.data.some((e=>e>=852));"Props"===e.name||"Props1"===e.name||o?(n=Array.from(i.values()),e.name):n=t;const l=s.createLayer(e.name,n,e.offsetX||0,e.offsetY||0);l&&(!1===e.visible&&l.setVisible(!1),void 0!==e.alpha&&l.setAlpha(e.alpha),void 0!==e.depth?l.setDepth(e.depth):e.name.toLowerCase().includes("ground")?l.setDepth(fu.MAP_GROUND):e.name.toLowerCase().includes("wall")?l.setDepth(fu.MAP_WALLS):e.name.toLowerCase().includes("decoration")?l.setDepth(fu.MAP_DECORATION):l.setDepth(fu.MAP_GROUND),a.set(e.name,l))}}else console.warn(`Layer "${e.name}" not found in tilemap`)}));const e=new Set(t.layers.map((e=>e.name))),n=s.layers.map((e=>e.name)).filter((t=>!e.has(t)));if(n.length>0){n.length,n.join(", ");const e=i.values().next().value;n.forEach(((t,n)=>{let r;const o=s.layers.find((e=>e.name===t)),l=o&&o.data.some((e=>e>=852));r="Props"===t||"Prop1"===t||l?Array.from(i.values()):e;const h=s.createLayer(t,r);h&&("Props1"===t?h.setDepth(15):"Props"===t?h.setDepth(25):h.setDepth(n),a.set(t,h),h.depth)}))}}else if(i.size>0){const e=i.values().next().value;s.layers.map((e=>e.name)).forEach(((t,n)=>{let r;const o=s.layers.find((e=>e.name===t)),l=o&&o.data.some((e=>e>=852));r="Props"===t||"Prop1"===t||l?Array.from(i.values()):e;const h=s.createLayer(t,r);h&&(t.toLowerCase().includes("ground")?h.setDepth(fu.MAP_GROUND):t.toLowerCase().includes("wall")?h.setDepth(fu.MAP_WALLS):t.toLowerCase().includes("decoration")?h.setDepth(fu.MAP_DECORATION):"Props1"===t?h.setDepth(15):"Props"===t?h.setDepth(25):h.setDepth(n),a.set(t,h),h.depth)}))}return this.scaleMap(s,a),!1!==this.options.enablePhysics&&this.setupMapPhysics(s,a,t),this.currentMapData={key:e,tilemap:s,tilesets:i,layers:a,mapDimensions:this.calculateMapDimensions(s,a)},this.currentMapKey=e,this.currentMapData}calculateMapDimensions(e,t){const s=e.widthInPixels,i=e.heightInPixels;let a=1;return t.size>0&&(a=t.values().next().value.scaleX||1),{baseWidth:s,baseHeight:i,width:s*a,height:i*a,scale:a}}scaleMap(e,t){var s;const i=this.maps.get(this.currentMapKey),a=(null==(s=null==i?void 0:i.options)?void 0:s.scaleFactor)||this.options.scaleFactor,n=e.widthInPixels,r=e.heightInPixels,o=this.scene.game.config.width/n,l=this.scene.game.config.height/r,h=Math.max(o,l)*a;t.forEach((e=>{e.setScale(h)}))}setupMapPhysics(e,t,s){const i=this.calculateMapDimensions(e,t);this.scene.physics.world.setBounds(0,0,i.width,i.height),s.collisionLayers&&s.collisionLayers.forEach((i=>{const a=t.get(i);a&&("level1redux"===s.key?a.setCollisionFromCollisionGroup():s.collisionProperties?a.setCollisionByProperty(s.collisionProperties):a.setCollision(0,e.getTileLayerNames().length))}))}cleanupCurrentMap(){this.currentMapData&&(this.currentMapData.layers.forEach((e=>{e.destroy()})),this.currentMapData.layers.clear(),this.currentMapData.tilesets.clear(),this.currentMapData=null)}getMapDimensions(){return this.currentMapData?this.currentMapData.mapDimensions:null}getLayer(e){return this.currentMapData&&this.currentMapData.layers&&this.currentMapData.layers.get(e)||null}findRandomPosition(e={}){if(!this.currentMapData)return null;const t=this.currentMapData.mapDimensions,s=e.margin||50;let i,a,n,r=0;do{if(n=!0,r++,i=Phaser.Math.Between(s,t.width-s),a=Phaser.Math.Between(s,t.height-s),e.avoidLayer){const t=this.getLayer(e.avoidLayer);if(t){const e=t.getTileAtWorldXY(i,a);e&&e.collides&&(n=!1)}}}while(!n&&r<50);return{x:i,y:a}}isPositionValid(e,t,s={}){if(!this.currentMapData)return!1;const i=this.currentMapData.mapDimensions;if(e<0||e>i.width||t<0||t>i.height)return!1;if(s.collisionLayer){const i=this.getLayer(s.collisionLayer);if(i){const s=i.getTileAtWorldXY(e,t);if(s&&s.collides)return!1}}return!0}switchMap(e,t={}){return new Promise((s=>{const i=!1!==t.fadeOut,a=!1!==t.fadeIn,n=t.fadeDuration||500,r=()=>{const t=this.loadMap(e);a?(this.scene.cameras.main.fadeIn(n),this.scene.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_IN_COMPLETE,(()=>{s(t)}))):s(t)};i?(this.scene.cameras.main.fadeOut(n),this.scene.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,r)):r()}))}}class Zu{constructor(e,t={}){this.scene=e,this.currentWave=t.currentWave||0,this.maxWaves=t.maxWaves||20,this.baseEnemyCount=t.baseEnemyCount||20,this.enemyCountGrowth=t.enemyCountGrowth||1.2,this.bossWaveInterval=t.bossWaveInterval||5,this.maxEnemiesPerWave=t.maxEnemiesPerWave||300,this.isPaused=!1,this.isWaveActive=!1,this.activeEnemies=0,this.activeBosses=0,this.enemiesSpawned=0,this.enemiesToSpawn=0,this.pauseBetweenWaves=!1!==t.pauseBetweenWaves,this.uiManager=null,this.baseSpawnDelay=t.baseSpawnDelay||150,this.minSpawnDelay=t.minSpawnDelay||50,this.spawnDelayReduction=t.spawnDelayReduction||50,this.lastBossWave=0,this.spawnTimer=null,e.waveManager=this}init(e){this.uiManager=e,this.uiManager&&this.uiManager.updateWaveUI(this.currentWave,this.maxWaves)}startNextWave(){this.currentWave++,this.uiManager&&this.uiManager.updateWaveUI(this.currentWave,this.maxWaves);const e=this.currentWave%this.bossWaveInterval==0;this.calculateWaveEnemies(e),this.isWaveActive=!0,this.isPaused=!1,this.enemiesSpawned=0,this.activeEnemies=0,this.activeBosses=0,this.uiManager&&this.uiManager.showWaveStartBanner(this.currentWave,e);const t={wave:this.currentWave,isBossWave:e,enemyCount:this.enemiesToSpawn};this.scene.events.emit("wave-start",t),uu&&(uu.emit("wave-start",t),this.scene.isDev),this.scene.time.delayedCall(2e3,(()=>{this.startEnemySpawning()}))}calculateWaveEnemies(e){let t=Math.round(this.baseEnemyCount*Math.pow(this.enemyCountGrowth,this.currentWave-1));e?(t=Math.round(.7*t),this.hasBoss=!0):this.hasBoss=!1,t=Math.min(t,this.maxEnemiesPerWave),this.enemiesToSpawn=t,this.scene.isDev&&(this.currentWave,this.maxEnemiesPerWave,Math.round(this.baseEnemyCount*Math.pow(this.enemyCountGrowth,this.currentWave-1)))}startEnemySpawning(){const e=Math.max(this.minSpawnDelay,this.baseSpawnDelay-(this.currentWave-1)*this.spawnDelayReduction);this.spawnTimer=this.scene.time.addEvent({delay:e,callback:this.spawnNextEnemy,callbackScope:this,loop:!0})}spawnNextEnemy(){if(!this.isWaveActive||this.isPaused)return;if(this.enemiesSpawned>=this.enemiesToSpawn)return this.spawnTimer&&(this.spawnTimer.destroy(),this.spawnTimer=null),void(this.hasBoss&&this.lastBossWave<this.currentWave&&(this.spawnBoss(),this.lastBossWave=this.currentWave));const e=this.getEnemyTypeForWave();let t=null;this.scene.groupManager&&(t=this.scene.groupManager.getNextSpawnGroup());const s=this.scene.mapDimensions;if(!s)return;const i=this.getRandomSpawnPosition(s);if(this.scene.enemyManager){const s=t?{groupId:t}:{};if(this.scene.enemyManager.spawnEnemy(e,i.x,i.y,s)&&(this.enemiesSpawned++,this.activeEnemies++),Math.random()<.05+this.currentWave/100){const s=Math.min(3+Math.floor(this.currentWave/10),8);this.spawnEnemyGroup(i.x,i.y,s,e,t)}}this.uiManager&&this.uiManager.updateDebugInfo()}spawnEnemyGroup(e,t,s,i,a=null){if(!this.scene.enemyManager)return;const n=a?{groupId:a}:{},r=this.scene.enemyManager.spawnEnemyGroup(i,e,t,s,100,n);r&&r.length&&(this.enemiesSpawned+=r.length,this.activeEnemies+=r.length)}spawnBoss(){if(!this.scene.player)return;const e=this.scene.player.getPosition(),t=Math.random()*Math.PI*2,s=e.x+500*Math.cos(t),i=e.y+500*Math.sin(t),a=this.scene.mapDimensions,n=Phaser.Math.Clamp(s,100,a.width-100),r=Phaser.Math.Clamp(i,100,a.height-100),o="boss1";if(this.scene.enemyManager){const e=this.scene.enemyManager.spawnEnemy(o,n,r);e&&(this.activeEnemies++,this.activeBosses++,uu.emit("boss-spawned",{bossType:o,x:n,y:r,boss:e}),this.createBossSpawnEffect(n,r))}}createBossSpawnEffect(e,t){const s=this.scene.add.circle(e,t,5,16711680,.7),i=this.scene.add.circle(e,t,10,16711680,.5);s.setDepth(100),i.setDepth(99),this.scene.tweens.add({targets:s,radius:150,alpha:0,duration:1e3,ease:"Cubic.Out",onComplete:()=>s.destroy()}),this.scene.tweens.add({targets:i,radius:200,alpha:0,duration:1500,ease:"Cubic.Out",onComplete:()=>i.destroy()}),this.scene.cameras.main.shake(500,.01)}getEnemyTypeForWave(){let e;if(this.currentWave<5)e="enemy1";else if(this.currentWave<10){const t=(this.currentWave-5)/10;e=Math.random()<t?"enemy2":"enemy1"}else if(this.currentWave<15){const t=Math.random();e=t<.1?"enemy3":t<.4?"enemy2":"enemy1"}else{const t=Math.random();e=t<.25?"enemy3":t<.65?"enemy2":"enemy1"}return this.currentWave>=10&&this.scene.isDev&&(this.scene.enemyManager&&this.scene.enemyManager.enemyRegistry&&this.scene.enemyManager.enemyRegistry.getConstructor("enemy3"),this.currentWave),e}getRandomSpawnPosition(e){this.scene.cameras.main;const t=100;if(Math.random()<.8)switch(Math.floor(4*Math.random())){case 0:return{x:Phaser.Math.Between(t,e.width-t),y:-100};case 1:return{x:e.width+t,y:Phaser.Math.Between(t,e.height-t)};case 2:return{x:Phaser.Math.Between(t,e.width-t),y:e.height+t};case 3:return{x:-100,y:Phaser.Math.Between(t,e.height-t)}}else switch(Math.floor(4*Math.random())){case 0:return{x:-100,y:-100};case 1:return{x:e.width+t,y:-100};case 2:return{x:e.width+t,y:e.height+t};case 3:return{x:-100,y:e.height+t}}return{x:-100,y:-100}}onEnemyKilled(e,t){this.scene.isDev&&(this.activeEnemies,this.activeBosses),this.activeEnemies>0?this.activeEnemies--:(console.warn("[WaveManager] Attempted to decrease activeEnemies below zero"),this.activeEnemies=0),e&&(this.activeBosses>0?this.activeBosses--:(console.warn("[WaveManager] Attempted to decrease activeBosses below zero"),this.activeBosses=0));const s=this.enemiesSpawned>=this.enemiesToSpawn,i=this.currentWave%this.bossWaveInterval==0;this.isWaveActive&&s&&(i&&this.hasBoss?0===this.activeEnemies&&0===this.activeBosses&&(this.scene.isDev,this.completeWave()):this.activeEnemies<=0&&(this.scene.isDev,this.completeWave()))}completeWave(){this.isWaveActive=!1;const e=this.currentWave>=this.maxWaves;e?this.gameVictory():this.enterPausePhase();const t={wave:this.currentWave,isLastWave:e};if(this.scene.events.emit("wave-completed",t),uu&&(uu.emit("wave-completed",t),this.scene.isDev),this._endOfRoundCallbacks&&this._endOfRoundCallbacks.length>0)for(const i of this._endOfRoundCallbacks)try{i(t)}catch(s){console.error("[WaveManager] Error executing end of round callback",s)}}enterPausePhase(){this.pauseBetweenWaves?(this.isPaused=!0,this.uiManager&&this.uiManager.showWaveCompleteUI()):this.startNextWave()}gameVictory(){this.scene.events.emit("victory")}update(){if(!this.scene.isPaused&&this.isWaveActive&&this.scene.enemyManager){const e=this.scene.time.now;(!this._lastVerifyTime||e-this._lastVerifyTime>2e3)&&(this._lastVerifyTime=e,this.verifyEnemyCount())}}verifyEnemyCount(){if(!this.scene.enemyManager||!this.isWaveActive)return;this.cleanupInactiveEnemies();const e=this.scene.enemyManager.getEnemyCount(),t=this.scene.enemyManager.getEnemyCount("boss1");!this.scene.isDev||e===this.activeEnemies&&t===this.activeBosses||(this.activeEnemies,this.activeBosses),this.activeEnemies<0&&(console.warn("[WaveManager] Negative activeEnemies count detected, resetting to actual count"),this.activeEnemies=0),this.activeBosses<0&&(console.warn("[WaveManager] Negative activeBosses count detected, resetting to actual count"),this.activeBosses=0),e===this.activeEnemies&&t===this.activeBosses||(this.activeEnemies=e,this.activeBosses=t);const s=this.enemiesSpawned>=this.enemiesToSpawn,i=this.currentWave%this.bossWaveInterval==0;if(this.scene.isDev&&(this.currentWave,this.enemiesSpawned,this.enemiesToSpawn,this.activeEnemies,this.activeBosses,this.isWaveActive,this.isPaused),i&&s&&!this.spawnTimer&&this.hasBoss&&0===this.activeBosses&&this.lastBossWave<this.currentWave)return this.scene.isDev,this.spawnBoss(),void(this.lastBossWave=this.currentWave);if(s&&0===this.activeEnemies)i?0===this.activeBosses&&this.isWaveActive&&(this.scene.isDev,this.completeWave()):this.isWaveActive&&(this.scene.isDev,this.completeWave());else if(this.scene.isDev&&this.isWaveActive){let e="";s?this.activeEnemies>0?e=`Active enemies still present: ${this.activeEnemies}`:i&&this.activeBosses>0&&(e=`Boss still active: ${this.activeBosses}`):e=`Enemy spawn threshold not met: ${this.enemiesSpawned}/${this.enemiesToSpawn}`}}cleanupInactiveEnemies(){if(!this.scene.enemyManager)return;let e=0,t=0;if(this.scene.killTimerManager)t=this.scene.killTimerManager.getTimeSinceLastKill();else{const e=uu.getLastEventData("kill-timer-updated");e&&(t=e.timeSinceLastKill)}for(let s=this.scene.enemyManager.enemies.length-1;s>=0;s--){const i=this.scene.enemyManager.enemies[s];i&&i.active&&i.graphics&&i.graphics.active||(this.scene.enemyManager.releaseEnemy(i),e++),i.killCounted&&(this.scene.enemyManager.releaseEnemy(i),e++),i.health<=0&&(this.scene.enemyManager.releaseEnemy(i),e++),t>15e3&&(this.scene.enemyManager.releaseEnemy(i),e++)}return e>0&&this.scene.isDev,e}getCurrentWave(){return this.currentWave}getActiveEnemyCount(){return this.activeEnemies}isInPausePhase(){return!this.isWaveActive&&this.isPaused}reset(){this.isWaveActive=!1,this.waveCompleted=!1,this.isPaused=!1,this.isWaitingForNextWave=!1,this.currentWave=0,this.enemiesToSpawn=0,this.enemiesSpawned=0,this.activeEnemies=0,this.activeBosses=0,this.hasBoss=!1,this.spawnTimer&&(this.spawnTimer.destroy(),this.spawnTimer=null),this.scene.isDev}debugState(){return{wave:this.currentWave,isActive:this.isWaveActive,isPaused:this.isPaused,enemiesSpawned:this.enemiesSpawned,enemiesToSpawn:this.enemiesToSpawn,activeEnemies:this.activeEnemies,activeBosses:this.activeBosses,hasBoss:this.hasBoss,lastBossWave:this.lastBossWave}}registerExternalEnemySpawn(e){"number"!=typeof e||e<=0||(this.enemiesSpawned+=e,this.activeEnemies+=e,this.scene.isDev&&(this.enemiesSpawned,this.activeEnemies))}registerEndOfRoundCallback(e){this._endOfRoundCallbacks||(this._endOfRoundCallbacks=[]),this._endOfRoundCallbacks.includes(e)||(this._endOfRoundCallbacks.push(e),this.scene.isDev)}unregisterEndOfRoundCallback(e){if(!this._endOfRoundCallbacks)return;const t=this._endOfRoundCallbacks.indexOf(e);-1!==t&&(this._endOfRoundCallbacks.splice(t,1),this.scene.isDev)}}class ed{constructor(e){this.scene=e,this.elements={},this.groups={},this.initialized=!1,this.isProcessingNextWave=!1,e.uiManager=this}init(e={}){this.initialized||(this.createUIContainer(),this.createWaveUI(),this.createHealthUI(),this.createWaveBanner(),this.createNextWaveButton(),this.createEndGameUI(),this.createPauseOverlay(),this.setupGroupDisplay(),this.createCashUI(),this.setupEventListeners(),this.initialized=!0)}createUIContainer(){this.scene.cameras.main.width,this.scene.cameras.main.height,this.elements.container=this.scene.add.container(0,0).setScrollFactor(0).setDepth(100)}createWaveUI(){this.elements.waveBackground=this.scene.add.rectangle(20,20,140,40,0,.7).setOrigin(0,0).setScrollFactor(0).setDepth(100),this.elements.waveText=this.scene.add.text(30,30,"Wave: 0/40",{fontFamily:"Arial",fontSize:20,color:"#ffffff"}).setScrollFactor(0).setDepth(101),this.elements.container.add(this.elements.waveBackground),this.elements.container.add(this.elements.waveText)}createHealthUI(){const e=this.scene.cameras.main.width;this.elements.healthBackground=this.scene.add.rectangle(e-220,20,200,30,0,.7).setOrigin(0,0).setScrollFactor(0).setDepth(100),this.elements.healthBar=this.scene.add.rectangle(e-215,25,190,20,16711680,1).setOrigin(0,0).setScrollFactor(0).setDepth(101),this.elements.healthText=this.scene.add.text(e-120,30,"100%",{fontFamily:"Arial",fontSize:14,color:"#ffffff"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(102),this.elements.levelCircle=this.scene.add.circle(e-30,35,22,0,.8).setScrollFactor(0).setDepth(101),this.elements.levelBorder=this.scene.add.circle(e-30,35,22).setScrollFactor(0).setDepth(102).setStrokeStyle(2,65433),this.elements.levelArc=this.scene.add.graphics().setScrollFactor(0).setDepth(101),this.elements.levelText=this.scene.add.text(e-30,35,"1",{fontFamily:"Arial",fontSize:18,color:"#ffffff"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(103),this.elements.container.add(this.elements.healthBackground),this.elements.container.add(this.elements.healthBar),this.elements.container.add(this.elements.healthText)}createWaveBanner(){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height;this.elements.waveBannerBg=this.scene.add.rectangle(e/2,.3*t,400,150,153,.8).setOrigin(.5).setScrollFactor(0).setDepth(110),this.elements.waveBannerText=this.scene.add.text(e/2,.3*t,"Wave 1",{fontFamily:"Arial",fontSize:36,color:"#ffffff",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(111),this.elements.container.add(this.elements.waveBannerBg),this.elements.container.add(this.elements.waveBannerText),this.elements.waveBannerBg.setVisible(!1),this.elements.waveBannerText.setVisible(!1)}createNextWaveButton(){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height;this.elements.nextWaveButtonBg=this.scene.add.rectangle(e/2,t-80,220,60,26112,1).setOrigin(.5).setScrollFactor(0).setDepth(110),this.elements.nextWaveButtonText=this.scene.add.text(e/2,t-80,"Start Next Wave",{fontFamily:"Arial",fontSize:20,color:"#ffffff",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(111),this.elements.nextWaveButtonBg.setInteractive({useHandCursor:!0}),this.elements.nextWaveButtonText.setInteractive({useHandCursor:!0}),this.elements.nextWaveButtonBg.on("pointerover",(()=>{this.elements.nextWaveButtonBg.setFillStyle(34816)})),this.elements.nextWaveButtonBg.on("pointerout",(()=>{this.elements.nextWaveButtonBg.setFillStyle(26112)})),this.elements.nextWaveButtonBg.on("pointerdown",(()=>{this.onNextWaveClick()})),this.elements.nextWaveButtonText.on("pointerdown",(()=>{this.onNextWaveClick()})),this.elements.container.add(this.elements.nextWaveButtonBg),this.elements.container.add(this.elements.nextWaveButtonText),this.elements.nextWaveButtonBg.setVisible(!1),this.elements.nextWaveButtonText.setVisible(!1)}createEndGameUI(){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height;this.elements.gameOverOverlay=this.scene.add.rectangle(0,0,e,t,0,.8).setOrigin(0).setScrollFactor(0).setDepth(200),this.elements.gameOverText=this.scene.add.text(e/2,t/2-50,"GAME OVER",{fontFamily:"Arial",fontSize:48,color:"#ff0000",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(201),this.elements.victoryText=this.scene.add.text(e/2,t/2-50,"VICTORY!",{fontFamily:"Arial",fontSize:48,color:"#00ff00",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(201),this.elements.endGameStats=this.scene.add.text(e/2,t/2+50,"",{fontFamily:"Arial",fontSize:24,color:"#ffffff",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(201),this.elements.restartButton=this.scene.add.rectangle(e/2,t/2+150,200,60,5592405,1).setOrigin(.5).setScrollFactor(0).setDepth(201),this.elements.restartText=this.scene.add.text(e/2,t/2+150,"Back to Menu",{fontFamily:"Arial",fontSize:20,color:"#ffffff",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(202),this.elements.restartButton.setInteractive({useHandCursor:!0}),this.elements.restartText.setInteractive({useHandCursor:!0}),this.elements.restartButton.on("pointerover",(()=>{this.elements.restartButton.setFillStyle(7829367)})),this.elements.restartButton.on("pointerout",(()=>{this.elements.restartButton.setFillStyle(5592405)})),this.elements.restartButton.on("pointerdown",(()=>{this.onRestartClick()})),this.elements.restartText.on("pointerdown",(()=>{this.onRestartClick()})),this.elements.container.add(this.elements.gameOverOverlay),this.elements.container.add(this.elements.gameOverText),this.elements.container.add(this.elements.victoryText),this.elements.container.add(this.elements.endGameStats),this.elements.container.add(this.elements.restartButton),this.elements.container.add(this.elements.restartText),this.elements.gameOverOverlay.setVisible(!1),this.elements.gameOverText.setVisible(!1),this.elements.victoryText.setVisible(!1),this.elements.endGameStats.setVisible(!1),this.elements.restartButton.setVisible(!1),this.elements.restartText.setVisible(!1)}createPauseOverlay(){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height;this.elements.pauseOverlay=this.scene.add.rectangle(0,0,e,t,0,.5).setOrigin(0).setScrollFactor(0).setDepth(150),this.elements.pauseText=this.scene.add.text(e/2,t/2,"PAUSED\nPress SPACE to continue",{fontFamily:"Arial",fontSize:36,color:"#ffffff",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(151),this.elements.container.add(this.elements.pauseOverlay),this.elements.container.add(this.elements.pauseText),this.elements.pauseOverlay.setVisible(!1),this.elements.pauseText.setVisible(!1)}createCashUI(){const e=this.scene.cameras.main.width;this.elements.cashBackground=this.scene.add.rectangle(e-220,60,120,30,0,.7).setOrigin(0,0).setScrollFactor(0).setDepth(100),this.elements.cashIcon=this.scene.add.text(e-210,75,"$",{fontFamily:"Arial",fontSize:18,color:"#FFD700",fontWeight:"bold"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(102),this.elements.cashText=this.scene.add.text(e-170,75,"0",{fontFamily:"Arial",fontSize:16,color:"#FFD700"}).setOrigin(0,.5).setScrollFactor(0).setDepth(102),this.elements.container.add(this.elements.cashBackground),this.elements.container.add(this.elements.cashIcon),this.elements.container.add(this.elements.cashText)}updateCashUI(e){if(!this.elements.cashText)return;const{cash:t}=e,s=t.toLocaleString();this.elements.cashText.setText(s),void 0!==this._previousCash&&t>this._previousCash&&(this.scene.tweens.add({targets:this.elements.cashText,scale:{from:1.2,to:1},duration:200,ease:"Back.easeOut"}),this.elements.cashText.setTint(16777215),this.scene.time.delayedCall(100,(()=>{this.elements.cashText.setTint(16766720)}))),this._previousCash=t}setupGroupDisplay(){const e=this.scene.cameras.main.width/2;this.groups.chaosContainer=this.scene.add.container(e,40).setScrollFactor(0).setDepth(fu.UI_ELEMENTS),this.elements.chaosBg=this.scene.add.rectangle(0,0,180,25,0,.6).setOrigin(.5,.5),this.elements.chaosBg=this.scene.add.rectangle(0,0,300,30,0,.7).setOrigin(.5,.5).setStrokeStyle(1,16777215,.3),this.elements.centerLine=this.scene.add.rectangle(0,0,2,30,16777215,.8).setOrigin(.5,.5),this.elements.aiBar=this.scene.add.rectangle(-150,0,0,24,yu.COLORS.AI,1).setOrigin(0,.5),this.elements.coderBar=this.scene.add.rectangle(0,0,0,24,yu.COLORS.CODER,1).setOrigin(0,.5),this.elements.aiLabel=this.scene.add.text(-140,0,"AI",{fontFamily:"Arial",fontSize:"12px",color:"#ffffff",fontStyle:"bold"}).setOrigin(0,.5).setShadow(1,1,"#000000",2),this.elements.coderLabel=this.scene.add.text(140,0,"CODER",{fontFamily:"Arial",fontSize:"12px",color:"#ffffff",fontStyle:"bold"}).setOrigin(1,.5).setShadow(1,1,"#000000",2),this.elements.chaosValue=this.scene.add.text(0,0,"0",{fontFamily:"Arial",fontSize:"14px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5,.5).setShadow(1,1,"#000000",2),this.elements.groupText=this.scene.add.text(0,20,"",{fontFamily:"Arial",fontSize:"11px",color:"#ffffff",align:"center"}).setOrigin(.5,.5),this.groups.chaosContainer.add([this.elements.chaosBg,this.elements.aiBar,this.elements.coderBar,this.elements.centerLine,this.elements.aiLabel,this.elements.coderLabel,this.elements.chaosValue,this.elements.groupText]),this.scene.chaosManager&&(uu.on("chaos-changed",this.handleChaosChanged,this),uu.on("MAJOR_CHAOS",this.handleMajorChaosEvent,this)),this.updateChaosMeter()}handleChaosChanged(e){this.updateChaosMeter();const t=null==yu?void 0:yu.MAJOR_EVENT_VALUE,s=e.newValue||e.value||0,i=e.oldValue||0;Math.abs(s)>=t&&Math.abs(i)<t&&this.flashChaosMeter()}handleMajorChaosEvent(e){this.flashChaosMeter(),this.scene.cameras&&this.scene.cameras.main&&this.scene.cameras.main.shake(yu.SHAKE_DURATION,yu.SHAKE_INTENSITY),this.createChaosParticleEffect(e.factionId)}createChaosParticleEffect(e){const t=this.scene.cameras.main.width/2,s=this.scene.cameras.main.height/2,i=e===gu.AI?yu.COLORS.AI:yu.COLORS.CODER;if(this.scene.add&&this.scene.add.particles){const e=this.scene.add.particles(t,s,"particle_texture",{speed:{min:100,max:300},scale:{start:.5,end:0},alpha:{start:1,end:0},lifespan:400,blendMode:"ADD",tint:i,quantity:20,angle:{min:0,max:360}});this.scene.time.delayedCall(1e3,(()=>{e&&e.destroy()}))}}flashChaosMeter(){this.elements.chaosBg&&(this.flashTween&&this.flashTween.stop(),this.elements.chaosBg.setStrokeStyle(1,16777215,.3),this.flashTween=this.scene.tweens.add({targets:[this.elements.chaosBg],alpha:{from:.7,to:1},strokeAlpha:{from:.3,to:.8},yoyo:!0,repeat:5,duration:100,ease:"Sine.easeInOut",onComplete:()=>{this.elements.chaosBg&&(this.elements.chaosBg.setStrokeStyle(1,16777215,.3),this.elements.chaosBg.setAlpha(.7)),this.flashTween=null}}))}updateChaosMeter(){if(this.scene&&this.scene.chaosManager&&this.elements.aiBar&&this.elements.coderBar&&this.elements.chaosValue&&this.elements.chaosValue.setText)try{const e=this.scene.chaosManager.getChaos(),t=150;this.elements.chaosValue.setText(Math.round(e));const s=Math.max(0,-e)/Math.abs(yu.MIN_VALUE)*t;this.elements.aiBar.width=s,this.elements.aiBar.x=-s;const i=Math.max(0,e)/yu.MAX_VALUE*t;this.elements.coderBar.width=i,this.elements.groupText&&this.elements.groupText.setText&&this.updateGroupCountText()}catch(e){}}updateGroupCountText(){if(!this.scene.groupManager||!this.elements.groupText)return;const e=this.scene.groupManager.getAllGroupCounts(),t=`AI: ${e[gu.AI]||0} | CODER: ${e[gu.CODER]||0} | NEUTRAL: ${e[gu.NEUTRAL]||0}`;this.elements.groupText.setText(t)}updateXPUI(e){if(!this.elements.levelText)return;const{level:t,xp:s,xpToNext:i}=e;if(this.elements.levelText.setText(t.toString()),this.elements.levelArc){this.elements.levelArc.clear();const e=this.scene.cameras.main.width-30,t=35,a=22;this.elements.levelArc.lineStyle(4,65433,1);const n=s/i||0,r=-Math.PI/2,o=r+2*Math.PI*n;this.elements.levelArc.beginPath(),this.elements.levelArc.arc(e,t,a,r,o,!1),this.elements.levelArc.strokePath()}}showLevelUpAnimation(e){const t=this.scene.cameras.main.width,s=this.scene.cameras.main.height,i=this.scene.add.text(t/2,s/2,`LEVEL UP!\nLevel ${e}`,{fontFamily:"Arial",fontSize:48,color:"#00ff99",align:"center",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setScrollFactor(0).setDepth(150).setAlpha(0),a=this.scene.add.particles(t/2,s/2,"particle_texture",{speed:{min:100,max:200},scale:{start:.5,end:0},alpha:{start:1,end:0},lifespan:300,blendMode:"ADD",quantity:10,tint:65433,angle:{min:0,max:360}});if(a.setDepth(149),this.scene.tweens.add({targets:i,alpha:{from:0,to:1},scale:{from:2,to:1},duration:500,ease:"Back.easeOut",onComplete:()=>{this.scene.time.delayedCall(1e3,(()=>{this.scene.tweens.add({targets:i,alpha:0,y:.4*s,duration:500,ease:"Power2",onComplete:()=>{i.destroy(),a.destroy()}})}))}}),this.scene.tweens.add({targets:[this.elements.levelCircle,this.elements.levelBorder],scale:{from:1.5,to:1},duration:500,ease:"Bounce.easeOut"}),this.elements.levelArc){this.elements.levelArc.clear(),this.elements.levelArc.lineStyle(4,16777215,1);const e=t-30,s=35,i=22;this.elements.levelArc.beginPath(),this.elements.levelArc.arc(e,s,i,0,2*Math.PI),this.elements.levelArc.strokePath(),this.scene.time.delayedCall(300,(()=>{this.elements.levelArc.clear()}))}this.scene.tweens.add({targets:this.elements.levelText,scale:{from:1.5,to:1},duration:500,ease:"Bounce.easeOut"})}updateWaveUI(e,t){this.elements.waveText&&this.elements.waveText.setText(`Wave: ${e}/${t}`)}updateHealthUI(e,t){if(!this.elements.healthBar||!this.elements.healthText)return;const s=Math.max(0,Math.min(100,e/t*100));this.elements.healthBar.width=Math.max(0,190*s/100),this.elements.healthText.setText(`${Math.floor(s)}%`),s<25?this.elements.healthBar.setFillStyle(16711680):s<50?this.elements.healthBar.setFillStyle(16737792):s<75?this.elements.healthBar.setFillStyle(16776960):this.elements.healthBar.setFillStyle(65280)}showWaveStartBanner(e,t){let s=`Wave ${e}`,i=153;t&&(s=`BOSS WAVE!\nWave ${e}`,i=10027008),this.elements.waveBannerText.setText(s),this.elements.waveBannerBg.setFillStyle(i,.8),this.elements.waveBannerBg.setVisible(!0),this.elements.waveBannerBg.setAlpha(0),this.elements.waveBannerText.setVisible(!0),this.elements.waveBannerText.setAlpha(0),this.scene.tweens.add({targets:[this.elements.waveBannerBg,this.elements.waveBannerText],y:{from:.2*this.scene.cameras.main.height,to:.3*this.scene.cameras.main.height},alpha:{from:0,to:1},duration:800,ease:"Back.easeOut",onComplete:()=>{this.scene.time.delayedCall(2e3,(()=>{this.scene.tweens.add({targets:[this.elements.waveBannerBg,this.elements.waveBannerText],y:.2*this.scene.cameras.main.height,alpha:0,duration:800,ease:"Back.easeIn",onComplete:()=>{this.elements.waveBannerBg.setVisible(!1),this.elements.waveBannerText.setVisible(!1)}})}))}})}showWaveCompleteUI(){this.elements.waveBannerText.setText("Wave Complete!\nPrepare for next wave"),this.elements.waveBannerBg.setFillStyle(39168,.8),this.elements.waveBannerBg.setVisible(!0),this.elements.waveBannerBg.setAlpha(0),this.elements.waveBannerText.setVisible(!0),this.elements.waveBannerText.setAlpha(0),this.scene.tweens.add({targets:[this.elements.waveBannerBg,this.elements.waveBannerText],y:{from:.2*this.scene.cameras.main.height,to:.3*this.scene.cameras.main.height},alpha:{from:0,to:1},duration:800,ease:"Back.easeOut",onComplete:()=>{this.showNextWaveButton(),this.scene.time.delayedCall(3e3,(()=>{this.scene.tweens.add({targets:[this.elements.waveBannerBg,this.elements.waveBannerText],y:.2*this.scene.cameras.main.height,alpha:0,duration:800,ease:"Back.easeIn",onComplete:()=>{this.elements.waveBannerBg.setVisible(!1),this.elements.waveBannerText.setVisible(!1)}})}))}})}showNextWaveButton(){this.elements.nextWaveButtonBg.setVisible(!0),this.elements.nextWaveButtonText.setVisible(!0),this.scene.tweens.add({targets:[this.elements.nextWaveButtonBg,this.elements.nextWaveButtonText],y:{from:this.scene.cameras.main.height+50,to:this.scene.cameras.main.height-80},duration:500,ease:"Back.easeOut"})}hideNextWaveButton(){this.scene.tweens.add({targets:[this.elements.nextWaveButtonBg,this.elements.nextWaveButtonText],y:this.scene.cameras.main.height+50,duration:500,ease:"Back.easeIn",onComplete:()=>{this.elements.nextWaveButtonBg.setVisible(!1),this.elements.nextWaveButtonText.setVisible(!1)}})}onNextWaveClick(){this.isProcessingNextWave||(this.isProcessingNextWave=!0,this.hideNextWaveButton(),this.scene.time.delayedCall(500,(()=>{this.scene.waveManager&&this.scene.waveManager.startNextWave(),this.scene.time.delayedCall(100,(()=>{this.isProcessingNextWave=!1}))})))}showGameOverUI(){this.elements.gameOverOverlay.setVisible(!0),this.elements.gameOverText.setVisible(!0),this.elements.gameOverText.setAlpha(0),this.elements.gameOverText.setScale(2);const e=this.scene.waveManager?`Waves Survived: ${this.scene.waveManager.currentWave}`:"",t=`Enemies Defeated: ${this.scene.killCount}`;let s="";this.scene.cashManager&&(s=`\nCash Collected: $${this.scene.cashManager.getCurrentCash().toLocaleString()}`);const i=`${e}\n${t}${s}`;this.elements.endGameStats.setText(i),this.elements.endGameStats.setVisible(!0),this.elements.endGameStats.setAlpha(0),this.elements.restartButton.setVisible(!0),this.elements.restartText.setVisible(!0),this.elements.restartButton.setAlpha(0),this.elements.restartText.setAlpha(0),this.scene.tweens.add({targets:this.elements.gameOverText,alpha:1,scale:1,duration:1e3,ease:"Back.easeOut",delay:500,onComplete:()=>{this.scene.tweens.add({targets:this.elements.endGameStats,alpha:1,y:{from:this.scene.cameras.main.height/2+20,to:this.scene.cameras.main.height/2+50},duration:800,ease:"Power2",onComplete:()=>{this.scene.tweens.add({targets:[this.elements.restartButton,this.elements.restartText],alpha:1,y:{from:this.scene.cameras.main.height/2+120,to:this.scene.cameras.main.height/2+150},duration:800,ease:"Power2"})}})}})}showVictoryUI(){this.elements.gameOverOverlay.setVisible(!0),this.elements.victoryText.setVisible(!0),this.elements.victoryText.setAlpha(0),this.elements.victoryText.setScale(2);const e=`Total Enemies Defeated: ${this.scene.killCount}`;let t="";this.scene.cashManager&&(t=`\nCash Collected: $${this.scene.cashManager.getCurrentCash().toLocaleString()}`);const s=`All 20 Waves Completed!\n${e}${t}`;this.elements.endGameStats.setText(s),this.elements.endGameStats.setVisible(!0),this.elements.endGameStats.setAlpha(0);const i=this.scene.cameras.main.height/2+150,a=this.scene.cameras.main.width/2,n=150;this.elements.continueButton=this.scene.add.rectangle(a-n,i,200,60,26112,1).setOrigin(.5).setScrollFactor(0).setDepth(201).setAlpha(0),this.elements.continueText=this.scene.add.text(a-n,i,"Continue Playing",{fontFamily:"Arial",fontSize:18,color:"#ffffff",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(202).setAlpha(0),this.elements.continueButton.setInteractive({useHandCursor:!0}),this.elements.continueText.setInteractive({useHandCursor:!0}),this.elements.continueButton.on("pointerover",(()=>{this.elements.continueButton.setFillStyle(34816)})),this.elements.continueButton.on("pointerout",(()=>{this.elements.continueButton.setFillStyle(26112)})),this.elements.continueButton.on("pointerdown",(()=>{this.hideVictoryUI()})),this.elements.continueText.on("pointerdown",(()=>{this.hideVictoryUI()})),this.elements.restartButton.setVisible(!0),this.elements.restartText.setVisible(!0),this.elements.restartButton.setAlpha(0),this.elements.restartText.setAlpha(0),this.elements.restartButton.x=a+n,this.elements.restartButton.y=i,this.elements.restartText.x=a+n,this.elements.restartText.y=i,this.elements.restartButton.setFillStyle(5592405),this.elements.restartButton.off("pointerover"),this.elements.restartButton.off("pointerout"),this.elements.restartButton.on("pointerover",(()=>{this.elements.restartButton.setFillStyle(7829367)})),this.elements.restartButton.on("pointerout",(()=>{this.elements.restartButton.setFillStyle(5592405)})),this.scene.tweens.add({targets:this.elements.victoryText,alpha:1,scale:1,duration:1e3,ease:"Back.easeOut",delay:500,onComplete:()=>{this.scene.tweens.add({targets:this.elements.endGameStats,alpha:1,y:{from:this.scene.cameras.main.height/2+20,to:this.scene.cameras.main.height/2+50},duration:800,ease:"Power2",onComplete:()=>{this.scene.tweens.add({targets:[this.elements.restartButton,this.elements.restartText,this.elements.continueButton,this.elements.continueText],alpha:1,y:{from:this.scene.cameras.main.height/2+120,to:i},duration:800,ease:"Power2"})}})}}),this.elements.container.add(this.elements.continueButton),this.elements.container.add(this.elements.continueText)}hideVictoryUI(){this.scene.tweens.add({targets:[this.elements.gameOverOverlay,this.elements.victoryText,this.elements.endGameStats,this.elements.restartButton,this.elements.restartText,this.elements.continueButton,this.elements.continueText],alpha:0,duration:500,ease:"Power2",onComplete:()=>{this.elements.gameOverOverlay.setVisible(!1),this.elements.victoryText.setVisible(!1),this.elements.endGameStats.setVisible(!1),this.elements.restartButton.setVisible(!1),this.elements.restartText.setVisible(!1),this.scene&&(this.scene.isGameOver=!1,this.scene.player&&(this.scene.player.getPosition(),this.scene.player.velX&&(this.scene.player.velX=0),this.scene.player.velY&&(this.scene.player.velY=0),this.scene.player.graphics&&this.scene.player.graphics.body&&this.scene.player.graphics.body.setVelocity(0,0)),this.scene.waveManager&&(this.scene.waveManager.isPaused=!1,this.showNextWaveButton())),this.elements.continueButton&&(this.elements.continueButton.destroy(),this.elements.continueButton=null),this.elements.continueText&&(this.elements.continueText.destroy(),this.elements.continueText=null)}})}onRestartClick(){this.scene.scene.start("MainMenu")}updateDebugInfo(){if(!this.elements.debugText||!this.options.showDebug)return;const{scene:e}=this;let t="DEBUG INFO\n";if(t+=`FPS: ${Math.floor(e.game.loop.actualFps)}\n`,e.waveManager&&(t+=`Wave: ${e.waveManager.currentWave}/${e.waveManager.maxWaves}\n`,t+=`Active Enemies: ${e.waveManager.activeEnemies}\n`,t+=`Enemies Spawned: ${e.waveManager.enemiesSpawned}\n`),e.gameObjectManager){const s=e.gameObjectManager.getStats();t+="\nPOOLS:\n";for(const[e,i]of Object.entries(s))i&&(t+=`${e}: ${i.active}/${i.total}\n`)}if(e.player){const s=e.player.getPosition();t+=`\nPlayer: (${Math.floor(s.x)}, ${Math.floor(s.y)})\n`}if(t+=`Kills: ${e.killCount}\n`,e.groupManager){const s=e.groupManager.getAllGroupCounts();t+=`Groups: AI=${s[gu.AI]||0}, `,t+=`CODER=${s[gu.CODER]||0}, `,t+=`NEUTRAL=${s[gu.NEUTRAL]||0}\n`}e.chaosManager&&(t+=`Chaos: ${Math.round(e.chaosManager.getChaos())}%\n`),this.elements.debugText.setText(t)}updateScoreUI(e){}setupEventListeners(){uu.on("xp-updated",this.updateXPUI,this),uu.on("level-up",(e=>{this.showLevelUpAnimation(e.level),this.updateXPUI(e)}),this),uu.on("cash-updated",this.updateCashUI,this),uu.on("faction-surge",this.showFactionSurgeNotification,this),this.scene.events.once("shutdown",(()=>{uu.off("xp-updated",this.updateXPUI,this),uu.off("level-up"),uu.off("cash-updated",this.updateCashUI,this),uu.off("faction-surge",this.showFactionSurgeNotification,this)}))}update(){if(this.scene.playerHealth){this.scene.playerHealth.getHealthPercent();const e=this.scene.playerHealth.maxHealth,t=this.scene.playerHealth.currentHealth;this.updateHealthUI(t,e)}this.updateChaosMeter()}showFactionSurgeNotification(e){const{groupId:t,strength:s}=e;let i="ai"===t?"AI":"Coder",a="ai"===t?43775:16733440;const n=this.scene.add.rectangle(this.scene.cameras.main.width/2,.2*this.scene.cameras.main.height,400,100,0,.8).setScrollFactor(0).setDepth(100),r=this.scene.add.text(this.scene.cameras.main.width/2,.2*this.scene.cameras.main.height,`${i} SURGE!\nMassive reinforcements incoming!`,{fontFamily:"Arial",fontSize:"24px",color:`#${a.toString(16).padStart(6,"0")}`,align:"center",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setScrollFactor(0).setDepth(101);if(this.scene.particles){const e=this.scene.particles.createEmitter({x:this.scene.cameras.main.width/2,y:.2*this.scene.cameras.main.height+30,speed:{min:100,max:200},angle:{min:230,max:310},scale:{start:.6,end:0},blendMode:"ADD",lifespan:800,quantity:2,tint:a});this.scene.time.delayedCall(1500,(()=>{e.stop()}))}this.scene.tweens.add({targets:[n,r],scaleX:{from:0,to:1},scaleY:{from:0,to:1},duration:300,ease:"Back.easeOut",onComplete:()=>{this.scene.tweens.add({targets:[n,r],scale:{from:1,to:1.05},yoyo:!0,repeat:3,duration:150,onComplete:()=>{this.scene.time.delayedCall(1500,(()=>{this.scene.tweens.add({targets:[n,r],alpha:0,y:"-=50",duration:500,onComplete:()=>{n.destroy(),r.destroy()}})}))}})}}),this.scene.cameras&&this.scene.cameras.main&&this.scene.cameras.main.shake(300,.005),this.scene.soundManager&&this.scene.soundManager.playSoundEffect("surge_alert",{volume:.7})}destroy(){this.chaosSyncTimer&&(this.chaosSyncTimer.destroy(),this.chaosSyncTimer=null);for(const e in this.elements)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements={},this.groups={},this.scene=null}}class td{constructor(e){this.scene=e,this.counts={[gu.AI]:0,[gu.CODER]:0,[gu.NEUTRAL]:0},this.hostilityMap={[gu.AI]:[gu.CODER],[gu.CODER]:[gu.AI],[gu.NEUTRAL]:[]},this.enemiesByGroup={[gu.AI]:[],[gu.CODER]:[],[gu.NEUTRAL]:[]},e.groupManager=this,this.setupEventListeners()}setupEventListeners(){uu.on("enemy-group-changed",this.onEnemyGroupChanged,this)}register(e,t){if(!Object.values(gu).includes(t))return console.warn(`Invalid group ID: ${t}`),null;const s=this.scene.waveManager,i=e._groupId;return i&&i!==t?this.deregister(e,i):!i&&s&&(e._registeredWithWaveManager||"function"!=typeof s.registerExternalEnemySpawn||(s.registerExternalEnemySpawn(1),e._registeredWithWaveManager=!0)),this.counts[t]++,this.enemiesByGroup[t].includes(e)||this.enemiesByGroup[t].push(e),e._groupId=t,this.applyModifiers(e,t)}registerEntity(e,t){return this.register(e,t)}deregister(e,t){if(!Object.values(gu).includes(t))return void console.warn(`Invalid group ID: ${t}`);this.counts[t]=Math.max(0,this.counts[t]-1);const s=this.enemiesByGroup[t].indexOf(e);-1!==s&&this.enemiesByGroup[t].splice(s,1)}onEnemyGroupChanged(e){const{enemy:t,oldGroupId:s,newGroupId:i}=e;s&&Object.values(gu).includes(s)&&this.deregister(t,s),i&&Object.values(gu).includes(i)&&this.register(t,i)}getGroupCount(e){return this.counts[e]||0}getAllGroupCounts(){return{...this.counts}}applyModifiers(e,t){const s=vu[t];if(!s)return null;if(e._originalStats||(e._originalStats={health:e.health,baseHealth:e.baseHealth,speed:e.speed,damage:e.damage,color:e.color,tint:e.tint||16777215}),s.health&&(e.health=Math.round(e._originalStats.health*s.health),e.baseHealth=Math.round(e._originalStats.baseHealth*s.health)),s.speed&&(e.speed=e._originalStats.speed*s.speed),s.damage&&(e.damage=e._originalStats.damage*s.damage),s.color&&(e.color=s.color,e.graphics&&e.graphics.setFillStyle&&e.graphics.setFillStyle(s.color)),e.sprite||e.graphics){let s;switch(t){case gu.AI:s=3447003;break;case gu.CODER:s=15158332;break;case gu.NEUTRAL:s=15844367;break;default:s=16777215}e.factionTint=s,e.sprite&&e.sprite.setTint&&e.sprite.setTint(s),e.graphics&&(e.graphics.setTint&&e.graphics.setTint(s),e.graphics.list&&Array.isArray(e.graphics.list)&&e.graphics.list.forEach((e=>{e&&e.setTint&&e.setTint(s)})))}return s}getNextSpawnGroup(){if(0===this.getTotalCount())return Math.random()<.5?gu.AI:gu.CODER;const e=this.counts[gu.AI],t=this.counts[gu.CODER];return e<t?gu.AI:t<e?gu.CODER:Math.random()<.5?gu.AI:gu.CODER}isHostileTo(e,t){return!(!Object.values(gu).includes(e)||!Object.values(gu).includes(t))&&this.hostilityMap[e].includes(t)}setHostility(e,t,s=!0){if(!Object.values(gu).includes(e)||!Object.values(gu).includes(t))return void console.warn(`Invalid group ID in setHostility: ${e} or ${t}`);const i=this.hostilityMap[e],a=i.indexOf(t);s&&-1===a?i.push(t):s||-1===a||i.splice(a,1),uu.emit("group-hostility-changed",{sourceGroupId:e,targetGroupId:t,isHostile:s})}findNearestHostileEnemy(e,t=1/0){if(!e||!e.groupId)return null;const s=e.groupId;let i=null,a=t;for(const n of this.hostilityMap[s])if(0!==this.enemiesByGroup[n].length)for(const t of this.enemiesByGroup[n]){if(!t||!t.active||!t.graphics)continue;const s=Phaser.Math.Distance.Between(e.graphics.x,e.graphics.y,t.graphics.x,t.graphics.y);s<a&&(a=s,i=t)}return i}getHostileEnemiesInRange(e,t,s,i){const a=[],n=Object.keys(this.hostilityMap).filter((t=>this.hostilityMap[t].includes(e)));for(const r of n)for(const e of this.enemiesByGroup[r])e&&e.active&&e.graphics&&Phaser.Math.Distance.Between(t,s,e.graphics.x,e.graphics.y)<=i&&a.push(e);return a}getTotalCount(){return Object.values(this.counts).reduce(((e,t)=>e+t),0)}getEntitiesInGroup(e){return Object.values(gu).includes(e)?[...this.enemiesByGroup[e]]:(console.warn(`Invalid group ID in getEntitiesInGroup: ${e}`),[])}reset(){Object.keys(this.counts).forEach((e=>{this.counts[e]=0,this.enemiesByGroup[e]=[]}))}debugCounts(){this.counts[gu.AI],this.counts[gu.CODER],this.counts[gu.NEUTRAL],this.getTotalCount()}}class sd{constructor(e,t={}){this.scene=e,this.chaosValue=t.initialValue??yu.DEFAULT_VALUE,this.minValue=t.minValue??yu.MIN_VALUE,this.maxValue=t.maxValue??yu.MAX_VALUE,this.killWeight=t.killWeight??yu.KILL_WEIGHT,this.panicThreshold=t.panicThreshold??yu.PANIC_THRESHOLD,this.killWeight=1.4*this.killWeight,this.momentumEnabled=!0,this.momentumFactor=.08,this.currentMomentum=0,this.momentumDecay=.96,this.maxMomentum=3.5,this.consecutiveKillType=null,this.consecutiveKillCount=0,this.majorEventFired={[yu.MIN_VALUE]:!1,[yu.MAX_VALUE]:!1},this.thresholdEvents=[{value:40,triggered:!1,direction:1},{value:70,triggered:!1,direction:1},{value:-40,triggered:!1,direction:-1},{value:-70,triggered:!1,direction:-1}],this.multiplierCache={[gu.AI]:this.calculateMultipliers(gu.AI),[gu.CODER]:this.calculateMultipliers(gu.CODER)},this.groupWeightManager=null,this.chaosOscillations=!1,this.oscillationAmount=0,this.oscillationSpeed=0,this.lastOscillationTime=Date.now(),this.extremeChaosTimeoutActive=!1,this.maxChaosCooldownDuration=5e3,e.chaosManager=this,uu.on("enemy-killed",this.handleEnemyKilled,this),this.isDev=this.scene.isDev||!1,this.scene&&this.scene.events&&this.scene.events.on("update",this.update,this)}setGroupWeightManager(e){this.groupWeightManager=e,this.updateGroupWeights(),this.isDev}handleEnemyKilled(e){e&&e.enemy&&e.enemy.groupId&&this.registerKill(e.enemy.groupId)}registerKill(e){if(!e||e===gu.NEUTRAL)return this.chaosValue;if(this.extremeChaosTimeoutActive)return this.isDev,this.chaosValue;if(this.momentumEnabled)if(this.consecutiveKillType===e){this.consecutiveKillCount++;const e=Math.min(this.momentumFactor*this.consecutiveKillCount,this.maxMomentum);this.currentMomentum=Math.min(this.maxMomentum,this.currentMomentum+e)}else this.consecutiveKillType=e,this.consecutiveKillCount=1,this.currentMomentum=this.momentumFactor;const t=e===gu.AI?1:-1,s=this.momentumEnabled?this.killWeight*(1+this.currentMomentum):this.killWeight,i=this.chaosValue+t*s,a=this.setChaos(i);if(this.updateMultiplierCache(),this.groupWeightManager&&(this.groupWeightManager.registerKill(e),this.momentumEnabled&&this.currentMomentum>3.5&&this.consecutiveKillCount>=8)){const t=e===gu.AI?gu.CODER:gu.AI;this.consecutiveKillCount%8==0&&this.triggerFactionSurge(t),this.currentMomentum*=.7}return a}triggerFactionSurge(e){if(!this.groupWeightManager)return;const t=this.scene.waveManager,s=Math.floor(3*Math.random())+1;this.groupWeightManager.temporaryBoost(e,3,1e4),t&&"function"==typeof t.registerExternalEnemySpawn&&(t.registerExternalEnemySpawn(s),this.isDev),this.scene.events&&this.scene.events.emit("faction-surge",{groupId:e,strength:3})}updateGroupWeights(){if(!this.groupWeightManager)return;const e=this.chaosValue/100;let t=50,s=50;if(e>0){const i=35*Math.pow(Math.abs(e),1.3);t+=i,s-=i}else if(e<0){const i=35*Math.pow(Math.abs(e),1.3);s+=i,t-=i}this.groupWeightManager.setWeights({ai:Math.max(20,t),coder:Math.max(20,s)}),this.isDev&&this.chaosValue}getMultipliers(e){return this.multiplierCache[e]||{hp:1,damage:1,fireRate:1,dodge:1}}calculateMultipliers(e){const t={hp:1,damage:1,fireRate:1,dodge:1},s=this.getPolarity();if(0===s)return t;if(!(e===gu.AI&&s<0||e===gu.CODER&&s>0))return t;const i=Math.abs(this.chaosValue)/100;return{hp:1+Math.pow(i,1.2)*yu.MULTIPLIERS.HP*1.2,damage:1+Math.pow(i,1.3)*yu.MULTIPLIERS.DAMAGE*1.3,fireRate:1+Math.pow(i,1.1)*yu.MULTIPLIERS.FIRE_RATE*1.2,dodge:1+Math.pow(i,1.4)*yu.MULTIPLIERS.DODGE*1.2}}updateMultiplierCache(){this.multiplierCache={[gu.AI]:this.calculateMultipliers(gu.AI),[gu.CODER]:this.calculateMultipliers(gu.CODER)}}isEnraged(e){return!(!e||e===gu.NEUTRAL)&&(!(Math.abs(this.chaosValue)<this.panicThreshold)&&(this.chaosValue>0?e===gu.AI:e===gu.CODER))}isPanicking(e){return this.isEnraged(e)}isGroupWeakened(e){if(!e||e===gu.NEUTRAL)return!1;const t=this.getFactionBalance();return e===gu.AI?t>.3:e===gu.CODER&&t<-.3}getChaos(){return this.chaosValue}getNormalizedChaos(){return(this.chaosValue-this.minValue)/(this.maxValue-this.minValue)}getPolarity(){return this.chaosValue>0?1:this.chaosValue<0?-1:0}getAbsoluteChaos(){return Math.abs(this.chaosValue)}getChaosPercentage(){const e=Math.round(this.chaosValue/this.maxValue*100);return(e>0?"+":"")+e+"%"}getFactionBalance(){return this.chaosValue/100}setChaos(e,t=!0){const s=this.chaosValue,i=Math.max(this.minValue,Math.min(this.maxValue,e));return this.chaosValue=i,this.checkMajorChaosEvents(s,i),this.checkThresholdEvents(s,i),this.groupWeightManager&&Math.abs(i-s)>=5&&this.updateGroupWeights(),t&&s!==this.chaosValue&&this.emitChaosChanged(s,this.chaosValue),this.chaosValue}checkMajorChaosEvents(e,t){t!==this.maxValue||this.majorEventFired[this.maxValue]||(this.triggerMajorChaosEvent(gu.CODER),this.majorEventFired[this.maxValue]=!0,this.startExtremeChaosTimeout()),t!==this.minValue||this.majorEventFired[this.minValue]||(this.triggerMajorChaosEvent(gu.AI),this.majorEventFired[this.minValue]=!0,this.startExtremeChaosTimeout()),e===this.maxValue&&t<this.maxValue&&(this.majorEventFired[this.maxValue]=!1),e===this.minValue&&t>this.minValue&&(this.majorEventFired[this.minValue]=!1)}startExtremeChaosTimeout(){this.extremeChaosTimeoutActive=!0,this.isDev&&this.maxChaosCooldownDuration,uu.emit("CHAOS_LOCKED",{duration:this.maxChaosCooldownDuration,faction:this.chaosValue===this.maxValue?gu.CODER:gu.AI});const e=this.chaosValue;this.scene.time.delayedCall(this.maxChaosCooldownDuration,(()=>{this.extremeChaosTimeoutActive=!1;const t=e>0?Math.floor(.25*this.maxValue):Math.ceil(.25*this.minValue);this.setChaos(t),this.isDev,uu.emit("CHAOS_UNLOCKED",{value:t,previousValue:e,faction:e===this.maxValue?gu.CODER:gu.AI})}))}checkThresholdEvents(e,t){for(const s of this.thresholdEvents){const i=s.direction>0&&e<s.value&&t>=s.value,a=s.direction<0&&e>s.value&&t<=s.value;if((i||a)&&!s.triggered){const e=s.direction>0?gu.CODER:gu.AI;if(this.triggerThresholdEvent(e,s.value),s.triggered=!0,this.groupWeightManager){const e=s.direction>0?gu.AI:gu.CODER;this.triggerFactionSurge(e)}}(s.direction>0&&t<s.value-10||s.direction<0&&t>s.value+10)&&(s.triggered=!1)}}triggerThresholdEvent(e,t){uu.emit("THRESHOLD_CHAOS",{factionId:e,value:t,absoluteValue:Math.abs(t)}),this.scene.cameras&&this.scene.cameras.main&&this.scene.cameras.main.shake(.7*yu.SHAKE_DURATION,.7*yu.SHAKE_INTENSITY),this.createChaosParticles(e,.7)}triggerMajorChaosEvent(e){uu.emit("MAJOR_CHAOS",{factionId:e}),this.scene.cameras&&this.scene.cameras.main&&this.scene.cameras.main.shake(yu.SHAKE_DURATION,yu.SHAKE_INTENSITY),this.createChaosParticles(e)}createChaosParticles(e,t=1){const s=yu.COLORS[e.toUpperCase()]||16777215;if(this.scene.add&&this.scene.add.particles){const e=this.scene.cameras.main.width/2,i=this.scene.cameras.main.height/2,a=this.scene.add.particles(e,i,"particle_texture",{speed:{min:-800*t,max:800*t},angle:{min:0,max:360},scale:{start:.6*t,end:0},blendMode:"ADD",lifespan:600*t,gravityY:0,quantity:Math.round(50*t),tint:s});this.scene.time.delayedCall(300*t,(()=>{a.destroy()}))}}ensureEnemyFactionTints(){if(!this.scene||!this.scene.groupManager)return;const e=this.scene.groupManager.getEntitiesInGroup(gu.AI)||[],t=this.scene.groupManager.getEntitiesInGroup(gu.CODER)||[];for(const s of e){if(!s||!s.graphics)continue;const e=s.factionTint||3447003;s.graphics.setTint&&s.graphics.setTint(e),s.graphics.list&&Array.isArray(s.graphics.list)&&s.graphics.list.forEach((t=>{t&&t.setTint&&t.setTint(e)})),s.sprite&&s.sprite.setTint&&s.sprite.setTint(e)}for(const s of t){if(!s||!s.graphics)continue;const e=s.factionTint||15158332;s.graphics.setTint&&s.graphics.setTint(e),s.graphics.list&&Array.isArray(s.graphics.list)&&s.graphics.list.forEach((t=>{t&&t.setTint&&t.setTint(e)})),s.sprite&&s.sprite.setTint&&s.sprite.setTint(e)}}applyOscillation(){}updateMomentum(){this.momentumEnabled&&(this.currentMomentum*=this.momentumDecay,this.currentMomentum<.01&&(this.currentMomentum=0))}adjustChaos(e,t=!0){return this.extremeChaosTimeoutActive?(this.isDev,this.chaosValue):this.setChaos(this.chaosValue+e,t)}emitChaosChanged(e,t){uu.emit("chaos-changed",{oldValue:e,newValue:t,direction:t>e?1:-1,absolute:Math.abs(t)}),(Math.abs(t-e)>=10||!1===this.extremeChaosTimeoutActive)&&this.ensureEnemyFactionTints()}reset(){this.chaosValue=yu.DEFAULT_VALUE,this.majorEventFired={[yu.MIN_VALUE]:!1,[yu.MAX_VALUE]:!1};for(const e of this.thresholdEvents)e.triggered=!1;this.currentMomentum=0,this.consecutiveKillCount=0,this.consecutiveKillType=null,this.extremeChaosTimeoutActive=!1,this.updateMultiplierCache(),uu.emit("chaos-reset")}update(e,t){this.updateMomentum()}destroy(){uu.off("enemy-killed",this.handleEnemyKilled,this),this.scene&&this.scene.events&&this.scene.events.off("update",this.update,this),this.scene=null,this.multiplierCache=null,this.groupWeightManager=null}}class id{constructor(e,t=0,s=1,i=100,a=1.2){this.scene=e,this.currentXP=t,this.currentLevel=s,this.baseXPRequirement=i,this.levelMultiplier=a,this.xpToNextLevel=this.calculateXPForLevel(this.currentLevel),e.xpManager=this,this.emitXPUpdate()}calculateXPForLevel(e){return Math.round(this.baseXPRequirement*Math.pow(this.levelMultiplier,e-1))}addXP(e){if(!e||isNaN(e)||e<=0)return!1;this.currentXP+=e;let t=!1;for(;this.currentXP>=this.xpToNextLevel;)t=!0,this.levelUp();return this.emitXPUpdate(),t}levelUp(){this.currentXP-=this.xpToNextLevel,this.currentLevel++,this.xpToNextLevel=this.calculateXPForLevel(this.currentLevel),this.scene.player&&void 0!==this.scene.player.skillPoints&&(this.scene.player.skillPoints+=1,this.scene.isDev&&this.scene.player.skillPoints),uu.emit("level-up",{level:this.currentLevel,xp:this.currentXP,xpToNext:this.xpToNextLevel,skillPoints:this.scene.player?this.scene.player.skillPoints:0}),this.scene.isDev&&this.currentLevel}emitXPUpdate(){uu.emit("xp-updated",{level:this.currentLevel,xp:this.currentXP,xpToNext:this.xpToNextLevel,skillPoints:this.scene.player?this.scene.player.skillPoints:0})}getXPProgress(){return this.xpToNextLevel>0?this.currentXP/this.xpToNextLevel:0}getCurrentLevel(){return this.currentLevel}getCurrentXP(){return this.currentXP}getXPToNextLevel(){return this.xpToNextLevel}get nextLevelXP(){return this.xpToNextLevel}}class ad{constructor(e,t=0,s=1){this.scene=e,this.currentCash=t,this.cashMultiplier=s,e.cashManager=this,this.lastCashCollectTime=0,this.cashCollectTimeout=1e3,this.accumulatedCash=0,this.cashAnimationText=null,this.cashAnimationActive=!1,this.cashAnimationTween=null,this.fadeOutTimer=null,this.emitCashUpdate()}addCash(e){if(!(!e||isNaN(e)||e<=0)){if(this.currentCash+=e,this.scene.soundManager){const e=this.scene.soundManager.hasSound("cash_pickup")?"cash_pickup":"laserShoot";this.scene.soundManager.playSoundEffect(e,{volume:.05,rate:1,detune:100*Math.random()-50})}return this.showCashCollectAnimation(e),this.emitCashUpdate(),e}}showCashCollectAnimation(e){const t=this.scene.time.now;if(!this.scene.player||!this.scene.player.getPosition)return;const s=this.scene.player.getPosition();this.fadeOutTimer&&(this.fadeOutTimer.remove(),this.fadeOutTimer=null),this.accumulatedCash+=e,this.lastCashCollectTime=t,this.cashAnimationText&&this.cashAnimationText.active?(this.cashAnimationText.setText(`+$${this.accumulatedCash}`),this.cashAnimationText.setPosition(s.x,s.y-50),this.cashAnimationTween&&this.cashAnimationTween.isPlaying()&&this.cashAnimationTween.stop()):this.createCashAnimationText(s),this.fadeOutTimer=this.scene.time.delayedCall(this.cashCollectTimeout,(()=>{this.animateCashTextOut()}))}createCashAnimationText(e){this.cashAnimationText&&this.cashAnimationText.destroy(),this.cashAnimationText=this.scene.add.text(e.x,e.y-50,`+$${this.accumulatedCash}`,{fontFamily:"Arial",fontSize:"20px",color:"#FFD700",stroke:"#000000",strokeThickness:3,align:"center"}),this.cashAnimationText.setOrigin(.5),this.cashAnimationText.setDepth(fu.UI_FLOATING_TEXT),this.scene.tweens.add({targets:this.cashAnimationText,scale:{from:.8,to:1},duration:200,ease:"Back.easeOut"})}animateCashTextOut(){this.cashAnimationText&&this.cashAnimationText.active&&(this.cashAnimationTween=this.scene.tweens.add({targets:this.cashAnimationText,y:"-=40",alpha:{from:1,to:0},scale:{from:1,to:1.2},duration:500,ease:"Cubic.Out",onComplete:()=>{this.cashAnimationText&&(this.cashAnimationText.destroy(),this.cashAnimationText=null),this.accumulatedCash=0}}))}updateCashAnimationPosition(){if(!this.cashAnimationText||!this.cashAnimationText.active||!this.scene.player)return;const e=this.scene.player.getPosition();e&&this.cashAnimationText.setPosition(e.x,e.y-50)}emitCashUpdate(){uu.emit("cash-updated",{cash:this.currentCash})}getCurrentCash(){return this.currentCash}setCashMultiplier(e){this.cashMultiplier=e}getCashMultiplier(){return this.cashMultiplier}setCash(e){if(!isNaN(e))return this.currentCash=Math.max(0,e),this.emitCashUpdate(),this.currentCash}spawnCashPickup(e,t,s){if(!this.scene.spritePool)return console.warn("SpritePool not available, cannot spawn cash pickup"),null;const i=Math.ceil(s*this.cashMultiplier);return this.scene.spritePool.createCashPickup(e,t,{value:i})}spendCash(e){return!(!e||isNaN(e)||e<=0||this.currentCash<e||(this.currentCash-=e,this.emitCashUpdate(),0))}}class nd{constructor(e,t={}){this.scene=e,this.gameObjectManager=e.gameObjectManager||new zu(e),this.sprites=[],this.defaultOptions={initialSize:30,maxSize:200,growSize:10,defaultTexture:"particle_texture",defaultFrame:0,defaultSize:16,defaultColor:16777215},this.options={...this.defaultOptions,...t},this.ensureTextureExists(this.options.defaultTexture),this.scene.spritePool=this,this.initPool()}ensureTextureExists(e){return e&&this.scene.textures.exists(e)?e:(console.warn(`Texture "${e}" not found, creating fallback`),this.createFallbackTexture(e||"fallback_texture"),e||"fallback_texture")}createFallbackTexture(e){const t=this.scene.make.graphics();t.fillStyle(16777215),t.fillRect(0,0,16,16),t.generateTexture(e,16,16),t.destroy()}initPool(){this.gameObjectManager.createPool("sprite",(()=>{const e=this.ensureTextureExists(this.options.defaultTexture),t=this.scene.add.sprite(0,0,e);return t.setVisible(!1),t.setActive(!1),t.setAlpha(0),t.setScale(0),t.setDepth(50),t.customData={},t}),((e,t,s,i={})=>{const a={texture:this.options.defaultTexture,frame:this.options.defaultFrame,scale:1,alpha:1,tint:this.options.defaultColor,lifespan:3e3,rotation:0,velocityX:0,velocityY:0,angularVelocity:0,collectible:!1,value:1,depth:50,onExpire:null,gravity:0,bounce:0,drag:0,...i},n=this.ensureTextureExists(a.texture);e.setPosition(t,s),e.setTexture(n,a.frame),e.setScale(a.scale),e.setAlpha(a.alpha),e.setTint(a.tint),e.setAngle(a.rotation),e.setDepth(a.depth),e.setVisible(!0),e.setActive(!0),e.velocityX=a.velocityX,e.velocityY=a.velocityY,e.angularVelocity=a.angularVelocity,e.lifespan=a.lifespan,e.lifetime=0,e.customData={collectible:a.collectible,value:a.value,onExpire:a.onExpire,type:a.type||"generic"},a.enablePhysics&&(this.scene.physics.world.enable(e),e.body.setGravity(0,a.gravity),e.body.setBounce(a.bounce),e.body.setDrag(a.drag)),this.sprites.includes(e)||this.sprites.push(e)}),{initialSize:this.options.initialSize,maxSize:this.options.maxSize,growSize:this.options.growSize})}createSprite(e,t,s={}){const i=this.gameObjectManager.get("sprite",e,t,s);if(i)return i;console.warn("Sprite pool maxSize reached - creating sprite outside pool");const a=this.ensureTextureExists(s.texture||this.options.defaultTexture),n=this.scene.add.sprite(e,t,a);return n.setScale(s.scale||1),n.setAlpha(s.alpha||1),n.setDepth(s.depth||50),n}createDeathEffect(e,t,s={}){const i={texture:"particle_texture",scale:.5,tint:16737894,lifespan:800,rotation:360*Math.random(),angularVelocity:200*Math.random()-100,velocityX:100*Math.random()-50,velocityY:100*Math.random()-50,type:"death_effect",...s},a=this.createSprite(e,t,i);return this.scene.tweens&&a&&this.scene.tweens.add({targets:a,alpha:{from:1,to:0},scale:{from:i.scale,to:0},duration:i.lifespan,ease:"Power2"}),a}createXPPickup(e,t,s={}){const i={texture:"particle_texture",scale:.4,tint:4521796,lifespan:15e3,rotation:0,angularVelocity:50,velocityX:40*Math.random()-20,velocityY:40*Math.random()-20,type:"xp_pickup",collectible:!0,value:s.value||1,enablePhysics:!0,gravity:50,bounce:.5,drag:50,...s},a=this.createSprite(e,t,i);return this.scene.tweens&&a&&this.scene.tweens.add({targets:a,scale:{from:i.scale,to:1.2*i.scale},yoyo:!0,repeat:-1,duration:1e3,ease:"Sine.easeInOut"}),a}createCashPickup(e,t,s={}){const i={texture:"cash_pickup",scale:1,lifespan:1e4,rotation:0,angularVelocity:60,velocityX:0,velocityY:0,type:"cash_pickup",collectible:!0,value:s.value||1,enablePhysics:!1,depth:40,...s},a=this.createSprite(e,t,i);if(this.scene.tweens&&a){this.scene.tweens.add({targets:a,scale:{from:i.scale,to:1.3*i.scale},yoyo:!0,repeat:-1,duration:800,ease:"Sine.easeInOut"});const e=i.lifespan-2e3;this.scene.tweens.add({targets:a,alpha:{from:1,to:0},duration:2e3,ease:"Power2",delay:e,onComplete:()=>{this.releaseSprite(a)}}),a.textObject&&this.scene.tweens.add({targets:a.textObject,alpha:{from:1,to:0},scale:{from:1,to:0},duration:2e3,ease:"Power2",delay:e})}return a}createHealthPickup(e,t,s={}){const i={texture:"health_pickup",scale:1,lifespan:8e3,rotation:0,angularVelocity:60,velocityX:0,velocityY:0,type:"health_pickup",collectible:!0,value:s.value||20,enablePhysics:!1,depth:40,...s},a=this.createSprite(e,t,i);if(this.scene.tweens&&a){this.scene.tweens.add({targets:a,scale:{from:i.scale,to:1.3*i.scale},yoyo:!0,repeat:-1,duration:800,ease:"Sine.easeInOut"});const e=i.lifespan-2e3;this.scene.tweens.add({targets:a,alpha:{from:1,to:0},duration:2e3,ease:"Power2",delay:e,onComplete:()=>{this.releaseSprite(a)}})}return a}releaseSprite(e){if(!e||!e.active)return;this.scene.tweens&&(this.scene.tweens.killTweensOf(e),e.textObject&&this.scene.tweens.killTweensOf(e.textObject)),e.body&&this.scene.physics.world.disable(e),e.textObject&&(e.textObject.destroy(),e.textObject=null),e.setVisible(!1),e.setActive(!1),e.setPosition(-1e3,-1e3),e.setAlpha(0),e.setScale(0),this.gameObjectManager.release("sprite",e);const t=this.sprites.indexOf(e);-1!==t&&this.sprites.splice(t,1)}update(e,t){for(let s=this.sprites.length-1;s>=0;s--){const e=this.sprites[s];e&&e.active?(e.lifetime+=t,e.body||(e.x+=e.velocityX*(t/1e3),e.y+=e.velocityY*(t/1e3),e.angle+=e.angularVelocity*(t/1e3)),e.lifetime>=e.lifespan&&(e.customData.onExpire&&e.customData.onExpire(e),this.releaseSprite(e))):e&&this.sprites.splice(s,1)}}checkCollision(e,t,s,i,a){const n=[];for(let r=this.sprites.length-1;r>=0;r--){const o=this.sprites[r];o&&o.active&&(o.customData&&o.customData.collectible&&(a&&o.customData.type!==a||Phaser.Math.Distance.Between(e,t,o.x,o.y)<s&&(n.push(o),i&&i(o),this.releaseSprite(o))))}return n}}class rd{constructor(e,t={}){this.scene=e,e.collectibleManager=this,this.managers={},this.collectionConfig={xp_pickup:{radius:t.xpCollectionRadius||40,processMethod:this.processXPCollection.bind(this),manager:"xpManager",soundKey:"xp_collect",fallbackSoundKey:"shoot_minigun",soundConfig:{detune:1200,volume:.03},particleColor:4521796},cash_pickup:{radius:t.cashCollectionRadius||40,processMethod:this.processCashCollection.bind(this),manager:"cashManager",soundKey:"cash_pickup",fallbackSoundKey:"laserShoot",soundConfig:{detune:100*Math.random()-50,volume:.05},particleColor:16766720},health_pickup:{radius:t.healthCollectionRadius||40,processMethod:this.processHealthCollection.bind(this),manager:null,soundKey:"health_pickup",fallbackSoundKey:"laserShoot",soundConfig:{detune:900,volume:.04},particleColor:16711680}},this.lastCollectionTime=0,this.collectionInterval=t.collectionInterval||100,uu.on("collectible-collected",this.onCollectibleCollected,this)}registerManager(e,t){t?this.managers[e]=t:console.warn(`Cannot register null manager for type: ${e}`)}checkCollectibles(e,t=null){if(!e||"number"!=typeof e.x||"number"!=typeof e.y)return console.warn("CollectibleManager: Invalid position for collectible check"),[];if(!this.scene.spritePool)return console.warn("CollectibleManager: No SpritePool found in scene"),[];const s=this.scene.time.now;if(s-this.lastCollectionTime<this.collectionInterval)return[];this.lastCollectionTime=s;const i=t||Object.keys(this.collectionConfig),a=[];return i.forEach((t=>{const s=this.collectionConfig[t];if(!s)return;const i=this.scene.spritePool.checkCollision(e.x,e.y,s.radius,(e=>this.processCollection(e,t)),t);i&&i.length&&a.push(...i)})),a}processCollection(e,t){if(!e||!e.customData)return!0;const s=this.collectionConfig[t];return!s||(s.processMethod&&s.processMethod(e),this.playCollectionSound(s),this.createCollectionEffect(e,s),uu.emit("collectible-collected",{type:t,value:e.customData.value,position:{x:e.x,y:e.y}}),!0)}processXPCollection(e){if(!e.customData||"number"!=typeof e.customData.value)return!1;const t=this.managers.xpManager||this.scene.xpManager;if(!t||!t.addXP)return console.warn("CollectibleManager: Cannot process XP - no valid XPManager found"),!1;const s=e.customData.value;return t.addXP(s),this.scene.uiManager&&this.scene.uiManager.showFloatingText&&this.scene.uiManager.showFloatingText(e.x,e.y,`+${s} XP`,4521796),!0}processCashCollection(e){if(!e.customData||"number"!=typeof e.customData.value)return!1;const t=this.managers.cashManager||this.scene.cashManager;if(!t||!t.addCash)return console.warn("CollectibleManager: Cannot process cash - no valid CashManager found"),!1;const s=e.customData.value;return t.addCash(s),this.scene.uiManager&&this.scene.uiManager.showFloatingText&&this.scene.uiManager.showFloatingText(e.x,e.y,`+$${s}`,16766720),!0}processHealthCollection(e){if(!e.customData||"number"!=typeof e.customData.value)return!1;const t=e.customData.value;if(this.scene.playerHealth&&"function"==typeof this.scene.playerHealth.heal)this.scene.playerHealth.heal(t),this.scene.isDev;else if(this.scene.player&&this.scene.player.healthSystem&&"function"==typeof this.scene.player.healthSystem.heal)this.scene.player.healthSystem.heal(t),this.scene.isDev;else{if(!this.scene.player||"function"!=typeof this.scene.player.heal)return console.warn("CollectibleManager: Cannot process health - no valid health system found"),!1;this.scene.player.heal(t),this.scene.isDev}if(this.scene.uiManager&&this.scene.uiManager.showFloatingText&&this.scene.uiManager.showFloatingText(e.x,e.y,`+${t} HP`,16711680),this.scene.soundManager){const e=this.scene.soundManager.hasSound("health_pickup")?"health_pickup":"laserShoot";this.scene.soundManager.playSoundEffect(e,{detune:900,volume:.04})}return this.showHealingEffect(),!0}showHealingEffect(){var e;const t=null==(e=this.scene.player)?void 0:e.graphics;if(t&&(t.setTint(65280),this.scene.time.delayedCall(200,(()=>{t.clearTint()})),this.scene.add&&this.scene.add.particles)){const e=this.scene.add.particles(t.x,t.y,"particle_texture",{speed:{min:30,max:80},scale:{start:.2,end:0},alpha:{start:.8,end:0},lifespan:500,blendMode:"ADD",quantity:8,tint:65280,angle:{min:0,max:360}});e.setDepth(100),this.scene.time.delayedCall(500,(()=>{e.destroy()}))}}playCollectionSound(e){if(!this.scene.soundManager)return;const t=this.scene.soundManager.hasSound(e.soundKey)?e.soundKey:e.fallbackSoundKey;if(t)try{this.scene.soundManager.playSoundEffect(t,e.soundConfig)}catch(s){console.warn(`CollectibleManager: Error playing sound ${t}`,s)}}createCollectionEffect(e,t){if(e&&t.particleColor&&this.scene.add&&this.scene.add.particles){const s=this.scene.add.particles(e.x,e.y,"particle_texture",{speed:{min:30,max:60},angle:{min:0,max:360},scale:{start:.3,end:0},blendMode:"ADD",lifespan:200,gravityY:0,quantity:5,tint:t.particleColor});this.scene.time.delayedCall(200,(()=>{s.destroy()}))}}onCollectibleCollected(e){}update(e,t){if(this.scene.player&&this.scene.player.getPosition){const e=this.scene.player.getPosition();e&&this.checkCollectibles(e)}}updateCollectionRadius(e,t){return this.collectionConfig&&this.collectionConfig[e]?(this.collectionConfig[e].radius*=t,this.scene.isDev&&this.collectionConfig[e].radius,!0):(console.warn(`CollectibleManager: Cannot update radius for unknown type: ${e}`),!1)}updateAllCollectionRadii(e){this.collectionConfig&&Object.keys(this.collectionConfig).forEach((t=>{this.updateCollectionRadius(t,e)}))}destroy(){uu.off("collectible-collected",this.onCollectibleCollected,this),this.scene=null,this.managers={}}}class od{constructor(e,t={}){this.scene=e,this.config={enabled:t.enabled??!0,chaosThreshold:t.chaosThreshold??45,requiredEnemiesPerFaction:t.requiredEnemiesPerFaction??4,totalEnemiesRequired:t.totalEnemiesRequired??10,detectionRadius:t.detectionRadius??350,battleCheckInterval:t.battleCheckInterval??2e3,victoryChance:t.victoryChance??.5,battleCooldown:t.battleCooldown??15e3,maxSimultaneousBattles:t.maxSimultaneousBattles??1},this.activeBattles=[],this.lastBattleTimestamp=0,this.isDev=t.isDev??e.isDev??!1,e.factionBattleManager=this,this.battleDetectionTimer=null,this.groupManager=null,this.chaosManager=null,this.setupEventListeners()}setupEventListeners(){uu.on("chaos-changed",this.onChaosChanged,this)}onChaosChanged(e){if(Math.abs(e.newValue-e.oldValue)<5)return;const t=Math.abs(e.newValue);t>=this.config.chaosThreshold&&!this.battleDetectionTimer?this.startBattleDetection():t<this.config.chaosThreshold&&this.battleDetectionTimer&&this.stopBattleDetection()}initialize(){this.groupManager=this.scene.groupManager,this.chaosManager=this.scene.chaosManager,this.groupManager&&this.chaosManager?(Math.abs(this.chaosManager.getChaos())>=this.config.chaosThreshold&&this.startBattleDetection(),this.isDev):console.error("FactionBattleManager requires GroupManager and ChaosManager")}startBattleDetection(){this.battleDetectionTimer||(this.battleDetectionTimer=this.scene.time.addEvent({delay:this.config.battleCheckInterval,callback:this.checkForPotentialBattles,callbackScope:this,loop:!0}),this.isDev)}stopBattleDetection(){this.battleDetectionTimer&&(this.battleDetectionTimer.remove(),this.battleDetectionTimer=null,this.isDev)}checkForPotentialBattles(){if(!this.config.enabled||!this.groupManager||!this.chaosManager)return;if(Math.abs(this.chaosManager.getChaos())<this.config.chaosThreshold)return;const e=Date.now();if(e-this.lastBattleTimestamp<this.config.battleCooldown)return;if(this.activeBattles.length>=this.config.maxSimultaneousBattles)return;const t=this.findEnemyClusters();if(0===t.length)return;const s=t[Math.floor(Math.random()*t.length)];this.startBattle(s),this.lastBattleTimestamp=e}findEnemyClusters(){if(!this.groupManager)return[];const e=[],t={},s=this.config.detectionRadius,i=this.groupManager.getEntitiesInGroup(gu.AI),a=this.groupManager.getEntitiesInGroup(gu.CODER);if(this.isDev&&(i.length,a.length,this.config.requiredEnemiesPerFaction,this.config.detectionRadius),i.length<this.config.requiredEnemiesPerFaction||a.length<this.config.requiredEnemiesPerFaction)return[];this.populateGrid(t,i,a,s);for(const n in t){const s=t[n];s.ai.length>=this.config.requiredEnemiesPerFaction&&s.coder.length>=this.config.requiredEnemiesPerFaction&&(e.push({position:{x:s.center.x,y:s.center.y},aiEnemies:s.ai,coderEnemies:s.coder,totalEnemies:s.ai.length+s.coder.length}),this.isDev&&(s.ai.length,s.coder.length))}return e}populateGrid(e,t,s,i){for(const a of t){if(!a||!a.graphics)continue;const t=`${Math.floor(a.graphics.x/i)},${Math.floor(a.graphics.y/i)}`;e[t]||(e[t]={ai:[],coder:[],center:{x:0,y:0},totalAdded:0}),e[t].ai.push(a);const s=++e[t].totalAdded;e[t].center.x=(e[t].center.x*(s-1)+a.graphics.x)/s,e[t].center.y=(e[t].center.y*(s-1)+a.graphics.y)/s}for(const a of s){if(!a||!a.graphics)continue;const t=`${Math.floor(a.graphics.x/i)},${Math.floor(a.graphics.y/i)}`;e[t]||(e[t]={ai:[],coder:[],center:{x:0,y:0},totalAdded:0}),e[t].coder.push(a);const s=++e[t].totalAdded;e[t].center.x=(e[t].center.x*(s-1)+a.graphics.x)/s,e[t].center.y=(e[t].center.y*(s-1)+a.graphics.y)/s}}startBattle(e){if(!e)return;const t=Math.min(e.aiEnemies.length,e.coderEnemies.length,this.config.requiredEnemiesPerFaction),s=e=>e.sort((()=>Math.random()-.5)),i=s([...e.aiEnemies]).slice(0,t),a=s([...e.coderEnemies]).slice(0,t),n={id:`battle_${Date.now()}_${Math.floor(1e3*Math.random())}`,position:e.position,aiTeam:i,coderTeam:a,startTime:Date.now(),pairings:[],status:"active",victoryResult:null};this.activeBattles.push(n),this.createBattlePairings(n),uu.emit("FACTION_BATTLE_START",{battleId:n.id,position:n.position,aiCount:i.length,coderCount:a.length}),this.createBattleEffect(n),this.scene.time.delayedCall(3e3,(()=>{this.resolveBattle(n)})),this.isDev&&(n.position.x,n.position.y,i.length,a.length)}createBattlePairings(e){const{aiTeam:t,coderTeam:s}=e,i=[];for(let a=0;a<Math.min(t.length,s.length);a++)i.push({ai:t[a],coder:s[a],resolved:!1,winner:null});e.pairings=i}createBattleEffect(e){if(this.scene.add&&this.scene.add.particles){const t=e.position.x,s=e.position.y,i=this.scene.add.particles(t,s,"particle_texture",{speed:{min:-200,max:200},angle:{min:0,max:360},scale:{start:.25,end:0},blendMode:"ADD",lifespan:800,quantity:15,tint:[16711680,255]});this.scene.time.delayedCall(1e3,(()=>{i.destroy()}))}const t=this.scene.add.text(e.position.x,e.position.y-50,"FACTION BATTLE!",{fontFamily:"Arial",fontSize:"24px",color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(.5);this.scene.tweens.add({targets:t,y:t.y-20,alpha:{from:1,to:0},ease:"Power2",duration:1500,onComplete:()=>t.destroy()})}resolveBattle(e){if(!e)return;let t=0,s=0;for(const a of e.pairings){const e=Math.random()<this.config.victoryChance;a.resolved=!0,a.winner=e?"ai":"coder",e?(t++,a.coder&&a.coder.takeDamage&&a.coder.takeDamage(1e3)):(s++,a.ai&&a.ai.takeDamage&&a.ai.takeDamage(1e3))}const i=t>s?gu.AI:gu.CODER;if(e.victoryResult={winningFaction:i,aiWins:t,coderWins:s},e.status="resolved",this.chaosManager){const e=i===gu.AI?-10:10;this.chaosManager.adjustChaos(e)}this.createBattleVictoryEffect(e,i),this.applyVictoryBoosts(e,i),uu.emit("FACTION_BATTLE_END",{battleId:e.id,position:e.position,winningFaction:i,aiWins:t,coderWins:s}),this.scene.time.delayedCall(5e3,(()=>{const t=this.activeBattles.findIndex((t=>t.id===e.id));-1!==t&&this.activeBattles.splice(t,1)})),this.isDev}createBattleVictoryEffect(e,t){const{x:s,y:i}=e.position,a=t===gu.AI?255:16711680;if(this.scene.add&&this.scene.add.particles){const e=this.scene.add.particles(s,i,"particle_texture",{speed:{min:70,max:250},angle:{min:0,max:360},scale:{start:.4,end:0},blendMode:"ADD",lifespan:1200,quantity:20,tint:a});this.scene.time.delayedCall(1500,(()=>{e.destroy()}))}const n=this.scene.add.text(s,i-40,t===gu.AI?"AI VICTORY!":"CODER VICTORY!",{fontFamily:"Arial",fontSize:"26px",color:t===gu.AI?"#0000ff":"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5);this.scene.tweens.add({targets:n,y:n.y-40,alpha:{from:1,to:0},duration:2e3,ease:"Power2",onComplete:()=>n.destroy()})}applyVictoryBoosts(e,t){const s=t===gu.AI?e.aiTeam.filter((e=>e&&e.active&&!e.isDead)):e.coderTeam.filter((e=>e&&e.active&&!e.isDead));for(const i of s)i&&i.applyTemporaryStatBoost&&(i.applyTemporaryStatBoost("speed",1.25,7e3),i.applyTemporaryStatBoost("damage",1.25,7e3),this.createVictoryAura(i))}createVictoryAura(e){if(!e||!e.graphics)return;if(this.scene.particles){const t=this.scene.particles.createEmitter({follow:e.graphics,scale:{start:.2,end:0},speed:20,lifespan:600,blendMode:"ADD",frequency:50,quantity:1,tint:e.groupId===gu.AI?35071:16724736});this.scene.time.delayedCall(7e3,(()=>{t.stop(),this.scene.time.delayedCall(600,(()=>t.remove()))}))}e.graphics.tint;const t=e.groupId===gu.AI?3447003:15158332;e.factionTint=t;const s=e.groupId===gu.AI?65535:16737894,i=this.scene.tweens.add({targets:e.graphics,tint:s,duration:400,yoyo:!0,repeat:8,onComplete:()=>{e&&e.graphics&&(e.graphics.tint=t,e.graphics.list&&Array.isArray(e.graphics.list)&&e.graphics.list.forEach((e=>{e&&e.setTint&&e.setTint(t)})),e.sprite&&e.sprite.setTint&&e.sprite.setTint(t))}});e._victoryTween=i}getActiveBattles(){return[...this.activeBattles]}forceBattle(e,t,s=300){if(!this.config.enabled||!this.groupManager)return!1;const i=this.groupManager.getEntitiesInGroup(gu.AI).filter((i=>!(!i||!i.graphics)&&Phaser.Math.Distance.Between(e,t,i.graphics.x,i.graphics.y)<=s)),a=this.groupManager.getEntitiesInGroup(gu.CODER).filter((i=>!(!i||!i.graphics)&&Phaser.Math.Distance.Between(e,t,i.graphics.x,i.graphics.y)<=s));if(i.length<2||a.length<2)return this.isDev,!1;const n={position:{x:e,y:t},aiEnemies:i,coderEnemies:a,totalEnemies:i.length+a.length};return this.startBattle(n),this.lastBattleTimestamp=Date.now(),!0}isEnemyInBattle(e){if(!e)return!1;for(const t of this.activeBattles){if(t.aiTeam.includes(e))return!0;if(t.coderTeam.includes(e))return!0}return!1}setEnabled(e){this.config.enabled=e,e?this.chaosManager&&Math.abs(this.chaosManager.getChaos())>=this.config.chaosThreshold&&this.startBattleDetection():this.stopBattleDetection()}update(e,t){var s,i,a,n;if(this.isDev&&this.scene.input&&this.scene.input.keyboard)if(this._debugKey||(this._debugKey=this.scene.input.keyboard.addKey("K"),this._debugKey.on("down",(()=>{this._showDebugVisuals=!this._showDebugVisuals,this._showDebugVisuals})),this._showDebugVisuals=!1,this._debugGraphics=this.scene.add.graphics()),this._showDebugVisuals&&this.drawDebugVisuals(),this._showDebugVisuals&&this.chaosManager){this._debugText||(this._debugText=this.scene.add.text(10,10,"",{font:"16px Arial",fill:"#ffffff",stroke:"#000000",strokeThickness:3}).setScrollFactor(0).setDepth(999));const e=Math.abs(this.chaosManager.getChaos()),t=this.config.chaosThreshold,r=e>=t?"ENABLED":"DISABLED";this._debugText.setText(`Faction Battles: ${r}\nChaos: ${Math.round(e)}% (Threshold: ${t}%)\nActive Battles: ${this.activeBattles.length}\nAI: ${(null==(i=null==(s=this.groupManager)?void 0:s.getEntitiesInGroup(gu.AI))?void 0:i.length)||0}\nCODER: ${(null==(n=null==(a=this.groupManager)?void 0:a.getEntitiesInGroup(gu.CODER))?void 0:n.length)||0}\nLast Battle: ${Date.now()-this.lastBattleTimestamp}ms ago\nPress D to toggle debug, B to force battle`)}else this._debugText&&this._debugText.setVisible(!1)}drawDebugVisuals(){if(!this._debugGraphics)return;this._debugGraphics.clear();const e=this.scene.player,t=this.config.detectionRadius;if(e&&e.getPosition){const s=e.getPosition();this._debugGraphics.lineStyle(2,16776960,.5),this._debugGraphics.strokeCircle(s.x,s.y,t)}for(const s of this.activeBattles){const{position:e,status:i}=s;this._debugGraphics.lineStyle(3,16777215,.8),this._debugGraphics.strokeCircle(e.x,e.y,.7*t);const a="active"===i?65280:16776960;this._debugGraphics.lineStyle(2,a,1),this._debugGraphics.strokeCircle(e.x,e.y,30),this._debugGraphics.lineStyle(1,16711680,.5);for(const t of s.coderTeam)t&&t.graphics&&this._debugGraphics.lineBetween(e.x,e.y,t.graphics.x,t.graphics.y);this._debugGraphics.lineStyle(1,255,.5);for(const t of s.aiTeam)t&&t.graphics&&this._debugGraphics.lineBetween(e.x,e.y,t.graphics.x,t.graphics.y)}if(this.chaosManager&&Math.abs(this.chaosManager.getChaos())>=this.config.chaosThreshold){const e=this.findEnemyClusters();for(const s of e){const{position:e}=s;this._debugGraphics.lineStyle(2,65280,.6),this._debugGraphics.strokeCircle(e.x,e.y,.7*t),this._clusterTexts||(this._clusterTexts=[]);let i=this._clusterTexts.find((e=>!e.visible));i||(i=this.scene.add.text(0,0,"",{font:"12px Arial",fill:"#ffffff",stroke:"#000000",strokeThickness:3}).setDepth(999),this._clusterTexts.push(i)),i.setText(`AI: ${s.aiEnemies.length}\nCODER: ${s.coderEnemies.length}`),i.setPosition(e.x-20,e.y-20),i.setVisible(!0)}if(this._clusterTexts)for(let t=e.length;t<this._clusterTexts.length;t++)this._clusterTexts[t].setVisible(!1)}else if(this._clusterTexts)for(const s of this._clusterTexts)s.setVisible(!1)}destroy(){this.stopBattleDetection(),uu.off("chaos-changed",this.onChaosChanged,this),this.scene=null,this.groupManager=null,this.chaosManager=null,this.activeBattles=[]}}class ld{constructor(e,t,s){this.player=e,this.weapon=t,this.rng=s,this.rerollCount=0,this.baseRerollCost=50,this.maxRerollsPerRound=5,this.purchasedDroneUpgrades=new Set,this.currentDroneLevel=0,this.purchasedUpgradesThisSession={weapon:new Set,player:new Set},this.permanentlyPurchasedUpgrades=new Set,e&&e.scene&&e.scene.time.delayedCall(100,(()=>{this.checkExistingUpgrades()}))}generateUpgrades(e=1){const t=e||(this.player&&this.player.scene&&this.player.scene.xpManager?this.player.scene.xpManager.getCurrentLevel():1);let s=1;this.player&&this.player.scene&&this.player.scene.waveManager&&(s=this.player.scene.waveManager.getCurrentWave());let i=function(e=3,t,s=1,i=1){if(!t||"function"!=typeof t.pick&&"function"!=typeof t.range)return Du.slice(0,e);!t.range&&t.pick&&(t.range=(e,t)=>Math.random()*(t-e)+e);const a=Du.filter((e=>!e.minWave||i>=e.minWave)),n=[],r=[];a.forEach(((e,t)=>{var s;const i=(null==(s=e.rarity)?void 0:s.weight)||100;for(let a=0;a<i;a++)r.push(t)}));const o=new Map;a.forEach(((e,t)=>{o.set(t,e)}));for(let l=0;l<e&&0!==r.length&&0!==o.size;l++){const e=Math.floor(t.range(0,r.length-1)),i=r[e],a=o.get(i);if(!a)continue;for(let t=r.length-1;t>=0;t--)r[t]===i&&r.splice(t,1);o.delete(i);const l=JSON.parse(JSON.stringify(a));let h;if(l.isDroneUpgrade)h=l.rarity;else if("Epic"===l.rarity.name||"Legendary"===l.rarity.name)h=l.rarity;else{const e=Object.values(xu),s=[];e.forEach((e=>{for(let t=0;t<e.weight;t++)s.push(e)}));const i=Math.floor(t.range(0,s.length-1));h=s[i],l.rarity=h}const c="Epic"===a.rarity.name||"Legendary"===a.rarity.name;if(!c){const e=h.multiplier;l.price=Math.round(l.price*e),l.stats&&Object.entries(l.stats).forEach((([t,s])=>{if("number"==typeof s&&!isNaN(s))if("fireRate"===t)if(s<1){const i=(1-s)*e;l.stats[t]=Math.max(.5,1-i)}else{const i=(s-1)*e;l.stats[t]=1+i}else if(s>1){const i=(s-1)*e;l.stats[t]=1+i}else l.stats[t]=s*e}))}if(l.effects)if(c)l.effects=a.effects;else{let e=l.effects;e.includes("(")&&(e=e.substring(0,e.indexOf("(")).trim()),l.effects=`${e} (${h.name})`}const u=_u(l,s);n.push(u)}return n}(6,this.rng,t,s);i=this.filterDroneUpgrades(i),this.purchasedUpgradesThisSession.weapon.size>0&&(i=i.filter((e=>!this.purchasedUpgradesThisSession.weapon.has(e.id)))),this.permanentlyPurchasedUpgrades.size>0&&(i=i.filter((e=>!this.permanentlyPurchasedUpgrades.has(e.id)))),i=i.slice(0,3);let a=0;this.player.healthSystem?a=Math.round(100*this.player.healthSystem.getDamageResistance()):this.player.scene&&this.player.scene.playerHealth?a=Math.round(100*this.player.scene.playerHealth.getDamageResistance()):void 0!==this.player.defense&&(a=this.player.defense);let n=0;void 0!==this.player.healthRegen&&(n=this.player.healthRegen);const r={defense:a,healthRegen:n,purchasedLegendaryUpgrades:this.permanentlyPurchasedUpgrades};let o=function(e=3,t,s=1,i=null){if(!t||"function"!=typeof t.pick&&"function"!=typeof t.range)return Iu.slice(0,e);!t.range&&t.pick&&(t.range=(e,t)=>Math.random()*(t-e)+e);let a=[...Iu];const n=[];i&&void 0!==i.defense&&i.defense>=25&&(a=a.filter((e=>e.category!==Ru))),i&&void 0!==i.healthRegen&&i.healthRegen>0&&(a=a.filter((e=>!(e.stats&&e.stats.healthRegen)))),i&&i.purchasedLegendaryUpgrades&&(a=a.filter((e=>{const t=e.rarity&&"Legendary"===e.rarity.name&&i.purchasedLegendaryUpgrades.has(e.id),s="dash_1"===e.id&&i.purchasedLegendaryUpgrades.has("dash_1"),a="shield_1"===e.id&&i.purchasedLegendaryUpgrades.has("shield_1"),n="regen_1"===e.id&&i.purchasedLegendaryUpgrades.has("regen_1");return!(t||s||a||n)})));const r=[];a.forEach(((e,t)=>{var s;const i=(null==(s=e.rarity)?void 0:s.weight)||100;for(let a=0;a<i;a++)r.push(t)}));const o=new Map;a.forEach(((e,t)=>{o.set(t,e)}));for(let l=0;l<e&&0!==r.length&&0!==o.size;l++){const e=Math.floor(t.range(0,r.length-1)),i=r[e],a=o.get(i);if(!a)continue;for(let t=r.length-1;t>=0;t--)r[t]===i&&r.splice(t,1);o.delete(i);const l=JSON.parse(JSON.stringify(a));let h;if("Epic"===l.rarity.name||"Legendary"===l.rarity.name)h=l.rarity;else{const e=Object.values(xu),s=[];e.forEach((e=>{for(let t=0;t<e.weight;t++)s.push(e)}));const i=Math.floor(t.range(0,s.length-1));h=s[i]}l.rarity=h;const c="Epic"===a.rarity.name||"Legendary"===a.rarity.name;if(l.description)if(c)l.description=a.description;else{let e=l.description;e.includes("(")&&(e=e.substring(0,e.indexOf("(")).trim()),l.description=`${e} (${h.name})`}const u=Lu(l,s);n.push(u)}return n}(5,this.rng,t,r);return this.purchasedUpgradesThisSession.player.size>0&&(o=o.filter((e=>!this.purchasedUpgradesThisSession.player.has(e.id)))),o=o.slice(0,3),{weaponUpgrades:i,playerUpgrades:o}}filterDroneUpgrades(e){return e.filter((e=>!e.isDroneUpgrade||!this.purchasedDroneUpgrades.has(e.id)&&("drone_1"===e.id||("drone_2"===e.id?this.purchasedDroneUpgrades.has("drone_1"):"drone_3"===e.id?this.purchasedDroneUpgrades.has("drone_2"):"drone_4"===e.id?this.purchasedDroneUpgrades.has("drone_3"):"drone_5"!==e.id||this.purchasedDroneUpgrades.has("drone_4")))))}reroll(){this.rerollCount++;const e=this.player&&this.player.scene&&this.player.scene.xpManager?this.player.scene.xpManager.getCurrentLevel():1;return this.generateUpgrades(e)}getRerollCost(){return 0===this.rerollCount?0:this.baseRerollCost+25*(this.rerollCount-1)}resetReroll(){this.rerollCount=0,this.purchasedUpgradesThisSession.weapon.clear(),this.purchasedUpgradesThisSession.player.clear(),this.checkExistingUpgrades()}checkExistingUpgrades(){if(!this.player)return;let e=!1;e=this.player.weaponManager?!0===this.player.weaponManager.bulletHoming:!0===this.player.bulletHoming,e&&this.permanentlyPurchasedUpgrades.add("homing_1");let t=!1;t=this.player.weaponManager?this.player.weaponManager.bulletAoeRadius>0:this.player.bulletAoeRadius>0,t&&this.permanentlyPurchasedUpgrades.add("area_1");let s=0;this.player.weaponManager&&this.player.weaponManager.drones&&(s=this.player.weaponManager.drones.length),s>=1&&this.purchasedDroneUpgrades.add("drone_1"),s>=2&&this.purchasedDroneUpgrades.add("drone_2"),s>=3&&this.purchasedDroneUpgrades.add("drone_3"),s>=4&&this.purchasedDroneUpgrades.add("drone_4"),s>=5&&(this.purchasedDroneUpgrades.add("drone_5"),this.permanentlyPurchasedUpgrades.add("drone_5"))}trackPurchasedUpgrade(e,t){"weapon"!==e&&"player"!==e||this.purchasedUpgradesThisSession[e].add(t)}applyWeaponUpgrade(e){return!!(e&&e.stats&&this.player)&&(e.id&&(this.trackPurchasedUpgrade("weapon",e.id),e.rarity&&"Legendary"===e.rarity.name&&(this.permanentlyPurchasedUpgrades.add(e.id),e.name)),e.isDroneUpgrade&&e.stats.drone&&this.player.weaponManager?(this.player.weaponManager.upgradeDrones(),e.id&&(this.purchasedDroneUpgrades.add(e.id),"drone_1"===e.id&&(this.currentDroneLevel=1),"drone_2"===e.id&&(this.currentDroneLevel=2),"drone_3"===e.id&&(this.currentDroneLevel=3),"drone_4"===e.id&&(this.currentDroneLevel=4),"drone_5"===e.id&&(this.currentDroneLevel=5)),uu.emit("drone-added",{upgrade:e,droneCount:this.player.weaponManager.drones.length,maxDrones:this.player.weaponManager.maxDrones,currentDroneLevel:this.currentDroneLevel}),!0):this.player.weaponManager?!1!==this.player.weaponManager.applyUpgrade(e):(Object.entries(e.stats).forEach((([t,s])=>{switch(t){case"damage":this.player.bulletDamage*=s;break;case"fireRate":s<1?this.player.fireRate*=s:this.player.fireRate/=s;break;case"bulletRange":this.player.bulletRange*=s;break;case"bulletSpeed":this.player.bulletSpeed*=s;break;case"bulletPierce":this.player.bulletPierce+=s;break;case"criticalChance":this.player.criticalHitChance=(this.player.criticalHitChance||0)+s;break;case"criticalDamageMultiplier":this.player.criticalDamageMultiplier=(this.player.criticalDamageMultiplier||1)+s;break;case"aoeRadius":this.player.bulletAoeRadius=(this.player.bulletAoeRadius||0)+s;break;case"aoeDamage":this.player.bulletAoeDamage=(this.player.bulletAoeDamage||0)+s;break;case"homing":this.player.bulletHoming=s,this.player.homingForce=e.stats.homingForce||.05,e.rarity&&"Legendary"===e.rarity.name&&this.permanentlyPurchasedUpgrades.add("homing_1");break;default:console.warn(`Unknown weapon stat: ${t}`)}})),uu.emit("weapon-upgraded",{upgrade:e,newStats:{damage:this.player.bulletDamage,fireRate:this.player.fireRate,range:this.player.bulletRange,speed:this.player.bulletSpeed,pierce:this.player.bulletPierce,criticalChance:this.player.criticalHitChance,criticalDamage:this.player.criticalDamageMultiplier}}),!0))}applyPlayerUpgrade(e){return!!(e&&e.stats&&this.player)&&(e.id&&(this.trackPurchasedUpgrade("player",e.id),"dash_1"!==e.id&&"shield_1"!==e.id&&"regen_1"!==e.id||(this.permanentlyPurchasedUpgrades.add(e.id),e.name),e.rarity&&"Legendary"===e.rarity.name&&(this.permanentlyPurchasedUpgrades.add(e.id),e.name)),Object.entries(e.stats).forEach((([t,s])=>{switch(t){case"maxHealth":const i=this.player.health||100,a=this.player.maxHealth||100;if(this.player.maxHealth=a+s,this.player.health=i+s,this.player.scene.playerHealth){this.player.scene.playerHealth.setMaxHealth(this.player.maxHealth);const e=s;this.player.scene.playerHealth.heal(e)}break;case"defense":let n=0,r=null,o=null;if(this.player.healthSystem&&(r=this.player.healthSystem,n=r.getDamageResistance()||0),this.player.scene.playerHealth&&(o=this.player.scene.playerHealth,r||(n=o.getDamageResistance()||0)),n>=.25)return!1;this.player.defense=(this.player.defense||0)+s;const l=n+s/100;if(r&&r.setDamageResistance(l),o&&o!==r&&o.setDamageResistance(l),!r&&!o)return console.warn("No health system found to apply defense upgrade"),!1;break;case"speed":this.player.speed*=s;break;case"pickupRadius":if(this.player.scene.collectibleManager){const e=this.player.scene.collectibleManager;"function"==typeof e.updateAllCollectionRadii?e.updateAllCollectionRadii(s):e.collectionConfig?(e.collectionConfig.xp_pickup&&(e.collectionConfig.xp_pickup.radius*=s),e.collectionConfig.cash_pickup&&(e.collectionConfig.cash_pickup.radius*=s),e.collectionConfig.health_pickup&&(e.collectionConfig.health_pickup.radius*=s)):console.warn("CollectibleManager has no collectionConfig object")}break;case"healthRegen":this.player.healthRegen=(this.player.healthRegen||0)+s,this.player.scene.showFloatingText&&this.player.scene.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Health regeneration activated!",11167402);break;case"dash":this.player.hasDash=!0,this.player.dashPower=e.stats.dashPower||1.5,this.player.dashCooldown=e.stats.dashCooldown||1e4,this.player.dashCooldownTimer=0,this.player.scene.showFloatingText&&this.player.scene.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Dash ability unlocked! (Press Q)",65535);break;case"shield":this.player.hasShield=!0,this.player.shieldDuration=e.stats.shieldDuration||3e3,this.player.shieldCooldown=e.stats.shieldCooldown||3e4,this.player.shieldCooldownTimer=0,this.player.scene.showFloatingText&&this.player.scene.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Shield ability unlocked! (Press E)",43775);break;default:console.warn(`Unknown player stat: ${t}`)}})),uu.emit("player-upgraded",{upgrade:e,newStats:{health:this.player.health,maxHealth:this.player.maxHealth,defense:this.player.defense,speed:this.player.speed,healthRegen:this.player.healthRegen}}),!0)}}class hd{constructor(e,t,s,i){this.scene=e,this.player=t,this.weapon=s,this.rng=i,this.upgradeManager=new ld(t,s,i),this.isShopOpen=!1,this.isProcessingShopOpen=!1,e.shopManager=this,this.onWaveCompleted=this.onWaveCompleted.bind(this),uu.on("wave-completed",this.onWaveCompleted),e.waveManager&&e.waveManager.registerEndOfRoundCallback(this.onWaveCompleted),this.scene.events.once("shutdown",(()=>{uu.off("wave-completed",this.onWaveCompleted),this.scene.waveManager&&this.scene.waveManager.unregisterEndOfRoundCallback(this.onWaveCompleted)})),e.isDev}onWaveCompleted(e){if(!this.scene||!this.scene.uiManager)return;this.scene.isDev;const t=this.scene.uiManager.elements.nextWaveButtonText;if(t){t.setText("Open Shop");const e=this.scene.uiManager.elements.nextWaveButtonBg;e&&(e.off("pointerdown"),e.on("pointerdown",(()=>{this.isProcessingShopOpen||(this.isProcessingShopOpen=!0,this.openShop(),this.scene.time.delayedCall(500,(()=>{this.isProcessingShopOpen=!1})))})),t.off("pointerdown"),t.disableInteractive(),e.visible||this.scene.uiManager.showNextWaveButton())}}openShop(){if(this.isShopOpen)return;this.isShopOpen=!0,this.scene.uiManager&&this.scene.uiManager.hideNextWaveButton(),this.scene.cashManager&&(this.player.credits=this.scene.cashManager.getCurrentCash(),this.scene.isDev&&this.player.credits);const e=this.upgradeManager.generateUpgrades();this.scene.scene.launch("ShopMenu",{shopManager:this,upgradeOptions:e,gameScene:this.scene,player:this.player}),this.scene.scene.pause("WaveGame"),this.scene.isDev}handleReroll(){if(this.upgradeManager.rerollCount>=this.upgradeManager.maxRerollsPerRound)return uu.emit("shop-reroll-failed",{reason:"reroll-limit-reached"}),!1;const e=this.upgradeManager.getRerollCost();if(e>0&&this.player.credits<e)return uu.emit("shop-reroll-failed",{reason:"insufficient-funds"}),!1;e>0&&(this.player.credits-=e,this.scene.cashManager&&this.scene.cashManager.setCash(this.player.credits));const t=this.upgradeManager.reroll();return uu.emit("shop-rerolled",{newUpgrades:t,newRerollCost:this.upgradeManager.getRerollCost(),rerollsRemaining:this.upgradeManager.maxRerollsPerRound-this.upgradeManager.rerollCount}),this.scene.soundManager&&this.scene.soundManager.playSoundEffect("shop_upgrade",{volume:.06,detune:-100,rate:1.1}),!0}purchaseWeaponUpgrade(e){return this.player.credits<e.price?(uu.emit("shop-purchase-failed",{reason:"insufficient-funds"}),!1):(this.player.credits-=e.price,this.scene.cashManager&&this.scene.cashManager.setCash(this.player.credits),this.upgradeManager.applyWeaponUpgrade(e),uu.emit("shop-item-purchased",{itemType:"weapon",itemId:e.id,player:this.player,weapon:this.weapon}),this.scene.soundManager&&this.scene.soundManager.playSoundEffect("levelUp",{volume:.05}),!0)}purchasePlayerUpgrade(e){return this.player.skillPoints<e.skillPointCost?(uu.emit("shop-purchase-failed",{reason:"insufficient-skill-points"}),!1):(this.player.skillPoints-=e.skillPointCost,uu.emit("skill-points-updated",{skillPoints:this.player.skillPoints}),this.upgradeManager.applyPlayerUpgrade(e),uu.emit("shop-item-purchased",{itemType:"player",itemId:e.id,player:this.player}),this.scene.soundManager&&this.scene.soundManager.playSoundEffect("levelUp",{volume:.05}),!0)}onNextWaveStart(){this.isShopOpen=!1,this.upgradeManager.resetReroll(),this.scene.uiManager&&this.scene.uiManager.elements.nextWaveButtonBg&&(this.scene.uiManager.elements.nextWaveButtonBg.setVisible(!1),this.scene.uiManager.elements.nextWaveButtonText&&this.scene.uiManager.elements.nextWaveButtonText.setVisible(!1)),this.scene.waveManager&&this.scene.waveManager.startNextWave()}}class cd{constructor(e){this.scene=e,this.lastRegenTime=0,this.regenInterval=1e3,e.healthRegenSystem=this}update(e,t){if(!this.scene.player)return;const s=this.scene.playerHealth||this.scene.player.healthSystem;if(!s)return;const i=this.scene.player.healthRegen||0;if(!(i<=0)&&e-this.lastRegenTime>=this.regenInterval){this.lastRegenTime=e;const t=i*(this.regenInterval/1e3);s.heal(t),t>0&&this.scene.player.graphics&&Math.random()<.3&&this.showRegenEffect()}}showRegenEffect(){if(this.scene.player.graphics&&this.scene.add.particles){const e=this.scene.add.particles(this.scene.player.graphics.x,this.scene.player.graphics.y,"particle_texture",{speed:{min:20,max:50},scale:{start:.2,end:0},alpha:{start:.8,end:0},lifespan:800,blendMode:"ADD",quantity:2,tint:65280,frequency:200,emitting:!0});e.setDepth(100),this.scene.time.delayedCall(800,(()=>{e.destroy()}))}}}class ud{constructor(e){this.scene=e,this.createdAnimations=new Set}canCreateAnimation(e){return!this.scene.anims.exists(e)&&!this.createdAnimations.has(e)}createAnimation(e,t,s,i,a,n,r={}){if(!this.canCreateAnimation(e))return null;try{const o={frameRate:10,repeat:-1,yoyo:!1,hideOnComplete:!1,...r},l={key:e,frames:this.scene.anims.generateFrameNames(t,{prefix:s,suffix:i,start:a,end:n}),frameRate:o.frameRate,repeat:o.repeat,yoyo:o.yoyo,hideOnComplete:o.hideOnComplete},h=this.scene.anims.create(l);return h&&this.createdAnimations.add(e),h}catch(o){return console.error(`Failed to create animation: ${e}`,o),null}}createAnimationWithFrames(e,t,s,i={}){if(!this.canCreateAnimation(e))return null;try{const a={frameRate:10,repeat:0,yoyo:!1,hideOnComplete:!1,...i},n={key:e,frames:this.scene.anims.generateFrameNames(t,{frames:s}),frameRate:a.frameRate,repeat:a.repeat,yoyo:a.yoyo,hideOnComplete:a.hideOnComplete},r=this.scene.anims.create(n);return r&&this.createdAnimations.add(e),r}catch(a){return console.error(`Failed to create animation with frames: ${e}`,a),null}}createEnemyAnimations(e,t={}){const s={idle:{start:0,end:3,frameRate:8,repeat:-1},run:{start:0,end:3,frameRate:10,repeat:-1},death:{start:0,end:7,frameRate:12,repeat:0},shoot:{start:0,end:3,frameRate:12,repeat:0},attack:null,...t};for(const[i,a]of Object.entries(s)){if(!a)continue;const t=`${e}_${i}`;a.frames?this.createAnimationWithFrames(t,e,a.frames,{frameRate:a.frameRate,repeat:a.repeat}):this.createAnimation(t,e,`${e}_${i}_`,".png",a.start,a.end,{frameRate:a.frameRate,repeat:a.repeat})}}playAnimation(e,t,s=!1){return!(!e||!e.anims||!this.scene.anims.exists(t)||(s&&e.anims.currentAnim&&e.anims.currentAnim.key===t||e.play(t,s),0))}}class dd{constructor(e){this.scene=e,this.lastKillTime=0,this.timeSinceLastKill=0,e.killTimerManager=this,this.setupEventListeners()}setupEventListeners(){uu.on("enemy-killed",this.onEnemyKilled,this)}onEnemyKilled(e){this.lastKillTime=this.scene.time.now,this.timeSinceLastKill=0,uu.emit("kill-timer-updated",{lastKillTime:this.lastKillTime,timeSinceLastKill:this.timeSinceLastKill})}update(){this.lastKillTime>0&&(this.timeSinceLastKill=this.scene.time.now-this.lastKillTime)}getTimeSinceLastKill(){return this.timeSinceLastKill}getLastKillTime(){return this.lastKillTime}}class pd extends s.Scene{constructor(){super({key:"WaveGame"}),this.gameTime=0,this.enemyList=[],this.killCount=0,this.regularKillCount=0,this.bossesKilled=0,this.availableMaps=["level1","darkcave","level1redux"],this.isDev=!1,this.showHitboxes=!1,this.gridCellSize=100,this.spatialGrid={},this.gridCache=new Map,this.lastGridUpdate=0,this.gridUpdateInterval=100}init(e){this.startWave=e.startWave||0,this.musicFadedOut=e.musicFadedOut||!1,this.resetGameState()}resetGameState(){this.killCount=0,this.regularKillCount=0,this.bossesKilled=0,this.gameTime=0,this.survivalTime=0,this.enemyList=[],this.isPaused=!1,this.isGameOver=!1}create(){this.sound.stopAll(),this.setupMap(),this.setupSoundManager(),this.setupObjectManager(),this.setupGroupManager(),this.setupChaosManager(),this.setupGroupWeightManager(),this.setupUIManager(),this.setupGameObjects(),this.setupWaveManager(),this.setupCollectibleManager(),this.setupShopManager(),this.setupFactionBattleManager(),this.setupHealthRegenerationSystem(),this.setupInput(),this.killTimerManager=new dd(this),uu.emit("current-scene-ready",this)}setupSoundManager(){this.soundManager=new pu(this),this.soundManager.initBackgroundMusic("ambient_music",{volume:.04,loop:!0}),this.soundManager.initBackgroundMusic("shop_music",{volume:.04,loop:!0}),this.soundManager.initBackgroundMusic("action_music",{volume:.03,loop:!0}),this.soundManager.initSoundEffect("shoot_weapon",{volume:.05,rate:1}),this.soundManager.initSoundEffect("level_up",{volume:.07,rate:1}),this.soundManager.initSoundEffect("cash_pickup",{volume:.05,rate:1}),this.soundManager.initSoundEffect("player_hit",{volume:.06,rate:1}),this.soundManager.initSoundEffect("player_death",{volume:.07,rate:1}),this.soundManager.initSoundEffect("shop_upgrade",{volume:.06,rate:1.1,detune:-100}),this.soundManager.initSoundEffect("boss_alert",{volume:.08,rate:1}),this.soundManager.initSoundEffect("boss_defeat",{volume:.08,rate:1}),this.soundManager.initSoundEffect("explosion",{volume:.015,rate:1});for(let e=1;e<=7;e++)this.soundManager.initSoundEffect(`waveEnd${e}`,{volume:.07,rate:1});this.soundManager.playMusic("shop_music",{fadeIn:2e3})}setupObjectManager(){this.gameObjectManager=new zu(this),this.bullets=this.add.group(),this.enemies=this.add.group(),this.bulletPool=new Qu(this,{initialSize:50,maxSize:500,growSize:20}),this.enemyManager=new qu(this,{initialSize:20,maxSize:300,growSize:5}),this.spritePool=new nd(this,{initialSize:50,maxSize:300,growSize:20})}setupGroupManager(){this.groupManager=new td(this)}setupChaosManager(){this.chaosManager=new sd(this,{initialValue:yu.DEFAULT_VALUE,autoAdjust:!1})}setupGroupWeightManager(){this.groupWeightManager=new Xu(this),this.chaosManager&&this.chaosManager.setGroupWeightManager(this.groupWeightManager)}setupUIManager(){this.uiManager=new ed(this),this.uiManager.init({showDebug:this.isDev}),this.xpManager=new id(this),this.cashManager=new ad(this,0,1),uu.on("xp-updated",(e=>{this.uiManager&&this.uiManager.updateXPUI(e)})),uu.on("level-up",(e=>{this.uiManager&&this.uiManager.showLevelUpAnimation(e.level),this.soundManager&&this.soundManager.playSoundEffect("level_up",{volume:.07})})),uu.on("wave-completed",(()=>{this.soundManager&&(this.soundManager.playRandomWaveEndSound(),this.soundManager.playMusic("shop_music",{fadeIn:2e3,fadeOut:2e3}))})),uu.on("collectible-collected",(e=>{this.soundManager&&e&&"cash_pickup"===e.type&&this.soundManager.playSoundEffect("cash_pickup",{volume:.05,detune:100*Math.random()-50})})),uu.on("player-damaged",(()=>{this.soundManager&&this.soundManager.playSoundEffect("player_hit",{volume:.06,detune:100*Math.random()-50})})),uu.on("player-death",(()=>{this.soundManager&&this.soundManager.playSoundEffect("player_death",{volume:.07,detune:50*Math.random()-25})})),uu.on("shop-upgrade-click",(e=>{this.soundManager&&this.soundManager.playSoundEffect("shop_upgrade",{volume:.1*((null==e?void 0:e.volume)||.6),detune:((null==e?void 0:e.detune)||-100)+(50*Math.random()-25),rate:(null==e?void 0:e.rate)||1.1})})),uu.on("boss-spawned",(e=>{this.soundManager&&(this.soundManager.playSoundEffect("boss_alert",{volume:.08}),this.uiManager&&this.uiManager.showBossWarning&&this.uiManager.showBossWarning((null==e?void 0:e.bossType)||"boss1"))})),uu.on("boss-defeated",(e=>{this.soundManager&&(this.soundManager.playSoundEffect("boss_defeat",{volume:.08}),this.uiManager&&this.uiManager.showBossDefeatedMessage&&this.uiManager.showBossDefeatedMessage((null==e?void 0:e.bossType)||"boss1"))})),uu.on("wave-start",(()=>{}))}setupWaveManager(){const e=this.startWave;void 0!==this.startWave&&this.startWave>0?(this.waveManager=new Zu(this,{maxWaves:20,baseEnemyCount:50,enemyCountGrowth:1.33,maxEnemiesPerWave:1e4,bossWaveInterval:5}),this.waveManager.currentWave=e,this.waveManager.init(this.uiManager),this.uiManager&&this.uiManager.updateWaveUI(this.startWave,this.waveManager.maxWaves)):(this.waveManager=new Zu(this,{maxWaves:20,baseEnemyCount:50,enemyCountGrowth:1.36,maxEnemiesPerWave:1e4,bossWaveInterval:5}),this.waveManager.init(this.uiManager)),this.events.on("wave-start",this.onWaveStart,this),this.events.on("wave-completed",this.onWaveComplete,this),this.events.on("victory",this.onVictory,this),this.uiManager&&(this.uiManager.elements.waveBannerBg.setFillStyle(102,.8),this.uiManager.elements.waveBannerText.setText('Wave Mode\nClick "Start Next Wave" to begin!'),this.uiManager.elements.waveBannerBg.setVisible(!0),this.uiManager.elements.waveBannerText.setVisible(!0),this.tweens.add({targets:[this.uiManager.elements.waveBannerBg,this.uiManager.elements.waveBannerText],y:{from:.2*this.cameras.main.height,to:.3*this.cameras.main.height},alpha:{from:0,to:1},duration:800,ease:"Back.easeOut",onComplete:()=>{this.uiManager.showNextWaveButton(),this.time.delayedCall(3e3,(()=>{this.tweens.add({targets:[this.uiManager.elements.waveBannerBg,this.uiManager.elements.waveBannerText],y:.2*this.cameras.main.height,alpha:0,duration:800,ease:"Back.easeIn",onComplete:()=>{this.uiManager.elements.waveBannerBg.setVisible(!1),this.uiManager.elements.waveBannerText.setVisible(!1)}})}))}}))}setupPlayerCollisions(){if(this.mapManager&&this.mapManager.currentMapKey){const e=this.mapManager.maps.get(this.mapManager.currentMapKey);e&&e.collisionLayers?(this.mapManager.currentMapKey,e.collisionLayers.join(", "),e.collisionLayers.forEach((e=>{const t=this.mapManager.getLayer(e);if(t){const e=this.physics.add.collider(this.player.graphics,t,null,null,this);this.playerColliders||(this.playerColliders=[]),this.playerColliders.push(e)}else console.warn(`Layer not found: ${e}`)}))):console.warn("No collision layers defined for current map")}else console.warn("Map manager or current map key not available")}setupCamera(){this.cameras.main.setBounds(0,0,this.mapDimensions.width,this.mapDimensions.height),this.cameras.main.startFollow(this.player.graphics,!0,.09,.09),this.cameras.main.setZoom(.7)}setupGameObjects(){const e=this.mapDimensions.width/2,t=this.mapDimensions.height/2;this.player=new Uu(this,e,t),this.player.initWeaponSystem(),this.playerHealth=new Fu(this,{maxHealth:100,hitDamage:34,damageResistance:0}),this.createEnemyAnimations(),this.setupPlayerCollisions(),this.setupCamera()}createEnemyAnimations(){this.animationManager||(this.animationManager=new ud(this)),this.animationManager.createEnemyAnimations("enemy1",{idle:{start:0,end:3,frameRate:8,repeat:-1},run:{start:0,end:3,frameRate:10,repeat:-1},death:{frames:["enemy1_death_0.png","enemy1_death_1.png","enemy1_death_2.png","enemy1_death_3.png","enemy1_death_4.png","enemy1_death_5.png","enemy1_death_6.png","enemy1_death_7.png"],frameRate:10,repeat:0},shoot:{start:0,end:3,frameRate:12,repeat:0}}),this.animationManager.createEnemyAnimations("enemy2",{idle:{start:0,end:7,frameRate:8,repeat:-1},run:{start:0,end:3,frameRate:8,repeat:-1},death:{start:0,end:7,frameRate:12,repeat:0},shoot:{start:0,end:3,frameRate:12,repeat:0}}),this.animationManager.createAnimation("enemy2_activate","enemy2","enemy2_activate_",".png",0,4,{frameRate:10,repeat:0}),this.animationManager.createEnemyAnimations("enemy3",{idle:{start:0,end:2,frameRate:6,repeat:-1},run:{start:0,end:3,frameRate:10,repeat:-1},death:{start:0,end:7,frameRate:12,repeat:0},shoot:{start:0,end:3,frameRate:10,repeat:0}}),this.animationManager.createEnemyAnimations("boss1",{idle:{start:0,end:3,frameRate:6,repeat:-1},run:{start:0,end:5,frameRate:12,repeat:-1},death:{start:0,end:7,frameRate:8,repeat:0},shoot:{start:0,end:4,frameRate:14,repeat:0},attack:{start:0,end:5,frameRate:10,repeat:0}})}setupCollectibleManager(){this.collectibleManager=new rd(this,{xpCollectionRadius:40,cashCollectionRadius:40,healthCollectionRadius:30,collectionInterval:100}),this.xpManager&&this.collectibleManager.registerManager("xpManager",this.xpManager),this.cashManager&&this.collectibleManager.registerManager("cashManager",this.cashManager),this.isDev}setupShopManager(){const e={pick:e=>e[Math.floor(Math.random()*e.length)],range:(e,t)=>Math.floor(Math.random()*(t-e+1))+e},t={type:"Standard",damage:this.player.bulletDamage||10,fireRate:this.player.fireRate||.1,pierce:this.player.bulletPierce||1};this.shopManager=new hd(this,this.player,t,e),void 0===this.player.credits&&(this.player.credits=100,this.cashManager&&this.cashManager.setCash(this.player.credits)),this.isDev}setupFactionBattleManager(){this.factionBattleManager=new od(this,{chaosThreshold:40,requiredEnemiesPerFaction:3,detectionRadius:400,battleCheckInterval:1500,enabled:!0,isDev:this.isDev}),this.particles||(this.particles=this.add.particles("particle_texture")),this.factionBattleManager.initialize(),this.isDev&&this.input.keyboard.addKey("B").on("down",(()=>{if(this.factionBattleManager){const e=this.player.getPosition();this.factionBattleManager.forceBattle(e.x,e.y,800)}}))}setupHealthRegenerationSystem(){this.healthRegenSystem=new cd(this),this.player&&void 0===this.player.healthRegen&&(this.player.healthRegen=0),this.isDev}setupMap(){this.mapManager=new Ju(this,{scaleFactor:1.5,enablePhysics:!0}),this.mapManager.registerMaps([{key:"level1",tilemapKey:"map",tilesets:[{key:"level1",name:"level1"}],layers:[{name:"Tile Layer 1",tilesetKey:"level1",depth:0}]},{key:"level1redux",tilemapKey:"level1redux",tilesets:[{key:"tileset_x1",name:"tileset x1"},{key:"props_and_items_x1",name:"props and items x1"}],layers:[{name:"Floor",tilesetKey:"tileset_x1",depth:0},{name:"Walls",tilesetKey:"tileset_x1",depth:1},{name:"Wall Decals",tilesetKey:"tileset_x1",depth:2},{name:"Props1",tilesetKey:"props_and_items_x1",depth:15},{name:"Props",tilesetKey:"props_and_items_x1",depth:25}],collisionLayers:["Walls","Props","Props1"],options:{scaleFactor:1.2}},{key:"darkcave",tilemapKey:"darkcavemap",tilesets:[{key:"darkcavenet",name:"DarkNetCaveSet"}],layers:[{name:"Ground",tilesetKey:"darkcavenet",depth:0},{name:"Walls",tilesetKey:"darkcavenet",depth:1},{name:"Spawner",tilesetKey:"darkcavenet",depth:0,visible:!0}],collisionLayers:["Walls"],options:{scaleFactor:1.4}}]),this.mapManager.loadMap("level1redux"),this.groundLayer=this.mapManager.getLayer("Floor"),this.mapDimensions=this.mapManager.getMapDimensions(),this.isDev&&(this.mapManager.currentMapKey,this.mapDimensions.width,this.mapDimensions.height)}setupInput(){this.input.on("pointermove",(e=>{this.mouseX=e.worldX,this.mouseY=e.worldY})),this.input.on("pointerdown",(()=>{this.isMouseDown=!0})),this.input.on("pointerup",(()=>{this.isMouseDown=!1})),this.wasd={up:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),down:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),left:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),right:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D)},this.pauseKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.dashKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),this.shieldKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),this.volumeDownKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.NINE),this.volumeUpKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ZERO),this.isDev&&(this.input.keyboard.addKey("V").on("down",(()=>{this.waveManager&&this.waveManager.verifyEnemyCount()})),this.input.keyboard.addKey("F").on("down",(()=>{this.waveManager&&this.waveManager.isWaveActive&&this.waveManager.completeWave()})),this.input.keyboard.addKey("C").on("down",(()=>{this.enemyManager&&(this.enemyManager.enemies.length,this.enemyManager.enemies.forEach(((e,t)=>{e.type,e.groupId,e.active,e.graphics&&(e.graphics.x,e.graphics.y)})))})),this.input.keyboard.addKey("U").on("down",(()=>{this.showHitboxes=!this.showHitboxes,this.enemies.getChildren().forEach((e=>{e.graphics&&e.graphics.setStrokeStyle(this.showHitboxes?1:0,16711680)})),this.showHitboxes})),this.input.keyboard.addKey("X").on("down",(()=>{this.player&&(this.player.dashCooldownEvent&&!this.player.dashCooldownEvent.hasDispatched&&(this.player.dashCooldownEvent.remove(),this.player.dashCooldownEvent=null),this.player.shieldCooldownEvent&&!this.player.shieldCooldownEvent.hasDispatched&&(this.player.shieldCooldownEvent.remove(),this.player.shieldCooldownEvent=null),this.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Cooldowns reset!",65280))})),this.input.keyboard.addKey("Z").on("down",(()=>{this.player&&(this.player.hasDash=!0,this.player.dashPower=1.5,this.player.dashCooldown=1e4,this.player.hasShield=!0,this.player.shieldDuration=3e3,this.player.shieldCooldown=3e4,this.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Dash (Q) and Shield (E) abilities unlocked!",65280))})))}onWaveStart(e){this.isDev&&(e.wave,e.isBossWave),this.soundManager&&this.playActionMusicWithSpecialFade()}playActionMusicWithSpecialFade(){this.soundManager.musicTracks.action_music?this.soundManager.currentMusic?this.tweens.add({targets:this.soundManager.currentMusic,volume:0,duration:1e3,onComplete:()=>{this.soundManager.currentMusic.stop(),this.soundManager.currentMusic=this.soundManager.musicTracks.action_music,this.soundManager.currentMusic.volume=0,this.soundManager.currentMusic.play(),this.tweens.add({targets:this.soundManager.currentMusic,volume:.05,duration:3e3,ease:"Linear"})}}):(this.soundManager.currentMusic=this.soundManager.musicTracks.action_music,this.soundManager.currentMusic.volume=0,this.soundManager.currentMusic.play(),this.tweens.add({targets:this.soundManager.currentMusic,volume:.05,duration:3e3,ease:"Linear"})):console.warn("Action music track not found")}onWaveComplete(e){this.isDev&&(e.wave,e.isLastWave),this.soundManager&&this.soundManager.playRandomWaveEndSound()}onVictory(){this.isDev,this.uiManager.showVictoryUI(),this.isGameOver=!0}setPauseState(e,t="toggle"){var s,i;this.isPaused=e,null==(s=this.uiManager.elements.pauseOverlay)||s.setVisible(e&&"toggle"===t),null==(i=this.uiManager.elements.pauseText)||i.setVisible(e&&"toggle"===t),this.waveManager&&this.waveManager.isInPausePhase()||(e?(this.physics.pause(),this.soundManager&&this.soundManager.pauseMusic()):(this.physics.resume(),this.soundManager&&this.soundManager.resumeMusic()))}togglePause(){this.isGameOver||this.setPauseState(!this.isPaused,"toggle")}handleVolumeControls(){if(!this.soundManager)return;let e=!1,t=this.soundManager.musicVolume;Phaser.Input.Keyboard.JustDown(this.volumeDownKey)&&(t=Math.max(0,t-.01),e=!0),Phaser.Input.Keyboard.JustDown(this.volumeUpKey)&&(t=Math.min(.1,t+.01),e=!0),e&&(this.soundManager.setMusicVolume(t),this.soundManager.setEffectsVolume(t),this.showVolumeIndicator(t))}showVolumeIndicator(e){this.volumeIndicator&&this.volumeIndicator.destroy();const t=Math.round(100*e),s=this.cameras.main,i=s.width,a=s.height;this.volumeIndicator=this.add.container(s.scrollX+i/2,s.scrollY+a-50).setDepth(200);const n=this.add.rectangle(0,0,200,40,0,.7).setOrigin(.5),r=this.add.text(0,0,`Volume: ${t}%`,{fontFamily:"Arial",fontSize:18,color:"#ffffff"}).setOrigin(.5);this.volumeIndicator.add([n,r]),this.time.delayedCall(1500,(()=>{this.volumeIndicator&&(this.volumeIndicator.destroy(),this.volumeIndicator=null)}))}update(e,t){Phaser.Input.Keyboard.JustDown(this.pauseKey)&&this.togglePause(),this.handleVolumeControls(),this.isPaused||this.isGameOver||(this.updateGameTimers(t),this.updateGameObjects(),this.waveManager&&this.waveManager.update(),this.uiManager&&this.uiManager.update(),this.collectibleManager&&this.collectibleManager.update(),this.healthRegenSystem&&this.healthRegenSystem.update(e,t),this.factionBattleManager&&this.factionBattleManager.update(e,t),this.checkCollisions(),this.isDev&&this.showHitboxes&&this.drawHitboxes())}updateGameTimers(e){this.gameTime+=e,this.survivalTime+=e/1e3}updateGameObjects(){if(this.player.update(),this.isMouseDown&&this.player.shoot(),Phaser.Input.Keyboard.JustDown(this.dashKey))if(this.player.hasDash){if(this.player.activateDash()){this.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Dash Activated!",65535);const e=Math.ceil(this.player.dashCooldown/1e3);this.showFloatingText(this.player.graphics.x,this.player.graphics.y-20,`Cooldown: ${e}s`,16755200)}}else this.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Dash ability not unlocked",16755200);if(Phaser.Input.Keyboard.JustDown(this.shieldKey))if(this.player.hasShield){if(this.player.activateShield()){this.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Shield Activated!",43775);const e=Math.ceil(this.player.shieldCooldown/1e3);this.showFloatingText(this.player.graphics.x,this.player.graphics.y-20,`Cooldown: ${e}s`,16755200)}}else this.showFloatingText(this.player.graphics.x,this.player.graphics.y-40,"Shield ability not unlocked",16755200);this.cashManager&&this.cashManager.updateCashAnimationPosition(),this.updateBullets(),this.enemyManager&&this.enemyManager.update()}updateBullets(){this.bulletPool.updateBullets(null,(e=>{const t=this.player.getPosition(),s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)>(e.range||(this.player.weaponManager?this.player.weaponManager.bulletRange:1e3))||e.lifetime>3e3}))}checkCollisions(){this.checkBulletEnemyCollisions(),this.checkPlayerEnemyCollisions()}checkBulletEnemyCollisions(){this.updateSpatialGrid(),this.bullets.getChildren().forEach((e=>{if(!e.active)return;const t=Math.floor(e.x/this.gridCellSize),s=Math.floor(e.y/this.gridCellSize);for(let i=t-1;i<=t+1;i++)for(let t=s-1;t<=s+1;t++){const s=`${i},${t}`;(this.spatialGrid[s]||[]).forEach((t=>{if(!t.active||!e.active)return;const s=Phaser.Math.Distance.Between(e.x,e.y,t.x,t.y),i=t.parentEnemy?t.parentEnemy.size/2:12,a=e.radius||this.player.caliber||5,n=e.damage||(this.player.weaponManager?this.player.weaponManager.getDamage():this.player.bulletDamage||10);if(s<a+i){let s=n;e.canCrit&&e.critMultiplier&&(s*=e.critMultiplier,this.createCriticalHitEffect(t.x,t.y,s)),t.parentEnemy&&"function"==typeof t.parentEnemy.takeDamage&&(t.parentEnemy.takeDamage(s),e.aoeRadius&&e.aoeDamage&&this.createExplosion(e.x,e.y,e.aoeRadius,e.damage*e.aoeDamage)),e.aoeRadius&&e.aoeDamage?(e.health=0,e.pierce=0):void 0!==e.pierce?(e.pierce-=.5,e.pierce>0&&e.penetratedEnemies&&e.penetratedEnemies.push(t.parentEnemy.id)):void 0!==e.health&&e.health--;const i=e.fillColor||16777215;if(e.fillColor=16777215,t.parentEnemy&&t.parentEnemy.factionTint){const e=t.parentEnemy.factionTint,s=16777215;t.setTint&&t.setTint(s),this.time.delayedCall(50,(()=>{t&&t.active&&t.setTint&&t.setTint(e)}))}this.time.delayedCall(50,(()=>{e&&e.active&&(e.fillColor=i)})),(void 0!==e.pierce&&e.pierce<=0||void 0!==e.health&&e.health<=0)&&this.bulletPool.releaseBullet(e)}}))}}))}checkPlayerEnemyCollisions(){if(!this.player||!this.playerHealth)return;if(this.playerHealth.getInvulnerable())return;if(this.player.isShieldActive)return void this.repelEnemiesFromShield();const e=this.enemyManager?this.enemyManager.enemies:[];for(const t of e)if(t&&t.active&&t.graphics&&t.graphics.active&&Phaser.Geom.Intersects.CircleToCircle(new Phaser.Geom.Circle(this.player.graphics.x,this.player.graphics.y+20,this.player.radius),new Phaser.Geom.Circle(t.graphics.x,t.graphics.y,t.size/2))){const e=t.damage;if(1==this.playerHealth.takeDamage(e))return;const s=Phaser.Math.Angle.Between(t.graphics.x,t.graphics.y,this.player.graphics.x,this.player.graphics.y),i=30*Math.cos(s),a=30*Math.sin(s);this.player.velX=.2*i,this.player.velY=.2*a,this.player.graphics.body.setVelocity(this.player.velX,this.player.velY);break}}repelEnemiesFromShield(){if(!this.player||!this.player.isShieldActive)return;const e=this.enemyManager?this.enemyManager.enemies:[],t=2.5*this.player.radius;for(const s of e){if(!(s&&s.active&&s.graphics&&s.graphics.active))continue;const e=s.graphics.x-this.player.graphics.x,i=s.graphics.y-this.player.graphics.y,a=Math.sqrt(e*e+i*i);if(a<t+s.size/2){const n=Math.atan2(i,e),r=5*(1-a/(t+s.size/2)),o=Math.cos(n)*r,l=Math.sin(n)*r;s.graphics.body?(s.graphics.body.setVelocity(150*o,150*l),this.time.delayedCall(300,(()=>{s&&s.active&&s.graphics&&s.graphics.body&&(s.graphics.body.setVelocity(.5*s.graphics.body.velocity.x,.5*s.graphics.body.velocity.y),"function"==typeof s.resetTarget&&s.resetTarget())}))):(s.graphics.x+=5*o,s.graphics.y+=5*l,"function"==typeof s.resetTarget&&s.resetTarget()),"function"==typeof s.takeDamage&&s.takeDamage(1),this.createShieldImpactEffect(s.graphics.x,s.graphics.y),this.createShieldRepulsionEffect(this.player.graphics.x+Math.cos(n)*t,this.player.graphics.y+Math.sin(n)*t)}}}createShieldRepulsionEffect(e,t){if(Math.random()<.3){const s=this.add.circle(e,t,Phaser.Math.Between(1,3),65535,.4);s.setDepth(fu.PLAYER+5),this.tweens.add({targets:s,alpha:0,scale:2,duration:200,ease:"Power2",onComplete:()=>{s.destroy()}})}}createShieldImpactEffect(e,t){const s=this.add.circle(e,t,15,65535,.4);s.setDepth(fu.PLAYER+10),this.tweens.add({targets:s,alpha:0,scale:3,duration:300,ease:"Power2",onComplete:()=>{s.destroy()}});for(let i=0;i<8;i++){const s=i/8*Math.PI*2,a=Phaser.Math.Between(5,15),n=this.add.circle(e+Math.cos(s)*a,t+Math.sin(s)*a,Phaser.Math.Between(2,4),65535,.7);n.setDepth(fu.PLAYER+5),this.tweens.add({targets:n,x:e+Math.cos(s)*Phaser.Math.Between(30,50),y:t+Math.sin(s)*Phaser.Math.Between(30,50),alpha:0,scale:0,duration:Phaser.Math.Between(200,400),ease:"Power2",onComplete:()=>{n.destroy()}})}if(this.soundManager){const e=this.soundManager.hasSound("shield_impact")?"shield_impact":"laserShoot";this.soundManager.playSoundEffect(e,{detune:Phaser.Math.Between(200,600),volume:.3})}}updateSpatialGrid(){const e=this.time.now;e-this.lastGridUpdate<this.gridUpdateInterval||(this.spatialGrid={},this.enemies.getChildren().forEach((e=>{const t=`${Math.floor(e.x/this.gridCellSize)},${Math.floor(e.y/this.gridCellSize)}`;this.spatialGrid[t]||(this.spatialGrid[t]=[]),this.spatialGrid[t].push(e)})),this.lastGridUpdate=e)}playerDeath(){this.isGameOver||(this.isGameOver=!0,this.waveManager&&(this.waveManager.isPaused=!0,this.waveManager.isWaveActive=!1,this.waveManager.spawnTimer&&(this.waveManager.spawnTimer.destroy(),this.waveManager.spawnTimer=null)),this.soundManager&&this.soundManager.stopMusic(1e3),this.uiManager&&this.time.delayedCall(1500,(()=>{this.uiManager.showGameOverUI()})))}onEnemyKilled(e,t,s,i,a){if(a&&a.killCounted)this.isDev;else{if(a&&(a.killCounted=!0),this.isDev,this.killCount++,this.uiManager&&this.uiManager.updateScoreUI(this.killCount),this.xpManager){const a=this.findEnemyByPosition(t,s,i),n=a&&a.scoreValue?a.scoreValue*(this.xpMultiplier||1):e?500:100;if(this.xpManager.addXP(n),this.soundManager){const e=this.soundManager.soundEffects&&this.soundManager.soundEffects.xp_collect?"xp_collect":"shoot_weapon";this.soundManager.playSoundEffect(e,{detune:1200,volume:.3})}}if(e?(this.bossesKilled++,void 0!==t&&void 0!==s&&this.createBossDeathEffect(t,s),uu.emit("boss-defeated",{bossType:i,x:t,y:s,enemy:a})):this.regularKillCount++,this.chaosManager){const e=this.findEnemyByPosition(t,s,i);if(e&&e.groupId)this.chaosManager.registerKill(e.groupId);else{const e=Math.random()>.5?"ai":"coder";this.chaosManager.registerKill(e)}}this.waveManager&&(this.waveManager.onEnemyKilled(e,i),this.waveManager.verifyEnemyCount())}}findEnemyByPosition(e,t,s){if(!this.enemyManager||!this.enemyManager.enemies)return null;for(const i of this.enemyManager.enemies)if(i&&i.graphics&&Math.abs(i.graphics.x-e)<=5&&Math.abs(i.graphics.y-t)<=5)return i;return null}createEnemyDeathEffect(e,t){const s=this.add.particles(e,t,"particle_texture",{speed:{min:50,max:200},scale:{start:.15,end:0},alpha:{start:1,end:0},lifespan:100,blendMode:"ADD",quantity:5,angle:{min:0,max:360}});s.setDepth(250),this.time.delayedCall(1e3,(()=>{s.destroy()}))}createBossDeathEffect(e,t){for(let s=0;s<2;s++)this.time.delayedCall(100*s,(()=>{const s=Phaser.Math.Between(-30,30),i=Phaser.Math.Between(-30,30),a=this.add.particles(e+s,t+i,"particle_texture",{speed:{min:20,max:50},scale:{start:.4,end:0},alpha:{start:1,end:0},lifespan:150,blendMode:"ADD",quantity:10,angle:{min:0,max:360}});a.setDepth(200),this.time.delayedCall(300,(()=>{a.destroy()}))}))}createExplosion(e,t,s,i){if(!this.enemyManager)return;this.createExplosionVisual(e,t,s),this.soundManager&&this.soundManager.playSoundEffect("explosion",{volume:.15,detune:Phaser.Math.Between(-300,300)});const a=this.enemyManager.enemies;if(!a||0===a.length)return;if(this.isDev){const i=this.add.circle(e,t,s,16711680,.2);i.setStrokeStyle(2,16711680,.8),i.setDepth(fu.BULLETS+20),this.time.delayedCall(300,(()=>{i.destroy()}))}let n=0;for(const r of a){if(!(r&&r.active&&r.graphics&&r.graphics.active))continue;const a=r.graphics.x-e,o=r.graphics.y-t,l=Math.sqrt(a*a+o*o);if(l<=s){const e=1-l/s,t=Math.max(1,Math.floor(i*e));"function"==typeof r.takeDamage&&(r.takeDamage(t),n++,this.createExplosionHitEffect(r.graphics.x,r.graphics.y))}}this.isDev&&n>0&&(Math.floor(e),Math.floor(t))}createExplosionVisual(e,t,s){const i=this.add.circle(e,t,s,16755200,.4);i.setStrokeStyle(3,16737792,.7),i.setDepth(fu.BULLETS-1);const a=this.add.circle(e,t,.5*s,16776960,.7);a.setDepth(fu.BULLETS),this.tweens.add({targets:i,alpha:0,scale:1.3,duration:400,ease:"Power2",onComplete:()=>{i.destroy()}}),this.tweens.add({targets:a,alpha:0,scale:1.8,duration:300,ease:"Power2",onComplete:()=>{a.destroy()}});const n=this.add.particles(e,t,"particle_texture",{speed:{min:50,max:250},scale:{start:.5,end:0},alpha:{start:1,end:0},lifespan:500,blendMode:"ADD",quantity:30,tint:[16776960,16737792,16729088],angle:{min:0,max:360}}),r=this.add.circle(e,t,5,16777215,.7);r.setDepth(fu.BULLETS+5),this.tweens.add({targets:r,radius:1.2*s,alpha:0,duration:300,ease:"Cubic.Out",onComplete:()=>{r.destroy()}}),n.setDepth(fu.BULLETS+10),this.time.delayedCall(600,(()=>{n.destroy()}))}createExplosionHitEffect(e,t){const s=this.add.circle(e,t,10,16777215,.8);s.setDepth(fu.BULLETS+15),this.tweens.add({targets:s,alpha:0,scale:1.5,duration:150,ease:"Power2",onComplete:()=>{s.destroy()}});const i=this.add.particles(e,t,"particle_texture",{speed:{min:30,max:100},scale:{start:.3,end:0},alpha:{start:.9,end:0},lifespan:250,blendMode:"ADD",quantity:8,tint:[16737792,16746496],angle:{min:0,max:360}});if(i.setDepth(fu.BULLETS+5),this.time.delayedCall(300,(()=>{i.destroy()})),Math.random()<.3){const s=this.add.text(e+Phaser.Math.Between(-10,10),t-15,"!",{fontFamily:"Arial",fontSize:"16px",fontStyle:"bold",color:"#ff8800",stroke:"#000000",strokeThickness:2});s.setOrigin(.5),s.setDepth(fu.BULLETS+20),this.tweens.add({targets:s,y:t-30,alpha:0,scale:1.2,duration:300,ease:"Power1",onComplete:()=>{s.destroy()}})}}createCriticalHitEffect(e,t,s){const i=this.add.text(e,t-20,`CRIT! ${Math.floor(s)}`,{fontFamily:"Arial",fontSize:"18px",fontStyle:"bold",color:"#ff0000",stroke:"#000000",strokeThickness:3,align:"center"});i.setDepth(150),this.tweens.add({targets:i,y:t-50,alpha:0,scale:1.5,duration:800,ease:"Power2",onComplete:()=>{i.destroy()}});const a=this.add.particles(e,t,"particle_texture",{speed:{min:40,max:120},scale:{start:.18,end:0},alpha:{start:1,end:0},lifespan:150,blendMode:"ADD",quantity:4,tint:16711680,angle:{min:0,max:360}});a.setDepth(100),this.time.delayedCall(150,(()=>{a.destroy()}))}showFloatingText(e,t,s,i=16777215){if(isNaN(e)||isNaN(t))return void console.warn("Invalid coordinates for floating text:",e,t);const a="number"==typeof i?`#${i.toString(16).padStart(6,"0")}`:i,n=this.add.text(e,t,s,{fontFamily:"Arial",fontSize:16,color:a,stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5);n.setDepth(fu.UI+50),this.tweens.add({targets:n,y:t-50,alpha:0,scale:1.2,duration:1500,ease:"Power2",onComplete:()=>{n.destroy()}}),this.isDev}shutdown(){uu.off("xp-updated"),uu.off("level-up"),uu.off("wave-completed"),uu.off("collectible-collected"),uu.off("player-damaged"),uu.off("player-death"),uu.off("wave-start"),uu.off("shop-upgrade-click"),uu.off("boss-spawned"),uu.off("boss-defeated"),this.player&&this.player.destroy&&this.player.destroy(),this.particles&&this.particles.destroy(),super.shutdown()}drawHitboxes(){this.hitboxGraphics||(this.hitboxGraphics=this.add.graphics(),this.hitboxGraphics.setDepth(1e3)),this.hitboxGraphics.clear();this.enemyManager&&this.enemyManager.enemies&&this.enemyManager.enemies.forEach((e=>{if(e&&e.active&&e.graphics&&e.graphics.active){this.hitboxGraphics.lineStyle(1,16711680,.8),this.hitboxGraphics.strokeCircle(e.graphics.x,e.graphics.y,e.size/2);const t=3;this.hitboxGraphics.lineBetween(e.graphics.x-t,e.graphics.y,e.graphics.x+t,e.graphics.y),this.hitboxGraphics.lineBetween(e.graphics.x,e.graphics.y-t,e.graphics.x,e.graphics.y+t)}})),this.bullets&&this.bullets.getChildren().forEach((e=>{if(e&&e.active){this.hitboxGraphics.lineStyle(1,65280,.8);const t=e.radius||this.player.caliber||5;this.hitboxGraphics.strokeCircle(e.x,e.y,t)}}))}}class fd extends s.Scene{constructor(){super("PreSpawn"),this.LORE_POPUP_DEPTH={BACKDROP:2e3,WINDOW:2001,CONTENT:2002}}init(e){this.startWave=e.startWave||0,this.debugMode=void 0!==e.debug&&e.debug,this.isLorePopupActive=!1}create(){this.add.image(512,384,"intro_card").setAlpha(.7),this.add.rectangle(512,384,1024,768,0,.6).setOrigin(.5).setDepth(fu.UI_BACKGROUND),this.add.text(512,120,"GAME INSTRUCTIONS",{fontFamily:"Arial Black",fontSize:48,color:"#ffffff",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setDepth(fu.UI_TEXT),["MOVEMENT: Use WASD keys to move your character","SPECIAL: Use Q or E to use special abilities (Unlockable)","AIM & SHOOT: Use mouse to aim in any direction, and Left Click to fire your weapon","COLLECT: Automatically gather XP and pickup cash or health from defeated enemies","UPGRADE: Use cash to purchase upgrades between waves","PAUSE: Spacebar to pause the game","VOLUME: 9 and 0 keys to adjust volume","","SURVIVE and defeat ALL WAVES to win!"].forEach(((e,t)=>{this.add.text(512,220+40*t,e,{fontFamily:"Arial",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setDepth(fu.UI_TEXT)}));const e=this.add.rectangle(512,650,300,70,3786347).setOrigin(.5).setStrokeStyle(4,16777215).setInteractive().setDepth(fu.UI_ELEMENTS);this.add.text(512,650,"START GAME",{fontFamily:"Arial Black",fontSize:28,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5).setDepth(fu.UI_TEXT+1),e.on("pointerover",(()=>{e.fillColor=5101184,this.scale.canvas.style.cursor="pointer"})),e.on("pointerout",(()=>{e.fillColor=3786347,this.scale.canvas.style.cursor="default"})),e.on("pointerdown",(()=>{this.startGame()}));const t=this.add.rectangle(512,730,200,50,6710886).setOrigin(.5).setStrokeStyle(2,16777215).setInteractive().setDepth(fu.UI_ELEMENTS);this.add.text(512,730,"BACK TO MENU",{fontFamily:"Arial",fontSize:20,color:"#ffffff",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setDepth(fu.UI_TEXT+1),t.on("pointerover",(()=>{t.fillColor=8947848,this.scale.canvas.style.cursor="pointer"})),t.on("pointerout",(()=>{t.fillColor=6710886,this.scale.canvas.style.cursor="default"})),t.on("pointerdown",(()=>{this.backToMainMenu()})),this.createLoreButton(),this.setupSoundManager(),uu.emit("current-scene-ready",this)}createLoreButton(){const e=this.add.rectangle(120,700,180,60,9127187).setOrigin(.5).setStrokeStyle(3,16766720).setInteractive().setDepth(fu.UI_ELEMENTS);this.add.text(120,700,"GAME LORE",{fontFamily:"Arial Black",fontSize:22,color:"#FFD700",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setDepth(fu.UI_TEXT+1),e.on("pointerover",(()=>{e.fillColor=10506797,this.scale.canvas.style.cursor="pointer"})),e.on("pointerout",(()=>{e.fillColor=9127187,this.scale.canvas.style.cursor="default"})),e.on("pointerdown",(()=>{this.isLorePopupActive||(this.soundManager&&this.soundManager.playSoundEffect("button_click"),this.showLorePopup())}))}showLorePopup(){this.isLorePopupActive=!0;const e=this.add.container(512,384).setDepth(this.LORE_POPUP_DEPTH.CONTENT),t=this.add.rectangle(0,0,1024,768,0,.8).setOrigin(.5).setInteractive().setDepth(this.LORE_POPUP_DEPTH.BACKDROP),s=this.add.rectangle(0,0,800,600,2236962,.95).setOrigin(.5).setStrokeStyle(4,16766720).setDepth(this.LORE_POPUP_DEPTH.WINDOW),i=this.add.text(0,-250,"EQUILIBRIUM PROTOCOL",{fontFamily:"Arial Black",fontSize:32,color:"#FFD700",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5).setDepth(this.LORE_POPUP_DEPTH.CONTENT),a=400,n=this.make.graphics();n.fillRect(162,184,700,a);const r=new Phaser.Display.Masks.GeometryMask(this,n),o=this.make.text({x:-350,y:-200,text:this.getLoreContent(),style:{fontFamily:"Arial",fontSize:22,color:"#ffffff",wordWrap:{width:700},lineSpacing:12}}).setOrigin(0).setDepth(this.LORE_POPUP_DEPTH.CONTENT);o.setMask(r);const l=this.add.rectangle(350,-250,60,40,11141120).setOrigin(.5).setStrokeStyle(2,16777215).setInteractive().setDepth(this.LORE_POPUP_DEPTH.CONTENT),h=this.add.text(350,-250,"X",{fontFamily:"Arial Black",fontSize:24,color:"#ffffff"}).setOrigin(.5).setDepth(this.LORE_POPUP_DEPTH.CONTENT);l.on("pointerover",(()=>{l.fillColor=13369344,this.scale.canvas.style.cursor="pointer"})),l.on("pointerout",(()=>{l.fillColor=11141120,this.scale.canvas.style.cursor="default"}));const c=this.add.rectangle(370,0,16,a,6710886).setOrigin(.5).setDepth(this.LORE_POPUP_DEPTH.CONTENT),u=o.height,d=Math.min(a/u,1),p=Math.max(d*a,40),f=this.add.rectangle(370,p/2-200,12,p,16777215).setOrigin(.5).setInteractive({draggable:!0}).setDepth(this.LORE_POPUP_DEPTH.CONTENT),m=u-a,g=a-p;let y=0;const v=e=>{y=Phaser.Math.Clamp(e,0,m),o.y=-200-y;const t=p/2-200+(m>0?y/m:0)*g;f.y=t};v(0),this.input.on("wheel",((e,t,s,i)=>{this.isLorePopupActive&&v(y+.4*i)})),f.on("drag",((e,t,s)=>{const i=p/2-200,a=200-p/2,n=Phaser.Math.Clamp(s,i,a);v((n-i)/g*m)})),c.setInteractive(),c.on("pointerdown",(t=>{const s=t.y-e.y-c.y;v((s+200)/a*m)})),l.on("pointerdown",(()=>{this.soundManager&&this.soundManager.playSoundEffect("button_click"),this.input.off("wheel"),e.destroy(),this.isLorePopupActive=!1})),e.add([t,s,i,o,l,h,c,f])}getLoreContent(){return"\n=== THE STORY OF EQUILIBRIUM PROTOCOL ===\n\nIn the near future, the world's code repositories grew so vast and vital that they formed the digital lifeblood of society.\nTo manage this chaos, two factions emerged:\n\n   The AI Collectives  self-evolving artificial intelligences, optimized for pure efficiency and control.\n\n   The Coder Guilds  rebellious human programmers, determined to preserve creativity, freedom, and chaos.\n\nWhen balance between these forces was lost, catastrophic instability followed. Systems crashed. Cities fell into darkness.\n\nYou are the First Sentient, humanitys last experiment: a hybrid of human intuition and machine precision \nderived from the desperation of one Master Coder tasked with saving the world.\nPlaced delicatley at the heart of the global network, you are the only hope to restore balance.\nYour sole purpose is to maintain the Equilibrium Protocol.\n\n=== THE FACTIONS ===\n\n   AI Collectives  Enforce order through machine logic and domination.\n\n   Coder Guilds  Inject chaos and creativity back into the system.\n\nBoth sides are necessary  but too much power in either direction will collapse the system.\n\n=== CORE GAMEPLAY MECHANICS ===\n\nChaos Meter (Balance System)\n\nThe Chaos Meter is the heartbeat of Equilibrium Protocol.\nEvery kill you make tips the world closer to Coder dominance or AI control  and with it, the battlefield changes in real time.\n\nCore Mechanics\n- Meter Range: -100 (AI dominance) to +100 (Coder dominance)\n- Default: 0 (Perfect Balance)\n- Kill Impact:\n  - Each enemy kill shifts the meter by 1 point, but your impact can grow dramatically through Momentum.\n\nMomentum System\n- Each consecutive kill builds Momentum, increasing your chaos impact by up to 4.9x.\n- Momentum naturally decays over time (about 4% loss per update), so staying aggressive is key.\n- High Momentum lets you rapidly shift the Chaos Meter, but comes with greater risks.\n\nFaction Power Scaling\nAs Chaos tilts toward one side:\n- The dominant faction (whichever side has the advantage) becomes significantly stronger.\n- Enemies gain increased HP, damage, fire rate, and dodge ability  scaling non-linearly with chaos level.\n\nExample maximum buffs at 100 Chaos:\n  - HP: ~2.4x\n  - Damage: ~2.6x\n  - Fire Rate: ~2.3x\n  - Dodge: ~2.7x\n\nDynamic Spawn Adjustments\n- As one side gains dominance, the other side starts spawning more frequently.\n- For example:\n  - If Coders dominate, more AI enemies will spawn to push back.\n  - If AI dominates, more Coders emerge to resist.\n\nThis self-balancing system keeps fights dynamic and unpredictable.\n\nExtreme Value Protection\n- If the meter hits 100, a cooldown starts.\n- After cooldown, the Chaos Meter resets to 25% of the extreme value.\n- This prevents one faction from permanently taking over.\n\nIn Summary:\n- Stay balanced: Favor neither side too heavily, or prepare for chaos.\n- Master momentum: Chain kills to control the battlefield.\n- Adapt: Expect the world to push back if you push too far.\n\nYour choices shape the war.\nStay balanced  or survive the consequences.\n\n=== UPGRADE SYSTEM ===\n\nEarn skill points by defeating enemies, collecting XP and leveling up.\n\nUpgrades include:\n   Weapon Enhancements  stronger bullets, faster fire rates.\n   Defensive Upgrades  shields, speed boosts, dodge improvements.\n   Drones, Explosives, Homing ammo and more!\n\nCustomize your Sentient to fit your strategy  aggressive, defensive, or perfectly balanced..\n\n=== DRONE SYSTEM ===\n\nDrones are your essential battlefield companions.\nAs you progress, you unlock deployable combat drones that hover around you and shoot wherever you shoot.\n\n   Up to 5 drones can orbit and fire automatically.\n   Drones share your upgrades and scale with you.\n   They provide crucial extra firepower in chaotic fights.\n\nDeploy and upgrade wisely  drones are your lifeline.\n\n=== FACTION BATTLES ===\n\nMajor battles erupt as AI and Coders clash for dominance.\n\n   Both sides fight each other  and you.\n   Imbalance can cause one faction to overwhelm the battlefield.\n\nThese dynamic battles are shaped by the current state of the Chaos Meter:\n- Favoring one faction too heavily will make them a dominant threat.\n- Maintaining balance will keep both sides in check  but at the cost of constant tension.\n\nStrategic intervention in these battles is critical. \nChoose carefully: destroy the wrong side too quickly, and the world could collapse into unstoppable chaos.\n\n=== MAINTAIN THE BALANCE. SURVIVE THE CHAOS. FULFILL THE PROTOCOL. ===\n\n"}setupSoundManager(){this.soundManager=new pu(this),this.soundManager.initBackgroundMusic("menu_music",{volume:.04,loop:!0}),this.soundManager.initSoundEffect("button_click",{volume:.06,rate:1})}startGame(){this.soundManager&&this.soundManager.playSoundEffect("button_click"),this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",(()=>{this.sound.stopAll(),this.scene.start("WaveGame",{startWave:this.startWave||0,debug:this.debugMode})}))}backToMainMenu(){this.soundManager&&this.soundManager.playSoundEffect("button_click"),this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",(()=>{this.scene.start("MainMenu")}))}}class md extends s.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background")}preload(){const e=this.cameras.main.width,t=this.cameras.main.height;this.add.rectangle(e/2,t/2,400,30,6710886);const s=this.add.rectangle(e/2-200+5,t/2,10,20,16777215);this.add.text(e/2,t/2-50,"Loading...",{fontFamily:"Arial",fontSize:24,color:"#ffffff"}).setOrigin(.5),this.load.on("progress",(t=>{s.width=390*t,s.x=e/2-195+390*t/2})),this.load.image("logo","assets/images/logo.png"),this.load.image("background","assets/images/bg.png"),this.load.image("intro_card","assets/images/intro_card.png"),this.load.image("bullet","assets/sprites/BULLETS/bullet_7.png"),this.load.image("cash_pickup","assets/images/cash_pickup.png"),this.load.image("health_pickup","assets/images/health_pickup.png"),this.load.image("particle_texture","assets/images/star.png"),this.load.on("fileerror",((e,t)=>{console.error("Failed to load asset:",e,t),"particle_texture"===e&&(console.warn("Creating fallback texture for particle_texture"),this.createFallbackParticleTexture())})),this.load.atlas("player","assets/sprites/TESTPLAYER1.png","assets/sprites/TESTPLAYER1.json"),this.load.atlas("drone","assets/sprites/DRONE.png","assets/sprites/DRONE.json"),this.load.atlas("enemy1","assets/sprites/ENEMY1.png","assets/sprites/ENEMY1.json"),this.load.atlas("enemy2","assets/sprites/ENEMY2.png","assets/sprites/ENEMY2.json"),this.load.atlas("enemy3","assets/sprites/ENEMY3.png","assets/sprites/ENEMY3.json"),this.load.atlas("boss1","assets/sprites/BOSS1.png","assets/sprites/BOSS1.json"),this.load.image("down1","assets/sprites/PLAYER1/down1.png"),this.load.image("down2","assets/sprites/PLAYER1/down2.png"),this.load.image("down3","assets/sprites/PLAYER1/down3.png"),this.load.image("down4","assets/sprites/PLAYER1/down4.png"),this.load.image("up1","assets/sprites/PLAYER1/up1.png"),this.load.image("up2","assets/sprites/PLAYER1/up2.png"),this.load.image("up3","assets/sprites/PLAYER1/up3.png"),this.load.image("up4","assets/sprites/PLAYER1/up4.png"),this.load.image("left1","assets/sprites/PLAYER1/left1.png"),this.load.image("left2","assets/sprites/PLAYER1/left2.png"),this.load.image("left3","assets/sprites/PLAYER1/left3.png"),this.load.image("left4","assets/sprites/PLAYER1/left4.png"),this.load.image("right1","assets/sprites/PLAYER1/right1.png"),this.load.image("right2","assets/sprites/PLAYER1/right2.png"),this.load.image("right3","assets/sprites/PLAYER1/right3.png"),this.load.image("right4","assets/sprites/PLAYER1/right4.png"),this.load.atlas("testplayer","assets/sprites/testplayer.png","assets/sprites/testplayer.json"),this.loadMapAssets(),this.load.audio("shoot_weapon","assets/audio/sfx/laserShoot.wav"),this.load.audio("level_up","assets/audio/sfx/levelUp.wav"),this.load.audio("cash_pickup","assets/audio/sfx/pickupCash.wav"),this.load.audio("player_hit","assets/audio/sfx/hitHurt.wav"),this.load.audio("player_death","assets/audio/sfx/explosion1.wav"),this.load.audio("button_click","assets/audio/sfx/btnClick.mp3"),this.load.audio("shop_upgrade","assets/audio/sfx/shopUpgrade.wav"),this.load.audio("boss_alert","assets/audio/sfx/bossAlert.mp3"),this.load.audio("boss_defeat","assets/audio/sfx/bossDefeat.mp3"),this.load.audio("explosion","assets/audio/sfx/explosion1.wav");for(let i=1;i<=7;i++)this.load.audio(`waveEnd${i}`,`assets/audio/sfx/waveEnd/waveEnd${i}.mp3`);this.load.audio("ambient_music","assets/audio/ambient/ambient_loop.mp3"),this.load.audio("menu_music","assets/audio/music/mainMenu.mp3"),this.load.audio("shop_music","assets/audio/music/track1.mp3"),this.load.audio("action_music","assets/audio/music/actionTrack1.mp3")}createFallbackParticleTexture(){const e=this.make.graphics();e.fillStyle(16777215),e.fillCircle(8,8,8),e.generateTexture("particle_texture",16,16),e.destroy()}loadMapAssets(){this.load.image("level1","assets/maps/level1.png"),this.load.tilemapTiledJSON("map","assets/maps/level1.json"),this.load.image("tileset_x1","assets/maps/tileset x1.png"),this.load.image("props_and_items_x1","assets/maps/props and items x1.png"),this.load.tilemapTiledJSON("level1redux","assets/maps/Level1-REDUX.json",{customCollisionObjects:!0}),this.load.plugin("AnimatedTiles","https://cdn.rawgit.com/PhaserEditor2D/AnimatedTiles/master/dist/AnimatedTiles.js",!0),this.load.image("darkcavenet","assets/maps/darkcavenet.png"),this.load.tilemapTiledJSON("darkcavemap","assets/maps/darkcavenet.json")}create(){this.textures.exists("particle_texture")||this.createFallbackParticleTexture(),uu.emit("preloader-complete",this),this.scene.start("MainMenu")}}class gd extends i.Scene{constructor(){super("ShopMenu"),this.upgradeElements={weaponCards:[],playerButtons:[],statPanels:[]},this.shopOverlay=null,this.shopWidth=0,this.shopHeight=0,this.shopManager=null,this.gameScene=null,this.upgradeOptions=null}init(e){this.shopManager=e.shopManager,this.upgradeOptions=e.upgradeOptions,this.gameScene=e.gameScene,this.playerRef=e.player}preload(){}create(){const{width:e,height:t}=this.sys.game.canvas;this.shopWidth=.9*e,this.shopHeight=.8*t,this.createShopUI(this.upgradeOptions),this.events.once("shutdown",this.cleanup,this),this.setupEventListeners(),this.cleanupButtonSounds=wu.setupButtonSounds(this)}setupEventListeners(){uu.on("shop-item-purchased",this.handleItemPurchased,this),uu.on("shop-rerolled",this.handleReroll,this),uu.on("shop-purchase-failed",this.handlePurchaseFailed,this),uu.on("shop-reroll-failed",this.handleRerollFailed,this),uu.on("skill-points-updated",this.updateStatPanels,this)}createShopUI(e){const{width:t,height:s}=this.sys.game.canvas;this.shopOverlay=this.add.container().setScrollFactor(0).setDepth(150);const i=this.add.rectangle(0,0,t,s,0,.8).setOrigin(0).setScrollFactor(0).setDepth(150);this.shopOverlay.add(i);const a=this.add.container(t/2,s/2),n=this.add.rectangle(0,0,this.shopWidth,this.shopHeight,1118481,.9);n.setOrigin(.5),a.add(n),this.shopOverlay.add(a);const r=this.add.text(0,-this.shopHeight/2+30,"Shop",{fontFamily:"Arial",fontSize:"28px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5,.5);a.add(r);const o=.25*-this.shopHeight,l=o+200,h=.35*this.shopHeight;e&&(this.createWeaponUpgrades(a,e.weaponUpgrades,o),this.createPlayerUpgrades(a,e.playerUpgrades,o),this.createStatPanels(a,l),this.createBottomButtons(a,h)),this.tweens.add({targets:this.shopOverlay,alpha:{from:0,to:1},duration:300,ease:"Power2"}),this.updateStatPanels()}calculateUpgradeValue(e,t){var s;if(!e||!e.stats||!e.stats[t])return"";const i=e.stats[t],a=(null==(s=e.rarity)?void 0:s.multiplier)||1;switch(t){case"damage":case"bulletRange":case"bulletSpeed":if(i>1){const e=100*(i-1)*a;return`+${Math.round(e)}%`}return"";case"fireRate":let e;e=i<1?100*(1-i):(i-1)/i*100;const s=e*a;return`+${Math.round(s)}%`;case"bulletPierce":case"criticalChance":case"aoeRadius":case"aoeDamage":case"droneCount":const n=i*a;return"criticalChance"===t?`+${Math.round(n)}%`:"bulletPierce"===t?`+${Math.round(n)}`:"aoeDamage"===t?`${Math.round(100*n)}%`:"droneCount"===t?"+1":`${Math.round(n)}`;case"criticalDamageMultiplier":return`+${(i*a).toFixed(1)}x`;default:return""}}createWeaponUpgrades(e,t,s){this.upgradeElements.weaponCards=[];(t||[]).forEach(((t,i)=>{var a,n,r;const o=.3*-this.shopWidth+175*i,l=this.add.container(o,s);let h,c;switch(null==(a=t.rarity)?void 0:a.name){case"Legendary":h=3351040,c=16755200;break;case"Epic":h=2228275,c=11158783;break;case"Rare":h=4403,c=4491519;break;default:h=1127168,c=4500036}const u=this.add.rectangle(0,0,160,150,h,.6),d=this.add.rectangle(0,0,160,150);d.setStrokeStyle(2,c),u.setOrigin(.5),d.setOrigin(.5);const p=this.add.text(0,-55,t.name,{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5,.5);p.setShadow(1,1,"rgba(0,0,0,0.5)",2);const f=this.add.text(0,-25,`Category: ${t.category}`,{fontFamily:"Arial",fontSize:"13px",color:"#dddddd",fontStyle:"bold"}).setOrigin(.5,.5),m=(null==(n=t.rarity)?void 0:n.color)||"#ffffff",g=this.add.text(0,0,`Rarity: ${(null==(r=t.rarity)?void 0:r.name)||"Common"}`,{fontFamily:"Arial",fontSize:"13px",color:m,fontStyle:"bold"}).setOrigin(.5,.5);f.setShadow(1,1,"rgba(0,0,0,0.7)",2),g.setShadow(1,1,"rgba(0,0,0,0.7)",2);let y="",v="";switch(t.category){case"Damage":y="damage";break;case"Fire Rate":y="fireRate";break;case"Range":y="bulletRange";break;case"Pierce":y="bulletPierce";break;case"Area of Effect":y="aoeRadius";break;case"Critical":y=t.stats.criticalChance?"criticalChance":"criticalDamageMultiplier";break;case"Projectile":y="bulletSpeed";break;case"Drone":v=t.stats.droneCount?"+1 Combat Drone":"Combat Drone";break;default:v=t.effects}y&&t.stats[y]&&(v=`${this.calculateUpgradeValue(t,y)} ${t.category}`);const b=this.add.text(0,25,v,{fontFamily:"Arial",fontSize:"13px",color:"#88ff88",fontStyle:"bold"}).setOrigin(.5,.5);b.setShadow(1,1,"rgba(0,0,0,0.7)",2);const w=this.add.rectangle(0,55,100,26,0,.5);w.setStrokeStyle(1,16763972);const M=this.add.text(0,55,`Credits: ${t.price}`,{fontFamily:"Arial",fontSize:"14px",color:"#ffcc44",fontStyle:"bold"}).setOrigin(.5,.5);M.setShadow(0,0,"#ffcc44",3,!0,!0),l.add([u,d,p,f,g,b,w,M]),l.setSize(160,150),l.setInteractive({useHandCursor:!0}),l.on("pointerover",(()=>{d.setStrokeStyle(3,c),f.setColor("#ffffff"),g.setStyle({color:m,fontSize:"14px"})})),l.on("pointerout",(()=>{d.setStrokeStyle(2,c),f.setColor("#dddddd"),g.setStyle({color:m,fontSize:"13px"})})),l.on("pointerdown",(()=>{uu.emit("shop-upgrade-click",{volume:.6,detune:-100,rate:1.1});const e=this.upgradeElements.weaponCards.find((e=>e.upgrade.id===t.id));if(e&&e.purchased)return void this.showFloatingText(l.x,l.y,"Already purchased!","#88ff88");const s=this.playerRef;s&&s.credits<t.price?this.showFloatingText(l.x,l.y,"Not enough credits!","#ff5555"):this.tweens.add({targets:l,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:()=>{this.shopManager&&(this.shopManager.purchaseWeaponUpgrade(t),this.scene.isDev&&(t.name,t.price))}})})),e.add(l),this.upgradeElements.weaponCards.push({container:l,upgrade:t,purchased:!1})}))}createPlayerUpgrades(e,t,s){this.upgradeElements.playerButtons=[];const i=.3*this.shopWidth;(t||[]).forEach(((t,a)=>{var n;const r=s-55+55*a,o=this.add.container(i,r);let l,h;switch(null==(n=t.rarity)?void 0:n.name){case"Legendary":l=3351040,h=16755200;break;case"Epic":l=2228275,h=11158783;break;case"Rare":l=4403,h=4491519;break;default:l=1127168,h=4500036}const c=this.add.rectangle(0,0,200,40,l,.6),u=this.add.rectangle(0,0,200,40);u.setStrokeStyle(2,h),c.setOrigin(.5),u.setOrigin(.5);const d=this.add.text(-90,0,t.name,{fontFamily:"Arial",fontSize:"14px",color:"#ffffff",fontStyle:"bold"}).setOrigin(0,.5),p=this.add.text(90,0,`${t.skillPointCost} SP`,{fontFamily:"Arial",fontSize:"13px",color:"#44ccff",fontStyle:"bold"}).setOrigin(1,.5);o.add([c,u,d,p]),c.setInteractive({useHandCursor:!0});const f=this.add.container(-210,0).setVisible(!1);o.add(f);const m=this.add.rectangle(0,0,200,80,0,.8);m.setStrokeStyle(2,h),m.setOrigin(.5,.5),f.add(m);const g=this.add.text(0,0,t.description,{fontFamily:"Arial",fontSize:"13px",color:"#ffffff",wordWrap:{width:180},align:"center"}).setOrigin(.5,.5);f.add(g),c.on("pointerover",(()=>{u.setStrokeStyle(3,h),d.setColor("#ffffff"),d.setStyle({fontSize:"15px",fontStyle:"bold"}),f.setVisible(!0)})),c.on("pointerout",(()=>{u.setStrokeStyle(2,h),d.setColor("#dddddd"),d.setStyle({fontSize:"14px",fontStyle:"bold"}),f.setVisible(!1)})),c.on("pointerdown",(()=>{uu.emit("shop-upgrade-click",{volume:.6,detune:-100,rate:1.1});const e=this.upgradeElements.playerButtons.find((e=>e.upgrade.id===t.id));if(e&&e.purchased)return void this.showFloatingText(o.x,o.y,"Already purchased!","#88ff88");const s=this.playerRef;s&&s.skillPoints<t.skillPointCost?this.showFloatingText(o.x,o.y,"Not enough skill points!","#ff5555"):this.tweens.add({targets:o,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:()=>{this.shopManager&&(this.shopManager.purchasePlayerUpgrade(t),this.scene.isDev&&(t.name,t.skillPointCost))}})})),e.add(o),this.upgradeElements.playerButtons.push({container:o,upgrade:t,purchased:!1,tooltip:f})}))}createStatPanels(e,t){this.upgradeElements.statPanels=[];const s=220,i=185,a=t+-60,n=.3*-this.shopWidth-80+110,r=.3*this.shopWidth+100-110,o=this.add.graphics();o.fillStyle(2236962,.8),o.fillRoundedRect(n-110,a,s,i,8),o.lineStyle(2,11161423),o.strokeRoundedRect(n-110,a,s,i,8);const l=this.add.text(n,a+10,"WEAPON STATS",{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",fontStyle:"bold",backgroundColor:"#222222",padding:{x:3,y:3}}).setOrigin(.5,.5),h=this.add.text(n-110+20,a+30,"Loading weapon stats...",{fontFamily:"Arial",fontSize:"14px",color:"#ffffff",lineSpacing:6,padding:{x:2,y:2}}),c=this.add.graphics();c.fillStyle(2236962,.8),c.fillRoundedRect(r-110,a,s,i,8),c.lineStyle(2,4878245),c.strokeRoundedRect(r-110,a,s,i,8);const u=this.add.text(r,a+10,"PLAYER STATS",{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",fontStyle:"bold",backgroundColor:"#222222",padding:{x:3,y:3}}).setOrigin(.5,.5),d=this.add.text(r-110+20,a+30,"Loading player stats...",{fontFamily:"Arial",fontSize:"14px",color:"#ffffff",lineSpacing:6,padding:{x:2,y:2}});h.setShadow(1,1,"rgba(0,0,0,0.7)",2),d.setShadow(1,1,"rgba(0,0,0,0.7)",2),this.upgradeElements.statPanels.push({type:"weapon",graphics:o,title:l,statsText:h}),this.upgradeElements.statPanels.push({type:"player",graphics:c,title:u,statsText:d}),e.add([o,l,h,c,u,d])}createBottomButtons(e,t){var s;const i=this.add.container(-130,t),a=this.add.rectangle(0,0,180,36,2772266);a.setStrokeStyle(2,4500036);const n=this.shopManager?this.shopManager.upgradeManager.getRerollCost():0,r=this.shopManager?this.shopManager.upgradeManager.rerollCount:0,o=this.shopManager?this.shopManager.upgradeManager.maxRerollsPerRound-r:5,l=`${0===n?"Free Reroll":`Reroll ($${n})`} [${o}/${(null==(s=this.shopManager)?void 0:s.upgradeManager.maxRerollsPerRound)||5}]`,h=this.add.text(0,0,l,{fontFamily:"Arial",fontSize:"14px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5);i.add([a,h]),this.rerollButton={container:i,bg:a,text:h};const c=o<=0;c?(a.setFillStyle(5592405),h.setColor("#999999")):(a.setInteractive({useHandCursor:!0}),a.on("pointerover",(()=>{a.setFillStyle(3824954)})),a.on("pointerout",(()=>{a.setFillStyle(2772266)}))),c||a.on("pointerdown",(()=>{uu.emit("shop-upgrade-click",{volume:.6,detune:-100,rate:1.1}),this.tweens.add({targets:a,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:()=>{this.shopManager&&this.shopManager.handleReroll()}})}));const u=this.add.container(130,t),d=this.add.rectangle(0,0,150,36,2772266);d.setStrokeStyle(2,4500036);const p=this.add.text(0,0,"Start Next Wave",{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5);u.add([d,p]),d.setInteractive({useHandCursor:!0}),d.on("pointerover",(()=>{d.setFillStyle(3824954)})),d.on("pointerout",(()=>{d.setFillStyle(2772266)})),d.on("pointerdown",(()=>{uu.emit("button-click",{volume:.6,detune:-200,rate:1.2}),this.tweens.add({targets:d,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:()=>{this.closeShop()}})})),e.add(i),e.add(u),this.nextWaveButton={container:u,bg:d,text:p}}updateStatPanels(){var e,t,s,i,a,n,r,o,l,h,c,u;if(!this.upgradeElements.statPanels||0===this.upgradeElements.statPanels.length)return;const d=this.playerRef;if(!d)return;let p,f,m;if(d.scene&&d.scene.playerHealth?(p=d.scene.playerHealth.getCurrentHealth(),f=d.scene.playerHealth.getMaxHealth()):d.healthSystem?(p=d.healthSystem.getCurrentHealth(),f=d.healthSystem.getMaxHealth()):(p=d.health||100,f=d.maxHealth||100),d.scene&&d.scene.playerHealth){const e=d.scene.playerHealth.getDamageResistance();m=Math.round(100*e),this.scene.isDev}else if(d.healthSystem){const e=d.healthSystem.getDamageResistance();m=Math.round(100*e),this.scene.isDev}else m=Math.round(100*(d.defense||0));let g=0;void 0!==d.credits?g=d.credits:void 0!==(null==(t=null==(e=this.gameScene)?void 0:e.cashManager)?void 0:t.cash)?g=this.gameScene.cashManager.cash:void 0!==(null==(s=this.shopManager)?void 0:s.playerCredits)&&(g=this.shopManager.playerCredits);let y=1,v=0,b=100;(null==(i=this.gameScene)?void 0:i.xpManager)?(y=(null==(n=(a=this.gameScene.xpManager).getCurrentLevel)?void 0:n.call(a))||this.gameScene.xpManager.currentLevel||1,v=(null==(o=(r=this.gameScene.xpManager).getCurrentXP)?void 0:o.call(r))||this.gameScene.xpManager.currentXP||0,b=(null==(h=(l=this.gameScene.xpManager).getXPToNextLevel)?void 0:h.call(l))||this.gameScene.xpManager.nextLevelXP||100,this.scene.isDev&&(this.gameScene.xpManager.xpToNextLevel,null==(u=(c=this.gameScene.xpManager).getXPToNextLevel)||u.call(c),this.gameScene.xpManager.nextLevelXP)):void 0!==d.level&&(y=d.level,v=d.xp||0,b=d.nextLevelXP||100);const w=Math.round(d.speed||150);let M,x,S,C,E,k,T;if(d.weaponManager){const e=d.weaponManager.getStats();M=Math.round((null==e?void 0:e.damage)||d.bulletDamage||10),x=Math.round((null==e?void 0:e.fireRate)?1e3/e.fireRate:d.fireRate?1e3/d.fireRate:3),S=Math.round((null==e?void 0:e.range)||d.bulletRange||400),C=Math.round((null==e?void 0:e.speed)||d.bulletSpeed||600),E=Math.round((null==e?void 0:e.criticalChance)||d.criticalHitChance||5),k=((null==e?void 0:e.criticalDamage)||d.criticalDamageMultiplier||1.5).toFixed(1),T=(null==e?void 0:e.pierce)||d.bulletPierce||1}else M=Math.round(d.bulletDamage||10),x=Math.round(d.fireRate?1e3/d.fireRate:3),S=Math.round(d.bulletRange||400),C=Math.round(d.bulletSpeed||600),E=Math.round(d.criticalHitChance||5),k=(d.criticalDamageMultiplier||1.5).toFixed(1),T=d.bulletPierce||1;const P=void 0!==d.skillPoints?d.skillPoints:0,D=[`Health: ${Math.round(p)}/${Math.round(f)}`,`Speed: ${w}`,`Defense: ${m}%`,`XP Level: ${y}`,`XP Points: ${v}/${b}`,`Skill Points: ${P}`,`Cash: $${g}`].join("\n"),_=[`Damage: ${M}`,`Fire Rate: ${x}/sec`,`Range: ${S}`,`Bullet Speed: ${C}`,`Pierce: ${T}`,`Critical Hit: ${E}%`,`Critical Damage: ${k}x`].join("\n");this.upgradeElements.statPanels.forEach((e=>{"player"===e.type?e.statsText.setText(D):"weapon"===e.type&&e.statsText.setText(_)})),this.scene.isDev}handleItemPurchased(e){this.updateStatPanels();const{itemType:t,itemId:s}=e;"weapon"===t?this.upgradeElements.weaponCards.forEach((e=>{if(e.upgrade.id===s){e.purchased=!0,e.container.setAlpha(.6);const t=this.add.text(0,0,"Purchased",{fontFamily:"Arial",fontSize:"16px",fontStyle:"bold",color:"#88ff88",backgroundColor:"#000000",padding:{x:4,y:2}}).setOrigin(.5,.5);e.container.add(t)}})):"player"===t&&this.upgradeElements.playerButtons.forEach((e=>{if(e.upgrade.id===s){e.purchased=!0,e.container.setAlpha(.6);const t=this.add.text(-70,0,"",{fontFamily:"Arial",fontSize:"16px",color:"#88ff88"}).setOrigin(.5);e.container.add(t)}}))}handleReroll(e){var t;const{newUpgrades:s,newRerollCost:i,rerollsRemaining:a}=e;if(this.rerollButton&&void 0!==i){const e=`${0===i?"Free Reroll":`Reroll ($${i})`} [${a}/${(null==(t=this.shopManager)?void 0:t.upgradeManager.maxRerollsPerRound)||5}]`;this.rerollButton.text.setText(e),a<=0&&this.rerollButton.bg&&(this.rerollButton.bg.disableInteractive(),this.rerollButton.bg.setFillStyle(5592405),this.rerollButton.text.setColor("#999999"))}this.clearUpgradeElements();const n=this.shopOverlay.getAt(1);if(n){const e=.25*-this.shopHeight;this.createWeaponUpgrades(n,s.weaponUpgrades,e),this.createPlayerUpgrades(n,s.playerUpgrades,e),this.updateStatPanels(),this.tweens.add({targets:n,scaleX:{from:.95,to:1},scaleY:{from:.95,to:1},duration:200,ease:"Back.easeOut"})}}clearUpgradeElements(){this.upgradeElements.weaponCards.forEach((e=>{e.container&&e.container.active&&e.container.destroy()})),this.upgradeElements.weaponCards=[],this.upgradeElements.playerButtons.forEach((e=>{e.container&&e.container.active&&e.container.destroy()})),this.upgradeElements.playerButtons=[]}handlePurchaseFailed(e){const{reason:t}=e;let s="Purchase failed";"insufficient-funds"===t?s="Not enough credits!":"insufficient-skill-points"===t&&(s="Not enough skill points!");const i=this.add.text(0,-100,s,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setScrollFactor(0).setDepth(200);this.shopOverlay&&this.shopOverlay.add(i),this.tweens.add({targets:i,alpha:{from:1,to:0},y:"-=50",duration:1500,ease:"Power2",onComplete:()=>{i.destroy()}}),this.sound&&this.sound.add&&this.sound.play("shoot_weapon",{volume:.3,detune:1200})}handleRerollFailed(e){const{reason:t}=e;let s="Reroll failed";"insufficient-funds"===t?s="Not enough credits for reroll!":"reroll-limit-reached"===t&&(s="Maximum rerolls reached for this round!",this.rerollButton&&this.rerollButton.bg&&this.rerollButton.text&&(this.rerollButton.bg.disableInteractive(),this.rerollButton.bg.setFillStyle(5592405),this.rerollButton.text.setColor("#999999")));const i=this.add.text(0,0,s,{fontFamily:"Arial",fontSize:"24px",color:"#ff0000",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setScrollFactor(0).setDepth(200);this.rerollButton&&this.rerollButton.container&&(i.x=this.rerollButton.container.x,i.y=this.rerollButton.container.y-30),this.shopOverlay&&this.shopOverlay.add(i),this.tweens.add({targets:i,alpha:{from:1,to:0},y:"-=30",duration:1500,ease:"Power2",onComplete:()=>{i.destroy()}}),this.sound&&this.sound.add&&this.sound.play("shoot_weapon",{volume:.3,detune:1200})}closeShop(){this.shopManager&&this.shopManager.onNextWaveStart(),this.tweens.add({targets:this.shopOverlay,alpha:0,duration:300,ease:"Power2",onComplete:()=>{this.scene.stop("ShopMenu"),this.scene.resume("WaveGame")}})}cleanup(){uu.off("shop-item-purchased",this.handleItemPurchased),uu.off("shop-rerolled",this.handleReroll),uu.off("shop-purchase-failed",this.handlePurchaseFailed),uu.off("shop-reroll-failed",this.handleRerollFailed),uu.off("skill-points-updated",this.updateStatPanels),this.cleanupButtonSounds&&this.cleanupButtonSounds(),this.upgradeElements={weaponCards:[],playerButtons:[],statPanels:[]}}showFloatingText(e,t,s,i="#ffffff"){const a=this.shopOverlay.getAt(1);if(!a)return;const n=a.x+e,r=a.y+t,o=this.add.text(n,r-20,s,{fontFamily:"Arial",fontSize:"16px",color:i,fontStyle:"bold",stroke:"#000000",strokeThickness:3}).setOrigin(.5,.5).setDepth(200);this.shopOverlay.add(o),this.tweens.add({targets:o,y:r-50,alpha:0,duration:1e3,ease:"Power2",onComplete:()=>{o.destroy()}})}}const yd=Mu,vd={type:i.AUTO,width:1024,height:768,parent:"game-container",backgroundColor:"#028af8",fps:{target:60,forceSetTimeOut:!1,min:30,max:60,deltaHistory:10,panicMax:60},physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[cu,md,yd,fd,pd,gd,du]},bd=V.forwardRef((function(e,t){const s=V.useRef(),a="game-container";V.useLayoutEffect((()=>(void 0===s.current&&r(),o)),[t]),V.useEffect((()=>{l();const e=document.getElementById(a);return e&&e.addEventListener("contextmenu",n),()=>{h();const e=document.getElementById(a);e&&e.removeEventListener("contextmenu",n)}}),[t]);const n=e=>(e.preventDefault(),!1),r=()=>{var e;s.current=(e=a,new i.Game({...vd,parent:e})),null!==t&&(t.current={game:s.current,scene:null})},o=()=>{s.current&&(s.current.destroy(!0),s.current=void 0)},l=()=>{uu.on("current-scene-ready",c)},h=()=>{uu.removeListener("current-scene-ready")},c=e=>{t&&(t.current.scene=e)};return Q.jsx("div",{id:a})}));function wd(){const e=V.useRef();return V.useEffect((()=>{const e=e=>{e&&e.key};return uu.on("current-scene-ready",e),()=>{uu.off("current-scene-ready",e)}}),[]),Q.jsxs("div",{id:"app",children:[Q.jsx("div",{style:{position:"relative"},children:Q.jsx(bd,{ref:e})}),!1]})}bd.propTypes={children:hu.node},J.createRoot(document.getElementById("root")).render(Q.jsx(H.StrictMode,{children:Q.jsx(wd,{})}));
